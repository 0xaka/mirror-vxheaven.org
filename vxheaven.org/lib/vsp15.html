<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> SPTH 'The Secure Virus-Copy' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="SPTH"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, SPTH,Secure Virus-Copy, article, option, echo, words, inverted, command, write, important, virus, microsoft, software, user, code, registry, commands"/>
<meta name="Description" content="The title of this article sounds really strange and I'm sure, you can't think what I'll tell you now. Don't worry, you will get the point while reading this text. First I have to thank three persons, who's viruses or articles helped me to get this idea. First person is Benny, who wrote a great article called 'Some ideaz about future worms', which was released in 29a#6. In his article he mentioned that a worm 'should not be stored at any file on the disk'. The second important person, who's virus helped me to get the idea and bring the idea to reallity was Lys Kovick with his WinREG.AntiREG. Last but not least Q the Misanthrope's virus Bat.OneLine wsa very important for this article. To all these guys I have to send out a really great 'THANK YOU'! :D Well you still can't think about my idea, so I'll stopp writing this silly intro and start to come to the important parts..."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"eb215f237240b4d216b89435368de76f19f06bda-1498757107-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vsp15.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>The Secure Virus-Copy</h1><p><a href="/lib/?lang=en&amp;author=SPTH"> SPTH</a><br/> <em><a href="/vx.php?fid=1375#f1375">Ready Rangers Liberation Front [5]</a></em><br/> <em>May 2004</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vsp15.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp15">Back to index</a>] [<a href="/lib/vsp15.html#disqus_thread">Comments</a>]<br/> 
<h2>Index</h2>
<ol start="0">
<li>Intro Words</li>
<li>The Idea</li>
<li>Important marginal notes
<ol type="a">
<li>Inverted commas</li>
<li>'exit'-command</li>
<li><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="e6c1a683858e89">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>'-command</li>
<li>'%~a'-option</li>
<li>'>>'-option</li>
</ol></li>
<li>How to use it
<ol type="a">
<li>General Information</li>
<li>Where to store the code</li>
</ol></li>
<li>Last words</li>
</ol>
<h2>0) Intro Words</h2>
<p>The title of this article sounds really strange and I'm sure, you can't think what I'll tell you now. Don't worry, you will get the point while reading this text. First I have to thank three persons, who's viruses or articles helped me to get this idea. First person is Benny, who wrote a great article called '<a href="/lib/vbe06.html">Some ideaz about future worms</a>', which was released in 29a#6. In his article he mentioned that a worm 'should not be stored at any file on the disk'. The second important person, who's virus helped me to get the idea and bring the idea to reallity was Lys Kovick with his WinREG.AntiREG. Last but not least Q the Misanthrope's virus Bat.OneLine wsa very important for this article. To all these guys I have to send out a really great 'THANK YOU'! :D Well you still can't think about my idea, so I'll stopp writing this silly intro and start to come to the important parts...</p>
<h2>1) The Idea</h2>
<p>The idea is, as you should have already noticed, a copy of the virus, which can't be detected. Let's consider the scan of a Antivirus-Program. The program detects every virus, which is already in the virus-definition, in (most times) every file at the computer. Now: What would be, if the virus doesn't exist in any file at the computer??? It is not detected. You may think, "Damn, silly boy, how should the virus work?". The answere's name is Registy...</p>
<p>As you may know, you can run any program with the right extansion via the registry. That is the main point. You just have to store a copy of the virus/worm's code in registry (if it's script than it's easy, if it's a binary you have to debug it later on). Now let's think that the virus is in the registry, how we get it out from there? As I have already told you, you can run programs via registry... One of this programs you can run is called 'CMD.exe', the new Windows 2000 Command-Interpreter.</p>
<p>The think get's tricky now: As you may know, your CMD.exe has a command called 'for', we are going to use it now. Why? Well, it's doubtful that your virus just have one line, therefore we have to use one line (registry just allows one line of CMD.exe-code) bringing your virus-code to a new file. Maybe you didn't fully understand what I meant, therefore I'll show you an example now. This is the content of a new registy-key, which is stored in <tt>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</tt>:</p>
<div class="dos" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; &nbsp; &nbsp;cmd /c <a style="color: #000060;" href="http://www.ss64.com/nt/for.html"><span style="color: #00b100; font-weight: bold;">for</span></a> <span style="color: #33cc33;">%</span><span style="color: #448888;">a</span> <a style="color: #000060;" href="http://www.ss64.com/nt/in.html"><span style="color: #00b100; font-weight: bold;">in</span></a> <span style="color: #33cc33;">(</span>&quot;<span style="color: #33cc33;">@</span><a style="color: #000060;" href="http://www.ss64.com/nt/echo.html"><span style="color: #b1b100; font-weight: bold;">echo</span></a> off&quot; cls &quot;<a style="color: #000060;" href="http://www.ss64.com/nt/echo.html"><span style="color: #b1b100; font-weight: bold;">echo</span></a> Second Part To Hell was here...&quot; <a style="color: #000060;" href="http://www.ss64.com/nt/pause.html"><span style="color: #b1b100; font-weight: bold;">pause</span></a> <a style="color: #000060;" href="http://www.ss64.com/nt/exit.html"><span style="color: #00b100; font-weight: bold;">exit</span></a><span style="color: #33cc33;">)</span> <a style="color: #000060;" href="http://www.ss64.com/nt/do.html"><span style="color: #00b100; font-weight: bold;">do</span></a> <span style="color: #33cc33;">@</span><a style="color: #000060;" href="http://www.ss64.com/nt/echo.html"><span style="color: #b1b100; font-weight: bold;">echo</span></a> <span style="color: #33cc33;">%</span><span style="color: #448888;">~a</span><span style="color: #33cc33;">&gt;&gt;</span>C:\example.cmd<br/>
&nbsp;</div>
<p>Now guess the effects of this key! Every start-up of the computer it will generate a new file called C:\example.cmd with the code between the inverted commas. Cool we got a new file onto the computer... I'm sure that you know it: The code should be your virus code. :). Now let's say, a virus uses such a code. First run it installs the key with it's code. Some time later the user notices that something smells fishy and scanns trough the harddisk. It finds a few copies of the virus and delets it. Now the cool thing: It doesn't matter as the virus has it's code saved in the registry. And this code is ready to infect the computer again and again (and again...).</p>
<h2>2) Impotant marginal notes</h2>
<p>There are some stranges in that line, which you have to note, otherwise you will have hard problems getting the code working:</p>
<h3>a) Inverted commas</h3>
<p>You have to set the commands between inverted commands, if the line you want to write to a new file contains at least one blank space. Otherwise CMD.exe treat it as more commands with the side-effects, that it writes every part to a new line. If the command doesn't contain a blank space, you may not use inverted commas.</p>
<h3>b) 'exit'-command</h3>
<p>After writing all your code to a .CMD or .BAT file, you have to use an 'exit'-command, since you may write the whole code to the file every computer run. That's also the reason why you must not use lables or gotos.</p>
<h3>c) <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="e1c6a18482898e">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>'-command</h3>
<p>You have to use @echo to write strings to a file. If you would use just 'echo', you would also write the primary command to it (i.e.: <code>C:\Windows\System32>echo cls>>C:\example.cmd</code> AND <code>cls</code>).</p>
<h3>d) '%~a'-option</h3>
<p>If you have used a multi-part-command (which contains blanc space[s]), you have to use inverted commands, as I have already told you. Using the simple '%a'-option, you would also write that inverted commas to the code (which you don't want I think). To write the code without that inverted commas you have to use '%~a'. (Of course, you could also use another variable-letter).</p>
<h3>e) '>>'-option</h3>
<p>When you try to use '>' to write your code to a file, you won't have success as CMD.exe overwrites everything in the file (the lines you have already written) with the new one with the result that the file contains JUST the last line you wanted to write.</p>
<h2>3) How to use it</h2>
<h3>a) General Information</h3>
<p>I've already told you, how the technique works, but not how to use it. Well, here we are. First thing your virus should do when it's activ is to search the AutoStart-Directory, after that it should write the modified code (the code above with the new directory+filename) to the registry. That's all, easy - isn't it?! :)</p>
<h3>b) Where to store the code</h3>
<p>This is maybe the most important decision you have to make. Here are a few opportunities with it's pro and contra.</p>
<dl>
<dt>Standart-Registry-Run</dt><dd>For Example: <tt>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</tt>This is maybe the easiest and saved way to make sure that the virus will be started every computer-Run. But the problem is that even low- and and medium-knowlegde computer users know how to find a key here. That's a big problem...</dd>
<dt>Command Processor-AutoRun</dt><dd><tt>HKEY_LOCAL_MACHINE\Software\Microsoft\Command Processor\AutoRun</tt> <tt>HKEY_CURRENT_USER\Software\Microsoft\Command Processor\AutoRun</tt> The good thing is that nearly nobody knows about this key. The key forces the CMD.exe to run a command or a file before the real window opens. The code would run when the user opens a .CMD/.BAT file or open directly the CMD.exe. The problem is that a normal user don's use these things. :(</dd>
<dt>Hooking File-extansions</dt><dd>malfunction wrote an article about that and released it in 29a#6. He used that technique to run a virus/worm-file before an .EXE is executed. We can use the same technique modified. just put the code above instead of malfunction's filename, and it should work.</dd>
</dl>
<h2>4) Last words</h2>
<p>Here, at the end of my article, I really want to thank you for still being with me and reading this. I am really happy that I've finally finished this technique and this article, and I would be even happier if you could send me your opinion of this way to make a secure virus copy. I know that this article looks like it's just a technique for batch viruses, but it isn't! You can use it in every file-virus/worm for Windows. Just use the command 'debug', which is really easy. As you can imaging, I will write such a virus as soon as possible, and for showing you that it's possible, it will become a binary virus. :)...</p>
<p>Greets goes to everybody who knows me (I'm too lazy to write them all down again, you know who you are - just look at my homepage :D)... A special greets goes to my RainBow, ILD!</p>
<pre>
                                                        - - - - - - - - - - - - - - -
                                                          Second Part To Hell/[rRlf]  
                                                          www.spth.de.vu
                                                          <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="97e4e7e3ffd7e7e5fef2e4e3b9f4f8fa">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>
                                                          written from april-may 2004
                                                          Austria
                                                        - - - - - - - - - - - - - - - </pre>[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp15">Back to index</a>] [<a href="/lib/vsp15.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vsp15">de</a><a href="/lib/index.php?lang=en&amp;id=vsp15">en</a><a href="/lib/index.php?lang=es&amp;id=vsp15">es</a><a href="/lib/index.php?lang=it&amp;id=vsp15">it</a><a href="/lib/index.php?lang=fr&amp;id=vsp15">fr</a><a href="/lib/index.php?lang=pl&amp;id=vsp15">pl</a><a href="/lib/index.php?lang=ru&amp;id=vsp15">ru</a><a href="/lib/index.php?lang=ua&amp;id=vsp15">ua</a></div>
</body>
</html>
