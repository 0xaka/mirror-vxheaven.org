<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Sarah Gordon 'The worm has turned' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Sarah Gordon"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Gordon, Sarah,worm has turned, internet, bind, versions, file, network, news, hosts, address, password, vulnerability, worm, cert, computers, morris, machines"/>
<meta name="Description" content="Since then, worms have come and gone without much fuss. There have been some isolated outbreaks, but generally the machine population susceptible to each worm has been sufficiently small and diverse to diffuse the problem. However, the conditions have become increasingly favourable to the creation of a new, viable worm. Enter Admw0rm, a worm capable of spreading from one Linux to another, utilizing a hole in the Berkeley Internet Name Domain server, BIND."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"888abed758b2f7cffe6faebd1640689699dcf686-1498757612-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/asg18.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>The worm has turned</h1><p><a href="/lib/?lang=en&amp;author=Gordon%2C%20Sarah">Sarah Gordon</a><br/> <em>Virus Bulletin, August 1998, pp.10-12</em><br/> <em>ISSN 0956-9979</em><br/> <em>August 1998</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/asg18.html';</script><div class="ci"><a href="/lib/?ci=asg18">4</a></div>[<a style="" href="/lib/?lang=EN&amp;index=AN#asg18">Back to index</a>] [<a href="/lib/asg18.html#disqus_thread">Comments</a>]<br/> <form method="post" action=""><input type="hidden" name="pages" value="1"/><input type="submit" value="Turn on page numbers"/></form>
<address>
Sarah Gordon<br/>
IBM Research
</address>
<ul>
<li><a href="#c1">The Ties that Bind</a></li>
<li><a href="#c2">Packaged to Go</a></li>
<li><a href="#c3">The Body</a></li>
<li><a href="#c4">Replication</a></li>
<li><a href="#c5">The Good News</a></li>
<li><a href="#c6">The Bad News</a></li>
<li><a href="#c7">References</a></li>
</ul>
<p>One of the most interesting developments in computing over the last few years has been that of the now-ubiquitous Internet. Twenty five years ago, when the late John Brunner told a tale of a computer program which could crawl through an Internet-like network of computers, the Internet was largely the stuff of science fiction. <em><a href="/lib/mjb01.html">Shockwave Rider</a></em>[1] is now ‘required reading’ for any fledgling hacker, cyberpunk wannabe, or serious student of Internet history and culture.</p>
<p>By 1982, ARPANET (the beginnings of the Internet) was being implemented. Real experiments with worm programs for beneficial tasks were being conducted at the Xerox Palo Alto Research Center.[2] The concept of a tapeworm program crawling through networked systems outside the research labs saw a hint of reality when, in 1988, Robert Morris Jr brought parts of the infant Internet to, if not a grinding halt, a slow crawl. He lost control of one of his projects, known ever after as ‘The Morris Worm’ or ‘The Internet Worm’.</p>
<p>The main condition that prevented complete chaos as a by-product of that worm was the non-standardization of Internet-connected machines – the diversity of operating systems and architecture. While ten years ago the idea of one’s desktop machine participating in a worldwide network of computers was just beginning to take flight, today modern operating systems almost invariably possess some form of Internet connectivity. Another interesting trend has been an increase in the homogeneity of the global network. Whereas the Internet once consisted of many different flavours of machines loosely grouped together as ‘Unix’, the Net has grown in such a way that there are now large populations of very similar machines.</p>
<p>While this similarity allows easy creation of software that can be run on a large number of machines, it also allows the homogenization of some attack strategies. That there are so many ‘like-minded’ machines on the Internet allows an attacker to penetrate many machines using the same technique, attack, or program should he find a security hole.</p>
<p>The Morris Worm was designed to spread from machine to machine, utilizing security holes of which most hackers and many administrators were already aware. Due to the large number of machines that were vulnerable to the worm’s penetration technique, it was an overnight sensation. Estimates are that hundreds, or perhaps thousands of machines were compromised within hours of its release[3].</p>
<p>Since then, worms have come and gone without much fuss. There have been some isolated outbreaks, but generally the machine population susceptible to each worm has been
 
sufficiently small and diverse to diffuse the problem. However, the conditions have become increasingly favourable to the creation of a new, viable worm. Enter Admw0rm, a worm capable of spreading from one <em>Linux</em> to another, utilizing a hole in the Berkeley Internet Name Domain server, BIND.</p>
<h2><a name="c1"></a>The Ties that Bind</h2>
<p>BIND is an implementation of Domain Name Service (DNS), written primarily for Unix Systems. It consists of three parts – client, server and tools. BIND is integral to the Internet, but has had some glitches. There have been vulnerabilities that result in the saving of incorrect (sometimes maliciously selected) data by a remote name server (cache poisoning), giving the possibility of corrupt or compromised information; denial of service attacks; and problems resulting in remote crashing of systems.</p>
<p>While problems in BIND are found and fixed, unpatched versions of the package remain on many machines. It is this fact that makes the discovery of the Admw0rm so unsettling. This program demonstrates yet another BIND vulnerability/compromise. BIND 4.9 versions prior to 4.9.7 and versions 8 prior to 8.1.2 have a vulnerability which, if properly exploited, can result in an intruder gaining access to the computer. (The worm takes this one step further, and does this compromise/access automatically.)</p>
<p>These vulnerable versions of BIND do not carry out proper bounds checking when they respond to an inverse query request. The worm begins its attack by making precisely that request, which, if successful, results in the creation of an SUID (root) shell on the newly compromised machine.</p>
<h2><a name="c2"></a>Packaged to Go</h2>
<p>The version of Admw0rm that has been distributed widely amongst the ‘hacker’ community is designed to attack the popular <em>Linux</em> operating system. The worm comes in a tar archive, complete with a README and a copy of the CERT advisory alerting system administrators of the BIND vulnerability, as well as full source code. In fact, the worm package is comprised entirely of C and shell script – all binaries are built by the handy install script included.</p>
<p>The worm starts with the execution of an install script, called, creatively enough, ‘startup’, written in standard Unix Shell command language. It builds several binaries and creates a zipped tar file of them for later use. It then adds itself to the password file of the new machine, creating an account with no password, before launching the main worm script, Admw0rm.</p>
<p>As diddling with the password file requires root access (if not, your system is in so much trouble, this worm will be a drop in the ocean) most users will not be able to launch the worm. It would, however, be relatively easy to bypass this limitation; in many cases, it is also relatively easy to obtain root access on many systems, but that is another topic.</p>
<h2><a name="c3"></a>The Body</h2>
<p>The body of the Admw0rm, apparently the product of the ‘ADM Crew’ (claiming, somewhat optimistically, that the ‘THE CREW WILL NEVER DIE’), is also a simple shell script. This script calls in turn: the previously compiled binary GimmeRAND which creates a random IP address, each octet in the range 1 to 231; Incremental – a simple shell script which, when given a starting IP address, creates a list of IP addresses by incrementing the starting value; and Scanco – a binary which attempts to connect to a remote machine via UDP port 53, on which BIND is normally located.</p>
<p>The result of the preceding contortions is to create a loop, into which IP addresses of machines which appear to be running named [<em>‘name dee’ – the name server daemon. Ed.</em>] are passed. Inside this loop, a test is first made to see if the remote machine is vulnerable to attack. In order to do this, the worm executes another compiled binary which tests whether ‘named’ is running with ‘iquery’ enabled. If it is, the replication routine is called.</p>
<h2><a name="c4"></a>Replication</h2>
<p>When a vulnerable machine is found, the exploit executable is called. This utilizes the aforementioned named buffer overflow problem to perform the initial compromise, and then executes a string of shell commands. These commands create a new user called worm on the target machine, with a null password. Furthermore, /bin/sh (the usual location of the standard Unix shell) is copied to /tmp/.worm, and made SUID root. Finally, any restrictions upon those hosts which are allowed to connect to the machine are lifted by the deletion of the hosts.deny file located in /etc.</p>
<p>With this damage successfully carried out, the worm runs a utility that allows for remote submission of commands to a machine via telnet. This is called with instructions that cause the following operations to be attempted. The named daemon is restarted, as the previously used buffer overflow usually causes it to crash. A file /tmp/.X11x is created, which by default is an html page containing the text ‘The ADM Inet worm is here !’. A directory /tmp/.worm0r is then created. The worm checks if it is already installed on this machine by looking for the existence of the file /tmp./wormishere. If found, the worm deletes all files in /var/log (the default location of the system log files) and the file /tmp/.worm. If the worm is not already installed, it uses the ftp protocol to connect to the source machine, and copies the tgz file (created above) from it.</p>
<p>The tgz file is decompressed in the directory /tmp/.worm0r and the self-infection check file /tmp/wormishere is created. Admw0rm’s main body is executed as a background task while the IP address of the newly compromised machine is emailed using /bin/mail to a definable email address. Finally, all files named index.html are replaced with the same html page described above but there is a trivial error in this routine that prevents this operation from completing.</p>
 
<h2><a name="c5"></a>The Good News</h2>
<p>The good news is that although the Admw0rm is a viable worm for the <em>Linux</em> operating system, it contains a number of assumptions and limitations. The most obvious is that the exploit used to travel from machine to machine is only present in some versions of BIND, and even then, only if the inverse query feature is turned on – it is off by default. The vulnerable versions of BIND have been superseded by ones that are not open to this particular attack. However, as was seen during the time of the Morris Worm, the availability of a patch or upgrade does not necessarily correlate with its being installed on vulnerable systems. The worm also assumes that the source machine has both telnet and ftp services enabled. Although these services are often on by default, many machines do not have them.</p>
<p>These limitations are responsible for restricting potential damage by the worm. Had the problem been manifested in the default configuration of BIND, the situation would most likely have been worse. That said, some administrators are seriously concerned about the number of compromised systems and Admw0rm’s general availability. The fact that so many machines have been compromised using buffer overflow exploits should merit the attention of anyone responsible for the security of systems running BIND.</p>
<p>In fact, the CERT advisory in which this vulnerability and exploit was mentioned stated ‘The CERT Coordination Center has received reports of new kinds of intruder activity indicating that intruders are targeting machines running vulnerable versions of “named” (domain name server software that is part of BIND). Thousands of sites running unpatched, vulnerable versions of “named” are known to have been compromised through exploit methods discussed here and in CS-98.04.’</p>
<p>According to CERT [4] , you can tell if your version of BIND is vulnerable to this particular buffer overflow exploit. For BIND 8, if your fake iquery parameter is set to ‘yes’ (the usual file name where you will find this is /etc/named.conf), you are vulnerable. You should remove that option, or set it to ‘no’. For BIND 4.9, look for the line containing ‘Fake-iquery’ in the /etc/named.boot file. If it is there, you are vulnerable – remove it. Make sure that the line defining INVQ is commented out in your conf/options.h source; otherwise, inverse query support will be added at compile time. (If your nslookup is old, disabling inverse query support may cause it to fail. If this happens, replace nslookup with a more current version.)</p>
<p>These same vulnerable versions of BIND have other problems which are not fixed by the suggestions above. According to CERT [5], the best option is to upgrade to BIND 4.9.7 or BIND 8.1.2 as appropriate.</p>
<h2><a name="c6"></a>The Bad News</h2>
<p>The bad news is that this is just one of several which have been observed in varying stages of ‘development’. The original warning, issued on 28 May stated ‘While intruders appear to be using tools that exploit this vulnerability on Intel-based machines, it would not be difficult for intruders to adapt existing tools to exploit the vulnerability on other architectures.’.</p>
<p>In fact, we have observed ports of the worm to other operating systems, as well as learning recently of several variations on the general theme. Some of these worms are even capable of performing system trojanization [6], making their presence invisible to the casual user as well as the reasonably experienced administrator.</p>
<p>While I have gone to great lengths to explain why the Admw0rm is not the end of the Internet-As-We-Know-It, it represents a disturbing trend which some have been predicting for a long time. As the number of machines connected to the Internet increases and the software they run becomes more homogenized, the environment becomes less and less hostile to worms. Indeed, should any one platform and operating system (e.g. <em>Windows NT</em> running on an <em>Intel</em> processor) even approach the de facto standard, the conditions become downright favourable should a worm capable of penetrating such a system be developed.</p>
<p>The logic behind this is clear – for a worm to be ‘successful’ it must be able to spread to new hosts faster than its replicating segments are discovered and removed from compromised hosts. To obtain such a foothold requires a reasonable number of machines that can be compromised in a limited time. The simplest way is to take advantage of a huge system of homogeneous networked computers. If any one platform/OS combination began to dominate the network (a position we are rapidly approaching), this task becomes much easier for the prospective worm.</p>
<p>The conditions now are conducive to worm development. If you are not sure, look around. Have you seen any such homogeneous networked systems lately? Ask yourself ‘Am I ready to defend my system from such an attack? Would I even recognize it if it crawled into my network?’ In the case of Admw0rm, you can easily defend against an attack with the methods discussed here.</p>
<h2><a name="c7"></a>References</h2>
<ol>
<li>Brunner, John. <em><a href="/lib/mjb01.html">The Shockwave Rider</a></em>. Ballantine Del Rey 0-345-32431-5.</li>
<li><em><a href="/lib/ajm01.html">The Worm Programs – Early Experience with a Distributed Computation</a></em>. Communications of the ACM 25: 1982, pp.172-180.</li>
<li>Kephart, Jeffrey O. <em><a href="/lib/ajk04.html">A Biologically Inspired Immune System for Computers</a></em>. Artificial Life IV: Proceedings of the Fourth International Workshop on the Synthesis and Simulation of Living Systems, Rodney A. Brooks and Patty Maes, ed., MIT Press, Cambridge, MA., 1994, pp.130-139.</li>
<li>CERT Advisory CA-98.05 <em>Inverse Query Buffer Overrun in BIND 4.9 and BIND 8</em>.</li>
<li>CERT Advisory CA-98.05 <em>Denial-of-Service Vulnerabilities in BIND 4.9 and BIND 8</em>.</li>
<li>Gordon, Sarah and Chess, David. <em><a href="/lib/adc04.html">Where There’s Smoke, There’s Mirrors: Tracking Trojans on the Internet</a></em>. Proceedings of the Virus Bulletin Conference, 1998. [Pre-print.]</li>
</ol>
 
[<a style="" href="/lib/?lang=EN&amp;index=AN#asg18">Back to index</a>] [<a href="/lib/asg18.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=asg18">de</a><a href="/lib/index.php?lang=en&amp;id=asg18">en</a><a href="/lib/index.php?lang=es&amp;id=asg18">es</a><a href="/lib/index.php?lang=it&amp;id=asg18">it</a><a href="/lib/index.php?lang=fr&amp;id=asg18">fr</a><a href="/lib/index.php?lang=pl&amp;id=asg18">pl</a><a href="/lib/index.php?lang=ru&amp;id=asg18">ru</a><a href="/lib/index.php?lang=ua&amp;id=asg18">ua</a></div>
</body>
</html>
