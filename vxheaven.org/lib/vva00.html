<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> ValleZ 'Genetic programming in virus' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="ValleZ"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, ValleZ,Genetic programming in virus, payload, block, changedir, infector, virus, program, outline, programs, functions, infected, viruses, progenitors, crossing, element, thought"/>
<meta name="Description" content="I wanna comment here some ideas i have had. They are only ideas...these ideas seems very beautiful however this seems fiction more than reality."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"97f46bf052e7264441479d8c5b1ccd9e1d7d4a78-1498756339-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vva00.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Genetic programming in virus</h1><p><a href="/lib/?lang=en&amp;author=ValleZ"> ValleZ</a><br/> <em><a href="/vx.php?fid=1224#f1224">29a [7]</a></em><br/> <em>February 2004</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vva00.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=AI#vva00">Back to index</a>] [<a href="/lib/vva00.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li><a href="#c1">Evolutionary Systems</a></li>
<li><a href="#c2">Genetic Programming</a></li>
<li><a href="#c3">Virus</a></li>
<li><a href="#c4">Mutation in virus</a></li>
<li><a href="#c5">Crossing in virus</a></li>
<li><a href="#c6">Problems</a></li>
<li><a href="#c7">Outline</a></li>
<li><a href="#c8">Outline of a block</a></li>
<li><a href="#c9">Kernel32 "Inventing a new teq"</a></li>
</ul>
<p>I wanna comment here some ideas i have had. They are only ideas...these ideas seems very beautiful however this seems fiction more than reality.</p>
<h2><a name="c1"></a>Evolutionary Systems</h2>
<p>We can find in the nature some biological systems that can response to a stimulus, learn from enviroment and training,... however we can find in the nature systems that improve their capabilities with evolution of specie.</p>
<p>Evolution works in this manner: descendants are generated from their progenitors. Descendants are similar to their progenitors, however they have some modifications. Using a natural selection process only descendants that was addapted better to environment survive. They will have more descendants and again it will be used a natural selection process.</p>
<p>With these characteristics (natural selection and progenitors generating more descendants) is anough to generate descendants more poweful with generations. We can see a analogy to understand this fact better:</p>
<p>We have a environment with valleys, mountains and plains. We have some individuals. A individual is more powerful than others if he is over a location with more high than others individual's locations. Descendants will be generated using characteristics of two individuals, their progenitors. Descendant's location will be in the middle of the line that links both progenitors's locations. If this middle point has more high than progenitors's locations we have a descendant more poweful than progenitors. A selection process will eliminate individuals with less high. With evolution, we will have individuals placed in higher locations. This method could be used to find summits for example.</p>
<h2><a name="c2"></a>Genetic Programming</h2>
<p>Genetic programming is based in these terms. We have a set of operations(elements of code considered as a unit). With these operations we have a first generation of programs. We use a selection process to select programs that adapts better. We search that programs that solve our problem more nearly posible. For evaluating a program we execute it over a set of training inputs, and we see results, and we see what program is nearer to the best solution. Then, we eliminate the worse programs. With that programs that survived, we generate a new generation of programs with two process, mutation and crossing. With mutation we generates descendants from a progenitor, changing a piece of code by other piece of the set of operations. Crossing is more effective. With crossing we generates descendants crossing two progenitors: we select randomly a operation of a progenitor and we change it by other randomly selected operation of the other progenitor. Usually, its used crossing more frequently and sometimes is used mutation, less frenquently, both combined.</p>
<p>Well, you can search a lot of articles about genetic programming in internet. I have commented a few what is this for now speaking how genetic programming could be used in the virus world.</p>
<h2><a name="c3"></a>Virus</h2>
<p>Since i read something about genetic programming i have been thinking how it could be used in the virus programming. Virus has some similaritys with genetic programming. When a virus infects a file it is generating a descendant. However, descendant is identical to progenitor. Yes, a polimorphic or metamorphic virus is different to progenitor, however it works in the same manner of its progenitor.</p>
<p>To use genetic programming in virus world we must see a virus as a set of operations. This operations arent xor, call, jmp... Im refering to more high level operations. For example, we could have a operational element that changes current directory or other element that infects .exe files or .hlp or others. A worm element. A payload element,....</p>
<p>These elements of code must works by itself, in any direction of memory. A program will be composed by these elements. We could name these elements blocks. I think this blocks could be similar to pieces of code defined in siilex article in 29a #6. Pieces of code that could be chained to do a complete program.</p>
<p>For example, we have a block with ability of changing current directory. We have too a block that infects .exe files with itself and others blocks in its current infected file. And too, we have a block with antidebbuging trickz and a block with a payload. We will generate randomly programs with 6 blocks. We could have a lot of posibilities:</p>
<ol>
<li>ChangeDir-Infector-ChangeDir-ChangeDir-Infector-Payload</li>
<li>Antidebug-ChangeDir-Infector-ChangeDir-Infector-Payload</li>
<li>...</li>
<li type="a" value="n">Antidebug-Antidebug-ChangeDir-ChangeDir-Payload-ChangeDir</li>
</ol>
<p>Well, with these blocks we have generate n programs. If we see previous showed programs, its easy to say that 2 program will be more effective than 1 and n. If these three programs are in the wild, second program will be more time in the wild. In fact, n program will not infect others programs. n "will die" first, and 2º will survive more time.</p>
<p>I said viruses have some similaritys with genetic programming. In the virus world, does it exist some selection process? Of course. However, this process is not a evaluation function or similar. A virus must, literally, survive. In virus world, antivirus, intelligent users,... are the selection process. Before, i said that obviously 2 program was better than 1 and n. A vxer writes virus with polimorphing, EPO, perprocess, ... becoz he want his virus survive so time as possible.</p>
<p>We have now two similaritys of virus programming and genetic programming. Virus generates descendants and only best programs survive.</p>
<h2><a name="c4"></a>Mutation in virus</h2>
<p>Im not referring to polimorphing or metamorphing. Again, we have a set of operational blocks. We generate randomly a set of generation 0 programs and we take one:</p>
<p>gen0-> ChangeDir-ChangeDir-Infector-Payload-Infector-Payload-ChangeDir-Payload</p>
<p>We could program a infector block with ability of mutating current code. It could change a block by other or change order of blocks. For example, this infector-mutator block infects a file changing order of two blocks:</p>
<p>gen1-> ChangeDir-Infector-ChangeDir-Payload-Infector-Payload-ChangeDir-Payload</p>
<p>In gen1 virus has gain level becouse now it infects two directorys in one execution. Now, virus of gen1 infects other file but in this time it change a block by other.</p>
<p>gen2-> ChangeDir-Infector-ChangeDir-Antidebug-Infector-Payload-ChangeDir-Payload</p>
<p>Of course, virus could infects a file with a bad combination of blocks:</p>
<p>other gen2-> ChangeDir-Payload-ChangeDir-Payload-Infector-Payload-ChangeDir-Payload</p>
<p>This other virus of gen2 will have less probability of surviving.</p>
<p>Note mutation must not occur always virus infects a file becouse if we have a good individual and always it infects it change its code, it will lose level. Virus must infect with mutation sometimes only.</p>
<h2><a name="c5"></a>Crossing in virus</h2>
<p>I think this could be very interesting, however it could be very umprobable of occuring too. I was thinking a lot of about how could occur crossing here. For crossing, we need two progenitors, however we cannot have a list of all infected files. In addition, virus's descendants will infects others files, and others and others and its impossible to know what files are infected. I think crossing must occur when a virus try to infect a already infected file. If a virus detects it's trying to infect a infected file, it will not infect it, however it could "learn" a block (randomly) from infected file and keep it to use it in next infection. In this manner, in the next generation, infected file will be a descendants from two progenitors.</p>
<p>In addition if a vxer in Jamaica and other vxer in Holland write two different virus but with a standart for recognizing blocks when the virus from Jamaica found a infected file with the virus from Holland it will learn blocks from virus from Holland. If a lot of vxers write their viruses with a standart, these viruses will learn from other viruses and more poweful viruses will survive becoz they will have the best blocks of all viruses. I think this could seem difficult and umprobable of occuring...it seems for a film than for real life, however i think its not a bad idea :-m</p>
<h2><a name="c6"></a>Problems</h2>
<p>Of course, for this propose it's necessary a standart that will define blocks formats, identifiers, infection modes, etc... If i write a virus waiting it will find other virus for exchanging blocks, my virus must be able to recognize blocks from others virus. You will be thinking that if my virus can recognize a block from other viruses, antivirus heuristic can do it too. Yes :(</p>
<p>In addition, antivirus software could create software oriented to detect blocks instead entire virus.</p>
<p>For example, we suppose a group of vxers use this method. They decide all virus that they will create will use a common mark infection (For example they could set a field of header to a value). With this mark all virus created could recognize a infected file (infected by them or by other virus of the same "group") and then it could scan infected file searching blocks to learn. However in the moment that a av knew that mark of infection is the mark used by this group of programmers, then all virus created by these programmers will be easily detected.</p>
<h2><a name="c7"></a>Outline</h2>
<p>I wrote a outline about how could be used this teory about genetic virus. This is only a outline, an example that would have to be modified with a lot of changes for it works well.</p>
<h2><a name="c8"></a>Outline of a block</h2>
<p>A block is a functional element that can be executed in any offset, indepentdently of any code out of block. A block uses functions implemented in its code and variables there too. In the other hand, a block would have to be able to be identified. It's not necessary to know exactly what block is it, however it's necessary to know it's a block and it can be used by other genetic virus.</p>
<p>Blocks could have not variable size or we could put a field of the block for keeping size of the block. I prefer second option.</p>
<p>I think blocks's format must be more simple as possible. A block must not have a big header with a lot of characteristics of the block.</p>
<p>A example of that i think must be a block is this:</p>
<pre>
 -----------------
+  N byte of      +
+ initial code    +
 -----------------
+ 4 bytes for     +
+ size of code(X) +
 -----------------
+ X bytes of code +
+ of the block    +
 -----------------
</pre>
<p>N is a constant value for all blocks. In that code could be a small decryptor for the block or simply a jump to the code of that block.</p>
<p>We could have problems becoz some blocks (for example a block that changes current directory) will do changes that later these changes must be undo. In addition we have not thought how virus will return to host. I thought some ideas for this. Structure of all blocks in a complete virus could be in this manner:</p>
<pre>
dd N_BCKs    (before all blocks there is a dd indication the total number of blocks)
---------
 BLOCK 1     (later, it will be the blocks)
---------
 BLOCK 2
---------
  ...
  ...
  ...
---------
 BLOCK n
---------
jmp host     (and finally a jump to the host)
---------
</pre>
<p>When an infector block infects a file with current blocks of its virus it must put after all blocks a jump to the host. Ok, this is typical in all virus. However this jump has a important role. This jump will be used by block to undo all changes they did. Initially, before virus runs, that jmp point to host entry point. When a block needs undo changes, it change that jmp for pointing to a part of its code where it will undo changes. It will keep last direction where jmp jumped and when it undo changes it will jump to that direction. It hooks that jmp. This method will be used by all blocks that need use it. If a block hooks the jmp and later other block hooks the jmp again, it occurs in this manner:</p>
<p>Block1 hooks jmp:</p>
<pre>
-------------
  BLOCK 1
 undo code1: &lt;---------
                       |
    ...		       |	
 jmp HOST EP           |
-------------          |
                       |
others blocks          |
                       |
-------------          |
jmp undo code1 --------
-------------
</pre>
<p>Blockn hooks jmp later BLOCK1 had hooked jmp:</p>
<pre>
-------------
  BLOCK 1
 undo code1: &lt;--------------
                            |
    ...			    |	
 jmp HOST EP                |
-------------               |
                       	    |
others blocks               |
                            |
-------------               |
                            |
  BLOCK N                   |
                            |
 undo codeN: &lt;---------     |
                       |    |
    ...       	       |    |	
 jmp undo code1 -------|----
-------------          |
                       |
others blocks          |
                       |
-------------          |
jmp undo codeN --------
-------------
</pre>
<p>In this manner all blocks will undo changes and first block that had hooked jmp will jump to host entry point after all blocks had undo their changes.</p>
<hr size="1"/>
<p>Well...after i had writed my article about genetic virus Kernel32 gave me this other doc that he wrote. He hadnt seen my article and i was wonderful coz he thought very similar things to that i wrote. I thought it was not fair that i sent my article for 29a when he had thought very similar things than me so i send too this coz i think it's right.</p>
<blockquote>
<h2><a name="c9"></a>INVENTING A NEW TEQ</h2>
<p>[KERNEL32]</p>
<p>Ever thought about virii as Humans? like virii, we all are living beings, right? We all have our own DNA signature. So does virii.</p>
<p>I'll explain the idea,</p>
<p>THe "male" virus should be the one who gives the full signature:</p>
<ul>
<li>of a payload</li>
<li>of certain Polyengine used by him</li>
<li>of different functions</li>
<li>etc</li>
</ul>
<p>The "Female" virus should be the one wo recieves the DNAcode and add it to her code or replace her code with it. One could always write a "DoubleSex" virus that recieves DNA and supplies it.</p>
<p>THe male should work like this:</p>
<pre>
	Male
	
	-------------------------
	-			-
	-   Main virus program	-	
	-------------------------
	-   Marker 		-
	-------------------------
	-   Functions		-
	-------------------------
	
	Female
	
	-------------------------
	-			-
	-   Main virus program	-	
	-------------------------
	-   Functions		-
	-------------------------
</pre>
<p>First things first, the marker is very importend, it should contain the following:</p>
<ul>
<li>what type of files it infects (exe, dll, ocx, etc)</li>
<li>what type of virus/worm it is (tsr, findfile, etc)</li>
</ul>
<p>Basicly all the info that the female need to check if she will be compatible with the male. You let the female take the functions that is not compatible with her, or she will crash. The functions, should have alot of stuff like, Payloads, Anti-Debugging, random number generators, etc.</p>
<p>The female should look for at the marker and check if she is compatible with the male, and if so then she should decide what functions she will choose to add to herself. simple hey, not quite. The male should supply how long the functions are too and where the start/end of the function is.</p>
</blockquote>
[<a style="" href="/lib/?lang=EN&amp;index=AI#vva00">Back to index</a>] [<a href="/lib/vva00.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vva00">de</a><a href="/lib/index.php?lang=en&amp;id=vva00">en</a><a href="/lib/index.php?lang=es&amp;id=vva00">es</a><a href="/lib/index.php?lang=it&amp;id=vva00">it</a><a href="/lib/index.php?lang=fr&amp;id=vva00">fr</a><a href="/lib/index.php?lang=pl&amp;id=vva00">pl</a><a href="/lib/index.php?lang=ru&amp;id=vva00">ru</a><a href="/lib/index.php?lang=ua&amp;id=vva00">ua</a></div>
</body>
</html>
