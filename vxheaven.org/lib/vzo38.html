<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Z0mbie 'Общие рекомендации по написанию движков' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Z0mbie"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Z0mbie,Общие рекомендации по написанию движков, dword, engine, user, push, killer, virus, data, функции, call, include, byte, callw, данных, range, void"/>
<meta name="Description" content="Этот текст был написан с единственно одной целью: обозначить признаки, которыми, на мой взгляд, должен обладать удобный движок."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"be078cb081501ebab2b532e6a023f9a25412858c-1498757896-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vzo38.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Общие рекомендации по написанию движков</h1><p><a href="/lib/?lang=ru&amp;author=Z0mbie"> Z0mbie</a><br/> <em> 2000</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vzo38.html';</script>[<a style="" href="/lib/?lang=RU&amp;index=VT#vzo38">Вернуться к списку</a>] [<a href="/lib/vzo38.html#disqus_thread">Комментарии</a>]<br/> 
<p><em>версия 2.00</em></p>
<dl>
<dt>движок (engine)</dt>
<dd>некоторый модуль используемый в вирусах. (представленный в бинарной форме и/или в сорцах любого языка)</dd>
</dl>
<h2>Введение</h2>
<p>Этот текст был написан с единственно одной целью: обозначить признаки, которыми, на мой взгляд, должен обладать удобный движок.</p>
<p>Надо сказать, что подобное желание возникло уже после того, как я прочувствовал все плюсы использования готовых компонент для создания вирусов. Были созданы движки LDE32, KME32, ETG, CMIX, DSCRIPT, EXPO, RPME, CODEGEN, PRCG, MACHO и MISTFALL, обладающие почти всеми свойствами, описанными в этом тексте. Однако даже и тех небольших преимуществ от попытки эти движки стандартизировать было достаточно чтобы понять всю важность приведения движков к некоторому "стандартному" виду. Следует сразу заметить: подобная "стандартизация" влияет скорее на алгоритм и внешний вид, чем на код, и ни коим образом не может послужить упрощению работы антивирусов.</p>
<h2>Код</h2>
<ul>
<li>Движок должен содержать только исполняемый код. Таким образом движок не должен содержать никаких данных в явном виде. (достигается генерацией данных кодом, <em>см. "<a href="/lib/vzo39.html">О кодировании данных в пермутирующих вирусах</a>"</em>)</li>
<li>Движок не должен содержать никаких абсолютных смещений. Для этого можно создать некую структуру общих вирусных данных в стэке и передавать поинтер на эту структуру.</li>
<li>Движок не должен непосредственно использовать никаких внешних данных и не должен непосредственно вызывать никаких внешних процедур. (достигается передачей движку указателей на данные/код)</li>
<li>Движок не должен содержать никаких непосредственных системных вызовов. Хотите работать в движке с файлами? - пишите свои процедуры работы с файлами, так, как это удобнее в конкретном вирусе, передаете на них указатели и движок становится универсальным.</li>
</ul>
<h2>PUBLIC-функции</h2>
<ul>
<li>Параметры каждой функции должны передаваться только на стэке.</li>
<li>Каждая функция должна сохранять и восстанавливать все регистры.</li>
<li>При выходе из функции флаг DF должен быть сброшен в 0. (CLD)</li>
<li>Результат (если он нужен) должен возвращаться в регистре EAX.</li>
</ul>
<h2>Исходники</h2>
<ul>
<li>Если движок поставляется в исходниках, то переменные, аргументы, константы, внутренние процедуры и все прочие имена и метки должны быть уникальными, то есть такими, чтобы они не встретились в чьем-нибудь еще движке или в вашем же другом движке. (тут частично помогают локальные метки)</li>
<li>Если при передаче данных между движком и вызывающим кодом используются данные, то все они должны быть описаны в отдельном .INC файле</li>
</ul>
<h2>Документация</h2>
<p>движку должна прилагаться документация, в которой будет указано:</p>
<ul>
<li>описание движка;</li>
<li>описание PUBLIC-процедур и их параметров;</li>
<li>описание замеченных глюков (т.е. фич);</li>
<li>где движок тестировался, то есть когда он точно работает, когда не работает, а когда хз;</li>
</ul>
<h2>Желательно</h2>
<ul>
<li>Чтобы в движке существовала одна (и только одна) PUBLIC-функция, которая бы шла <em>в начале</em> исполняемого кода (хотите в середине - вставьте в начало <code>JMP</code>), и чтобы написана она была в стиле cdecl (<code>RET</code> с последующим <code>ADD ESP, xx</code>) или pascal-функции (выход по <code>RET nnnn</code>).</li>
<li>Чтобы алгоритм и код движка использовали в качестве данных только свой стэк и были написаны с учетом мультитреадности.</li>
<li>Чтобы движок был написан инструкциями real 386, то есть чтобы отсутствовали привилегированные инструкции/регистры и все 486+ инструкции вообще.</li>
</ul>
<h2>Что в результате</h2>
<p>С использованием всех вышеперечисленных ограничений и фич, получаем код движка: независимый ни от кольца защиты, ни от операционки, ни от смещения по которому он находится. Такой код легко подвергается пермутации. Код или исходники такого движка легко могут быть подключены к другим движкам, вирусам, генераторам вирусов или вирусным конструкторам.</p>
<p>Более того, решается просто глобальная задача связи asm- и cpp- кода, без использования obj-ей.</p>
<h2>Пример оформления движка</h2>
<p>Движок: KILLER. Задача: произвести зависание с вероятностью 1/1000.</p>
<p>Исходник:</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">;----[begin KILLER.ASM]--------------------------------------------------</span><br/>
engine &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;proc &nbsp; &nbsp;c<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; arg &nbsp; &nbsp; user_param &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; user-data</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; arg &nbsp; &nbsp; user_random &nbsp; &nbsp; <span style="color: black; font-style: italic;">; external randomer</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; arg &nbsp; &nbsp; arg1<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; arg &nbsp; &nbsp; arg2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; other parameters</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; arg &nbsp; &nbsp; arg3<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">pusha</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">cld</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">;;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #ff0000;">1000</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;user_param<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span> &nbsp; &nbsp;user_random<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">add</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">esp</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">8</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">;;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">cmp</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">eax</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">666</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">je</span> &nbsp; &nbsp; &nbsp;<span style="color: #0000ff; font-weight: bold;">$</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">;;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">popa</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">ret</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; endp<br/>
<span style="color: black; font-style: italic;">;----[end KILLER.ASM]----------------------------------------------------</span><br/>
&nbsp;</div>
<p>Полученный в результате инклюдник на ASM:</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">;----[begin KILLER.INC]--------------------------------------------------</span><br/>
<span style="color: black; font-style: italic;">; KILLER 1.00 engine</span><br/>
<span style="color: #0000ff; font-weight: bold;">db</span> <span style="color: #ff0000;">0C8h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">000h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">000h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">000h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">060h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0FCh</span><span style="color: #339933;">,</span><span style="color: #ff0000;">068h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0E8h</span><br/>
<span style="color: #0000ff; font-weight: bold;">db</span> <span style="color: #ff0000;">003h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">000h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">000h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0FFh</span><span style="color: #339933;">,</span><span style="color: #ff0000;">075h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">008h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0FFh</span><span style="color: #339933;">,</span><span style="color: #ff0000;">055h</span><br/>
<span style="color: #0000ff; font-weight: bold;">db</span> <span style="color: #ff0000;">00Ch</span><span style="color: #339933;">,</span><span style="color: #ff0000;">083h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0C4h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">008h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">03Dh</span><span style="color: #339933;">,</span><span style="color: #ff0000;">09Ah</span><span style="color: #339933;">,</span><span style="color: #ff0000;">002h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">000h</span><br/>
<span style="color: #0000ff; font-weight: bold;">db</span> <span style="color: #ff0000;">000h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">074h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0FEh</span><span style="color: #339933;">,</span><span style="color: #ff0000;">061h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0C9h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0C3h</span><br/>
<span style="color: black; font-style: italic;">;----[end KILLER.INC]----------------------------------------------------</span><br/>
&nbsp;</div>
<p>Тот же самый инклюдник на C/C++:</p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">//----[begin KILLER.CPP]--------------------------------------------------</span><br/>
<span style="color: black; font-style: italic;">// KILLER 1.00 engine</span><br/>
BYTE killer_bin<span style="color: black;">&#91;</span><span style="color: #0000dd;">30</span><span style="color: black;">&#93;</span> <span style="color: #339933;">=</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #208080;">0xC8</span><span style="color: #339933;">,</span><span style="color: #208080;">0x00</span><span style="color: #339933;">,</span><span style="color: #208080;">0x00</span><span style="color: #339933;">,</span><span style="color: #208080;">0x00</span><span style="color: #339933;">,</span><span style="color: #208080;">0x60</span><span style="color: #339933;">,</span><span style="color: #208080;">0xFC</span><span style="color: #339933;">,</span><span style="color: #208080;">0x68</span><span style="color: #339933;">,</span><span style="color: #208080;">0xE8</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #208080;">0x03</span><span style="color: #339933;">,</span><span style="color: #208080;">0x00</span><span style="color: #339933;">,</span><span style="color: #208080;">0x00</span><span style="color: #339933;">,</span><span style="color: #208080;">0xFF</span><span style="color: #339933;">,</span><span style="color: #208080;">0x75</span><span style="color: #339933;">,</span><span style="color: #208080;">0x08</span><span style="color: #339933;">,</span><span style="color: #208080;">0xFF</span><span style="color: #339933;">,</span><span style="color: #208080;">0x55</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #208080;">0x0C</span><span style="color: #339933;">,</span><span style="color: #208080;">0x83</span><span style="color: #339933;">,</span><span style="color: #208080;">0xC4</span><span style="color: #339933;">,</span><span style="color: #208080;">0x08</span><span style="color: #339933;">,</span><span style="color: #208080;">0x3D</span><span style="color: #339933;">,</span><span style="color: #208080;">0x9A</span><span style="color: #339933;">,</span><span style="color: #208080;">0x02</span><span style="color: #339933;">,</span><span style="color: #208080;">0x00</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #208080;">0x00</span><span style="color: #339933;">,</span><span style="color: #208080;">0x74</span><span style="color: #339933;">,</span><span style="color: #208080;">0xFE</span><span style="color: #339933;">,</span><span style="color: #208080;">0x61</span><span style="color: #339933;">,</span><span style="color: #208080;">0xC9</span><span style="color: #339933;">,</span><span style="color: #208080;">0xC3</span><br/>
<span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
<span style="color: black; font-style: italic;">//----[end KILLER.CPP]----------------------------------------------------</span><br/>
&nbsp;</div>
<p>Инклюдник/хеадер на ASM:</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">;----[begin KILLER.ASH]--------------------------------------------------</span><br/>
<span style="color: black; font-style: italic;">; KILLER 1.00 engine</span><br/>
KILLER_VERSION &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff; font-weight: bold;">equ</span> &nbsp; &nbsp; <span style="color: #ff0000;">0100h</span><br/>
<span style="color: black; font-style: italic;">;----[end KILLER.ASH]----------------------------------------------------</span><br/>
&nbsp;</div>
<p>Инклюдник/хеадер на C/C++:</p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">//----[begin KILLER.HPP]--------------------------------------------------</span><br/>
<span style="color: black; font-style: italic;">// KILLER 1.00 engine</span><br/>
<span style="color: #339933;">#ifndef __KILLER_HPP__</span><br/>
<span style="color: #339933;">#define __KILLER_HPP__</span><br/>
<br/>
<span style="color: #339933;">#define KILLER_VERSION &nbsp;0x0100</span><br/>
<br/>
<span style="color: #993333;">typedef</span><br/>
<span style="color: #993333;">void</span> __cdecl killer_engine<span style="color: black;">&#40;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD &nbsp; user_param<span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// user-parameter</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD __cdecl user_random<span style="color: black;">&#40;</span>DWORD user_param<span style="color: #339933;">,</span> DWORD range<span style="color: black;">&#41;</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD &nbsp; arg1<span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD &nbsp; arg2<span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DWORD &nbsp; arg3<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<br/>
<span style="color: #339933;">#endif //__KILLER_HPP__</span><br/>
<span style="color: black; font-style: italic;">//----[end KILLER.HPP]----------------------------------------------------</span><br/>
&nbsp;</div>
<p>Пример вызова движка на ASM:</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">;----[begin EXAMPLE.ASM]-------------------------------------------------</span><br/>
<span style="color: black; font-style: italic;">; KILLER 1.00 usage example</span><br/>
include &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; killer<span style="color: #339933;">.</span>ash<br/>
<br/>
callW &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; macro &nbsp; x<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">extern</span> &nbsp;x<span style="color: #339933;">:</span>PROC<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span> &nbsp; &nbsp;x<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; endm<br/>
<br/>
v_data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff; font-weight: bold;">struc</span><br/>
v_randseed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;?<br/>
<span style="color: black; font-style: italic;">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ends<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p386<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; model &nbsp; <span style="color: #0000ff; font-weight: bold;">flat</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; locals &nbsp;__<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">.data</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;?<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #339933;">.</span><span style="color: #0000ff; font-weight: bold;">code</span><br/>
<br/>
<span style="color: #0000ff; font-weight: bold;">start</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">call</span> &nbsp; &nbsp;virus_code<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #339933;">-</span><span style="color: #ff0000;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callW &nbsp; ExitProcess<br/>
<br/>
virus_code<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">pusha</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">sub</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">esp</span><span style="color: #339933;">,</span> size v_data<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ebp</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">esp</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">;;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callW &nbsp; GetTickCount<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">xor</span> &nbsp; &nbsp; <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">ebp</span><span style="color: black;">&#93;</span><span style="color: #339933;">.</span>v_randseed<span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">eax</span> &nbsp;<span style="color: black; font-style: italic;">; randomize</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">;;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #ff0000;">3</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #ff0000;">2</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; parameters</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #ff0000;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span> &nbsp; &nbsp;<span style="color: #0000ff; font-weight: bold;">$</span><span style="color: #339933;">+</span><span style="color: #ff0000;">5</span><span style="color: #339933;">+</span><span style="color: #ff0000;">2</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; pointer to randomer</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; short my_random<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #46aa03; font-weight: bold;">ebp</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; user-param, v_data ptr</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span> &nbsp; &nbsp;killer_engine<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">add</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">esp</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">4</span><span style="color: #339933;">*</span><span style="color: #ff0000;">5</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">;;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">add</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">esp</span><span style="color: #339933;">,</span> size v_data<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">popa</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retn<br/>
<br/>
<span style="color: black; font-style: italic;">; DWORD __cdecl random(DWORD user_param, DWORD range)</span><br/>
<span style="color: black; font-style: italic;">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [esp+4] &nbsp; &nbsp; &nbsp; &nbsp;[esp+8]</span><br/>
my_random<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ecx</span><span style="color: #339933;">,</span> <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">esp</span><span style="color: #339933;">+</span><span style="color: #ff0000;">4</span><span style="color: black;">&#93;</span> &nbsp; <span style="color: black; font-style: italic;">; v_data ptr</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">eax</span><span style="color: #339933;">,</span> <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">ecx</span><span style="color: black;">&#93;</span><span style="color: #339933;">.</span>v_randseed<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">imul</span> &nbsp; &nbsp;<span style="color: #46aa03; font-weight: bold;">eax</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">214013</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">add</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">eax</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">2531011</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">ecx</span><span style="color: black;">&#93;</span><span style="color: #339933;">.</span>v_randseed<span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">eax</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">shr</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">eax</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">16</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">imul</span> &nbsp; &nbsp;<span style="color: #46aa03; font-weight: bold;">eax</span><span style="color: #339933;">,</span> <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">esp</span><span style="color: #339933;">+</span><span style="color: #ff0000;">8</span><span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">shr</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">eax</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">16</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retn<br/>
killer_engine<span style="color: #339933;">:</span><br/>
include &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; killer<span style="color: #339933;">.</span><span style="color: #00007f; font-weight: bold;">inc</span><br/>
<br/>
virus_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff; font-weight: bold;">equ</span> &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">$</span><span style="color: #339933;">-</span>virus_code<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">start</span><br/>
<span style="color: black; font-style: italic;">;----[end EXAMPLE.ASM]---------------------------------------------------</span><br/>
&nbsp;</div>
<p>Пример использования на C/C++:</p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">//----[begin EXAMPLE.CPP]-------------------------------------------------</span><br/>
<span style="color: #339933;">#include &lt;windows.h&gt;</span><br/>
<span style="color: #339933;">#include &quot;killer.hpp&quot;</span><br/>
<span style="color: #339933;">#include &quot;killer.cpp&quot;</span><br/>
DWORD randseed <span style="color: #339933;">=</span> GetTickCount<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
DWORD __cdecl my_random<span style="color: black;">&#40;</span>DWORD user_param<span style="color: #339933;">,</span>DWORD range<span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #b1b100;">return</span> range <span style="color: #339933;">?</span> <span style="color: black;">&#40;</span>randseed <span style="color: #339933;">=</span> randseed <span style="color: #339933;">*</span> <span style="color: #0000dd;">214013</span> <span style="color: #339933;">+</span> <span style="color: #0000dd;">2531011</span><span style="color: black;">&#41;</span> <span style="color: #339933;">%</span> range <span style="color: #339933;">:</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span><br/>
<span style="color: black;">&#125;</span><br/>
<span style="color: #993333;">void</span> main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #993333;">void</span><span style="color: #339933;">*</span> killer_ptr <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>killer_bin<span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#40;</span><span style="color: #339933;">*</span><span style="color: black;">&#40;</span>killer_engine<span style="color: #339933;">*</span><span style="color: black;">&#41;</span>killer_ptr<span style="color: black;">&#41;</span> &nbsp;<span style="color: black;">&#40;</span><span style="color: #208080;">0x12345678</span><span style="color: #339933;">,</span> my_random<span style="color: #339933;">,</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">2</span><span style="color: #339933;">,</span><span style="color: #0000dd;">3</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<span style="color: black;">&#125;</span><br/>
<span style="color: black; font-style: italic;">//----[end EXAMPLE.CPP]---------------------------------------------------</span><br/>
&nbsp;</div>
<p>Пример программки для компиляции исходника движка:</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">;----[begin BUILD.ASM]---------------------------------------------------</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p386<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; model &nbsp; <span style="color: #0000ff; font-weight: bold;">flat</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; locals &nbsp;__<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">.data</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">0EBh</span><span style="color: #339933;">,</span><span style="color: #ff0000;">02h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0FFh</span><span style="color: #339933;">,</span><span style="color: #ff0000;">01h</span> &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; signature</span><br/>
include &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; killer<span style="color: #339933;">.</span>asm<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">0EBh</span><span style="color: #339933;">,</span><span style="color: #ff0000;">02h</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0FFh</span><span style="color: #339933;">,</span><span style="color: #ff0000;">02h</span> &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; signature</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #339933;">.</span><span style="color: #0000ff; font-weight: bold;">code</span><br/>
<span style="color: #0000ff; font-weight: bold;">start</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #339933;">-</span><span style="color: #ff0000;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callW &nbsp; ExitProcess<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; end &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">start</span><br/>
<span style="color: black; font-style: italic;">;----[end BUILD.ASM]-----------------------------------------------------</span><br/>
&nbsp;</div>
<p>Пример программки для выдирания бинарной (DB,DB,...) версии движка из скомпиленного EXE-файла:</p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">//----[begin HAXOR.CPP]---------------------------------------------------</span><br/>
<span style="color: #339933;">#include &lt;stdio.h&gt;</span><br/>
<span style="color: #339933;">#include &lt;stdlib.h&gt;</span><br/>
<span style="color: #339933;">#pragma hdrstop</span><br/>
<span style="color: #993333;">void</span> main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; FILE<span style="color: #339933;">*</span>f<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;build.exe&quot;</span><span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;rb&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #993333;">int</span> bufsize <span style="color: #339933;">=</span> filelength<span style="color: black;">&#40;</span>fileno<span style="color: black;">&#40;</span>f<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; BYTE<span style="color: #339933;">*</span> buf <span style="color: #339933;">=</span> new BYTE<span style="color: black;">&#91;</span>bufsize<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fread.html"><span style="color: #000066;">fread</span></a><span style="color: black;">&#40;</span>buf<span style="color: #339933;">,</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">,</span>bufsize<span style="color: #339933;">,</span> f<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>f<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #993333;">int</span> id1<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> id2<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>bufsize<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">*</span><span style="color: black;">&#40;</span>DWORD<span style="color: #339933;">*</span><span style="color: black;">&#41;</span><span style="color: #339933;">&amp;</span>buf<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #208080;">0x01FF02EB</span><span style="color: black;">&#41;</span> id1<span style="color: #339933;">=</span>i<span style="color: #339933;">+</span><span style="color: #0000dd;">4</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">// check signature</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">*</span><span style="color: black;">&#40;</span>DWORD<span style="color: #339933;">*</span><span style="color: black;">&#41;</span><span style="color: #339933;">&amp;</span>buf<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #208080;">0x02FF02EB</span><span style="color: black;">&#41;</span> id2<span style="color: #339933;">=</span>i<span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">// check signature</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; f<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;killer.inc&quot;</span><span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;wb&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;; KILLER 1.00 engine<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>id2<span style="color: #339933;">-</span>id1<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>i<span style="color: #339933;">%</span><span style="color:#800080;">8</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;db &quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;0%02Xh&quot;</span><span style="color: #339933;">,</span> buf<span style="color: black;">&#91;</span>id1<span style="color: #339933;">+</span>i<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>i<span style="color: #339933;">%</span><span style="color:#800080;">8</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #0000dd;">7</span><span style="color: black;">&#41;</span><span style="color: #339933;">||</span><span style="color: black;">&#40;</span>i<span style="color: #339933;">==</span>id2<span style="color: #339933;">-</span>id1<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #b1b100;">else</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;,&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>f<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; f<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;killer.cpp&quot;</span><span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;wb&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;// KILLER 1.00 engine<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;BYTE killer_bin[%i] = {<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span>id2<span style="color: #339933;">-</span>id1<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>id2<span style="color: #339933;">-</span>id1<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>i<span style="color: #339933;">%</span><span style="color:#800080;">8</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot; &nbsp;&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;0x%02X&quot;</span><span style="color: #339933;">,</span> buf<span style="color: black;">&#91;</span>id1<span style="color: #339933;">+</span>i<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span>i<span style="color: #339933;">!=</span>id2<span style="color: #339933;">-</span>id1<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;,&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>i<span style="color: #339933;">%</span><span style="color:#800080;">8</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #0000dd;">7</span><span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fprintf.html"><span style="color: #000066;">fprintf</span></a><span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot; };<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>f<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<span style="color: black;">&#125;</span><br/>
<span style="color: black; font-style: italic;">//----[end HAXOR.CPP]-----------------------------------------------------</span><br/>
&nbsp;</div>
<p>Обратим внимание на example.asm - прообраз будущего вируса. В файле используется движок, движок использует внешннюю процедуру (рандомер), а рандомер использует randseed который создан в основном теле вируса и инициализирован перед вызовом движка. В результате не только этот движок, но и любой другой, да и сам вирус, смогут вызывать одну и ту же внешнюю процедуру (в данном случае рандомер, но это могли бы быть функции работы с файлами и другие движки). Очевидно, что call GetTickCount, произведенный перед вызовом движка, в настоящем вирусе будет произведен по соответствующему вычисленному кернеловскому адресу.</p>
<p>Заметим, что все это написано без использования оффсетов как таковых.</p>
<p>Итак, задача достигнута: движок компиляется отдельно, отлаживается так же отдельно, в example.cpp (имхо на cpp отлаживать алгоритмы быстрее и проще чем на asm), и используется в вирусах на ассемблере.</p>
[<a style="" href="/lib/?lang=RU&amp;index=VT#vzo38">Вернуться к списку</a>] [<a href="/lib/vzo38.html#disqus_thread">Комментарии</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vzo38">de</a><a href="/lib/index.php?lang=en&amp;id=vzo38">en</a><a href="/lib/index.php?lang=es&amp;id=vzo38">es</a><a href="/lib/index.php?lang=it&amp;id=vzo38">it</a><a href="/lib/index.php?lang=fr&amp;id=vzo38">fr</a><a href="/lib/index.php?lang=pl&amp;id=vzo38">pl</a><a href="/lib/index.php?lang=ru&amp;id=vzo38">ru</a><a href="/lib/index.php?lang=ua&amp;id=vzo38">ua</a></div>
</body>
</html>
