<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Z0mbie 'Полиморфизм: что дальше' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Z0mbie"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Z0mbie,Полиморфизм: что дальше, вирус, вируса, один, программы, сигнатуры, пользователю, расшифровщик, файл, алгоритма, следует, работы, байт, уровень, антивирус, можно"/>
<meta name="Description" content="VX Heaven site is dedicted to providing information about computer viruses (virii) and web space for virus authors and groups"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"4b1cddb1c4dc746de2d22b5562f80b1b519b5afe-1498757869-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vzo59.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Полиморфизм: что дальше</h1><p><a href="/lib/?lang=ru&amp;author=Z0mbie"> Z0mbie</a><br/> <em> 1999</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vzo59.html';</script>[<a style="" href="/lib/?lang=RU&amp;index=PO#vzo59">Вернуться к списку</a>] [<a href="/lib/vzo59.html#disqus_thread">Комментарии</a>]<br/> 
<p>Вирус - независящая от пользователя программа, направленная на самораспространение.</p>
<p>Под свойством независимости будем понимать отсутствие в вирусе специально написанных для этого функций, позволяющих пользователю управлять работой вируса.</p>
<p>Под способностью к самораспространению(направленностью на самораспространение) будем понимать присутствие(и использование) в вирусе специально написанных функций для распространения [копий] вируса.</p>
<p>Важными действиями, влияющими на способность к распространению, являются различные методы затруднения обнаружения вируса, как то - стелс-алгоритмы, периодическое приостанавливание активности, полиморфизм, и прочее.</p>
<p>Под полиморфизмом вируса понимается существование одного вируса в нескольких формах. Это свойство мы далее и рассмотрим.</p>
<p>Итак, изменение формы вируса возможно на тех уровнях информации, с позиции которых можно рассматривать(различать) любые компьютерные программы, а именно:</p>
<ol>
<li>На уровне байт, составляющих тело вируса.</li>
<li>На уровне команд(опкодов), составляющих тело вируса.</li>
<li>На уровне функциональных вызовов(действий) вируса.</li>
<li>На уровне алгоритма вируса.</li>
</ol>
<h2>Уровень 1</h2>
<p>Наиболее простой уровень полиморфизма, существует в двух проявлениях:</p>
<dl>
<dt>крипт-вирусы</dt><dd>тело вируса зашифровано, расшифровщик как правило один и постоянный, после расшифровки управление передается на один и тот же (байт-в-байт) код</dd>
<dt>"полиморфные" вирусы</dt><dd>тело вируса зашифровано, расшифровщик(и) как правило создан(ы) вирусом с использованием случайных команд ("мусора"), заменой регистров, ключей и т.п., после расшифровки управление опять же передается на один и тот же (байт-в-байт) код</dd>
</dl>
<p>Детектирование таких вирусов может достигаться:</p>
<ul>
<li>анализом самого расшифровщика (статистическим либо по плавающей сигнатуре)</li>
<li>трассировкой расшифровщика до нахождения постоянной сигнатуры</li>
<li>сравнением сигнатуры "насквозь" (в случае слабой шифровки тела вируса)</li>
<li>по функциональной сигнатуре</li>
</ul>
<h2>Уровень 2</h2>
<p>"Пермутирующие", они же "метаморфные" вирусы.</p>
<p>Идея заключается в том, чтобы изменять команды/группы команд на функционально им эквивалентные(замена), и/или менять команды/группы команд местами(перестановка).</p>
<p>Очевидно, детектирование таких вирусов непосредственно по сигнатуре невозможно, но зная правила изменения одной копии на другую можно специальным образом обработав код получить некоторый единый для всех копий "скелет" вируса и применить сигнатуру к нему.</p>
<p>Остается возможным также статистический (покомандный) анализ тела вируса и детектирование по функциональной сигнатуре.</p>
<p>О реализации.</p>
<p>Здесь пока есть два основных подхода к технологии мутирования вируса:</p>
<ol>
<li>код вируса "переделывается" каждый раз, тут используются либо фиксированные длины команд, либо встроенный дисассемблер, возвращающий хотя бы длину инструкции.</li>
<li>новый код создается каждый раз из некоего специфически закодированного "прообраза", который хранится в зашифрованном виде.</li>
</ol>
<p>Кстати, здесь существует интересная проблема о степени зашифрованности этого самого прообраза и соответственно возможности его детектирования.</p>
<h2>Уровень 3</h2>
<p>Назовем их функционально мутирующие вирусы.</p>
<p>Такой уровень на практике пока еще не был реализован.</p>
<p>Смысл мутации заключается в том, чтобы затруднить детектирование вируса по функциональной сигнатуре.</p>
<p>Дело в том, что при эмуляции/трассировке вируса, его функциональные вызовы могут быть закодированы например так:</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ah</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">4Eh</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; найти файл</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">int</span> &nbsp; &nbsp; <span style="color: #ff0000;">21h</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; вызов: 21 4E</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jc</span>&nbsp; &nbsp; &nbsp; <span style="color: #339933;">...</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span>&nbsp; &nbsp; infect_file<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #339933;">...</span><br/>
infect_file<span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #339933;">...</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ah</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">3Dh</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; открыть файл</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">int</span> &nbsp; &nbsp; <span style="color: #ff0000;">21h</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; вызов: 21 3D</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #339933;">...</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ah</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">40h</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; записать в файл</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">int</span> &nbsp; &nbsp; <span style="color: #ff0000;">21h</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; вызов: 21 40</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #339933;">...</span><br/>
&nbsp;</div>
<p>функциональна сигнатура: 21 4E 21 3D 21 40</p>
<p>Очевидно, что прерывания/процедуры api, которые вызываются вирусом, представляют неплохую информацию для его детектирования.</p>
<p>Консенсус здесь достигается при помощи генератора случайных чисел, то есть следует создать нечто вроде событий, которые будут делится на необходимые и случайные, перемешать их, и вызывать соответствующим образом.</p>
<h2>Уровень 4</h2>
<p>Пожалуй самый сложный уровень, единственный за который не следует браться ;-)</p>
<p>Назовем их алгоритмически мутирующие вирусы.</p>
<p>Алгоритм работы программы (вместе с результатом ее работы), есть, наверное, самый высокий уровень информации о программе.</p>
<p>И как бы мы ни извращались на уровнях команд и функциональных вызовов, все равно файл с расширением .EXE и внутренним форматом PE будет найден, открыт, и в него произойдет запись. Либо нечто в этом роде.</p>
<p>Теоретически обойти эту проблему можно, связав, например в один сотню разных вирусов, производящих самые разные действия, и переходя от одного алгоритма работы к другому случайным образом.</p>
<p>Можно пойти по весьма депрессивному пути, раз за разом "выкидывая" из вируса процедуры и функции(как части алгоритма), естественно, в начале создав некоторую их избыточность.</p>
<p>Можно попытаться создать анализатор кода, который во внешних файлах найдет некоторый код, выполняющий <em>в частности</em> еще и нужные нам действия, и заменить этим кодом часть собственного. Но это уже из области фантастики.</p>
<h2>Общие рекомендации</h2>
<p>В глобальном смысле, я сегодня вижу такую ситуацию:</p>
<p>Вылечить можно отнюдь не все вирусы, достигается это технологиями Seek&amp;Destroy (вставка ошибок в случайные места программы и обработка их вирусом), UEP (Unknown Entry Point) и прочими гадостями.</p>
<p>В частности, есть вот такая интересная техника заражения:</p>
<ul>
<li>Выбирается точка в теле программы, в которую будет записан переход на вирус.</li>
<li>В случае нормального вируса, это просто точка входа (entrypoint) программы.</li>
<li>В случае хорошего вируса, это случайно выбранная точка программы. (UEP)</li>
<li>Если вирус еще более правильный, то переход произойдет на полиморфный расшифровщик.</li>
<li>А вот если вирус из этой самой точки <em>заберет</em> с десяток инструкций, а потом либо размешает их в полиморфном декрипторе, либо сохранит в себе (с последующим восстановлением, понятно) - то это совсем правильно.</li>
</ul>
<p>А вот детектировать можно любой (или почти любой ;-) вирус, вопрос только <strong>когда</strong>.</p>
<p>Здесь есть несколько параллельных временных стадий.</p>
<ol>
<li>Фаза распространения (вирус идет от пользователя к пользователю, и через некоторое время попадает в антивирусную контору)</li>
<li>Фаза создания антивируса (контора пишет антивирус)</li>
<li>Фаза лечения (антивирус идет из конторы к пользователю, и, в последный момент, вирус просекает что больше не судьба и накернивает "...ЭВМ, систему ЭВМ или их сеть...")</li>
</ol>
<p>Длительность всех трех стадий некоторым образом связана с такими "качествами" вируса, как:</p>
<ol>
<li>маскировка (позднее поймают)</li>
<li>сложность (дольше будут писать антивирус)</li>
<li>защита (сводит антивирус на нет)</li>
</ol>
<p>Здесь следует сказать пару слов о деструкции. Так вот деструкция, несомненно, нужна. ;-) Но в меру. Например всякая рандомная деструкция снижает маскировку, зато "умная" деструкция (типа пришел новый антивирус или юзер пишет письмо к аверам) усиляет защиту и усложняет лечение.</p>
<p>Также можно хранить вирус в нескольких файлах, но это может сильно затруднить распространение.</p>
<p>Можно ввести собственные сигнатуры на антивирусы, и "убивать", а лучше патчить их при загрузке. В этом случае все сводится к ситуации "кто первый "встал в резидент", тот и рулез".</p>
<p>Можно при обнаружении антивируса совершать "самоубийство" (полное либо частичное - удалять/изменять часть кода), тогда вирус попадет в антивирусную контору намного позже(а еще и не весь), и соответственно более "счастливые" копии сумеют распространиться подальше.</p>
<p>Можно при ситуации "антивир хочет нас вылечить" совершать убийство (ритуальное) пользователя вместе с компьютером.</p>
<h2>В заключение...</h2>
<p>...не надо ;-)</p>
[<a style="" href="/lib/?lang=RU&amp;index=PO#vzo59">Вернуться к списку</a>] [<a href="/lib/vzo59.html#disqus_thread">Комментарии</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vzo59">de</a><a href="/lib/index.php?lang=en&amp;id=vzo59">en</a><a href="/lib/index.php?lang=es&amp;id=vzo59">es</a><a href="/lib/index.php?lang=it&amp;id=vzo59">it</a><a href="/lib/index.php?lang=fr&amp;id=vzo59">fr</a><a href="/lib/index.php?lang=pl&amp;id=vzo59">pl</a><a href="/lib/index.php?lang=ru&amp;id=vzo59">ru</a><a href="/lib/index.php?lang=ua&amp;id=vzo59">ua</a></div>
</body>
</html>
