<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Z0mbie 'Преобразование кода и конечные автоматы (проектируем очень хуево дизассемблируемый код)' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Z0mbie"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Z0mbie,Преобразование кода и конечные автоматы (проектируем очень хуево дизассемблируемый код), break, case, float, cycle, после, число, switch, кода, состояний, действия, store, части, команды, числа, автомат"/>
<meta name="Description" content="VX Heaven site is dedicted to providing information about computer viruses (virii) and web space for virus authors and groups"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"5fb922c22325e9cd9de57f1a34e4d3ff8a81bffe-1498757902-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vzo32.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Преобразование кода и конечные автоматы (проектируем очень хуево дизассемблируемый код)</h1><p><a href="/lib/?lang=ru&amp;author=Z0mbie"> Z0mbie</a><br/></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vzo32.html';</script>[<a style="" href="/lib/?lang=RU&amp;index=VT#vzo32">Вернуться к списку</a>] [<a href="/lib/vzo32.html#disqus_thread">Комментарии</a>]<br/> 
<p>Существует такой интересный объект, как конечный автомат (finite automaton). Этот автомат обладает внутренними состояниями (это просто такие переменные), при изменении которых происходят определенные действия. Таким образом, есть набор действий, каждое из которых определяется текущим состоянием автомата, и/или переходом из одного состояния в другое, и матрица, определяющяя переходы между состояниями.</p>
<p>Рассмотрим простую задачку: есть строка вида "1,3-7,9-100,105" которую надо преобразовать в бинарный вид. Рассмотрим реализацию, основанную на технологии конечных автоматов (еще говорят switch-технология). Введем внутренние состояния автомата.</p>
<ol start="0">
<li>до первого (до '-') числа</li>
<li>внутри первого числа</li>
<li>до второго (после '-') числа</li>
<li>внутри второго числа</li>
<li>конец строки (после последнего символа)</li>
<li>ошибка синтаксиса</li>
</ol>
<p>тогда программа представляется в таком виде:</p>
<ul>
<li>c - указатель на текущий символ</li>
<li>*c - текущий символ разбираемой строки</li>
<li>A - номер действия</li>
</ul>
<table summary="">
<tr><th>переход</th><th>cимвол</th><th>A</th><th>действие:</th><th>ситуация:</th></tr>
<tr><td>0--&gt;1</td><td>0..9</td><td>1</td><td><code>l=*c-'0';</code></td><td>новая пара чисел, встречена цифра</td></tr>
<tr><td>0--&gt;5</td><td>другие</td><td>&nbsp;</td><td>&nbsp;</td><td>новая пара чисел, встречена НЕ цифра</td></tr>
<tr><td>1--&gt;0</td><td>,</td><td>2</td><td><code>store(l,l);</code></td><td>одно число, в конце ','</td></tr>
<tr><td>1--&gt;1</td><td>0..9</td><td>3</td><td><code>l=l*10+*c-'0';</code></td><td>добавить символ к первому числу</td></tr>
<tr><td>1--&gt;2</td><td>-</td><td>&nbsp;</td><td>&nbsp;</td><td>два числа, первое закончилось на '-'</td></tr>
<tr><td>1--&gt;4</td><td>eoln</td><td>2</td><td><code>store(l,l);</code></td><td>одно число, после него - конец строки</td></tr>
<tr><td>1--&gt;5</td><td>другие</td><td>&nbsp;</td><td>&nbsp;</td><td>недопустимый символ в первом числе</td></tr>
<tr><td>2--&gt;3</td><td>0..9</td><td>4</td><td><code>h=*c-'0';</code></td><td>два числа, после '-' цифра</td></tr>
<tr><td>2--&gt;5</td><td>другие</td><td>&nbsp;</td><td>&nbsp;</td><td>два числа, после '-' НЕ цифра</td></tr>
<tr><td>3--&gt;0</td><td>,</td><td>5</td><td><code>store(l,h);</code></td><td>два числа, в конце ','</td></tr>
<tr><td>3--&gt;3</td><td>0..9</td><td>6</td><td><code>h=h*10+*c-'0';</code></td><td>добавить символ к второму числу</td></tr>
<tr><td>3--&gt;4</td><td>eoln</td><td>5</td><td><code>store(l,h);</code></td><td>два числа, после них - конец строки</td></tr>
<tr><td>3--&gt;5</td><td>другие</td><td>&nbsp;</td><td>&nbsp;</td><td>недопустимый символ во втором числе</td></tr>
<tr><td>4--&gt; </td><td>&nbsp;</td><td>7</td><td><code>exit();</code></td><td>конец строки (после последнего символа)</td></tr>
<tr><td>5--&gt; </td><td>&nbsp;</td><td>8</td><td><code>error();</code></td><td>ошибка синтаксиса</td></tr>
</table>
<p>тогда таблица действий при переходах между состояниями выглядит так:</p>
<table summary="таблица действий при переходах между состояниями">
<tr><th>номер действия</th><th colspan="7">следующее состояние</th></tr>
<tr><th rowspan="8">текущее<br/>состояние</th></tr>
<tr><th>&nbsp;</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
<tr><th>0</th><td>-</td><td>1</td><td>-</td><td>-</td><td>-</td><td>2</td></tr>
<tr><th>1</th><td>3</td><td>4</td><td>5</td><td>-</td><td>3</td><td>2</td></tr>
<tr><th>2</th><td>-</td><td>-</td><td>-</td><td>6</td><td>-</td><td>2</td></tr>
<tr><th>3</th><td>7</td><td>-</td><td>-</td><td>8</td><td>7</td><td>2</td></tr>
<tr><th>4</th><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
<tr><th>5</th><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
</table>
<p>Простой исходник на си будет выглядеть так:</p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; &nbsp; <span style="color: #993333;">int</span> S <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #993333;">char</span><span style="color: #339933;">*</span>c <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;1,3-7,9-100,105&quot;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #339933;">;;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">switch</span><span style="color: black;">&#40;</span>S<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/isdigit.html"><span style="color: #000066;">isdigit</span></a><span style="color: black;">&#40;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#41;</span> &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> l<span style="color: #339933;">=*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">*</span>c <span style="color: #339933;">==</span> <span style="color: #ff0000;">','</span> &nbsp; &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> store<span style="color: black;">&#40;</span>l<span style="color: #339933;">,</span>l<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;<span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/isdigit.html"><span style="color: #000066;">isdigit</span></a><span style="color: black;">&#40;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#41;</span> &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> l<span style="color: #339933;">=</span>l<span style="color: #339933;">*</span><span style="color: #0000dd;">10</span><span style="color: #339933;">+*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">*</span>c <span style="color: #339933;">==</span> <span style="color: #ff0000;">'-'</span> &nbsp; &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">*</span>c <span style="color: #339933;">==</span> <span style="color: #0000dd;">0</span> &nbsp; &nbsp; &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">4</span><span style="color: #339933;">;</span> store<span style="color: black;">&#40;</span>l<span style="color: #339933;">,</span>l<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;<span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/isdigit.html"><span style="color: #000066;">isdigit</span></a><span style="color: black;">&#40;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#41;</span> &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">3</span><span style="color: #339933;">;</span> h<span style="color: #339933;">=*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">3</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">*</span>c <span style="color: #339933;">==</span> <span style="color: #ff0000;">','</span> &nbsp; &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> store<span style="color: black;">&#40;</span>l<span style="color: #339933;">,</span>h<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;<span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/isdigit.html"><span style="color: #000066;">isdigit</span></a><span style="color: black;">&#40;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#41;</span> &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">3</span><span style="color: #339933;">;</span> h<span style="color: #339933;">=</span>h<span style="color: #339933;">*</span><span style="color: #0000dd;">10</span><span style="color: #339933;">+*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">*</span>c <span style="color: #339933;">==</span> <span style="color: #0000dd;">0</span> &nbsp; &nbsp; &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">4</span><span style="color: #339933;">;</span> store<span style="color: black;">&#40;</span>l<span style="color: #339933;">,</span>h<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;<span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">4</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">5</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; error<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; c<span style="color: #339933;">++;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>Если теперь преобразовать вышеприведенный исходник в более низкоуровневое представление, при этом избавившись от переменных, то получится вот что:</p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">x<span style="color: #339933;">:</span><br/>
&nbsp; x0<span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/isdigit.html"><span style="color: #000066;">isdigit</span></a><span style="color: black;">&#40;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#41;</span> &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> l<span style="color: #339933;">=*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: #b1b100;">goto</span> x1<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: #b1b100;">goto</span> x5<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
&nbsp; x1<span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">*</span>c <span style="color: #339933;">==</span> <span style="color: #ff0000;">','</span> &nbsp; &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> store<span style="color: black;">&#40;</span>l<span style="color: #339933;">,</span>l<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: #b1b100;">goto</span> x0<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/isdigit.html"><span style="color: #000066;">isdigit</span></a><span style="color: black;">&#40;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#41;</span> &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> l<span style="color: #339933;">=</span>l<span style="color: #339933;">*</span><span style="color: #0000dd;">10</span><span style="color: #339933;">+*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> c<span style="color: #339933;">++;</span> <span style="color: #b1b100;">goto</span> x1<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">*</span>c <span style="color: #339933;">==</span> <span style="color: #ff0000;">'-'</span> &nbsp; &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">goto</span> x2<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">*</span>c <span style="color: #339933;">==</span> <span style="color: #0000dd;">0</span> &nbsp; &nbsp; &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> store<span style="color: black;">&#40;</span>l<span style="color: #339933;">,</span>l<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: #b1b100;">goto</span> x4<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">goto</span> x5<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
&nbsp; x2<span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/isdigit.html"><span style="color: #000066;">isdigit</span></a><span style="color: black;">&#40;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#41;</span> &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> h<span style="color: #339933;">=*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: #b1b100;">goto</span> x3<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">goto</span> x5<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
&nbsp; x3<span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">*</span>c <span style="color: #339933;">==</span> <span style="color: #ff0000;">','</span> &nbsp; &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> store<span style="color: black;">&#40;</span>l<span style="color: #339933;">,</span>h<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: #b1b100;">goto</span> x0<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/isdigit.html"><span style="color: #000066;">isdigit</span></a><span style="color: black;">&#40;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#41;</span> &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> h<span style="color: #339933;">=</span>h<span style="color: #339933;">*</span><span style="color: #0000dd;">10</span><span style="color: #339933;">+*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> c<span style="color: #339933;">++;</span> <span style="color: #b1b100;">goto</span> x3<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">*</span>c <span style="color: #339933;">==</span> <span style="color: #0000dd;">0</span> &nbsp; &nbsp; &nbsp;<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> store<span style="color: black;">&#40;</span>l<span style="color: #339933;">,</span>h<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: #b1b100;">goto</span> x4<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">goto</span> x5<span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
&nbsp; x4<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; x5<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; error<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">goto</span> x<br/>
&nbsp;</div>
<p>Полученный код, будучи скомпилированным с оптимизацией, крайне труден для дизассемблирования, и вот по какой причине: при попытке его восстановления в классические си-конструкции, типа for, while, if-else, останутся "лишние" goto, и если их будет много, то понять смысл будет исключительно сложно. Граф переходов между блоками для подобной программы будет отличаться от графа для классической программы бОльшим количеством перекрещивающихся связей.</p>
<p>Для восстановления этого кода в исходный вид, придется выделить постоянные блоки кода, пронумеровать их, затем заново ввести переменные-состояния, и только тогда будет возможно пытаться что-то понять дальше. Но это представляется непростой задачей, потому что выделение тех же самых блоков кода что и были в исходном состоянии, после компиляции с оптимизацией становится в некоторых случаях весьма затруднительным, так как блоки могут делиться на части, объединяться и перемешиваться.</p>
<p>Теперь рассмотрим более сложный исходник:</p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; &nbsp; <span style="color: #993333;">int</span> T<span style="color: black;">&#91;</span><span style="color: #0000dd;">256</span><span style="color: black;">&#93;</span> <span style="color: #339933;">=</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #0000dd;">4</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;, - &nbsp; &nbsp; &nbsp;0 1 2 3 4 5 6 7 8 9</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">2</span><span style="color: #339933;">,</span><span style="color: #0000dd;">3</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #339933;">;;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #993333;">int</span> A<span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">switch</span><span style="color: black;">&#40;</span> S <span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">switch</span><span style="color: black;">&#40;</span> T<span style="color: black;">&#91;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#93;</span> <span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">:</span> &nbsp;<span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> A<span style="color: #339933;">=</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">default</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> A<span style="color: #339933;">=</span><span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">switch</span><span style="color: black;">&#40;</span> T<span style="color: black;">&#91;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#93;</span> <span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">:</span> &nbsp;<span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> A<span style="color: #339933;">=</span><span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">:</span> &nbsp;<span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> A<span style="color: #339933;">=</span><span style="color: #0000dd;">3</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">3</span><span style="color: #339933;">:</span> &nbsp;<span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">4</span><span style="color: #339933;">:</span> &nbsp;<span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">4</span><span style="color: #339933;">;</span> A<span style="color: #339933;">=</span><span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">:</span> &nbsp;<span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">switch</span><span style="color: black;">&#40;</span> T<span style="color: black;">&#91;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#93;</span> <span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">:</span> &nbsp;<span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">3</span><span style="color: #339933;">;</span> A<span style="color: #339933;">=</span><span style="color: #0000dd;">4</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">default</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">3</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">switch</span><span style="color: black;">&#40;</span> T<span style="color: black;">&#91;</span><span style="color: #339933;">*</span>c<span style="color: black;">&#93;</span> <span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">:</span> &nbsp;<span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> A<span style="color: #339933;">=</span><span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">:</span> &nbsp;<span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">3</span><span style="color: #339933;">;</span> A<span style="color: #339933;">=</span><span style="color: #0000dd;">6</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">4</span><span style="color: #339933;">:</span> &nbsp;<span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">4</span><span style="color: #339933;">;</span> A<span style="color: #339933;">=</span><span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">default</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> S<span style="color: #339933;">=</span><span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">4</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; A <span style="color: #339933;">=</span> <span style="color: #0000dd;">7</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">5</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; A <span style="color: #339933;">=</span> <span style="color: #0000dd;">8</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">switch</span><span style="color: black;">&#40;</span> A <span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> l<span style="color: #339933;">=*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> store<span style="color: black;">&#40;</span>l<span style="color: #339933;">,</span>l<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">3</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> l<span style="color: #339933;">=</span>l<span style="color: #339933;">*</span><span style="color: #0000dd;">10</span><span style="color: #339933;">+*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> c<span style="color: #339933;">++;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">4</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> h<span style="color: #339933;">=*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">5</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> store<span style="color: black;">&#40;</span>l<span style="color: #339933;">,</span>h<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp;c<span style="color: #339933;">++;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">6</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> h<span style="color: #339933;">=</span>h<span style="color: #339933;">*</span><span style="color: #0000dd;">10</span><span style="color: #339933;">+*</span>c<span style="color: #339933;">-</span><span style="color: #ff0000;">'0'</span><span style="color: #339933;">;</span> c<span style="color: #339933;">++;</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">7</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">case</span> <span style="color: #0000dd;">8</span><span style="color: #339933;">:</span> <span style="color: black;">&#123;</span> error<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>Как видим, последний пример написан без команд сравнения и условных переходов.</p>
<p>В таком виде программа представляет собой цикл из трех частей: в первой части анализируются внешние данные (здесь это строка символов), и преобразуются в некоторые внутренние переменные (здесь это показано неявно через массив T[]), затем вычисляются переходы по таблицам между состояниями (здесь это первый switch), и одновременно на каждом таком переходе выбирается из таблиц номер действия (здесь это опять же первый switch и переменная A), и в третьей части цикла выполняется некоторое реальное действие (здесь это второй switch).</p>
<p>И вот что интересно: от программы как таковой, мы теперь перешли к номерам блоков команд, и последовательность этих номеров и является самой сутью исходной программы.</p>
<p>Рассмотрим теперь такой вопрос: как генерируется номер следующего действия. Он генерируется в зависимости от текущих состояний конечного автомата. В случае, если таких переменных-состояний мало, можно обойтись таблицами, в которых указано, какие следующие состояния и действия соответствуют текущим состояниям.</p>
<p>Подобные таблицы могут быть преобразованы в функцию.</p>
<p>Требования к такой функции просты: на вход ей подается число, в котором закодированы текущие состояния, а на выходе получается число, в котором закодированы следующие состояния и номер действия. Таким образом работа программы будет заключаться в итерации такого цикла:</p>
<ol>
<li>Вызвать функцию, передав в нее текущие состояния, затем из результата извлечь новые значения состояний и номер действия.</li>
<li>Выполнить действие, определяемое полученным номером.</li>
</ol>
<p>Рассмотрим следующий вариант. Состояниями являются значения регистров EAX..EDI, а номером действия является численное значение байтов, определяющих некую инструкцию, дополненную либо <code>NOP</code>'ами либо командой <code>RETN</code>.</p>
<p>Тогда ВСЯ наша программа будет являться... функцией. Изначально, на вход этой функции подается, к примеру, EAX = 2, ECX = 3, остальные = 0, команда <code>NOP</code>. Тогда число будет, например, таким:</p>
<pre>
	00000000...00000003000000020000C390
	&lt;--EDI-&gt;...&lt;--ECX-&gt;&lt;--EAX-&gt;&lt;--cmd-&gt;
</pre>
<p>На выходе функция дает результат:</p>
<pre>
	00000000...00000003000000020000C341
	&lt;--EDI-&gt;...&lt;--ECX-&gt;&lt;--EAX-&gt;&lt;--cmd-&gt;
</pre>
<p>что соответствует команде <code>inc ecx</code>, и тем же самым состояниям-значениям регистров. Тогда мы выполняем полученную команду, и меняется состояние ecx, и мы подаем в функцию такое число:</p>
<pre>
	00000000...00000004000000020000С341
	&lt;--EDI-&gt;...&lt;--ECX-&gt;&lt;--EAX-&gt;&lt;--cmd-&gt;
</pre>
<p>и так далее. К числу, понятно, надо еще добавить уникальный номер каждой инструкции в программе, потому что сами опкоды могут повторяться.</p>
<p>Интересно то, что при помощи такой функции, можно закодировать бОльшую часть ассемблерных команд -- в частности, все условные и безусловные переходы, а также все команды, изменяющие значения регистров известным образом. Остаются только команды работы с памятью, прочими устройствами и команды вызова api-функций.</p>
<p>Возникает вопрос: как построить такую функцию.</p>
<p>И здесь есть огромное количество вариантов, от простых таблиц, и до нейронных сетей.</p>
<p>В вышеприведенном примере, конечно, ничего не получится, потому что регистров много, принимать они могут много разных значений, и поэтому функция будет такой большой, что не поместится в компьютере. А жаль.</p>
<p>Поэтому рассмотрим упрощенный вариант.</p>
<ul>
<li>Аргументом функции будет номер состояния.</li>
<li>Результатом будет число размером в WORD.</li>
<li>Старшим байтом результата будет первый байт опкода.</li>
<li>Младшим байтом будет номер состояния, а его младшим битом -- значение флага ZF.</li>
</ul>
<p>Поэтому появится возможность убрать из программы команды вида JZ/JNZ, и закодировать их посредством переходов между состояниями. Сама программа будет криптовать текстовую строчку.</p>
<p>Исходный код программы:</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;">; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ДЕЙСТВИЯ: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;СОСТОЯНИЯ И ПЕРЕХОДЫ:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; &nbsp; &nbsp;NZ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ZR</span><br/>
xormsg<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; -1 --&gt; 00</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">xor</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">edx</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">edx</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; 00 --&gt; 02 &nbsp; 01 --&gt; 02</span><br/>
cycle1<span style="color: #339933;">:</span> &nbsp;<span style="color: #00007f; font-weight: bold;">lea</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">esi</span><span style="color: #339933;">,</span> msg &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; 02 --&gt; 04 &nbsp; 03 --&gt; 04</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ecx</span><span style="color: #339933;">,</span> msg_size &nbsp; &nbsp;<span style="color: black; font-style: italic;">; 04 --&gt; 06 &nbsp; 05 --&gt; 06</span><br/>
cycle2<span style="color: #339933;">:</span> &nbsp;<span style="color: #00007f; font-weight: bold;">xor</span> &nbsp; &nbsp; <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">esi</span><span style="color: black;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">dh</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; 06 --&gt; 08 &nbsp; 07 --&gt; 08</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">sub</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">dh</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">dl</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; 08 --&gt; 10 &nbsp; 09 --&gt; 10</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">inc</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">esi</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; 10 --&gt; 12 &nbsp; 11 --&gt; 12</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">dec</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ecx</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; 12 --&gt; 06 &nbsp; 13 --&gt; 14</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">jnz</span> &nbsp; &nbsp; cycle2<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">inc</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">dl</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; 14 --&gt; 16 &nbsp; 15 --&gt; 16</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">cmp</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">dl</span><span style="color: #339933;">,</span> <span style="color: #7f007f;">'Z'</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; 16 --&gt; 02 &nbsp; 17 --&gt; 18</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">jne</span> &nbsp; &nbsp; cycle1<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;retn &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; 18</span><br/>
&nbsp;</div>
<p>Функция, заданная таблицей:</p>
<pre>
       Аргумент   Значение

        f( -1 ) = 0x3300
        f(0x00) = 0xBE02
        f(0x01) = 0xBE02
        f(0x02) = 0xB904
        f(0x03) = 0xB904
        f(0x04) = 0x3006
        f(0x05) = 0x3006
        f(0x06) = 0x2A08
        f(0x07) = 0x2A08
        f(0x08) = 0x460A
        f(0x09) = 0x460A
        f(0x0A) = 0x490C
        f(0x0B) = 0x490C
        f(0x0C) = 0x3006
        f(0x0D) = 0xFE0E
        f(0x0E) = 0x8010
        f(0x0F) = 0x8010
        f(0x10) = 0xBE02
        f(0x11) = 0x0012
</pre>
<p>Теперь сгенерируем функцию. Пусть это будет полином. Хоть и тривиально, но интересно.</p>
<p>f(X) = SUMi( C[i]*X^i ), i=0..18</p>
<p>Здесь X -- аргумент функции, который, как мы решили, есть текущее состояние, а в возвращаемом функцией числе будет закодировано следующее состояние и первый байт инструкции.</p>
<p>Нахуячим простенькую програмку по подсчету коэффициентов полинома: см. (1)</p>
<p>Теперь у нас есть все, что необходимо для реализации функции. Вот как она будет выглядеть:</p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #993333;">float</span> calc<span style="color: black;">&#40;</span><span style="color: #993333;">float</span> X<span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #993333;">float</span> y <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> j<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> j<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> j<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; y <span style="color: #339933;">+=</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/pow.html"><span style="color: #000066;">pow</span></a><span style="color: black;">&#40;</span>X<span style="color: #339933;">,</span>j<span style="color: black;">&#41;</span> <span style="color: #339933;">*</span> C<span style="color: black;">&#91;</span>j<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">return</span> y<span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>Или же, в более приятном виде:</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">N &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">equ</span> &nbsp; &nbsp; <span style="color: #ff0000;">19</span><br/>
<br/>
go_next_state<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">pushf</span> &nbsp;<span style="color: black; font-style: italic;">; IN/OUT: EBX=current/next state</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">pusha</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">finit</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">fild</span> &nbsp; &nbsp;<span style="color: #0000ff; font-weight: bold;">dword</span> ptr <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">esp</span><span style="color: #339933;">+</span><span style="color: #ff0000;">4</span><span style="color: #339933;">*</span><span style="color: #ff0000;">4</span><span style="color: black;">&#93;</span> &nbsp; &nbsp; <span style="color: black; font-style: italic;">; pusha.ebx</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;N<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">pop</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ecx</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">lea</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">edx</span><span style="color: #339933;">,</span> C_table<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">fldz</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; st(1)</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">fld1</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; st(0)</span><br/>
__c1<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">fld</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">st</span><span style="color: black;">&#40;</span><span style="color: #ff0000;">0</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">fld</span> &nbsp; &nbsp; tbyte ptr <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">edx</span><span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">fmulp</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">faddp</span> &nbsp; <span style="color: #46aa03; font-weight: bold;">st</span><span style="color: black;">&#40;</span><span style="color: #ff0000;">2</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span><span style="color: #46aa03; font-weight: bold;">st</span><span style="color: black;">&#40;</span><span style="color: #ff0000;">0</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">fmul</span> &nbsp; &nbsp;<span style="color: #46aa03; font-weight: bold;">st</span><span style="color: black;">&#40;</span><span style="color: #ff0000;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span><span style="color: #46aa03; font-weight: bold;">st</span><span style="color: black;">&#40;</span><span style="color: #ff0000;">2</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">add</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">edx</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">10</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">loop</span> &nbsp; &nbsp;__c1<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">fistp</span> &nbsp; <span style="color: #0000ff; font-weight: bold;">dword</span> ptr <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">esp</span><span style="color: #339933;">+</span><span style="color: #ff0000;">4</span><span style="color: #339933;">*</span><span style="color: #ff0000;">4</span><span style="color: black;">&#93;</span> &nbsp; &nbsp; <span style="color: black; font-style: italic;">; pusha.ebx</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">fistp</span> &nbsp; <span style="color: #0000ff; font-weight: bold;">dword</span> ptr <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">esp</span><span style="color: #339933;">+</span><span style="color: #ff0000;">4</span><span style="color: #339933;">*</span><span style="color: #ff0000;">4</span><span style="color: black;">&#93;</span> &nbsp; &nbsp; <span style="color: black; font-style: italic;">; pusha.ebx</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">popa</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">popf</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retn<br/>
<br/>
C_table &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; label &nbsp; tbyte<br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">4.864199999999999986e+04</span> &nbsp; <span style="color: black; font-style: italic;">; C[ 0]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">1.052028658321440037e+06</span> &nbsp; <span style="color: black; font-style: italic;">; C[ 1]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; <span style="color: #339933;">-</span><span style="color: #ff0000;">2.226893544084362929e+06</span> &nbsp; <span style="color: black; font-style: italic;">; C[ 2]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">1.054917653361728822e+06</span> &nbsp; <span style="color: black; font-style: italic;">; C[ 3]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">1.030581898921544049e+06</span> &nbsp; <span style="color: black; font-style: italic;">; C[ 4]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; <span style="color: #339933;">-</span><span style="color: #ff0000;">1.641889337850409245e+06</span> &nbsp; <span style="color: black; font-style: italic;">; C[ 5]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">1.056816179457771135e+06</span> &nbsp; <span style="color: black; font-style: italic;">; C[ 6]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; <span style="color: #339933;">-</span><span style="color: #ff0000;">4.226269487577827341e+05</span> &nbsp; <span style="color: black; font-style: italic;">; C[ 7]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">1.179126264336835917e+05</span> &nbsp; <span style="color: black; font-style: italic;">; C[ 8]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; <span style="color: #339933;">-</span><span style="color: #ff0000;">2.418954943314347526e+04</span> &nbsp; <span style="color: black; font-style: italic;">; C[ 9]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">3.749247680199179089e+03</span> &nbsp; <span style="color: black; font-style: italic;">; C[10]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; <span style="color: #339933;">-</span><span style="color: #ff0000;">4.446691826539333110e+02</span> &nbsp; <span style="color: black; font-style: italic;">; C[11]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">4.044639078866551414e+01</span> &nbsp; <span style="color: black; font-style: italic;">; C[12]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; <span style="color: #339933;">-</span><span style="color: #ff0000;">2.801020107772053989e+00</span> &nbsp; <span style="color: black; font-style: italic;">; C[13]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">1.450610807381378830e-01</span> &nbsp; <span style="color: black; font-style: italic;">; C[14]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; <span style="color: #339933;">-</span><span style="color: #ff0000;">5.436999378694686739e-03</span> &nbsp; <span style="color: black; font-style: italic;">; C[15]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">1.391774067561251339e-04</span> &nbsp; <span style="color: black; font-style: italic;">; C[16]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; <span style="color: #339933;">-</span><span style="color: #ff0000;">2.174850123595773034e-06</span> &nbsp; <span style="color: black; font-style: italic;">; C[17]</span><br/>
&nbsp; <span style="color: #0000ff; font-weight: bold;">dt</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">1.563443629925163634e-08</span> &nbsp; <span style="color: black; font-style: italic;">; C[18]</span><br/>
&nbsp;</div>
<p>Поскольку первый опкод закодирован в старшем байте возвращаемого функцией числа, в собственно программе он будет отсутствовать.</p>
<p>Вот программа, полученная в результате всех этих извращений:</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">.data</span><br/>
<br/>
msg &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;<span style="color: #7f007f;">'Бля, пошли все нахуй, мудаки!'</span><span style="color: #339933;">,</span><span style="color: #ff0000;">0</span><br/>
msg_size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff; font-weight: bold;">equ</span> &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">$</span><span style="color: #339933;">-</span>msg<br/>
<br/>
<span style="color: #0000ff; font-weight: bold;">start</span><span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span> &nbsp; &nbsp;xormsg<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #ff0000;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;offset msg<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;offset msg<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #ff0000;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callW &nbsp; MessageBoxA<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span> &nbsp; &nbsp;xormsg<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #ff0000;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;offset msg<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;offset msg<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #ff0000;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callW &nbsp; MessageBoxA<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #339933;">-</span><span style="color: #ff0000;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callW &nbsp; ExitProcess<br/>
<br/>
xormsg<span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">xor</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ebx</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">ebx</span> &nbsp; &nbsp;<span style="color: black; font-style: italic;">; начальное состояние = -1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">dec</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ebx</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; begin<br/>
<br/>
cycle<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #00007f; font-weight: bold;">pushf</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; копируем ZF в младший бит EBX</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #46aa03; font-weight: bold;">eax</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">lahf</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">shr</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ah</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">6</span> <span style="color: black; font-style: italic;">; ZF &nbsp;;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">and</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ah</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">1</span> &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">and</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">bl</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">0FEh</span> &nbsp; &nbsp;<span style="color: black; font-style: italic;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">or</span> &nbsp; &nbsp; &nbsp;<span style="color: #46aa03; font-weight: bold;">bl</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">ah</span> &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">pop</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">eax</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">popf</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">;</span><br/>
begin<span style="color: #339933;">:</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span> &nbsp; &nbsp;go_next_state <span style="color: black; font-style: italic;">; вычисляем следующее состояние</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">cmp</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">bl</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">18</span> &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; последнее состояние --&gt; выход</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jae</span> &nbsp; &nbsp; quit<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">push</span> &nbsp; &nbsp;<span style="color: #46aa03; font-weight: bold;">eax</span> <span style="color: #46aa03; font-weight: bold;">ecx</span> &nbsp; &nbsp; <span style="color: black; font-style: italic;">; берем первый байт инструкции из</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">cl</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">bh</span> &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; результата функции, и патчим себя</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">bh</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">eax</span><span style="color: #339933;">,</span> jtab<span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">ebx</span><span style="color: #339933;">*</span><span style="color: #ff0000;">4</span><span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">mov</span> &nbsp; &nbsp; <span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">eax</span><span style="color: black;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">cl</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">pop</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">ecx</span> <span style="color: #46aa03; font-weight: bold;">eax</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; jtab<span style="color: black;">&#91;</span><span style="color: #46aa03; font-weight: bold;">ebx</span><span style="color: #339933;">*</span><span style="color: #ff0000;">4</span><span style="color: black;">&#93;</span> <span style="color: black; font-style: italic;">; переходим на действие</span><br/>
<br/>
quit<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; retn<br/>
<br/>
jtab &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;label &nbsp; <span style="color: #0000ff; font-weight: bold;">dword</span> &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; таблица указателей на действия</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; index = номер действия =</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;s00<span style="color: #339933;">,</span>s01 &nbsp; &nbsp; <span style="color: black; font-style: italic;">; &nbsp; &nbsp; &nbsp; = номер состояния</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;s02<span style="color: #339933;">,</span>s03<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;s04<span style="color: #339933;">,</span>s05<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;s06<span style="color: #339933;">,</span>s07<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;s08<span style="color: #339933;">,</span>s09<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;s10<span style="color: #339933;">,</span>s11<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;s12<span style="color: #339933;">,</span>s13<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;s14<span style="color: #339933;">,</span>s15<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;s16<span style="color: #339933;">,</span>s17<br/>
s00<span style="color: #339933;">:</span><br/>
s01<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; xor &nbsp; &nbsp; edx, edx</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;?<span style="color: #339933;">,</span><span style="color: #ff0000;">0D2h</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; cycle<br/>
s02<span style="color: #339933;">:</span><br/>
s03<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; lea &nbsp; &nbsp; esi, msg</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;?<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;offset msg<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; cycle<br/>
s04<span style="color: #339933;">:</span><br/>
s05<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; mov &nbsp; &nbsp; ecx, msg_size</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;?<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">dd</span> &nbsp; &nbsp; &nbsp;msg_size<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; cycle<br/>
s06<span style="color: #339933;">:</span><br/>
s07<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; xor &nbsp; &nbsp; [esi], dh</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;?<span style="color: #339933;">,</span><span style="color: #ff0000;">36h</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; cycle<br/>
s08<span style="color: #339933;">:</span><br/>
s09<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; sub &nbsp; &nbsp; dh, dl</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;?<span style="color: #339933;">,</span><span style="color: #ff0000;">0F2h</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; cycle<br/>
s10<span style="color: #339933;">:</span><br/>
s11<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; inc &nbsp; &nbsp; esi</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;?<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; cycle<br/>
s12<span style="color: #339933;">:</span><br/>
s13<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; dec &nbsp; &nbsp; ecx</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;?<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; cycle<br/>
s14<span style="color: #339933;">:</span><br/>
s15<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; inc &nbsp; &nbsp; dl</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;?<span style="color: #339933;">,</span><span style="color: #ff0000;">0C2h</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; cycle<br/>
s16<span style="color: #339933;">:</span><br/>
s17<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black; font-style: italic;">; cmp &nbsp; &nbsp; dl, 'Z'</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff; font-weight: bold;">db</span> &nbsp; &nbsp; &nbsp;?<span style="color: #339933;">,</span><span style="color: #ff0000;">0FAh</span><span style="color: #339933;">,</span><span style="color: #7f007f;">'Z'</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">jmp</span> &nbsp; &nbsp; cycle<br/>
&nbsp;</div>
<p>Теперь, чтобы пронять логику работы программы, надо взять функцию, и получить все ее значения для всех возможных состояний, а затем составить таблицу переходов между состояниями, и заменить их на jz/jnz. После этого, если программа не была спроектирована как конечный автомат, так, как это показано в начале статьи, то можно будет реверсировать ее в классические си-конструкции типа if, for, while.</p>
<p>На этом перейдем к теории.</p>
<p>Самое интересное заключается в том, что все показанные здесь преобразования кода возможно осуществлять автоматически, то есть конвертировать части обычных бинарных программ или сорцов в конечные автоматы и/или заменять порядок выполнения команд функцией.</p>
<p>Предположим, что в качестве переменной части состояния автомата был бы использован не флаг ZF, а, скажем, значение регистра AL. Тогда для получения всей информации, закодированной в функции, на каждом шаге пришлось бы анализировать 256 вариантов. А если бы это был регистр AX, то при проверке первых двух байт файла на MZ, из текущего состояния было бы 65534 перехода на одну ветвь исполнения, и 2 перехода на другую ветвь. При еще больших размерах состояний, перебор всех состояний на каждом шаге стал бы еще более трудным, и тогда часть программы, отвечающая за изменение того же exe файла была бы пропущена, то есть не была бы экстрактирована из функции.</p>
<p>В идеале такая функция должна представлять собой черный ящик, в него подают текущее состояние - он возвращает следующее, а получить значение из середины последовательности крайне сложно.</p>
<p>В общем, достаточно уже сказано, и на этом я пойду выпью пивка, а вы сидите и ломайте головы над всем этим бредом - авось пригодится где-нибудь...</p>
<p><strong>Приложение (1) - программа для подсчета коэффициентов полинома. Для понимания рекомендуется знание си и самую малость линейной алгебры.</strong></p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #339933;">#include &lt;windows.h&gt;</span><br/>
&nbsp; <span style="color: #339933;">#include &lt;stdio.h&gt;</span><br/>
&nbsp; <span style="color: #339933;">#include &lt;stdlib.h&gt;</span><br/>
&nbsp; <span style="color: #339933;">#include &lt;assert.h&gt;</span><br/>
&nbsp; <span style="color: #339933;">#include &lt;io.h&gt;</span><br/>
&nbsp; <span style="color: #339933;">#include &lt;math.h&gt;</span><br/>
&nbsp; <span style="color: #339933;">#pragma hdrstop</span><br/>
<br/>
&nbsp; <span style="color: #339933;">#define float &nbsp; &nbsp;long double</span><br/>
<br/>
&nbsp; <span style="color: #993333;">int</span> N <span style="color: #339933;">=</span> <span style="color: #0000dd;">19</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; <span style="color: #993333;">float</span> X<span style="color: black;">&#91;</span><span style="color: #0000dd;">100</span><span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: black;">&#123;</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #0000dd;">2</span><span style="color: #339933;">,</span><span style="color: #0000dd;">4</span><span style="color: #339933;">,</span><span style="color: #0000dd;">6</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">8</span><span style="color: #339933;">,</span><span style="color: #0000dd;">10</span><span style="color: #339933;">,</span><span style="color: #0000dd;">12</span><span style="color: #339933;">,</span><span style="color: #0000dd;">14</span><span style="color: #339933;">,</span><span style="color: #0000dd;">16</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span><span style="color: #0000dd;">3</span><span style="color: #339933;">,</span><span style="color: #0000dd;">5</span><span style="color: #339933;">,</span><span style="color: #0000dd;">7</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">9</span><span style="color: #339933;">,</span><span style="color: #0000dd;">11</span><span style="color: #339933;">,</span><span style="color: #0000dd;">13</span><span style="color: #339933;">,</span><span style="color: #0000dd;">15</span><span style="color: #339933;">,</span><span style="color: #0000dd;">17</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #993333;">float</span> Y<span style="color: black;">&#91;</span><span style="color: #0000dd;">100</span><span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">0</span><span style="color: #339933;">+</span><span style="color: #208080;">0x3300</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">2</span><span style="color: #339933;">+</span><span style="color: #208080;">0xBE00</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">4</span><span style="color: #339933;">+</span><span style="color: #208080;">0xB900</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">6</span><span style="color: #339933;">+</span><span style="color: #208080;">0x3000</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">8</span><span style="color: #339933;">+</span><span style="color: #208080;">0x2A00</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp;<span style="color: #0000dd;">10</span><span style="color: #339933;">+</span><span style="color: #208080;">0x4600</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp;<span style="color: #0000dd;">12</span><span style="color: #339933;">+</span><span style="color: #208080;">0x4900</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">6</span><span style="color: #339933;">+</span><span style="color: #208080;">0x3000</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp;<span style="color: #0000dd;">16</span><span style="color: #339933;">+</span><span style="color: #208080;">0x8000</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">2</span><span style="color: #339933;">+</span><span style="color: #208080;">0xBE00</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">2</span><span style="color: #339933;">+</span><span style="color: #208080;">0xBE00</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">4</span><span style="color: #339933;">+</span><span style="color: #208080;">0xB900</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">6</span><span style="color: #339933;">+</span><span style="color: #208080;">0x3000</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; <span style="color: #0000dd;">8</span><span style="color: #339933;">+</span><span style="color: #208080;">0x2A00</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp;<span style="color: #0000dd;">10</span><span style="color: #339933;">+</span><span style="color: #208080;">0x4600</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp;<span style="color: #0000dd;">12</span><span style="color: #339933;">+</span><span style="color: #208080;">0x4900</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp;<span style="color: #0000dd;">14</span><span style="color: #339933;">+</span><span style="color: #208080;">0xFE00</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp;<span style="color: #0000dd;">16</span><span style="color: #339933;">+</span><span style="color: #208080;">0x8000</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp;<span style="color: #0000dd;">18</span><span style="color: #339933;">+</span><span style="color: #208080;">0x0000</span> <span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; <span style="color: #993333;">float</span> C<span style="color: black;">&#91;</span><span style="color: #0000dd;">100</span><span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; <span style="color: #993333;">float</span> calc<span style="color: black;">&#40;</span><span style="color: #993333;">float</span> X<span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #993333;">float</span> y <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> j<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> j<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> j<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; y <span style="color: #339933;">+=</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/pow.html"><span style="color: #000066;">pow</span></a><span style="color: black;">&#40;</span>X<span style="color: #339933;">,</span>j<span style="color: black;">&#41;</span> <span style="color: #339933;">*</span> C<span style="color: black;">&#91;</span>j<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">return</span> y<span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; <span style="color: #993333;">void</span> init<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #993333;">float</span><span style="color: #339933;">*</span> Z <span style="color: #339933;">=</span> new <span style="color: #993333;">float</span><span style="color: black;">&#91;</span> N<span style="color: #339933;">*</span><span style="color: black;">&#40;</span>N<span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: black;">&#41;</span> <span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/assert.html"><span style="color: #000066;">assert</span></a><span style="color: black;">&#40;</span>Z<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; <span style="color: #339933;">#define Zyx(y,x) &nbsp; &nbsp; &nbsp; Z[y*(N+1)+x]</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> y<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> y<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> y<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> x<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> x<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> x<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; Zyx<span style="color: black;">&#40;</span>y<span style="color: #339933;">,</span>x<span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/pow.html"><span style="color: #000066;">pow</span></a><span style="color: black;">&#40;</span>X<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: #339933;">,</span> x<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; Zyx<span style="color: black;">&#40;</span>y<span style="color: #339933;">,</span>N<span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> Y<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> n<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> n<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> n<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> y<span style="color: #339933;">=</span>n<span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> y<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> y<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #993333;">float</span> t <span style="color: #339933;">=</span> Zyx<span style="color: black;">&#40;</span>y<span style="color: #339933;">,</span>n<span style="color: black;">&#41;</span> <span style="color: #339933;">/</span> Zyx<span style="color: black;">&#40;</span>n<span style="color: #339933;">,</span>n<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> x<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> x<span style="color: #339933;">&lt;=</span>N<span style="color: #339933;">;</span> x<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; Zyx<span style="color: black;">&#40;</span>y<span style="color: #339933;">,</span>x<span style="color: black;">&#41;</span> <span style="color: #339933;">-=</span> Zyx<span style="color: black;">&#40;</span>n<span style="color: #339933;">,</span>x<span style="color: black;">&#41;</span> <span style="color: #339933;">*</span> t<span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> n<span style="color: #339933;">=</span>N<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> n<span style="color: #339933;">&gt;=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> n<span style="color: #339933;">--</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #993333;">float</span> s <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> t<span style="color: #339933;">=</span>n<span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> t<span style="color: #339933;">&lt;=</span>N<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> t<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; s <span style="color: #339933;">+=</span> Zyx<span style="color: black;">&#40;</span>n<span style="color: #339933;">,</span>t<span style="color: black;">&#41;</span> <span style="color: #339933;">*</span> C<span style="color: black;">&#91;</span>t<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; C<span style="color: black;">&#91;</span>n<span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: black;">&#40;</span>Zyx<span style="color: black;">&#40;</span>n<span style="color: #339933;">,</span>N<span style="color: black;">&#41;</span> <span style="color: #339933;">-</span> s<span style="color: black;">&#41;</span> <span style="color: #339933;">/</span> Zyx<span style="color: black;">&#40;</span>n<span style="color: #339933;">,</span>n<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; delete Z<span style="color: #339933;">;</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/assert.html"><span style="color: #000066;">assert</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/abs.html"><span style="color: #000066;">abs</span></a><span style="color: black;">&#40;</span>calc<span style="color: black;">&#40;</span>X<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span> <span style="color: #339933;">-</span> Y<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span> <span style="color: #339933;">&lt;</span> <span style="color:#800080;">0.0001</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; <span style="color: #993333;">void</span> main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; init<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> n<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> n<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> n<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;f(%5.2Lf) (%02X) = %5.2Lf (%04X)<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> X<span style="color: black;">&#91;</span>n<span style="color: black;">&#93;</span><span style="color: #339933;">,</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#40;</span><span style="color: #993333;">int</span><span style="color: black;">&#41;</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/ceil.html"><span style="color: #000066;">ceil</span></a><span style="color: black;">&#40;</span>X<span style="color: black;">&#91;</span>n<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span> Y<span style="color: black;">&#91;</span>n<span style="color: black;">&#93;</span><span style="color: #339933;">,</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span><span style="color: black;">&#41;</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/ceil.html"><span style="color: #000066;">ceil</span></a><span style="color: black;">&#40;</span>Y<span style="color: black;">&#91;</span>n<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;f(X) = SUMi( C[i]*X^i ), i=0..%i<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> N<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span><span style="color: #993333;">int</span> n<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> n<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> n<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;dt %30.19Le &nbsp;; C[%2i]<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> C<span style="color: black;">&#91;</span>n<span style="color: black;">&#93;</span><span style="color: #339933;">,</span> n<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
[<a style="" href="/lib/?lang=RU&amp;index=VT#vzo32">Вернуться к списку</a>] [<a href="/lib/vzo32.html#disqus_thread">Комментарии</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vzo32">de</a><a href="/lib/index.php?lang=en&amp;id=vzo32">en</a><a href="/lib/index.php?lang=es&amp;id=vzo32">es</a><a href="/lib/index.php?lang=it&amp;id=vzo32">it</a><a href="/lib/index.php?lang=fr&amp;id=vzo32">fr</a><a href="/lib/index.php?lang=pl&amp;id=vzo32">pl</a><a href="/lib/index.php?lang=ru&amp;id=vzo32">ru</a><a href="/lib/index.php?lang=ua&amp;id=vzo32">ua</a></div>
</body>
</html>
