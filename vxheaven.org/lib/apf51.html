<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Peter Ferrie, Péter Ször 'SirCamstantial Evidence' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Peter Ferrie, Péter Ször"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Ferrie, Peter; Ször, Péter,SirCamstantial Evidence, email, smtp, files, addresses, suffix, line, worm, worms, display, attempt, mail, personal, explorer, cache, referred"/>
<meta name="Description" content="Although SirCam made a name for itself sending out random files and personal documents from infected PCs, not all of the information that spread with Win32/SirCam was spread by the worm itself. Almost as soon as updated descriptions of SirCam were posted to Web sites, selected texts from these descriptions appeared on other sites, complete with identical spelling errors and inaccuracies.Evidently the emerging complexity of new 32-bit worms is proving a tough challenge for every one of us in this business: if ExploreZip was boring and difficult to analyse, SirCam was a major pain. SirCam's author tried to make sure that the analysis would not be straightforward. The worm is written in a high-level language, but all the string constants (including its email message) are encrypted in such a way that it took a little while to decrypt completely (at least for some of us)."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"1794909b4e3870bbd4da5a5d9a9d2ae398896e8b-1498757140-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/apf51.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>SirCamstantial Evidence</h1><p><a href="/lib/?lang=en&amp;author=Ferrie%2C%20Peter">Peter Ferrie</a>, <a href="/lib/?lang=en&amp;author=Sz%C3%B6r%2C%20P%C3%A9ter">Péter Ször</a><br/> <em>Virus Bulletin, September 2001, pp. 8-10</em><br/> <em>ISSN 0956-9979</em><br/> <em>September 2001</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/apf51.html';</script><div class="ci"><a href="/lib/?ci=apf51">1</a></div><img src="/img/pdf.gif" alt="PDF"/><a href="/lib/pdf/SirCamstantial%20Evidence.pdf">Download</a> PDF (148.49Kb) (You need to be registered on <a href="/forum">forum</a>)<br/>[<a style="" href="/lib/?lang=EN&amp;index=AN#apf51">Back to index</a>] [<a href="/lib/apf51.html#disqus_thread">Comments</a>]<br/> <form method="post" action=""><input type="hidden" name="pages" value="1"/><input type="submit" value="Turn on page numbers"/></form>
<address>
Peter Ferrie and Péter Ször<br/>
Symantec Corporation, USA
</address>
<ul>
<li><a href="#c1">Start Your Engines</a></li>
<li><a href="#c2">Spread the Word</a></li>
<li><a href="#c3">Randamn</a></li>
<li><a href="#c4">I'm Sending You a Letter</a></li>
<li><a href="#c5">Compositions</a></li>
<li><a href="#c6">I'm Sending You a File ...</a></li>
<li><a href="#c7">Conclusion</a></li>
</ul>
<p>Although SirCam made a name for itself sending out random files and personal documents from infected PCs, not all of the information that spread with Win32/SirCam was spread by the worm itself. Almost as soon as updated descriptions of SirCam were posted to Web sites, selected texts from these descriptions appeared on other sites, complete with identical spelling errors and inaccuracies.</p>
<p>Evidently the emerging complexity of new 32-bit worms is proving a tough challenge for every one of us in this business: if ExploreZip was boring and difficult to analyse, SirCam was a major pain. SirCam's author tried to make sure that the analysis would not be straightforward. The worm is written in a high-level language, but all the string constants (including its email message) are encrypted in such a way that it took a little while to decrypt completely (at least for some of us).</p>
<h2><a name="c1"></a>Start Your Engines</h2>
<p>Win32/SirCam usually arrives as an attachment to an email. This attachment is special, because it contains not only SirCam itself, but an additional file (attached to the end of SirCam), which has been 'stolen' from the Personal or Desktop directory of the sender's computer.</p>
<p>When this attachment is run, SirCam will detach the stolen file and display it. The way in which the file is displayed depends on its suffix. If the suffix is .doc, SirCam will attempt to run <em>WinWord</em>. If this fails, then <em>WordPad</em> will be used instead. If the suffix is .xls, SirCam will run <em>Excel</em>. If the suffix is .zip, SirCam will run <em>WinZip</em>. If the suffix matches none of these, SirCam will run rundll32. Even in the event that no suitable application can be found to display the file, SirCam will install itself in the system. There is the additional risk that the stolen file might contain confidential information, or even macro viruses, in the case of <em>WinWord</em> and <em>Excel</em> documents, which SirCam will help to spread further.</p>
<p>SirCam begins installation by attempting to copy itself into the Recycle Bin. It is assumed that this is called 'Recycled', and that it is located on the drive that contains <em>Windows</em> (the hard-coded directory name is the one thing that prevents SirCam from functioning correctly in <em>Windows NT/2000/XP</em>, in which the Recycle Bin is named 'Recycler').</p>
<p>Once SirCam has placed itself in the Recycle Bin, where it is hidden from the view of programs such as <em>Explorer</em>, SirCam will copy itself to the System directory, using the name 'SCam32.exe'. A new value, Driver32, is placed in the RunServices key in the registry, which refers to the SCam32.exe file. Thus, the worm will run whenever <em>Windows</em> is booted.</p>
<p>Additionally, SirCam.exe installs itself as the application that handles requests to run other .exe files, by changing the exefile Open key (HKCR\exefile\shell\open\command) in the registry. In this way, SirCam gains control whenever an application is run. This is not a new technique. In fact, the PrettyPark worm was one of the first viruses to utilize this technique, more than two years ago.</p>
<p>Not content with such control, SirCam will also watch for requests to run applications in the Desktop directory (referred to by ...\Explorer\Shell Folders\Desktop in the registry). When such a request is made, SirCam will prepend itself to the specified file, before running the application! Thus, even if the registry is restored and the files are removed from the Recycle Bin, infected files could remain in the Desktop directory.</p>
<h2><a name="c2"></a>Spread the Word</h2>
<p>After installation is complete, SirCam will search the local network for computers which allow unrestricted access. SirCam will copy itself to the Recycled directory on each unprotected computer that is found and append a line to the Autoexec.bat file. The line will run the SirCam file from the Recycle Bin whenever the computer is booted. Then SirCam will rename rundll32.exe to run32.exe in the Windows directory on the remote computer, and create another copy of SirCam in its place. Neither the copying of the SirCam files to remote computers nor the emailing to other users occurs in <em>Windows NT/2000/XP</em>, however each of the other effects can be observed.</p>
<h2><a name="c3"></a>Randamn</h2>
<p>The date-activated trigger is checked at this point, however two factors prevent it from working. The least significant of these factors is the dependency on the date format used by the computer, which SirCam requires to be dd/mm/yy (as opposed to mm/dd/yy, for example). However, the more significant factor is that the trigger contains a random component, but the random number generator is never initialized, resulting in there being no chance of producing the required condition.</p>
<p>Unfortunately, there are two other ways in which the payload can be activated. One is by renaming one of the three files, SirC32.exe, SCam32.exe, or rundll32.exe, to another name and running that file. The other is to run an attachment whose stolen file contains the characters 'FA2' not followed immediately by the characters 'sc'. The
 
payload deletes all files in all directories on the drive that contains <em>Windows</em>.</p>
<p>The missing randomiser initialization prevents SirCam from copying itself to the Windows directory as ScMx32.exe, and copying itself to the Startup directory (referred to by ...\Explorer\Shell Folders\Startup in the registry) as Microsoft Internet Office.exe. It also prevents SirCam from creating, on October 16, a file that fills the remaining disk space.</p>
<h2><a name="c4"></a>I'm Sending You a Letter</h2>
<p>When SirCam is run for the first time, it will change <em>Internet Explorer</em>'s Download directory (referred to by HKCU\Software\Microsoft\Internet Explorer\Download Directory in the registry) to point to the Desktop directory, in order to maximize the use of the prepending routine mentioned earlier.</p>
<p>During the second execution, SirCam will gather email addresses into files stored in the System directory. SirCam searches for email addresses in <em>Internet Explorer</em>'s Cache directory (referred to by HKCU\Software\Microsoft\WindowsCurrentVersion\Explorer\Shell Folders\Cache in the registry), the user's Personal directory (referred to by HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\Personal in the registry), and the directory that contains the <em>Windows</em> Address Books (referred to by HKCU\Software\Microsoft\WAB\WAB4\Wab File Name in the registry), in files whose name begins with 'sho', 'get', or 'hot', or whose suffix is 'htm' or 'wab'.</p>
<p>Thus, SirCam creates a file called scy1.dll, which contains the addresses from %cache%\sho* files, sch1.dll contains the addresses from %cache%\get* and %cache%\hot* files, sci1.dll contains the addresses from %cache%\*.htm files, sct1.dll contains the addresses from %personal%\*.htm files, and scw1.dll contains the addresses found in *.wab files.</p>
<p>If the Address Book registry key is not found, SirCam will search for WAB files in the System directory instead. After creating the lists of email addresses, SirCam will search for fil[Ces to attach to the emails that it will send. The list that is created consists of the name of every .doc, .xls, and .zip file in the user's Personal and Desktop directory and is called scd.dll. An apparent oversight on the part of SirCam's author prevents the inclusion of .exe files in the list.</p>
<p>On the third and subsequent runs, and if an active connection to the Internet exists, SirCam will retrieve the information required to send email using SMTP. Sending mail using SMTP avoids relying on an email program such as <em>Outlook</em>. The SMTP information consists of the current user's email address (HKCU\Software\Microsoft\Internet Account Manager\Default Mail Account\Accounts\SMTP Email Address in the registry), the address of the email server (HKCU\Software\Microsoft\Internet Account Manager\Default Mail Account\Accounts\SMTP Server in the registry) and the user's display name (HKCU\Software \Microsoft\Internet Account Manager\Default Mail Account\Accounts\SMTP Display Name in the registry).</p>
<p>If, for some reason, this information does not exist, SirCam will use prodigy.net.mx as the email server, and the user's logon name as the email address and display name. Then SirCam will attempt to connect to an email server. First, it will try the user's own email server (or prodigy.net.mx). If this fails, SirCam will attempt to connect to the email server of the person who sent the infected email. This is possible because SirCam carries within it the email information of the previously infected person. If this connection fails, then SirCam will attempt to connect to goeke.net, then enlace.net, then doubleclick.com.mx.</p>
<h2><a name="c5"></a>Compositions</h2>
<p>If one of the connections to an email server is successful, an email is constructed in the following way: if the language used on the current user's computer is Spanish, SirCam will send email in Spanish, otherwise it will use English.</p>
<p>The email body consists of three lines. The first line of the email body is always 'Hola como estas?' in Spanish, and 'Hi! How are you?' in English; the third line is always 'Nos vemos pronto, gracias.' in Spanish, and 'See you later. Thanks' in English. The second line is chosen from the following list, in Spanish:</p>
<ul>
<li>'Te mando este archivo para que me des tu punto de vista'</li>
<li>'Espero me puedas ayudar con el archivo que te mando'</li>
<li>'Espero te guste este archivo que te mando'</li>
<li>'Este es el archivo con la informacion que me pediste'</li>
</ul>
<p>and, in English:</p>
<ul>
<li>'I send you this file in order to have your advice'</li>
<li>'I hope you can help me with this file that I send'</li>
<li>'I hope you like the file that I sendo [sic] you'</li>
<li>'This is the file with the information that you ask for'</li>
</ul>
<p>However, since the randomiser is not initialized, the choice is reduced to the first line alone, until October 16, or until SirCam has been run at least 8000 times, at which point the last line can be chosen, too.</p>
<p>As long as an active connection to the Internet exists, SirCam will send email to every address in each of the email lists that it created. It will send an email three times to each address in the scw1.dll list, then once each to all the other addresses, in the order: scy1.dll, sch1.dll, shi1.dll, and sht1.dll, before starting again with scw1.dll.</p>
<p>SirCam keeps the current mailing position in the registry, so if the connection is broken and restored later, SirCam can continue to send mail as though it were never interrupted.</p>
 
<p>Interestingly, SirCam ensures that the current user never receives an email from SirCam. In the case that the recipient is the current user, SirCam will send the mail instead to email address <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="a1ced5d3ced3cecdcdcee1c4d2ccc0d28fc2cecc8f">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></p>
<h2><a name="c6"></a>I'm Sending You a File ...</h2>
<p>For each email it sends, SirCam will randomly select a file from the scd.dll list, prepend itself to that file, attach an additional extension, chosen randomly from 'pif', 'lnk', 'bat', or 'com', and send the email. The lack of the randomiser initialisation has no impact on the emailing routine. If an Internet connection exists for long enough, eventually every recipient will receive multiple copies of every file in the list, and among those copies all four of the random extensions will be represented. To avoid overloading email servers, SirCam remains idle for one minute between sending each email.</p>
<p>In some ways, SirCam's success has had much to do with luck: the emails SirCam constructs are unintentionally malformed such that it appears, to some email scanning products, that the mail contains no attachment. This has allowed the worm to slip past some gateway scanners, though this is far from the sole reason for SirCam's widespread distribution.</p>
<h2><a name="c7"></a>Conclusion</h2>
<p>Evidently SMTP propagation is the hot topic of the year. Even the first Win32 mass-mailer, Parvo (see <em>VB</em>, January 1999) used an SMTP engine. However, most of the worms that have utilized SMTP mailing so far have got a few things wrong. Thanks to the implementation mistakes and bugs, it was a little while before SMTP worms could take their real place. Most of the previous worms have lacked some important detail in their spreading mechanism. For instance, Magistr often sends clean files or files that will not run on the recipients' computers because of some missing DLLs. As VBS creations are controlled with proactive technologies, so virus writers turn their attention to the creation of more dangerous binary worms. One thing is for sure: there is more to come!</p>
<table summary="W32/SirCam.worm">
<tr><th colspan="2">W32/SirCam.worm</th></tr>
<tr><td>Aliases:</td><td><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="6a3d595844390318090b07443d0518072a0707">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>, <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="5d0a34336e6f720e342f1e3c301d3030">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>, Backdoor.SirCam.</td></tr>
<tr><td>Type:</td><td>Win32 SMTP mass-mailer worm, prepender.</td></tr>
<tr><td>Payload:</td><td>Propagates confidential files, attempts to delete all files on disk, attempts to eat up free space on disk.</td></tr>
<tr><td>Removal:</td><td>Fix registry and modified files, delete standalone worm copies, restore infected ones from backups.</td></tr>
</table>
 
[<a style="" href="/lib/?lang=EN&amp;index=AN#apf51">Back to index</a>] [<a href="/lib/apf51.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=apf51">de</a><a href="/lib/index.php?lang=en&amp;id=apf51">en</a><a href="/lib/index.php?lang=es&amp;id=apf51">es</a><a href="/lib/index.php?lang=it&amp;id=apf51">it</a><a href="/lib/index.php?lang=fr&amp;id=apf51">fr</a><a href="/lib/index.php?lang=pl&amp;id=apf51">pl</a><a href="/lib/index.php?lang=ru&amp;id=apf51">ru</a><a href="/lib/index.php?lang=ua&amp;id=apf51">ua</a></div>
</body>
</html>
