<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> BlueOwl 'Implementing genetic algorithms in virusses' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="BlueOwl"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, BlueOwl,Implementing genetic algorithms in virusses, chance, virus, mutations, genes, small, call, legs, genetic, virusses, change, dogs, computer, survive, completely, bits"/>
<meta name="Description" content="I have personally always been fascinated by evolution and am a strong believer that it is the truth about how organisms evolve. I have also spend many thoughts and codes and readings trying to figure out if it could also be implemented in computer virusses, of course something completely different.Normally computer virusses either don't change them selves (static), they encrypt themselves with one or multiple decryptors or they completely change their body (hard to do). With the second and the third way virusses try to completely change their layout / code use / register use etc. This theory will try to prove that another way could be better.In this theory I mainly describe how a fileinfecting virus could use genetics. This can however be applied to any spreading program including worms, as long as you can be creative."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"f21c12efd1a502fb0553ba1b8231de22d8da8222-1498756476-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vbo00.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Implementing genetic algorithms in virusses</h1><p><a href="/lib/?lang=en&amp;author=BlueOwl"> BlueOwl</a><br/> <em><a href="/vx.php?fid=1375#f1375">Ready Rangers Liberation Front [5]</a></em><br/> <em>November 2004</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vbo00.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=AI#vbo00">Back to index</a>] [<a href="/lib/vbo00.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li><a href="#c1">Introduction</a></li>
<li><a href="#c2">Darwinian evolution - theory</a></li>
<li><a href="#c3">So in short</a></li>
<li><a href="#c4">Binary organisms</a></li>
<li><a href="#c5">Binary and biologic: the connection</a></li>
<li><a href="#c6">Genetic algorithms</a></li>
<li><a href="#c7">Selecting appropriate genes</a></li>
<li><a href="#c8">Mutations</a></li>
<li><a href="#c9">Code example</a></li>
<li><a href="#ca">Final Word</a></li>
</ul>
<h2><a name="c1"></a>Introduction</h2>
<p>I have personally always been fascinated by evolution and am a strong believer that it is the truth about how organisms evolve. I have also spend many thoughts and codes and readings trying to figure out if it could also be implemented in computer virusses, of course something completely different.</p>
<p>Normally computer virusses either don't change them selves (static), they encrypt themselves with one or multiple decryptors or they completely change their body (hard to do). With the second and the third way virusses try to completely change their layout / code use / register use etc. This theory will try to prove that another way could be better.</p>
<p><strong>Note!</strong> In this theory I mainly describe how a fileinfecting virus could use genetics. This can however be applied to any spreading program including worms, as long as you can be creative.</p>
<h2><a name="c2"></a>Darwinian evolution - theory</h2>
<p>Ok, so in short. What is Darwinian evolution? Let assume we have one species, let us say dogs. And lets assume that they are put in the jungle without humans around. You probably know there are lots of different dogs. Small, thin, big with long/small tales large/small beaks etc. etc. So all these different ones are dumped into the jungle.</p>
<p>Some would die because they could not find something to eat. Some because they were caught and eaten by lions. Some would fall and drown in rivers. Etc. But as you could imagine: From all those tens of thousands of dogs a few would still probably survive, because they were best adapted to the jungle. These remaining dogs would then mate and produce offspring. Some of these new dogs would be better adjusted to the environment, some worse. So some of this new generation would die but a lot of them would not, because they resembled their dog parents which <em>could</em> survive.</p>
<p>With Darwinian evolution it is all about this. The strongest survive, and the offspring of these strongest will survive event better or worse. Ultimately creating the "perfect" species.</p>
<h2><a name="c3"></a>So in short</h2>
<p>Okay, so reading from the text above there are x core factors:</p>
<ul>
<li>Each individual has a certain DNA which depends what it is, small thin, with long hair/short hair etc.</li>
<li>The environment kills individuals with certain characteristics, for example some dogs have long legs to run fast with so they can outrun lions, the ones with short legs are killed and eaten.</li>
<li>Dogs which <em>do</em> survive because of their positive characteristics will produce offspring which resembles them, thus they have a lot of the same characteristics but with a small number of changes. These changes will depend whether this individual will do better or worse than its parents.</li>
</ul>
<h2><a name="c4"></a>Binary organisms</h2>
<p>This theory said, lets talk about modern computer virusses and evolution theory. What's the use of genetics in computer virusses?</p>
<p>In the virus world, of course, there are no "natural" enemies. No lions, rivers, etc. etc. There is only one enemy: antivirusses. When an antivirus finds a virus, it will be removed. Killed. To detect virusses antivirusses have 2 ways: virus specific and virus unspecific (heuristic).</p>
<p>The first method means a virus on the loose is 'caught'. Someone who is infected by it and sends it over to antivirus offices for analysing. It will get fully or partially analysed by antivirus personnel and a detection routine for it is generated. This is sent to all people owning the antivirus and thus they become 'immune' to the virus.</p>
<p>The second way for detecting virusses in general is for the antivirus to check for virus-like signs and suspicious things. What kind of things are suspicious and what things are not have been decided by the software authors. Some virusses will not get detected though, because they don't match the 'description'. The programmer cannot add an unlimited number of 'recognisers' because the more he adds the higher the chance will be a non-virus will fit the description.</p>
<h2><a name="c5"></a>Binary and biologic: the connection</h2>
<p>First let us talk about unspecific detection. With this detection virusses are detected on what they do. The antivirus can detect them on the changes they make to files they infect. But as I said before: Some virusses <em>do not</em> get detected. This is of course because each virus can have its own way of doing it.</p>
<p>If we would compare this with a dog with long or short legs, we get a remarkably good comparison. If a dog has short legs he dies, and with long legs he survives. If a virus has one way of infecting it gets detected, if it uses another it does not.</p>
<p>So what way is best for the virus to use? That's unknown. Just like a dog with short or long legs does not <em>know</em> if it will survive, a virus won't either. For the dog species in total it is not a problem. Some dogs will die but new dogs will take their places. For a virus species it *is* a problem. Simply because there are no different kinds of one virus. Even if the virus is polymorphic (self changing), it will still be a problem because a polymorphic virus survivor has no way of 'knowing' what combination worked. So it would be like a long-legged parent getting both long-legged and short-legged offspring.</p>
<p>Here comes the idea of genetics and DNA for virusses to mind. What if the virus could 'remember' what kind of infection it did and pass it on with some slight modifications to its children. If it did that it could truly evolute like the dogs would.</p>
<p>The same goes for specific detection. Let us say the antivirus researcher analyses the virus and finds a kind of infection. It is added to the virus database and all virusses using that kind will be detected and removed. Virusses using another one because of other DNA won't be removed and will take the place of the previous virus sample. That way virus evolution is complete: as long as not <em>all</em> virus samples have been added to the detection database, some will escape detection, live on and breed.</p>
<h2><a name="c6"></a>Genetic algorithms</h2>
<p>Genetic algorithms can be considered reasonably simple with a few things maybe harder to understand (and code). The structure of the, in my opinion, best genetic engine would be (explained later):</p>
<p>For each file to infect:</p>
<ol>
<li>Save virus DNA</li>
<li>Mutate virus DNA</li>
<li>Infect file</li>
<li>Restore virus DNA</li>
</ol>
<p>Firstly let us talk about the infection of the file. In this routine every possible genetic step (*) is made in the way of:</p>
<pre class="source">&gt; if (stepxgene==0){ do first way } else { do second way }</pre>
<p>To make the process more efficient it is the easiest to give all steps a fixed number of possibilities, Fe. all four possibilities. This will help in determining the way you are going to <em>store</em> the DNA. If you are thinking about multiple DNA steps per byte I would encourage you to use a number in the range of 2^... so you can use the maximum number of bits available.</p>
<p>The save/mutate/restore may be a little bit harder to understand why it is done. The ultimate reason is the fact that this way the file will be infect according to DNA of the virus's OFFSPRING. That way the offspring 'knows' <em>exactly</em> what it consists of. If the virus would only give its copy a mutated DNA under infection evolution would stay behind a little. Fe. A virus has DNA A and infects a file in way A but gives its copy DNA B. Also a problem is the fact that all files infected by one virus will be infected in exactly the same way. And you don't see all the puppies of a dog look the same.</p>
<h2><a name="c7"></a>Selecting appropriate genes</h2>
<p>What to make genetic and what not is another topic to think about and it is debatable. The real question is whether or not something is useful to be genetic. Fe. human hair colour is genetic, but fingerprints are even with one-egg twins different. Finger prints were in through the evolution of man clearly of no importance. You can add anything which you like to make genetic, but a problem comes up when you have something like:</p>
<pre class="source">
if(gene==0){ ...
	if (anothergene==0){ ... } else { ... }
		...
	} else {
		...
		if (yetanothergene==0){ ... } else { ... }
		...
	}
</pre>
<p>Of course it is possible, but when you look at it more closely you will notice that the importance of a gene declines, f.e.:</p>
<pre class="source">if (...){ if (...){ if (...){ ... } ..}..}</pre>
<p>If the first "if" gene will mutate all the inner genes won't get executed anymore, and a much bigger adaptation is made than when an inner gene is changed. So to be 'fair' you would have to make the chance of mutation smaller on more important genes. It is a problem which you can live with but I would recommend trying to avoid it and keeping it in this format:</p>
<pre class="source">
	if (...) { ... }
	...
	if (...) { ... }
	...
	if (...) { ... }
	...
	...
</pre>
<p>Furthermore, do not get carried away when creating genes. I mean do not create a self destruct gene. ;) And make sure all options are compatible! The best way to test for this is to put all genes first to zero, than to one etc. to the end number of different options. You can't test all combination individually anyway.</p>
<h2><a name="c8"></a>Mutations</h2>
<p>Mutations are the essence of evolution. Without it, of course, everything would stay the same. So the engine should make a change sometimes. However this is another thing to think about: How often should something be changed? If too much is changed virusses could be completely different to soon and the effect of evolution lost. But if it changed too slow it could be not variable enough to escape detection and come up with new ways. Anyway, it is debatable.</p>
<p>Furthermore, the number of possible mutations shouldn't also be static. So to stick to nature, every gene should independently have a certain chance of changing. My algorithm is (ASM):</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span>&nbsp; &nbsp; rand&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; eax = random</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">xchg</span>&nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">eax</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">edx</span>&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; (each bit has a chance of 1 in 2 to be 1)</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span>&nbsp; &nbsp; rand&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; eax = random</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">and</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">edx</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">eax</span>&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; chance 1 in 4</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span>&nbsp; &nbsp; rand<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">and</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">edx</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">eax</span>&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; chance 1 in 8</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span>&nbsp; &nbsp; rand<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">and</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">edx</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">eax</span>&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; chance 1 in 16</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">call</span>&nbsp; &nbsp; rand<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">and</span> &nbsp; &nbsp; <span style="color: #46aa03; font-weight: bold;">edx</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">eax</span>&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">; chance 1 in 32</span><br/>
&nbsp;</div>
<p>So in this example, at the end, every bit in edx has a chance of one in thirty-two to be 1; while all others are zero. Thus because a dword consists out of 32 bits, the average should be one bit 1 each time at the end of this proc. However 0, 2, 3, 4 ... 32 bits 1 are also possibilities, but the chance 32 bits are 1 is a number of one in 48 digits. So we are save to assume too big mutations will almost never happen.</p>
<p>So after getting this value we simply xor it with the dna (given the fact it only consists out of one dword). Giving a small number or no mutations.</p>
<div class="asm" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #00007f; font-weight: bold;">xor</span> &nbsp; &nbsp; <span style="color: black;">&#91;</span>dna<span style="color: black;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #46aa03; font-weight: bold;">edx</span><br/>
&nbsp;</div>
<h2><a name="c9"></a>Code example</h2>
<p>To give and example of how this <em>could</em> be implement I have coded this simple polymorphic engine. Actually it is not <em>that</em> simple and may be hard to understand, since I optimized most things about it. It has 2 parts which contain genetics. A DNA variable (called DNA), and a register container. These are firstly saved at the start of the engine and then the originals are altered. Then it generates a decryptor according to these.</p>
<p>The decryptor is then generated in the following way: All parts of the decryptor have four possible options (see the part under &lt;call load_table&gt;). So from the DNA each time 2 bits (can be 0,1,2,3) are read and used to pick the correct genetically specified option. If you check this out maybe you will learn some new techniques, but don't try to understand it too much :) (blame my coding style ;)).</p>
<h2><a name="ca"></a>Final Word</h2>
<p>First of all, I hope you have enjoyed reading my article. As i am very interested in the subject myself, i liked to write something about this. I have already read other people thinking and writing about this subject, and i like it. I also hope this will enspire you to do new things with your codings, even completely different. This is not <em>necessarily</em> the best idea.</p>
<a href="/vx.php?id=eb06">BGPE - BlueOwls Genetic Poly Engine (Simple version)</a>
<div align="right"><em>BlueOwl november 2004</em></div>
[<a style="" href="/lib/?lang=EN&amp;index=AI#vbo00">Back to index</a>] [<a href="/lib/vbo00.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vbo00">de</a><a href="/lib/index.php?lang=en&amp;id=vbo00">en</a><a href="/lib/index.php?lang=es&amp;id=vbo00">es</a><a href="/lib/index.php?lang=it&amp;id=vbo00">it</a><a href="/lib/index.php?lang=fr&amp;id=vbo00">fr</a><a href="/lib/index.php?lang=pl&amp;id=vbo00">pl</a><a href="/lib/index.php?lang=ru&amp;id=vbo00">ru</a><a href="/lib/index.php?lang=ua&amp;id=vbo00">ua</a></div>
</body>
</html>
