<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Tony Abou-Assaleh, Nick Cercone, Vlado Keselj, Ray Sweidan 'Detection of New Malicious Code Using N-grams Signatures' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Tony Abou-Assaleh, Nick Cercone, Vlado Keselj, Ray Sweidan"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Abou-Assaleh, Tony; Cercone, Nick; Keselj, Vlado; Sweidan, Ray,Detection of New Malicious Code Using N-grams Signatures, virus, table, collection, limit, analysis, based, code, grams, profile, text, executable, detecting, language, computer, values"/>
<meta name="Description" content="Signature-based malicious code detection is the standard technique in all commercial anti-virus software. This method can detect a virus only after the virus has appeared and caused damage. Signature-based detection performs poorly when attempting to identify new viruses. Motivated by the standard signature-based technique for detecting viruses, and a recent successful text classification method, n-grams analysis, we explore the idea of automatically detecting new malicious code. We employ n-grams analysis to automatically generate signatures from malicious and benign software collections. The n-grams-based signatures are capable of classifying unseen benign and malicious code. The datasets used are large compared to earlier applications of n-grams analysis."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"4dc6fc5ae12d5069e88087c9c6ff0bd280e85bac-1498756080-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/aat03.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Detection of New Malicious Code Using N-grams Signatures</h1><p><a href="/lib/?lang=en&amp;author=Abou-Assaleh%2C%20Tony">Tony Abou-Assaleh</a>, <a href="/lib/?lang=en&amp;author=Cercone%2C%20Nick">Nick Cercone</a>, <a href="/lib/?lang=en&amp;author=Keselj%2C%20Vlado">Vlado Keselj</a>, <a href="/lib/?lang=en&amp;author=Sweidan%2C%20Ray">Ray Sweidan</a><br/> <em>Proceedings of Second Annual Conference on Privacy, Security and Trust, October 13-15, 2004</em><br/> <em>October 2004</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/aat03.html';</script><img src="/img/pdf.gif" alt="PDF"/><a href="/lib/pdf/Detection%20of%20New%20Malicious%20Code%20Using%20N-grams%20Signatures.pdf">Download</a> PDF (358.54Kb) (You need to be registered on <a href="/forum">forum</a>)<br/>[<a style="" href="/lib/?lang=EN&amp;index=AT#aat03">Back to index</a>] [<a href="/lib/aat03.html#disqus_thread">Comments</a>]<br/> <form method="post" action="">
<img src="/img/cache/0b9fd596a90421f9f1f68a9760275737.gif" alt="\text{T_EX size}" valign="middle"/>
<select name="TeX_size"><option value="-2">-2</option><option value="-1">-1</option><option value="0" selected="selected">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option> </select>
<input type="submit" value="Scale"/>
</form><form method="post" action=""><input type="hidden" name="pages" value="1"/><input type="submit" value="Turn on page numbers"/></form>
<address>
Privacy and Security Laboratory, Faculty of Computer Science<br/>
Dalhousie University, Canada<br/>
Email: {taa,nick,vlado,<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="d5a6a2b0bcb1b4bba895b6a6fbb1b4b9fbb6b4">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>
</address>
<h2>Abstract</h2>
<p>Signature-based malicious code detection is the standard technique in all commercial anti-virus software. This method can detect a virus only after the virus has appeared and caused damage. Signature-based detection performs poorly when attempting to identify new viruses. Motivated by the standard signature-based technique for detecting viruses, and a recent successful text classification method, n-grams analysis, we explore the idea of automatically detecting new malicious code. We employ n-grams analysis to automatically generate signatures from malicious and benign software collections. The n-grams-based signatures are capable of classifying unseen benign and malicious code. The datasets used are large compared to earlier applications of n-grams analysis.</p>
<h2>I. Introduction</h2>
<p>Since the appearance of the first computer virus in 1986, a significant number of new viruses has appeared every year.<sup><a href="#f1" name="b1">1</a></sup> This number is growing and it threatens to outpace the manual effort by anti-virus experts in designing solutions for detecting them and removing them from the system [5]. Even without this threat, the traditional approach consists of waiting for a number of computers to be infected, detecting the virus, designing a solution, and delivering and deploying the solution. A significant damage is done during this process. To address this problem, we explore solutions based on machine learning and not strictly dependent on certain viruses. It would not be feasible to design a general anti-virus tool that could replace a human expert or be as reliable as the exact solutions for known viruses, but such a solution would be of a great benefit in warning against new viruses, in aiding experts in finding a good signature for a new virus, and in adaptable solutions for different users.<sup><a href="#f2" name="b2">2</a></sup></p>
<p>The term <em>virus</em> is commonly used for malicious code, but for clarity reasons, we will use the term <em>malicious</em> code in further discussion, since it is relevant for all kinds of malicious code, such as viruses, worms, and Trojan horses.</p>
<p>Since the specific substrings of malicious code (MC), or signatures, are typically used to detect certain type of MC, it is natural to use sets of such substrings as indicators for MC detection. <em>N-grams</em> - all substrings of a file of a fixed length <em>n</em> - are a candidate for such a set that can be efficiently collected. The idea of using n-grams for MC analysis is not new. In 1994, a byte n-gram-based method for automatic extraction of virus signatures was described in [5]. Similarly, an n-gram-based method is used in a proposal for a "computer immune system" in [6]. However, there is little literature on this approach after 1994.</p>
<p>The <em>word</em> n-gram analysis, which uses a window of n consecutive words, has been used for a while in natural language processing (NLP). For example, it is successfully used in language modelling and speech recognition [4]. On the other hand, the <em>character</em> n-gram analysis was only sparsely used. In 1994, character n-grams were used for text categorization in [3] with modest results. The Common N-Gram analysis (CNG) method [7] for text classification has been recently successfully used in automatic authorship attribution [7], detection of dementia of Alzheimer's type [8], and text clustering. The CNG method was motivated by an approach introduced by W. R. Bennett in 1976 [2], in which the letter bi-gram frequencies were used in authorship attribution.</p>
<p>Byte n-grams of a file are overlapping substrings, collected in a sliding-window fashion where the windows of size <em>n</em> slides one byte at a time. Concordantly, they do not capture just statistics about substrings of length <em>n</em>, but they implicitly capture frequencies of longer substrings as well. This phenomenon was noted in NLP, where tri-grams frequently perform very well even though they seem to be too short to capture any significant information. N-grams have the ability to capture implicit features of the input that are difficult to detect explicitly. As a growing number of MC writers use tools to write and compile their code, n-grams could detect features of the code that are specific for certain tools, or families of tools, including code generators, compilers, and programming environment. In addition, n-grams could capture features that are specific for authors, coding styles, or even behavioural features.</p>
<p>Given a database of MC and benign code (BC), n-gram analysis can be used to extract the most frequent n-grams, which act as signatures. When a new code is analyzed, it can be classified as benign or malicious based on the category that it matches the most. Thus, n-grams could predict the maliciousness of unseen code and capture new viruses that share features with previously learned viruses. Since the captured
 
features are implicit in the extracted n-grams, it would be difficult for virus writers to deliberately write viruses that fool n-gram analysis even when they have full access to the detection algorithm.</p>
<p><strong>Table I. Win32 Collection: Accuracy with a Limit of 100,000</strong></p>
<table border="1" summary="Table I. Win32 Collection: Accuracy with a Limit of 100,000">
<tr><th rowspan="2">L</th><th colspan="15">n</th></tr>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th></tr>
<tr><td>20</td><td>.45</td><td> .58</td><td> .52</td><td> .63</td><td> .69</td><td> .57</td><td> .55</td><td> .51</td><td> .50</td><td> .49</td><td> .44</td><td> .42</td><td> .38</td><td> .36</td><td> .37</td></tr>
<tr><td>50</td><td>.60</td><td> .63</td><td> .88</td><td> .89</td><td> .87</td><td> .84</td><td> .73</td><td> .68</td><td> .82</td><td> .63</td><td> .79</td><td> .79</td><td> .82</td><td> .85</td><td> .82</td></tr>
<tr><td>100</td><td>.77</td><td> .75</td><td> .90</td><td> .87</td><td> .87</td><td> .89</td><td> .87</td><td> .84</td><td> .84</td><td> .86</td><td> .86</td><td> .87</td><td> .87</td><td> .86</td><td> .85</td></tr>
<tr><td>200</td><td>.85</td><td> .76</td><td> .87</td><td> .89</td><td> .90</td><td> .90</td><td> .92</td><td> .89</td><td> .90</td><td> .90</td><td> .90</td><td> .89</td><td> .89</td><td> .89</td><td> .90</td></tr>
<tr><td>500</td><td>.85</td><td> .89</td><td> .89</td><td> .91</td><td> .90</td><td> .90</td><td> .91</td><td> .90</td><td> .88</td><td> .88</td><td> .87</td><td> .87</td><td> .84</td><td> .85</td><td> .85</td></tr>
<tr><td>1K</td><td>.85</td><td> .92</td><td> .93</td><td> .93</td><td> .91</td><td> .90</td><td> .89</td><td> .87</td><td> .85</td><td> .84</td><td> .84</td><td> .83</td><td> .85</td><td> .80</td><td> .80</td></tr>
<tr><td>2K</td><td>.85</td><td> .87</td><td> .93</td><td> .92</td><td> .90</td><td> .87</td><td> .86</td><td> .84</td><td> .83</td><td> .81</td><td> .83</td><td> .83</td><td> .86</td><td> .79</td><td> .75</td></tr>
<tr><td>3K</td><td>.85</td><td> .83</td><td> .92</td><td> .91</td><td> .90</td><td> .87</td><td> .86</td><td> .83</td><td> .82</td><td> .81</td><td> .81</td><td> .82</td><td> .84</td><td> .93</td><td> .93</td></tr>
<tr><td>4K</td><td>.85</td><td> .78</td><td> .91</td><td> .91</td><td> .89</td><td> .87</td><td> .85</td><td> .82</td><td> .81</td><td> .85</td><td> .92</td><td> .92</td><td> .92</td><td> .92</td><td> .92</td></tr>
<tr><td>5K</td><td>.85</td><td> .73</td><td> .91</td><td> .89</td><td> .89</td><td> .87</td><td> .84</td><td> .81</td><td> .92</td><td> .93</td><td> .93</td><td> .92</td><td> .92</td><td> .92</td><td> .92</td></tr>
<tr><td>6K</td><td>.85</td><td> .69</td><td> .91</td><td> .88</td><td> .88</td><td> .86</td><td> .84</td><td> .92</td><td> .93</td><td> .93</td><td> .93</td><td> .92</td><td> .92</td><td> .92</td><td> .92</td></tr>
<tr><td>7K</td><td>.85</td><td> .65</td><td> .91</td><td> .87</td><td> .87</td><td> .84</td><td> .92</td><td> .92</td><td> .93</td><td> .93</td><td> .93</td><td> .92</td><td> .92</td><td> .92</td><td> .92</td></tr>
<tr><td>8K</td><td>.85</td><td> .63</td><td> .91</td><td> .87</td><td> .87</td><td> .84</td><td> .92</td><td> .92</td><td> .93</td><td> .93</td><td> .93</td><td> .92</td><td> .92</td><td> .92</td><td> .92</td></tr>
<tr><td>9K</td><td>.85</td><td> .61</td><td> .90</td><td> .86</td><td> .87</td><td> .92</td><td> .92</td><td> .92</td><td> .93</td><td> .93</td><td> .93</td><td> .92</td><td> .92</td><td> .92</td><td> .92</td></tr>
<tr><td>10K</td><td>.85</td><td> .59</td><td> .89</td><td> .86</td><td> .86</td><td> .92</td><td> .92</td><td> .92</td><td> .93</td><td> .93</td><td> .93</td><td> .92</td><td> .92</td><td> .92</td><td> .92</td></tr>
</table>
<p><strong>Table I. Win32 Collection: Accuracy with a Limit of 200,000</strong></p>
<table border="1" summary="Table II. Win32 Collection: Accuracy with a Limit of 200,000">
<tr><th rowspan="2">L</th><th colspan="15">n</th></tr>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th></tr>
<tr><th>20</th><td>.45</td><td>.59</td><td>.50</td><td>.62</td><td>.70</td><td>.60</td><td>.55</td><td>.53</td><td>.51</td><td>.50</td><td>.46</td><td>.44</td><td>.41</td><td>.40</td><td>.42</td></tr>
<tr><th>50</th><td>.60</td><td>.64</td><td>.88</td><td>.89</td><td>.87</td><td>.84</td><td>.73</td><td>.69</td><td>.81</td><td>.63</td><td>.78</td><td>.79</td><td>.83</td><td>.85</td><td>.82</td></tr>
<tr><th>100</th><td>.77</td><td>.75</td><td>.90</td><td>.88</td><td>.88</td><td>.91</td><td>.87</td><td>.85</td><td>.84</td><td>.85</td><td>.86</td><td>.87</td><td>.87</td><td>.87</td><td>.85</td></tr>
<tr><th>200</th><td>.85</td><td>.76</td><td>.87</td><td>.89</td><td>.91</td><td>.91</td><td>.93</td><td>.90</td><td>.89</td><td>.90</td><td>.90</td><td>.90</td><td>.89</td><td>.89</td><td>.90</td></tr>
<tr><th>500</th><td>.85</td><td>.90</td><td>.88</td><td>.91</td><td>.91</td><td>.90</td><td>.91</td><td>.91</td><td>.89</td><td>.89</td><td>.88</td><td>.87</td><td>.84</td><td>.84</td><td>.85</td></tr>
<tr><th>1K</th><td>.85</td><td>.92</td><td>.93</td><td>.93</td><td>.92</td><td>.90</td><td>.90</td><td>.88</td><td>.88</td><td>.87</td><td>.87</td><td>.84</td><td>.84</td><td>.84</td><td>.85</td></tr>
<tr><th>2K</th><td>.85</td><td>.90</td><td>.94</td><td>.92</td><td>.91</td><td>.89</td><td>.89</td><td>.86</td><td>.86</td><td>.84</td><td>.83</td><td>.82</td><td>.83</td><td>.82</td><td>.81</td></tr>
<tr><th>3K</th><td>.85</td><td>.83</td><td>.93</td><td>.91</td><td>.90</td><td>.87</td><td>.85</td><td>.85</td><td>.84</td><td>.83</td><td>.82</td><td>.82</td><td>.82</td><td>.78</td><td>.77</td></tr>
<tr><th>4K</th><td>.85</td><td>.82</td><td>.92</td><td>.91</td><td>.90</td><td>.86</td><td>.85</td><td>.85</td><td>.83</td><td>.82</td><td>.81</td><td>.81</td><td>.81</td><td>.76</td><td>.75</td></tr>
<tr><th>5K</th><td>.85</td><td>.78</td><td>.93</td><td>.91</td><td>.89</td><td>.86</td><td>.85</td><td>.84</td><td>.83</td><td>.80</td><td>.78</td><td>.78</td><td>.78</td><td>.74</td><td>.73</td></tr>
<tr><th>6K</th><td>.85</td><td>.75</td><td>.93</td><td>.88</td><td>.88</td><td>.86</td><td>.85</td><td>.82</td><td>.80</td><td>.79</td><td>.76</td><td>.75</td><td>.76</td><td>.73</td><td>.72</td></tr>
<tr><th>7K</th><td>.85</td><td>.72</td><td>.92</td><td>.87</td><td>.87</td><td>.86</td><td>.84</td><td>.81</td><td>.79</td><td>.78</td><td>.76</td><td>.74</td><td>.74</td><td>.72</td><td>.72</td></tr>
<tr><th>8K</th><td>.85</td><td>.70</td><td>.90</td><td>.86</td><td>.87</td><td>.86</td><td>.84</td><td>.81</td><td>.79</td><td>.77</td><td>.75</td><td>.74</td><td>.74</td><td>.71</td><td>.92</td></tr>
<tr><th>9K</th><td>.85</td><td>.69</td><td>.90</td><td>.86</td><td>.86</td><td>.85</td><td>.83</td><td>.81</td><td>.79</td><td>.93</td><td>.75</td><td>.93</td><td>.92</td><td>.92</td><td>.92</td></tr>
<tr><th>10K</th><td>.85</td><td>.66</td><td>.90</td><td>.86</td><td>.85</td><td>.85</td><td>.82</td><td>.80</td><td>.94</td><td>.93</td><td>.92</td><td>.93</td><td>.92</td><td>.92</td><td>.92</td></tr>
</table>
<p>The datasets used in our experiments are in the order of tens of megabytes in size, which is small compared to the terabyte virus repositories, but is considerably larger than the datasets traditionally used in n-grams analysis, which usually does not exceed a few megabytes. In addition to using n-grams analysis for malicious code detection, this work presents</p>
<h2>II. CNG Method</h2>
<p>The CNG classification method relies on profiles for class representation. During training, the data for each class is collected and n-grams with their normalized frequencies are counted. The <img src="/img/cache/d20caec3b48a1eef164cb4ca81ba2587.gif" alt="L" valign="middle"/> most frequent n-grams with their normalized frequencies represent a class profile. There are two parameters in building a profile: <img src="/img/cache/7b8b965ad4bca0e41ab51de7b31363a1.gif" alt="n" valign="middle"/> - the n-gram size, and <img src="/img/cache/d20caec3b48a1eef164cb4ca81ba2587.gif" alt="L" valign="middle"/> - the profile length. When a new instance needs to be classified, the instance profile is built in the same way. The instance is classified using k-nearest neighbour algorithm with <img src="/img/cache/5c6f937eacd3732196734c56ec527fa4.gif" alt="k = 1" valign="middle"/>; i.e., the similarity distance is measured between the instance profile and class profiles, and the class with the closest class profile is chosen. The following distance measure is used:</p>
<div class="N5"><img src="/img/cache/9f236e5eb257d887857270165ddf6e5d.gif" alt="
	\sum_{s \in profiles}\left(\frac{f_1(s) - f_2(s)}{\frac{f_1(s) + f_2(s)}{2}}\right)^2
" valign="middle"/></div>
<p>where <img src="/img/cache/03c7c0ace395d80182db07ae2c30f034.gif" alt="s" valign="middle"/> is any n-gram from one of the two profiles, <img src="/img/cache/42bc811bb002f87982f2b81837070f79.gif" alt="f_1(s)" valign="middle"/> is frequency of the n-gram in one profile, or 0 if the n-gram does not exist in the profile, and <img src="/img/cache/b01e6512782755196d8591e3ffde16f1.gif" alt="f_2(s)" valign="middle"/> is the frequency of the n-gram in another profile. The difference between frequencies is divided by <img src="/img/cache/7488cd3b2c957807b8e853321d0d8035.gif" alt="\left(f_1(s)+f_2(s)\right)/2" valign="middle"/> in order to make the difference relative instead of absolute, so that the same weight is given to the difference between low-frequent n-grams as for the high-frequent n-grams.</p>
<h2>III. Experimental Results</h2>
<p>In our earlier experiments [1], we used a small collection of 25 worms (831KB) that we extracted from infected email messages and 40 <em>healthy</em> Windows executable files (5.5MB). We achieved a training accuracy of 100% for several parameter configurations and a 3-fold cross-validation average accuracy of 98%.</p>
<p>Following the encouraging results of using the CNG method with the small worm collection, we conducted series of experiments with two larger collections of MC: the <em>I-Worm</em> collection and the <em>Win32</em> collection. These collections are available from [11]. The I-Worm collection consists of 292 Internet worms that are Windows binary executable files. The total size of the I-Worm collection is 15.7MB. The Win32 collection contains 493 Windows binary executable viruses whose names begin with "Win32"; their total size is 21.2MB.</p>
<p>There are computational issues that must be considered when dealing with larger code collections. In our initial experiments, we computed n-grams of sizes up to 10 bytes. The number of potential n-grams of size 10 is <img src="/img/cache/751a4b3ef0bdc07a4259c4e58c86733b.gif" alt="2^{10 * 8} \approx 10^{24}" valign="middle"/>. The small code size in our initial experiments resulted in a computationally-tractable upper bound on the number of possible n-grams. With the larger code collections, computing the frequencies of all seen n-grams is impractical. The Perl software tool Ngrams [9], which we use in our experiments, supports the <em>limit</em> parameter; if the number of collected n-grams exceeds twice the limit, the list of n-grams is reduced to the limit by removing the least frequent n-grams from the list.</p>
<h3>A. Parameter selection</h3>
<p>There are three primary parameters in our experiments: the limit, the maximum length of the n-grams, and the maximum profile size. The limit ensures that the computation does not overflow the physical memory and is a single-valued parameter. The length of the n-grams, <img src="/img/cache/7b8b965ad4bca0e41ab51de7b31363a1.gif" alt="n" valign="middle"/>, takes values from 1 to the specified maximum. As evident in table I and table II,
 
larger values of <img src="/img/cache/7b8b965ad4bca0e41ab51de7b31363a1.gif" alt="n" valign="middle"/> do not always result in a better performance. The maximum value of <img src="/img/cache/7b8b965ad4bca0e41ab51de7b31363a1.gif" alt="n" valign="middle"/> should be chosen large enough as to demonstrate that the optimal value of <img src="/img/cache/7b8b965ad4bca0e41ab51de7b31363a1.gif" alt="n" valign="middle"/> is withing the tested range. The profile size, <img src="/img/cache/d20caec3b48a1eef164cb4ca81ba2587.gif" alt="L" valign="middle"/>, determines the number of the most frequent n-grams of a file that are used as a signature for that file. Similar to <img src="/img/cache/7b8b965ad4bca0e41ab51de7b31363a1.gif" alt="n" valign="middle"/>, larger values of <img src="/img/cache/d20caec3b48a1eef164cb4ca81ba2587.gif" alt="L" valign="middle"/> do not always result in a better performance and a maximum value should be chosen as to encompass the optimal value of <img src="/img/cache/d20caec3b48a1eef164cb4ca81ba2587.gif" alt="L" valign="middle"/>.</p>
<p><strong>Table III. I-Worm Collection: Training Accuracy for Different Values of N-gram Size (n) and Profile Size (L)</strong></p>
<table border="1" summary="Table III. I-Worm Collection: Training Accuracy for Different Values of N-gram Size (n) and Profile Size (L)">
<tr><th rowspan="2">L</th><th colspan="15">n</th></tr>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th></tr>
<tr><th>20</th><td>0.54</td><td>0.50</td><td>0.65</td><td>0.74</td><td>0.68</td><td>0.64</td><td>0.52</td><td>0.50</td><td>0.52</td><td>0.43</td></tr>
<tr><th>50</th><td>0.62</td><td>0.62</td><td>0.83</td><td>0.80</td><td>0.85</td><td>0.83</td><td>0.72</td><td>0.65</td><td>0.60</td><td>0.57</td></tr>
<tr><th>100</th><td>0.80</td><td>0.65</td><td>0.76</td><td>0.68</td><td>0.84</td><td>0.86</td><td>0.85</td><td>0.83</td><td>0.83</td><td>0.85</td></tr>
<tr><th>200</th><td>0.75</td><td>0.69</td><td>0.63</td><td>0.62</td><td>0.79</td><td>0.86</td><td>0.89</td><td>0.87</td><td>0.89</td><td>0.88</td></tr>
<tr><th>500</th><td>0.57</td><td>0.87</td><td>0.88</td><td>0.70</td><td>0.83</td><td>0.89</td><td>0.88</td><td>0.87</td><td>0.88</td><td>0.89</td></tr>
<tr><th>1000</th><td>0.57</td><td>0.85</td><td>0.89</td><td>0.90</td><td>0.90</td><td>0.89</td><td>0.88</td><td>0.88</td><td>0.89</td><td>0.87</td></tr>
<tr><th>1500</th><td>0.57</td><td>0.86</td><td>0.89</td><td>0.91</td><td>0.88</td><td>0.90</td><td>0.86</td><td>0.85</td><td>0.83</td><td>0.84</td></tr>
<tr><th>2000</th><td>0.57</td><td>0.83</td><td>0.90</td><td>0.90</td><td>0.88</td><td>0.87</td><td>0.84</td><td>0.79</td><td>0.73</td><td>0.74</td></tr>
<tr><th>3000</th><td>0.57</td><td>0.81</td><td>0.88</td><td>0.89</td><td>0.86</td><td>0.83</td><td>0.71</td><td>0.71</td><td>0.64</td><td>0.65</td></tr>
<tr><th>4000</th><td>0.57</td><td>0.78</td><td>0.88</td><td>0.87</td><td>0.84</td><td>0.82</td><td>0.68</td><td>0.64</td><td>0.61</td><td>0.62</td></tr>
<tr><th>5000</th><td>0.57</td><td>0.76</td><td>0.88</td><td>0.85</td><td>0.80</td><td>0.80</td><td>0.64</td><td>0.62</td><td>0.58</td><td>0.61</td></tr>
</table>
<p><strong>Table IV. Win32 Collection: Training Accuracy for Different Values of N-gram Size (n) and Profile Size (L)</strong></p>
<table border="1" summary="Table IV. Win32 Collection: Training Accuracy for Different Values of N-gram Size (n) and Profile Size (L)">
<tr><th rowspan="2">L</th><th colspan="15">n</th></tr>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th></tr>
<tr><th>20</th><td>0.45</td><td>0.59</td><td>0.51</td><td>0.63</td><td>0.67</td><td>0.59</td><td>0.54</td><td>0.52</td><td>0.51</td><td>0.47</td></tr>
<tr><th>50</th><td>0.60</td><td>0.63</td><td>0.88</td><td>0.88</td><td>0.87</td><td>0.85</td><td>0.74</td><td>0.68</td><td>0.81</td><td>0.64</td></tr>
<tr><th>100</th><td>0.76</td><td>0.73</td><td>0.90</td><td>0.88</td><td>0.87</td><td>0.90</td><td>0.87</td><td>0.85</td><td>0.84</td><td>0.85</td></tr>
<tr><th>200</th><td>0.85</td><td>0.74</td><td>0.87</td><td>0.89</td><td>0.92</td><td>0.90</td><td>0.93</td><td>0.89</td><td>0.89</td><td>0.90</td></tr>
<tr><th>500</th><td>0.85</td><td>0.87</td><td>0.89</td><td>0.91</td><td>0.90</td><td>0.90</td><td>0.91</td><td>0.91</td><td>0.90</td><td>0.89</td></tr>
<tr><th>1000</th><td>0.85</td><td>0.90</td><td>0.93</td><td>0.93</td><td>0.91</td><td>0.90</td><td>0.89</td><td>0.88</td><td>0.87</td><td>0.87</td></tr>
<tr><th>1500</th><td>0.85</td><td>0.89</td><td>0.94</td><td>0.94</td><td>0.91</td><td>0.89</td><td>0.88</td><td>0.87</td><td>0.87</td><td>0.86</td></tr>
<tr><th>2000</th><td>0.85</td><td>0.87</td><td>0.94</td><td>0.92</td><td>0.91</td><td>0.89</td><td>0.87</td><td>0.86</td><td>0.85</td><td>0.82</td></tr>
<tr><th>3000</th><td>0.85</td><td>0.84</td><td>0.93</td><td>0.91</td><td>0.90</td><td>0.86</td><td>0.83</td><td>0.81</td><td>0.80</td><td>0.80</td></tr>
<tr><th>4000</th><td>0.85</td><td>0.79</td><td>0.93</td><td>0.92</td><td>0.87</td><td>0.86</td><td>0.81</td><td>0.80</td><td>0.80</td><td>0.79</td></tr>
<tr><th>5000</th><td>0.85</td><td>0.75</td><td>0.93</td><td>0.91</td><td>0.87</td><td>0.86</td><td>0.81</td><td>0.80</td><td>0.78</td><td>0.78</td></tr>
</table>
<p><strong>Table V. I-Worm Collection: Average Accuracy in 5-fold Cross-validation for Different Values of N-gram Size (n) and Profile Size (L)</strong></p>
<table border="1" summary="Table V. I-Worm Collection: Average Accuracy in 5-fold Cross-validation for Different Values of N-gram Size (n) and Profile Size (L)">
<tr><th rowspan="2">L</th><th colspan="15">n</th></tr>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th></tr>
<tr><th>20</th><td>0.59</td><td>0.49</td><td>0.61</td><td>0.64</td><td>0.72</td><td>0.64</td><td>0.57</td><td>0.49</td><td>0.50</td><td>0.45</td></tr>
<tr><th>50</th><td>0.67</td><td>0.55</td><td>0.80</td><td>0.76</td><td>0.83</td><td>0.83</td><td>0.63</td><td>0.58</td><td>0.60</td><td>0.55</td></tr>
<tr><th>100</th><td>0.81</td><td>0.73</td><td>0.72</td><td>0.73</td><td>0.70</td><td>0.84</td><td>0.81</td><td>0.79</td><td>0.81</td><td>0.82</td></tr>
<tr><th>200</th><td>0.77</td><td>0.69</td><td>0.69</td><td>0.66</td><td>0.79</td><td>0.85</td><td>0.86</td><td>0.85</td><td>0.87</td><td>0.86</td></tr>
<tr><th>500</th><td>0.56</td><td>0.85</td><td>0.85</td><td>0.78</td><td>0.82</td><td>0.86</td><td>0.87</td><td>0.85</td><td>0.86</td><td>0.86</td></tr>
<tr><th>1000</th><td>0.56</td><td>0.84</td><td>0.89</td><td>0.89</td><td>0.90</td><td>0.88</td><td>0.85</td><td>0.87</td><td>0.88</td><td>0.87</td></tr>
<tr><th>1500</th><td>0.56</td><td>0.82</td><td>0.89</td><td>0.91</td><td>0.88</td><td>0.89</td><td>0.87</td><td>0.85</td><td>0.84</td><td>0.85</td></tr>
<tr><th>2000</th><td>0.56</td><td>0.83</td><td>0.89</td><td>0.89</td><td>0.87</td><td>0.87</td><td>0.85</td><td>0.83</td><td>0.82</td><td>0.84</td></tr>
<tr><th>3000</th><td>0.56</td><td>0.82</td><td>0.88</td><td>0.88</td><td>0.87</td><td>0.84</td><td>0.80</td><td>0.82</td><td>0.80</td><td>0.81</td></tr>
<tr><th>4000</th><td>0.56</td><td>0.80</td><td>0.87</td><td>0.86</td><td>0.83</td><td>0.81</td><td>0.79</td><td>0.81</td><td>0.78</td><td>0.80</td></tr>
<tr><th>5000</th><td>0.56</td><td>0.79</td><td>0.86</td><td>0.83</td><td>0.81</td><td>0.81</td><td>0.79</td><td>0.79</td><td>0.77</td><td>0.78</td></tr>
</table>
<p>In our experience with n-grams, we found that a limit of 100, 000, n-grams of lengths 1 to 10, and profile sizes ranging from 20 to 5, 000 most frequent n-grams provided good results. We conducted several runs to verify whether these choices of values are suitable for the I-Worm collection and Win32 collection. The results of two runs using the Win32 collection are shown in table I and table II. In these two runs, we increased the maximum n-grams length to 15 and the maximum profile size to 10, 000. Table I shows the results with a limit of 100, 000 n-grams and table II shows the results with a limit of 200, 000 n-grams.</p>
<p>We did not find a significant improvement in training accuracy when increasing the limit to 200, 000, the maximum n-grams length to 15, or the maximum profile size to 10, 000. Therefore, all the experiments described below are configured with a limit of 100, 000, a maximum n-grams length of 10, and a maximum profile size of 5, 000.</p>
<h3>B. Training accuracy</h3>
<p>In the training accuracy experiments, we build a <em>malicious profile</em> using all available MC, and, in a similar fashion, a benign profile is built from the BC. Each file is then classified as a malicious or a benign program using the CNG method, and we measured the accuracy for different combinations of parameters <img src="/img/cache/7b8b965ad4bca0e41ab51de7b31363a1.gif" alt="n" valign="middle"/> (n-gram size) and <img src="/img/cache/d20caec3b48a1eef164cb4ca81ba2587.gif" alt="L" valign="middle"/> (profile size). The results of the I-Worm collection and the Win32 collection are shown in table III and table IV, respectively.</p>
<p>The results are very encouraging, achieving accuracy of over 90% for several parameter configurations. An accuracy of and 91% for <img src="/img/cache/cff6a0454d14f999df05e954187d3683.gif" alt="n = 4" valign="middle"/> and <img src="/img/cache/1071597b71272f36c97d9df18dd19f34.gif" alt="L = 1500" valign="middle"/> is achieved for the I-Worm collection, and 94% for the Win32 collection using the same parameters, as well as others. This is a biased evaluation experiment, since the same training data is used in testing. Even though this is a biased experiment, the result is significant since it shows that the 5MB corpus of BC, 15.7MB of I-Worm MC, and 21.2 of Win32 MC can be represented as 1500-length quad-gram profiles with a very simple algorithm, and be successfully used in the classification.</p>
<h3>C. 5-fold cross-validation</h3>
<p>To obtain unbiased evaluation results, we performed a 5-fold cross-validation. In the cross-validation method [10], the data is randomly partitioned into n disjoint datasets or folds. <img src="/img/cache/a438673491daae8148eae77373b6a467.gif" alt="n-1" valign="middle"/> of these datasets are used for training and the remaining dataset is used for testing. The process is repeated <img src="/img/cache/7b8b965ad4bca0e41ab51de7b31363a1.gif" alt="n" valign="middle"/> times, each time using a different testing dataset. The results in these n evaluations are averaged to obtain the final result.</p>
<p>The folds are created in a random, balanced way, i.e., approximately 1/5 of malicious files and 1/5 of benign files are selected in each fold. The average accuracy using the I-Worm collection and the Win32 collection are shown in table V and table VI, respectively.</p>
<p>The result provides more positive evidence for the use of the CNG method in the MC detection. The average accuracy is high, achieving 91% for both the I-Worm collection and the Win32 collection.</p>
 
<p><strong>Table VI. Win32 Collection: Average Accuracy in 5-fold Cross-validation for Different Values of N-gram Size (n) and Profile Size (L)</strong></p>
<table border="1" summary="Table VI. Win32 Collection: Average Accuracy in 5-fold Cross-validation for Different Values of N-gram Size (n) and Profile Size (L)">
<tr><th rowspan="2">L</th><th colspan="15">n</th></tr>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th></tr>
<tr><th>20</th><td>0.64</td><td>0.63</td><td>0.63</td><td>0.61</td><td>0.58</td><td>0.58</td><td>0.55</td><td>0.52</td><td>0.50</td><td>0.47</td></tr>
<tr><th>50</th><td>0.58</td><td>0.70</td><td>0.81</td><td>0.87</td><td>0.85</td><td>0.86</td><td>0.80</td><td>0.63</td><td>0.68</td><td>0.64</td></tr>
<tr><th>100</th><td>0.75</td><td>0.74</td><td>0.90</td><td>0.87</td><td>0.87</td><td>0.89</td><td>0.88</td><td>0.85</td><td>0.86</td><td>0.85</td></tr>
<tr><th>200</th><td>0.85</td><td>0.70</td><td>0.87</td><td>0.88</td><td>0.90</td><td>0.90</td><td>0.91</td><td>0.88</td><td>0.87</td><td>0.89</td></tr>
<tr><th>500</th><td>0.85</td><td>0.81</td><td>0.88</td><td>0.91</td><td>0.90</td><td>0.90</td><td>0.90</td><td>0.89</td><td>0.89</td><td>0.88</td></tr>
<tr><th>1000</th><td>0.85</td><td>0.88</td><td>0.90</td><td>0.91</td><td>0.89</td><td>0.89</td><td>0.86</td><td>0.86</td><td>0.87</td><td>0.86</td></tr>
<tr><th>1500</th><td>0.85</td><td>0.86</td><td>0.91</td><td>0.91</td><td>0.90</td><td>0.88</td><td>0.87</td><td>0.87</td><td>0.87</td><td>0.85</td></tr>
<tr><th>2000</th><td>0.85</td><td>0.86</td><td>0.91</td><td>0.91</td><td>0.89</td><td>0.88</td><td>0.87</td><td>0.85</td><td>0.84</td><td>0.84</td></tr>
<tr><th>3000</th><td>0.85</td><td>0.84</td><td>0.91</td><td>0.90</td><td>0.88</td><td>0.87</td><td>0.85</td><td>0.84</td><td>0.83</td><td>0.83</td></tr>
<tr><th>4000</th><td>0.85</td><td>0.84</td><td>0.91</td><td>0.91</td><td>0.89</td><td>0.86</td><td>0.86</td><td>0.84</td><td>0.82</td><td>0.82</td></tr>
<tr><th>5000</th><td>0.85</td><td>0.79</td><td>0.91</td><td>0.90</td><td>0.88</td><td>0.86</td><td>0.86</td><td>0.83</td><td>0.81</td><td>0.87</td></tr>
</table>
<h2>IV. Conclusions and Future Work</h2>
<p>We have demonstrated encouraging initial results in applying the CNG method based on byte n-gram analysis in the detection of MC. We used two datasets of MC, I-Worm collection and Win32 collection, and a collection of BC. The size of the MC code of each of the collections is considerably larger than what is traditionally used in n-grams analysis, and still satisfactory results are obtained using the same parameter values for <img src="/img/cache/7b8b965ad4bca0e41ab51de7b31363a1.gif" alt="n" valign="middle"/> and <img src="/img/cache/d20caec3b48a1eef164cb4ca81ba2587.gif" alt="L" valign="middle"/> as in other works. The method achieves over 90% accuracy on training data using each of the two datasets, and 91% accuracy in 5-fold cross-validation. The future work includes experiments on larger data collection with sizes of the order of hundreds of megabytes. Currently, we use the CNG method as black box for detecting viruses and worms. Mining the extracted n-grams may help refine the extraction of the MC signatures. Experimenting with reverse-engineered MC source code is another direction that we plan to pursue.</p>
<h2>Acknowledgment</h2>
<p>This work is supported in part by the Natural Sciences and Engineering Research Council of Canada (NSERC).</p>
<h2>References</h2>
<ol>
<li>T. Abou-Assaleh, N. Cercone, V. Keselj, and R. Sweidan. 2004. "N-gram-based Detection of New Malicious Code." In Proceedings of the 24th Annual International Computer Software and Applications Conference (COMPSAC 2004), Hong Kong.</li>
<li>W.R. Bennett. 1976. Scientific and engineering problem-solving with the computer. Prentice-Hall, Inc., Englewood Cliffs, New Jersey.</li>
<li>W. Cavnar and J. Trenkle. 1994. "N-gram-based text categorization." In Proceedings SDAIR-94.</li>
<li>D. Jurafsky and H. M. James. 2000. Speech and Language Processing. Prentice-Hall, Inc.</li>
<li>J.O. Kephart and W.C. Arnold. 1994. "<a href="/lib/ajk05.html">Automatic Extraction of Computer Virus Signatures</a>." In Proceedings of the 4th Virus Bulletin International Conference. R. Ford, ed., Virus Bulletin Ltd., Abingdon, England, pp. 178-184.</li>
<li>J.O. Kephart. 1994. "A Biologically Inspired Immune System for Computers." In Artificial Life IV, Proc.of the Fourth Intern.Workshop on Synthesis and Simulation of Living Systems. Rodney A. Brooks and Pattie Maes, eds., MIT Press, Cambridge, Massachusetts, pp. 130-139.</li>
<li>V. Keselj, F. Peng, N. Cercone, and C. Thomas. 2003. "N-gram-based Author Profiles for Authorship Attribution." In Proceedings of the Conference Pacific Association for Computational Linguistics, PACLING'03, Dalhousie University, Halifax, Nova Scotia, Canada.</li>
<li>V. Keselj, E. Asp, K. Rockwood, and N. Cercone. 2003. "Computational analysis of language used by Alzheimer patients in interviews." In Proceedings of the 6th Annual Symposium on the Treatment of Alzheimer's Disease, Halifax.</li>
<li>V. Keselj. 2003-04. Perl package Text::Ngrams. WWW: http://search.cpan.org/author/VLADO/Text-Ngrams-0.03/Ngrams.pm.</li>
<li>C. Manning and H. Schuetze. 1999. Foundations of Statistical Natural Language Processing. The MIT Press.</li>
<li>VX Heavens. 2004-06. WWW: http://vx.netlux.org/.</li>
</ol>
 
<hr/>
<p><a name="f1" href="#b1">1</a> "<a href="/lib/asg12.html">Virus Writers: The End of The Innocence?</a>" by Sarah Gordon, IBM Thomas J. Watson Research Center, http://www.research.ibm.com/antivirus/SciPapers/VB2000SG.htm The WildList - http://www.wildlist.org/</p>
<p><a name="f2" href="#b2">2</a> A criterion for detecting viruses may be adopted to a specific user. For some users any executable attachment in an e-mail message can be immediately classifies as malicious code, while other users do exchange executable code by e-mail.</p>
[<a style="" href="/lib/?lang=EN&amp;index=AT#aat03">Back to index</a>] [<a href="/lib/aat03.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=aat03">de</a><a href="/lib/index.php?lang=en&amp;id=aat03">en</a><a href="/lib/index.php?lang=es&amp;id=aat03">es</a><a href="/lib/index.php?lang=it&amp;id=aat03">it</a><a href="/lib/index.php?lang=fr&amp;id=aat03">fr</a><a href="/lib/index.php?lang=pl&amp;id=aat03">pl</a><a href="/lib/index.php?lang=ru&amp;id=aat03">ru</a><a href="/lib/index.php?lang=ua&amp;id=aat03">ua</a></div>
</body>
</html>
