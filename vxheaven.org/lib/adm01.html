<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Dmitry Mostovoy 'Modern Methods of Detecting and Eradicating Known and Unknown Viruses' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Dmitry Mostovoy"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Mostovoy, Dmitry,Modern Methods of Detecting and Eradicating Known and Unknown Viruses, adinf, anti, file, stealth, reading, programs, directories, files, scanning, size, infected, boot, disk, block, area"/>
<meta name="Description" content="The first outcome  of our efforts  in this direction,  ADinf (Advanced  Diskinfoscope),  is  a  forecasting  center which alerts the user in advance with great reliability about  the intrusion of viruses, even  HITHERTO unknown infectors.   As distinct  from  all  other  data  integrity  checkers, ADinf inspects  a  disk  by  scanning  the  sectors one by one via direct  addressing  of  BIOS  without  the assistance of the operating system and  takes under check  all vital parts  of hard disk."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"e4a27b838e98c7caa13ddf984e798a2a41f47ca1-1498756784-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/adm01.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Modern Methods of Detecting and Eradicating Known and Unknown Viruses</h1><p><a href="/lib/?lang=en&amp;author=Mostovoy%2C%20Dmitry">Dmitry Mostovoy</a><br/> <em>5th international conference Virus Bulletin - 95</em><br/> <em>September 1995</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/adm01.html';</script><div class="ci"><a href="/lib/?ci=adm01">1</a></div><img src="/img/pdf.gif" alt="PDF"/><a href="/lib/pdf/Modern%20Methods%20of%20Detecting%20and%20Eradicating%20Known%20and%20Unknown%20Viruses.pdf">Download</a> PDF (129.79Kb) (You need to be registered on <a href="/forum">forum</a>)<br/>[<a style="" href="/lib/?lang=EN&amp;index=AT#adm01">Back to index</a>] [<a href="/lib/adm01.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li><a href="#p1">Abstract</a></li>
<li><a href="#p2">Integrity Checking</a></li>
<li><a href="#p3">Virus Removal Techniques</a></li>
<li><a href="#p4">Conclusion</a></li>
<li><a href="#p5">References</a></li>
</ul>
<h2><a name="p1"></a>Abstract</h2>
<p>Viruses are growing in number from day to day, so it is obvious that soon anti-virus programs like NAV or MSAV will not be quite efficacious. Therefore, we started designing a program that would annihilate not individual infectors, but viruses in general, regardless of whether a virus is known or not, or whether it is old or new.</p>
<p>The first outcome of our efforts in this direction, ADinf (Advanced Diskinfoscope), is a forecasting center which alerts the user in advance with great reliability about the intrusion of viruses, even HITHERTO unknown infectors. As distinct from all other data integrity checkers, ADinf inspects a disk by scanning the sectors one by one via direct addressing of BIOS without the assistance of the operating system and takes under check all vital parts of hard disk. To evade such a detection tactics is almost impossible.</p>
<p>ADinf alerts the user in time about virus intrusion and restores infected boot sectors. How to restore the infected files automatically? Our next step was to produce a curing companion to ADinf. The new tool, ADinf Cure Module, deploys a novel strategy. Paradoxically, ninety seven percents of the viruses in our collection fall under few standard groups by the types of infection methods. New viruses are as a rule designed on one of these common infection principles, and therefore ADinf Cure Module will be about 97% efficient in its performance also in the future.</p>
<p>ADinf and ADinf Cure Module are parts of DialogueScience anti-virus kit - the most popular anti-virus in Russia.</p>
<h2><a name="p2"></a>Integrity Checking</h2>
<p>The basic classes of anti-virus programs are well known. They are scanners/removers, monitors, and vaccines. I would like to discuss the development of programs to which, in my opinion, anti-virus designer pay undeservedly little attention. This class of anti-virus programs is known as ``integrity checkers'', though the name does not fully characterize the program's policy which we describe below. This is the only class of purely software means of anti-virus protection, which permits the detection of known and unknown viruses with reliability approaching 100% and eradication up to 97% file infectors, even new hitherto unknown viruses.</p>
<p>The operation of integrity checkers is based on a simple fact: even though it is impossible to know all information about potentially infinite number of viruses, it is quite possible to store a finite volume of information about each logical drive in the disk and to detect virus infection from the changes taken place in files and system areas of the disk. As already mentioned, the name "integrity checker'' does not fully reflect the essence of these programs. Infection techniques is not restricted to a simple modification of the program code. Other paths for infection either already exist or are also possible; for example, companion viruses [1]. A disk can be corrupted by restructuring the directory tree, say, by renaming the directories and creating new directories, and by other such manipulations. Consequently, to provide reliable protection integrity checkers must take care of far more number of parameters that the mere changes in the size and CRC of files as is done by most programs of this class. Thus, master boot record (MBR) and boot sectors of logical drives, a list of bad clusters, directory tree structure, free memory size, CRC of Int 13h handler in BIOS and even the Hard Disk Parameter Tables, all must be under the control of integrity checkers. Changes in the size and CRC of files, creation of new files and directories and removal of old files and directories are obviously objects for strict control. A designer of integrity checker must be one step ahead of virus designers and block every possible loophole for parasite intrusion.</p>
<p>Despite the large amount of controlled information, an integrity checker must nonetheless be user-friendly, simple in usage, and quick in checking disks. It must at the same time be user-customizable as regards the levels of messages displayed on the changes occurred in the disk and be capable of conducting a preliminary analysis of the changes, particularly the suspicious modifications such as</p>
<ul>
<li>changes in size and CRC of files without any change in datestamp,</li>
<li>illegal values of hours, minutes or seconds in the datestamp of infected files (for example, 62 seconds),</li>
<li>year greater than the current year (certain viruses mark infected files by increasing the year of creation by 100 years, which cannot be detected visually because ``dir'' command only displays the last two figures of the year,</li>
<li>any changes in files specified in the ``stable'' list,</li>
<li>change in master boot record or boot sector,</li>
<li>appearance of new bad clusters on the disk and others.</li>
</ul>
<p>Let us now discuss the main problems faced by a designers of ``integrity checkers''. First, this is the dodging ability of viruses based on stealth-mechanism. Integrity checkers that rely on operating system tools in their scanning mission are absolutely helpless against this class of viruses. They have stimulated the development of an integrity checker that checks disks by reading the sectors via direct addressing through BIOS. Stealth viruses cannot hide the changes in an infected file size; on the contrary, under such a scanning technique the stealth-mechanism betrays the presence of known and hitherto unknown stealth viruses through the discrepancy between the information given out by DOS and the information obtained by reading via BIOS. Such algorithms have been created and successfully detect the appearance of stealth-viruses.</p>
<p>Scanning a disk by reading the sectors by direct addressing of BIOS has one more important merit which is often overlooked. If a computer is infected by a so-called ``fast infector'' [1], i.e., a virus that infects files not only when they are started, but also when they opened, such an integrity checker will not spread the infection to all files in the disk, because it does not at all address the operating system for reading a disk via sectors and uses an independent file opening system, and the viruses does not get any control.</p>
<p>Finally, an integrity checker utilizing direct reading of sectors is twice faster in checking a disk than any other program than relies on the operating system tools, because a disk scan algorithm can be created that reads each sector only once and optimizes the head movements.</p>
<p>Disk handling via BIOS has its own hurdles. The foremost problem is the compatibility with innumerable number of diverse hardware and software, including disk compactors (Stacker, DoubleSpace), specialized drivers for accessing large disks (Disk Manager), SCSI disk drivers etc. Furthermore, there are many MS-DOS compatible operating systems that have imperceptible but quite important features in partitioning logical drives. Integrity checkers must pay due attention to these fine factors.</p>
<h2><a name="p3"></a>Virus Removal Techniques</h2>
<p>Modern integrity checkers are useful not only in detecting infection, but are also capable of removing viruses immediately with the help of the information they retrieve from an uninfected machine at the time of installation. An integrity checkers can kill known viruses as well as the viruses which were unknown at the time of creation of the integrity checker.</p>
<p>How this is done? Obvious are the methods for removing viruses from the master boot record and boot sectors. Integrity checker stores images of uninfected boot sectors in its tables and in case of damage can instantly restore them. The only restriction is the restoration must also be effected via direct addressing of BIOS and after restoration the system must be rebooted immediately in order to prevent the active virus from reinjecting infection while accessing the disk via INT 13h.</p>
<p>Removal of file viruses is based on a surprising fact, namely, despite the vast number of diverse viruses, there are only a few techniques by which a virus is injected into a file. Here we only briefly outline the file restoration strategy. Figure 1 shows a schematic diagram of a usual EXE file.</p>
<p>For each file integrity checker keeps a header (area 1), relocation table (area 2) and the code at the entry point (area 4). Strings (area 3 and area 5) are vital because they are the keys to identifying the mutual locations of various areas in an infected file when a virus writes its tail, not at the file end, but at the file beginning or in the file body (after the relocation table or at the entry point). In an infected file, after determining the area that coincides with the imaged areas in the table, the displacement of a block (for example, the block for area 3 begins at the end of area 2 and ends at the beginning of the area 4) can be identified by string 3 position and thus moved back to its original location.</p>
<pre>
+---------------------------+
|     EXE-header            | 1
+---------------------------|
|  Relocation table         | 2
+---------------------------|
|        Code               | 3
|       		    |
|     Entry point   ------->| 4
|                           | 
|                           | 5
+---------------------------|
| Debug information or      | 6
| overlays                  |
+---------------------------+
        <em>Fig.1</em>
</pre>
<p>Image of area 6 takes about 3-4 Kb and is essential in recovering a file corrupted by viruses which damage the debug information and overlays in the course of defective infection.</p>
<p>Thus, a file is recovered by reinstating its original status overwriting the image of its structure stored in integrity checker tables on an infected file. Consequently, a knowledge as to which virus infected the file is not mandatory.</p>
<p>Tables containing information necessary for recovering files take about 200-450 Kb for one logical drive. The table size can be cut down to 90 Kb, if a user decides not to save the relocation information and this will not have any perceptible influence on the quality of recovery in most of the cases.</p>
<h2><a name="p4"></a>Conclusion</h2>
<p>Integrity checkers undoubtedly do not provide a panacea against computer viruses. Unfortunately, there is no such panacea, nor can there be one. But they are quite reliable protection utilities which must be used jointly with other classes of anti-virus tools. The highlights of integrity checkers described above are all implemented in ADinf program, the most popular itegrity checker in Russia. It also is known in Germany where it is distributed on CD-ROM as a component of the DialogueScience Anti-Virus Kit. It checks a disk by reading its sectors one by one directly addressing BIOS, easily traps active stealth viruses by comparing the information obtained through BIOS and DOS. It instantly restores up to 97% of files corrupted by known and unknown viruses.</p>
<h2><a name="p5"></a>References</h2>
<ol>
<li>Vesselin Bontchev, <a href="/lib/avb04.html">Possible Virus Attacks Against Integrity Programs And How To Prevent Them</a>, Proc. 2nd Int. Virus Bulletin Conf., September 1992, pp. 131-141.</li>
<li>Mostovoy D. Yu., A Method of Detecting and Eradicating Known and Unknown Viruses, IFIP Transactions, A-43, Security&amp;Control of Information Technology i Society, February, 1994, pp. 109-111.</li>
</ol>
[<a style="" href="/lib/?lang=EN&amp;index=AT#adm01">Back to index</a>] [<a href="/lib/adm01.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=adm01">de</a><a href="/lib/index.php?lang=en&amp;id=adm01">en</a><a href="/lib/index.php?lang=es&amp;id=adm01">es</a><a href="/lib/index.php?lang=it&amp;id=adm01">it</a><a href="/lib/index.php?lang=fr&amp;id=adm01">fr</a><a href="/lib/index.php?lang=pl&amp;id=adm01">pl</a><a href="/lib/index.php?lang=ru&amp;id=adm01">ru</a><a href="/lib/index.php?lang=ua&amp;id=adm01">ua</a></div>
</body>
</html>
