<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Eugene Kaspersky 'Cruncher - The First Beneficial Virus?' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Eugene Kaspersky"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Kaspersky, Eugene,Cruncher - The First Beneficial Virus?, files, cruncher, file, viruses, function, bytes, trident, memory, contents, pattern, unpacking, installation, routine, polymorphic, executed"/>
<meta name="Description" content="The first time I ever heard about the dispute over whether there could ever be such a thing as a useful virus was many years ago, when I was analysing the first virus I had ever seen. One of the articles which I read at the time was about the definition of a computer virus and the philosophical aspects of viruses. The article went on to discuss what the future might hold, and whether or not one could ever have a useful virus.At the time, I was not ready to take a firm standing point on this issue - in fact, I’m still not ready to decide. For example, a well-written boot sector virus which looked for lost clusters could arguably be useful. Once you begin to consider the beneficial things a virus could do, the list is rather long. There is a multitude of small ‘housekeeping’ tasks which a virus could perform, all of which could be inserted into the virus’ algorithm.I hope that this does not appear to be propaganda for the legitimacy of virus writing. Computer viruses bring immense problems with them, and seriously compromise the security of machines. However, life brings a lot of surprises, and to become fixed with one particular viewpoint is always a bad idea - one of these surprises was that the Earth is not flat, but round as a ball. In the 15th Century, who would have thought it!"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"1222d430909197515d3b0f410f2ab017c137df80-1498755995-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/aek07.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Cruncher - The First Beneficial Virus?</h1><p><a href="/lib/?lang=en&amp;author=Kaspersky%2C%20Eugene">Eugene Kaspersky</a><br/> <em>Viruis Bulletin, June 1993, pp. 8-9</em><br/> <em>ISSN 0956-9979</em><br/> <em>June 1993</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/aek07.html';</script><div class="ci"><a href="/lib/?ci=aek07">1</a></div>[<a style="" href="/lib/?lang=EN&amp;index=GV#aek07">Back to index</a>] [<a href="/lib/aek07.html#disqus_thread">Comments</a>]<br/> <form method="post" action=""><input type="hidden" name="pages" value="1"/><input type="submit" value="Turn on page numbers"/></form>
<ul>
<li><a href="#c1">The Virus Which Saves Your Disk Space</a></li>
<li><a href="#c2">The Origin</a></li>
<li><a href="#c3">Resident Operation</a></li>
<li><a href="#c4">Slimming Down</a></li>
<li><a href="#c5">Unpacking and Installation</a></li>
<li><a href="#c6">Detection Problems</a></li>
</ul>
<p>The first time I ever heard about the dispute over whether there could ever be such a thing as a useful virus was many years ago, when I was analysing the first virus I had ever seen. One of the articles which I read at the time was about the definition of a computer virus and the philosophical aspects of viruses. The article went on to discuss what the future might hold, and whether or not one could ever have a useful virus.</p>
<p>At the time, I was not ready to take a firm standing point on this issue - in fact, I’m still not ready to decide. For example, a well-written boot sector virus which looked for lost clusters could arguably be useful. Once you begin to consider the beneficial things a virus could do, the list is rather long. There is a multitude of small ‘housekeeping’ tasks which a virus could perform, all of which could be inserted into the virus’ algorithm.</p>
<p>I hope that this does not appear to be propaganda for the legitimacy of virus writing. Computer viruses bring immense problems with them, and seriously compromise the security of machines. However, life brings a lot of surprises, and to become fixed with one particular viewpoint is always a bad idea - one of these surprises was that the Earth is not flat, but round as a ball. In the 15th Century, who would have thought it!</p>
<p>However, regardless of all of the above, the question remains - can we have a useful virus? If we can, then the Cruncher virus could well be it.</p>
<h2><a name="c1"></a>The Virus Which Saves Your Disk Space</h2>
<p>This virus takes its name from an internal text string ‘Cruncher V1.0ß’ which is inserted into the end of the virus body. This word has a special meaning in the world of file compression - ‘crunching’ is the name of one of the file-packing methods used by most popular data compressors.</p>
<p>On the face of it, Cruncher looks like an ordinary memory-resident parasitic COM-file infector. It hooks Int 21h when it is executed and then alters the Memory Control Block list, leaving itself neatly installed in high memory.</p>
<p>When Cruncher is memory-resident, it infects on the DOS Load and Execute function. During the infection process, the virus intercepts Int 24h (the DOS Critical Error Handler) to ensure that spurious error messages are not displayed. The virus does not alter the time and date stamp of infected files, nor their attributes.</p>
<p>So far, Cruncher appears to be almost an ANSI-standard file infector virus, but unfortunately things are not nearly as simple as this first analysis would show. The additional code in the virus makes up a complete data compression routine. The Cruncher virus compresses the body of the host file when it infects it - so a hard disk thoroughly infected by this virus will have more space on it than before the infection - with no resulting loss of data!</p>
<h2><a name="c2"></a>The Origin</h2>
<p>The virus contains the text string ‘[ MK / Trident ]’. This message is present in several of the more complex hacker products, including the four versions of the <a href="/vx.php?id=et06">TPE - the Trident Polymorphic Engine</a>, which is rather like the <a href="/vx.php?id=em11">MtE</a>.</p>
<p>This means that virus writers can append that OBJ module to their viruses to make them polymorphic and difficult to detect. About six TPE-based viruses are known at this time, including the Girafe virus and the last version of the Coffeeshop and Civil War viruses.</p>
<p>The ‘MK’ label is present in several other viruses which are comparatively advanced - these are the MtE-based version of the Coffeeshop virus and WinVir-1.4, which is capable of infecting Windows executables.</p>
<h2><a name="c3"></a>Resident Operation</h2>
<p>When the virus is memory-resident, it intercepts the main DOS interrupt Int 21h and checks function 4B00h (Load and Execute) and function 33E0h which is used by the virus as an ‘Are you there?’ call.</p>
<p>When a Load and Execute (AX=4B00h) function is trapped, the virus checks the file’s name and extension. Version one of the virus only infects COM files, although it excludes any files which have the first letters CO. Version two of the Cruncher virus infects both COM and EXE files, but excludes files which begin with the letters SC, CL, VS, NE, HT, TB, VI, FI, GI, RA, FE, MT, BR, or IM.</p>
<p>The virus opens the file and examines five bytes of its header to ensure that the file is not already infected. If the target file length is less than 256 bytes or above 61440 bytes, the virus will not infect it.</p>
<h2><a name="c4"></a>Slimming Down</h2>
<p>If the file is deemed suitable for infection, the virus reads the whole file contents into one of two temporary segments (128k) of system memory. The virus then infects the file <em>in
 
memory</em>, by appending the virus code and adding a jump instruction at the start of the host file.</p>
<p>Up to this point, the virus has acted like any other file infector- however, the virus now starts to pack the infected memory image of the file using the same algorithm as the DIET utility. This compression is used over the entire file, i.e. the host and the virus body.</p>
<p>The infection routine ends here, and the compressed file is copied back to disk. The virus closes the file, restores the file attributes and time/data stamp and releases the temporarily allocated segment of system memory which was used during infection. The result of this is that the virus code is now stored within the file compression - and therefore not immediately visible. The compressed file is completely DIET-compatible to the extent that it is possible to use the DIET utility to decompress the executable!</p>
<h2><a name="c5"></a>Unpacking and Installation</h2>
<p>When an infected file is executed, the file begins to unpack itself, using the DIET algorithm. When the unpacking routine is complete, the virus installation code is executed. This checks the system memory to see whether the virus is already resident by using an ‘Are you there?’ call. If it is not, the interrupt handlers are hooked into place and the virus becomes memory-resident.</p>
<h2><a name="c6"></a>Detection Problems</h2>
<p>Reliable detection of the Cruncher virus is a very difficult task because the actual virus code is hidden within the compressed file. In this case it is not acceptable to search for the decompression routine (effectively, the decryption routine) because that code has a perfectly legitimate role in other programs. It is also not possible to use a Hex pattern search (even with wildcards) as the contents of the compressed file will depend on the contents of the host file.</p>
<p>When a file is compressed using DIET, an algorithm developed by Lempel and Ziv is used. The compression is based on creating a dictionary of ‘words’ which make up the majority of the file. Compression of this type is known as ‘adapted word compression’, which can be thought of as creating ‘abbreviations’ for longer expressions - just as one abbreviates Terminate Stay Resident to TSR.</p>
<p>For example, by using this method the string ‘111122231111’ will be compressed to ‘11 [repeat 2 bytes from offset 0] 2223 [repeat 4 bytes from offset 0]’.</p>
<p>The contents of a file are therefore packed as the sequence of new words and pointers to words which have already occurred in that file.</p>
<p>This means that the byte sequences contained in the compressed file will depend not only on the contents of the virus code but also on the contents of the host file. Therefore the contents of the compressed infected file will differ vastly for different host files.</p>
<p>This presents rather serious problems when considering how to detect the Cruncher virus. I can see no way of detecting every single infection of the virus unless the entire file is unDIETed [<em>Fattened? Ed.</em>], and then scanned. However, this process is both time and resource consuming - if the target disk contained a number of legitimate DIETed files, the scan time for the disk could be unacceptably high.</p>
<p>It is probably possible to search for the strings ‘[ MK / Trident ]’ and ‘Cruncher V1.0ß’. Although these are nominally compressed, the brief experiments which I have conducted show that infected files are detected in 75% of cases - which is enough to raise the alarm, but not nearly enough for reliable detection.</p>
<table summary="Cruncher virus">
<tr><th colspan="2">CRUNCHER</th></tr>
<tr><td>Aliases:</td><td>Cruncher-2092, Cruncher-4000</td></tr>
<tr><td>Type:</td><td>Memory-Resident, Appending Parasitic, Polymorphic</td></tr>
<tr><td>Infection:</td><td>COM files only (Cruncher-2092) COM and EXE files (Cruncher-4000)</td></tr>
<tr><td colspan="2">Self-Recognition:</td></tr>
<tr><td>Files</td><td>Checks contents of first five bytes</td></tr>
<tr><td>Memory</td><td>‘Are you there?’ call using INT 21h with AX=33E0h.</td></tr>
<tr><td>Hex Pattern:</td><td>No simple search pattern is possible. Many infected files contain ‘corrupted’ incidences of the following strings Cruncher-2092: <pre>[ MK / Trident ] Cruncher V1.0ß</pre> Cruncher-4000: <pre>*** CRUNCHER V2.0*** Automatic file compression utility</pre></td></tr>
<tr><td>Trigger:</td><td>None</td></tr>
<tr><td>Removal:</td><td>File disinfection is possible but difficult. Under clean system conditions identify and replace infected files.</td></tr>
</table>
 
[<a style="" href="/lib/?lang=EN&amp;index=GV#aek07">Back to index</a>] [<a href="/lib/aek07.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=aek07">de</a><a href="/lib/index.php?lang=en&amp;id=aek07">en</a><a href="/lib/index.php?lang=es&amp;id=aek07">es</a><a href="/lib/index.php?lang=it&amp;id=aek07">it</a><a href="/lib/index.php?lang=fr&amp;id=aek07">fr</a><a href="/lib/index.php?lang=pl&amp;id=aek07">pl</a><a href="/lib/index.php?lang=ru&amp;id=aek07">ru</a><a href="/lib/index.php?lang=ua&amp;id=aek07">ua</a></div>
</body>
</html>
