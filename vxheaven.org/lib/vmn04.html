<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> MidNyte 'An Introduction to Encryption, Part I' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="MidNyte"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, MidNyte,Introduction to Encryption, Part I, start, word, examples, armouring, words, principles, algorithm, encryption, routine, means, increases, method, order, step, reversible"/>
<meta name="Description" content="First,  a brief description of some  of  the principles involved  in encryption that you should  know before  we start.  After the  principles  follows a brief discussion of  a  few more  important topics,  then examples  of the encryption types mentioned here."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"c5aa5ce1ec494361a922ba9a917143142bba4cf4-1498756607-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vmn04.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>An Introduction to Encryption, Part I</h1><p><a href="/lib/?lang=en&amp;author=MidNyte"> MidNyte</a><br/> <em><a href="/vx.php?fid=225#f225">Final Chaos [1]</a></em><br/> <em>April 1999</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vmn04.html';</script><div class="ci"><a href="/lib/?ci=vmn04">3</a></div>[<a style="" href="/lib/?lang=EN&amp;index=PO#vmn04">Back to index</a>] [<a href="/lib/vmn04.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li><a href="#p1">Introduction.</a></li>
<li><a href="#p2">Substitution (Simple) Encryption.</a></li>
<li><a href="#p3">Sliding Key Encryption.</a></li>
<li><a href="#p4">Long Key Encryption.</a></li>
<li><a href="#p5">Transposition (Order) Encryption.</a></li>
<li><a href="#p6">Multiple Encryption.</a></li>
<li><a href="#p7">Cryptanalysis.</a></li>
<li><a href="#p8">Encryption strength.</a></li>
<li><a href="#p9">Armouring. (in brief)</a></li>
<li><a href="#pa">Some Examples.</a></li>
<li><a href="#pb">Conclusion.</a></li>
</ul>
<h2><a name="p1">Introduction.</a></h2>
<p>Encryption can be as simple or complicated as you need it to be and there are many advantages and disadvantages to each system. The trick to encryption (IMHO) is to use the type and complexity of encryption that best suits your needs, and not just the strongest encryption you can manage. First, a brief description of some of the principles involved in encryption that you should know before we start. After the principles follows a brief discussion of a few more important topics, then examples of the encryption types mentioned here. Part II will discuss these principles in more detail, and then some more advanced techniques.</p>
<h2><a name="p2">Substitution (Simple) Encryption.</a></h2>
<p>The original form of encryption, which is just a substitution cipher. Each character has a value added (or deducted, rotated etc) to it to make a new character, ie, A becomes B, B becomes C, C becomes D etc. To decrypt this, you need only save the key (the value added) and then reverse the encryption, ie, subtract instead of add. This encryption is only really effective against the casual reader. When talking in computer terms, XOR is generally used, as it is reversible (ie, value XOR valueII = valueIII, then valueIII XOR value II = value). This means you can use the same routine to decrypt as to encrypt.</p>
<h2><a name="p3">Sliding Key Encryption.</a></h2>
<p>A sliding key is a key that changes after each character is encrypted (for example just increased by one), ie, XXYZ is the code and the key starts with A. The first X is encrypted with A, second X with B, Y with C, Z with D etc. You'll notice that the two X's that were next to each other were encrypted with different values, meaning that the encrypted values of these two characters will be different. If somebody looks at this encrypted code, they won't be able to tell that the two characters are the same when unencrypted.</p>
<h2><a name="p4">Long Key Encryption.</a></h2>
<p>This is slightly more complex, using a key that is longer than the piece of code that is encrypted in each step. The key's values are used one after another to encrypt the code, ie, if the key was ABC and the code was VWXXZ then V would be encrypted with A, W with B, first X with C, second X with A and Z with B. This has two advantages. First, the key is much harder to guess or brute force. (given each value has a range of 255, a key of one character has (obviously) got 255 possible values, a key of only three characters has 16,581,375 (255 x 255 x 255) and a key of five characters has over 1,000,000,000,000 (255 x 255 x 255 x 255 x 255)). Secondly, this method also has the advantage of a sliding key.</p>
<h2><a name="p5">Transposition (Order) Encryption.</a></h2>
<p>This is normally used in conjunction with another method, as by itself it is pretty weak. All you do is basically scramble the order of all the characters in the target code. There are several methods to do this, but most require a lot of data or code to reconstruct the original if they are to be very random.</p>
<h2><a name="p6">Multiple Encryption.</a></h2>
<p>This is simply encrypting a piece of code, then encrypting the code again (usually with a different method and/or key). This drastically improves the strength of the encryption, as any patterns that show through the original encryption (see cryptanalysis below) will be obscured by the next level.</p>
<h2><a name="p7">Cryptanalysis.</a></h2>
<p>This only really applies to encrypted text, but it is possible that it could be applied to code in the hands of an experienced cryptographer who has assembly language knowledge. I'm only mentioning it so that you know that it may be possible. Cryptanalysis is basically the study of encrypted code for clues, and with the right sample and experience, it is possible to 'guess' the decryption method. For example, if simple encryption was used, you could count all the instances of each encrypted character, then rank them in numerical order. The list of encrypted characters would probably then read 'e,t,a,o,n,i,s,r,h,d'... etc, because this is the most common order of instances in the English language (I'm assuming you're decrypting English text) ie, if the most common letter you had in the encrypted example was Y, this would more than likely be the letter E when decrypted. Also some pairs of characters appear more often than others, for example 'th' or 'er'. After you have this information, it may be possible to guess some words. Once you start guessing words, the rest comes quite quickly. There are also other rules such as most three letter words will be 'the', which help speed things up. Of course, stronger (or more) encryption means less of these patterns show through. For example, if you also encrypt the space character, you make it ten times harder to decrypt encrypted text with cryptanalysis. All the word boundaries are lost, which means half the rules are of no use. A space is also more common than the letter 'e' which means you have to add this to your frequency chart. Simply adding another type of encryption will render most of these rules useless, as they are only really applicable to substitution encryption.</p>
<h2><a name="p8">Encryption strength.</a></h2>
<p>This is a common cause of mis-understanding when talking in the context of computers. Encrypted code is very vulnerable to deciphering if it is encrypted simply. Increasing the complexity of the encryption increases the strength of the encryption. However, even the strongest of encryption can easily be broken when used on a computer with an algorithm to decrypt and run the code included in the program. For the encrypted code to be able to run, you must include step by step instructions on how to decode it along with the code (the decryption routine) and the key required. Anyone who knows machine code can read this like a book. This is where armouring comes in. When you talk about encryption strength in the context of self-decrypting code, it is generally assumed to mean how well armoured the code is as opposed to the strength of the encryption method used.</p>
<h2><a name="p9">Armouring. (in brief)</a></h2>
<p>Armouring (AKA anti-debugging) is a method of trying to prevent the decryption routine running in any circumstances that aren't acceptable to the decryptor (ie, in a debugger or emulator). A simple armouring routine will try to detect the debugger/emulator and quit if found. There are many ways to armour code, and more are being found all the time. It's an ongoing battle. For instance, some emulators/debuggers will use the stack for their own purposes (although they simulate the information going on and off the stack when pushed or popped). If we set the stack pointer to a vital part of our code, any data pushed by the debugger/emulator will overwrite this, causing an unpredictable change to the instructions in our decryption routine. This will at the least cause the decryption to fail, thus protecting the encrypted data. In the best case it will crash the computer entirely, wasting time for whoever is trying to crack your encryption. There are many tutorials around on armouring etc, so i will leave it to those more qualified to teach this subject. At least you know why it's important, and that you are basically wasting your time with anything other than simple encryption if your decryptor is not armoured. Anyone with debug (that's about 99% of all PC users) and a bit of knowledge (no comment) will be able to watch as your precious secrets are displayed on their screens, piece by piece. Remember, armouring is a completely different skill to encryption, but you should know at least a little if you intend to have your code decrypt itself *and* remain hidden to observers. There are also techniques that will defeat an emulator but not a debugger, such as calling an obsolete or rare interrupt that returns a predictable value and using this value as part of your key. In an emulated environment the value will be different and ruin the decryption. You might want to research RDK (Random Decryption Key) and RDA (Random Decryption Algorithm) techniques (aka throw-away key/algorithm). This is a technique in which the virus is encrypted with a key/algorithm that it is not recorded (ie, thrown away). to decrypt itself, the virus must therefor brute-force attack it's own encrypted code looking for a piece of fixed data at a fixed point.</p>
<h2><a name="pa">Some Examples.</a></h2>
<p>(These examples are only code snippets to demonstrate certain principles, obviously you will need to set up the sections within a program yourself. These routines can be used to both encrypt and decrypt the code sections, as the operations chosen are reversible. If you substitute a non-reversible operation, you will need to adjust/repeat the routines accordingly. Please note these are very simple examples of each type of encryption, much more can be done with these. All examples are shown in a clear manner, not necessarily the most optimised. LOD and STO are used instead of indexing to help in readability. For further examples, there are many articles and tutorials in <a href="/lib/vcc00.html">VDAT</a>.</p>
<h3>Substitution (Simple) Encryption.</h3>
<p>(Pad encrypted area to an even number of bytes)</p>
<pre class="source">
setup:
   mov cx,(offset end_of_encryption - offset start_of_encryption) / 2
   ;length of encrypted code in words
   mov si,offset start_of_encryption		;source=start of encrypted code
   mov di,si					;destination=same as source
   mov bx,02828h				;bx=decryption key

start_loop:
   lodsw		;MOV's word from [si] to ax, and increases si by 2
   xor ax,bx		;the actual decryption
   stosw		;MOV's word from ax to [di], and increases di by 2
   loop start_loop	;DEC'c cx, and jumps to start_loop if CX > 0

done:
</pre>
<h3>Sliding Key Encryption.</h3>
<p>(Pad encrypted area to an even number of bytes)</p>
<pre class="source">
setup:
   mov cx,(offset end_of_encryption - start_of_encryption) / 2
   					;length of encrypted code in words
   mov si,offset start_of_encryption	;source=start of encrypted code
   mov di,si				;destination=same as source
   mov bx,02828h			;bx=decryption key

start_loop:
   lodsw		;MOV's word from [si] to ax, and increases si by 2
   xor ax,bx		;the actual decryption
   inc bx		;adds 1 to the key in each loop
   stosw		;MOV's word from ax to [di], and increase di by 2
   loop start_loop	;DEC'c cx, and jumps to start_loop if CX > 0

done:
</pre>
<h3>Long Key Encryption.</h3>
<p>(Uses long key. Pad encrypted area to an even number of bytes)</p>
<pre class="source">
setup:
   mov cx,(offset end_of_encryption - start_of_encryption) / 2
   					;length of encrypted code in words
   mov si,offset start_of_encryption	;source=start of encrypted code
   mov di,si					;destination=same as source
   mov bx,offset start_of_key			;bx=key indexing register
   mov dx,offset end_of_key - start_of_key	;length of key (even sized key)

start_loop:
   lodsw		;MOV's word from [si] to ax, and increases si by 2
   xor ax,[bx]		;the actual decryption
   add bx,2		;moves key register to next word in the key
   cmp bx,dx			;compare current index to length of key
   jb next:			;skip next instruction if not yet reached
   mov bx,offset start_of_key	;bx=key indexing register

   next:
   stosw		;MOV's word from ax to [di], and increase di by 2
   loop start_loop	;DEC'c cx, and jumps to start_loop if CX > 0

done:
</pre>
<h3>Transposition (Order) Encryption.</h3>
<p>(Swaps every pair of words. Encrypted area must be padded to a multiple of four bytes)</p>
<pre class="source">
setup:
   mov cx,(offset end_of_encryption - start_of_encryption) / 2
					;length of encrypted code in words
   mov si,offset start_of_encryption	;source=start of encrypted code
   mov di,si				;destination=same as source

start_loop:
   lodsw		;loads first word from source
   mov bx,ax		;stores first word in bx
   lodsw		;loads second word from source
   stosw		;puts second word into first word's place in destination
   mov ax,bx		;restores first word from bx to ax
   stosw		;puts first word in second word's place in destination
   loop start_loop	;DEC'c cx, and jumps to start_loop if CX > 0

done:
</pre>
<h2><a name="pb">Conclusion.</a></h2>
<p>Thus concludes today's lesson. I hope it's been of some use. See you in part II.</p>
<pre>
				- MidNyte
</pre>
<p>As always, I welcome ANY feedback, good or bad, as long as it is reasonable.</p>
[<a style="" href="/lib/?lang=EN&amp;index=PO#vmn04">Back to index</a>] [<a href="/lib/vmn04.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vmn04">de</a><a href="/lib/index.php?lang=en&amp;id=vmn04">en</a><a href="/lib/index.php?lang=es&amp;id=vmn04">es</a><a href="/lib/index.php?lang=it&amp;id=vmn04">it</a><a href="/lib/index.php?lang=fr&amp;id=vmn04">fr</a><a href="/lib/index.php?lang=pl&amp;id=vmn04">pl</a><a href="/lib/index.php?lang=ru&amp;id=vmn04">ru</a><a href="/lib/index.php?lang=ua&amp;id=vmn04">ua</a></div>
</body>
</html>
