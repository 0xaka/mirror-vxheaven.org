<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> MidNyte 'Permission to infect, sir?' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="MidNyte"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, MidNyte,Permission to infect, sir?, autoexec, file, virus, code, infect, loop, permission, granted, infection, line, system, control, user, offset, warning"/>
<meta name="Description" content="Following various posts in  alt.comp.virus  I decided to revamp one of my old piece of code that I wrote a while back.  It is basically just a snippet that checks for permission  to  do something before it does,  in this case a virus checks for permission to infect other files."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"bd67833b0f492d60c515926f140c595484ec1e4d-1498756949-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vmn10.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Permission to infect, sir?</h1><p><a href="/lib/?lang=en&amp;author=MidNyte"> MidNyte</a><br/> <em><a href="/vx.php?fid=225#f225">Final Chaos [1]</a></em><br/> <em>September 1999</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vmn10.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=PS#vmn10">Back to index</a>] [<a href="/lib/vmn10.html#disqus_thread">Comments</a>]<br/> 
<h2>Introduction.</h2>
<p>Following various posts in alt.comp.virus I decided to revamp one of my old piece of code that I wrote a while back. It is basically just a snippet that checks for permission to do something before it does, in this case a virus checks for permission to infect other files. If this is incorporated into viruses, you have a way of ensuring that the virus does not escape into the wild. (ok, there are ways this could be got round with batch files etc, but why bother? if someone malicious gets to have a batch file run they could just include a line to format a drive.)</p>
<p>Permission for the virus to infect under this particular system is given by the line 'rem WARNING: virus infection permission granted' being present in the c:\autoexec.bat file. It must be the first line, and must be exactly as above (ie, all capitalisation, spaces etc). The line is designed to convey its purpose to the casual user so that its function cannot be hidden to someone who is unaware of what is going on. Upon not finding the line, the virus should return control to the user, this being the default condition. Anything other than permission being granted results in no infection. A mistake on the line will leave users protected.</p>
<p>Because this works without interupting the user with an actual request, it can be said to work transparently. The user need do nothing except set it up the first time. This system has recently been scrutinised by Kurt Wisemer and Randy Abrams (amongst others) in the alt.comp.virus newsgroup. While they approved of the attempt to provide control, they both stated that it would be better to have a system that provided warning, rather than silent operation. I am currently trying to find a solution that will alert the user without causing disruption, until then, this is a step towards that solution. It's better than nothing.</p>
<p>The example below will check for the presence of the line in the autoexec.bat file and will let the user know whether permission was granted or denied. Compile with Tasm &amp; Tlink. Enjoy.</p>
<pre>
				- MidNyte
</pre>
<p>As always, I welcome ANY feedback, good or bad, as long as it is reasonable.</p>
<pre class="source">
code segment
     assume cs:code,ds:code
     org 100h
    
start:
   mov ax,3D00h			;open file
   mov dx,offset autoexec_mask	;c:\autoexec.bat
   int 21h

   mov bx,ax			;move file handle

   mov ah,3fh			;read from file
   mov dx,offset autoexec_line	;store in variable
   mov cx,47d			;number of bytes to read
   int 21h

   mov ax,3e00h			;close autoexec.bat
   int 21h

find_granted_message:
   mov si,offset autoexec_line
   mov di,offset granted
   mov cx,46d			;length of granted line

loop1:
   lodsb
   cmp al, byte ptr [di]
   jnz fix_copy_in_memory	;will jump on any difference
   inc di
   loop loop1

   jmp infect

fix_copy_in_memory:
   mov ah,009h
   mov dx,offset no_permission_msg
   int 21h
   int 20h			;in practicle use we should
				;return control to the host
				;program, not just quit.

infect:
   mov ah,009h			;in practice, if we have
   mov dx,offset permission_msg ;reached this point, we
   int 21h			;have the users permission
   int 20h			;to function normally (ie spread)

autoexec_mask db 'c:\autoexec.bat',0
autoexec_line db 47d dup (0)
granted db 'rem WARNING: virus infection permission granted',0
permission_msg db 'Granted',10,13,'$'
no_permission_msg db 'Denied',10,13,'$'

code ends
     end start
</pre>
<div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vmn10">de</a><a href="/lib/index.php?lang=en&amp;id=vmn10">en</a><a href="/lib/index.php?lang=es&amp;id=vmn10">es</a><a href="/lib/index.php?lang=it&amp;id=vmn10">it</a><a href="/lib/index.php?lang=fr&amp;id=vmn10">fr</a><a href="/lib/index.php?lang=pl&amp;id=vmn10">pl</a><a href="/lib/index.php?lang=ru&amp;id=vmn10">ru</a><a href="/lib/index.php?lang=ua&amp;id=vmn10">ua</a></div>
</body>
</html>
