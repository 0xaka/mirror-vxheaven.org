<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Rogue Warrior 'Argument for slow infection and slow polymorphism' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Rogue Warrior"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Rogue Warrior,Argument for slow infection and slow polymorphism, opened, files, slow, disk, ditto, stealth, host, implementation, infecting, infector, travel, computer, seed, make, programs"/>
<meta name="Description" content="Many people say that fast infectors are better than slow infectors but I have to disagree. The goal of a virus is to travel to as many hosts as possible. Agreed?"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"45e6f2cd69d33190e11393e96adcb2fe056b3f1f-1498755575-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vrw01.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Argument for slow infection and slow polymorphism</h1><p><a href="/lib/?lang=en&amp;author=Rogue%20Warrior"> Rogue Warrior</a><br/> <em><a href="/vx.php?fid=274#f274">Insane Reality Magazine [8]</a></em><br/> <em>December 1996</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vrw01.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=PO#vrw01">Back to index</a>] [<a href="/lib/vrw01.html#disqus_thread">Comments</a>]<br/> 
<h2>Slow infectors</h2>
<p>Many people say that fast infectors are better than slow infectors but I have to disagree. The goal of a virus is to travel to as many hosts as possible. Agreed?</p>
<p>For a virus to do this it must do certain things:</p>
<ol>
<li>Not be noticed (stealth).</li>
<li>Infect files which travel outside the current host.</li>
</ol>
<p>Ok, so we write a stealth fast-infector and hey presto it's all fixed right? Wrong...</p>
<p>There is a reason for this, point #1 is really two points:</p>
<ul>
<li>1.1 Cannot be detected (file/disk stealth).</li>
<li>1.2 Cannot be noticed by the user (speed, memory, disk space).</li>
</ul>
<p>Most coders forget about 1.2 and their virus is has a very obvious appearance on the host system - causing it to slow down to a snail pace at some times.</p>
<p>In virus forums there have been many cases of users saying "I noticed something happening - so I investigated and found virus X - how do I remove it?" - Our goal is to avoid this suspicion in the first place.</p>
<p>Think about AIDS/HIV? it lies dormant for up to 10 years infecting people it comes into contact with - but showing little in the way of symptoms.</p>
<p>The same applies to viruses they must not slow down the system or cause incompatibilities (QEMM exceptions/crashes etc) because human users are very good at noticing differences in the way their computer is acting.</p>
<p>This leads us to slow infection techniques, now if the goal is to get a virus to another system then all we need to do is infect files which are highly likely to be moved to another computer system, these files are:</p>
<ol>
<li>Files on Floppy Diskettes.</li>
<li>Files on Network/Remote devices.</li>
<li>Files opened while in a communications program.</li>
<li>Files opened while in a compression program.</li>
<li>Files opened while in a backup program.</li>
</ol>
<p>These files all have a chance of leaving the system.</p>
<p>Floppy disks :- 14-y/o pirates use these to swap their games, perfect way to reach out to other hosts.</p>
<p>Network devices :- useful if you have supervisor access you can by chance infect a file like login.exe and then you have all 250 computers (or however many!) working as infection posts.</p>
<p><strong>N.B.</strong>, Novell Netware allows storage of complete bootable disks on the server as files. So the network client just boots up from a file on the server. These files are useful targets also but I am lacking a network to create/test such a virus.</p>
<dl>
<dt>Comms program</dt><dd>anyone uploading a EXE/COM file is doing it for a reason (probably to send to someone). Another perfect way to infect one or *many* other hosts.</dd>
<dt>Compression program</dt><dd>usually these are used to compress software before uploading/downloading with comms programs so if we infect EXE/COM programs while compression is in progress then we have a good chance of making it outside.</dd>
<dt>Backup program</dt><dd>this is just to guard against removal of our virus from the host - if the user discovers the virus by using an AV program then we can reinfect.</dd>
</dl>
<p>Example diagram:</p>
<pre>
                                      .-&lt;&lt;--backups-----.
        .HOST SYSTEM------------------|---.             |
        |.------------------..--------'--.|----------&gt; floppies
        ||ethernet/modem/fdd|| HARD DISK ||----------&gt; network
        |'------------------''--------.--'|----------&gt; modem/comms
        '-----------------------------|---'             |
                                      '-compressed--&gt;&gt;--'
</pre>
<p>Infecting hard disk <em>files</em> is useless since they never travel outside - not like infecting files on floppies, networks and comms channels.</p>
<p>Its a good idea however to make sure your virus is loaded before other programs so that stealth is active. You should either automatically infect \COMMAND.COM or make the virus multipartite (infect mbr/track 0).</p>
<p>Implementation of this method:</p>
<p>The best implementation is this:</p>
<dl>
<dt>Floppy diskette and CDR (CD-ROM Writers) check</dt><dd>Use AX=4408, DL=Logical Drive#, INT 21h</dd>
<dt>Network/Remote check</dt><dd>Use AX=4409, DL=Logical Drive#, INT 21h<p>Use AX=440A, BX=File Handle, INT 21h</p></dd>
<dt>Comms/Compression/Backup check</dt>
<dd>Use a lookup table (LUT) to disable stealth and activate the fast-infector at opportune times:
<dl>
<dt>'CHKDSK'</dt><dd>Stops CHKDSK errors (well known).</dd>
<dt>'SCANDISK'</dt><dd>Ditto.</dd>
<dt>'NDD'</dt><dd>Ditto.</dd>
<dt>'PKLITE'</dt><dd>Protect virus in PKLITE compression wrapper.</dd>
<dt>'DIET'</dt><dd>Protect virus in DIET compression wrapper.</dd>
<dt>'LZ'</dt><dd>Protect virus in LZEXE compression wrapper.</dd>
<dt>'TM'</dt><dd>Telemate, to infect EXE/COM uploads.</dd>
<dt>'TE'</dt><dd>Telix/Terminate, to infect EXE/COM uploads.</dd>
<dt>'BACKUP'</dt><dd>To infect executable backups.</dd>
<dt>'MSBACKUP'</dt><dd>Ditto.</dd>
<dt>'CPBACKUP'</dt><dd>Ditto.</dd>
</dl>
<p>Also use the following LUT to look when a compression program output file is opened.</p>
<dl>
<dt>'ZIP'</dt><dd>PKZIP tmpfile extension opened.</dd>
<dt>'LZH'</dt><dd>LHA tmpfile extension opened.</dd>
<dt>'ARJ'</dt><dd>ARJ tmpfile extension opened.</dd>
<dt>'ARC'</dt><dd>ARC tmpfile extension opened.</dd>
<dt>'RAR'</dt><dd>RAR tmpfile extension opened.</dd>
</dl>
<p>Check the file's extension when you intercept an INT 21h AH=3C and INT 21h AH=3D call.</p></dd>
</dl>
<p>If the file which is opened is one of the above then activate the fast infector and disable the stealth.</p>
<p>When it is closed (use SFT's to check with AX=1220/INT2F AX=1216/INT2F) then reenable the slow infector and reenable the stealth.</p>
<h2>Slow Polymorphism</h2>
<p>This is a less contentious issue, slow polymorphism is designed almost entirely to annoy the anti-virus community.</p>
<p>These people receive lots of viruses everyday and they can't go around disassembling each one to the most minute detail, this is good for us because it means we can annoy them into wasting time.</p>
<p>Together with anti-goat techniques explained by Rajaat this will be rather annoying. The anti-virus community will have to spend at least a day analyzing a good polymorphic virus to:</p>
<ol type="a">
<li>get it to infect their goat files</li>
<li>get it to generate a huge number of samples (they did about 200,000 samples for SMEG I believe).</li>
</ol>
<p>BTW: If you decided to make your code dependant on the integrity of the anti-goat code then you will find the researchers have even more problems in spoon feeding the virus 200,000 good samples :)</p>
<h2>Implementation</h2>
<p>Poly of course is based on random number generation how to select a random number which changes slowly? Well I can think of two nice ways:</p>
<ol>
<li>BIOS date. -very slow poly only changes with each computer!</li>
<li>Today's date. -quite slow.</li>
</ol>
<pre class="source">
    1.  push    0FFFF
        pop     ds
        mov     si,0005             ;DS:SI -&gt; FFFF:0005 (8 bytes).
        xor     bx,bx               ;value=0
        mov     cx,4                ;size=4 words.
    L1: lodsw                       ;fetch word.
        add     bx,ax               ;checksum.
        loop    L1                  ;next 3 words.
        mov     ds:rnd_seed,bx      ;set seed.

    -------------------------------------------------------------

    2.  mov     ah,2A
        int     21                  ;get date.
        rol     dx,cl               ;random adjustment.
        xor     dx,cx               ;place cx into eqn.
        mov     ds:rnd_seed,dx      ;set seed.
</pre>
<div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vrw01">de</a><a href="/lib/index.php?lang=en&amp;id=vrw01">en</a><a href="/lib/index.php?lang=es&amp;id=vrw01">es</a><a href="/lib/index.php?lang=it&amp;id=vrw01">it</a><a href="/lib/index.php?lang=fr&amp;id=vrw01">fr</a><a href="/lib/index.php?lang=pl&amp;id=vrw01">pl</a><a href="/lib/index.php?lang=ru&amp;id=vrw01">ru</a><a href="/lib/index.php?lang=ua&amp;id=vrw01">ua</a></div>
</body>
</html>
