<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Z0mbie 'Some ideas about metamorphism' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Z0mbie"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Z0mbie,Some ideas about metamorphism, variant, program, element, code, instructions, garbage, found, viruses, hash, infected, programs, means, consisting, small, variants"/>
<meta name="Description" content="Not long ago appeared an idea about virus, consisting of only NOPs. Let we have such typical program, that its code (in different places, but consecutively) contains the same instructions, blocks of instructions or their functional variants, those can be used in some virus. Then, it will be enough to fill all other part of that program's code with NOPs, so all remaining instructions will become the virus itself. Thus, from viewpoint of performed midifications, virus will consist of only NOPs. This can be not only the simple program, but program with all its DLLs; moreover, we can insert not only NOPs, but lots of other garbage. In other words, standard infection by means of adding new instructions here changed into inverse operation, that removes unnecessary instructions. Of course, there will be troubls with constants; but if you're interested in, you will invent something."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"300acebb0fa7285fc3f623e763ee7307602fd40d-1498757162-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vzo20.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Some ideas about metamorphism</h1><p><a href="/lib/?lang=en&amp;author=Z0mbie"> Z0mbie</a><br/></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vzo20.html';</script><div class="ci"><a href="/lib/?ci=vzo20">1</a></div>[<a style="" href="/lib/?lang=EN&amp;index=ME#vzo20">Back to index</a>] [<a href="/lib/vzo20.html#disqus_thread">Comments</a>]<br/> 
<p>Not long ago appeared an idea about virus, consisting of only NOPs. Let we have such typical program, that its code (in different places, but consecutively) contains the same instructions, blocks of instructions or their functional variants, those can be used in some virus. Then, it will be enough to fill all other part of that program's code with NOPs, so all remaining instructions will become the virus itself. Thus, from viewpoint of performed midifications, virus will consist of only NOPs. This can be not only the simple program, but program with all its DLLs; moreover, we can insert not only NOPs, but lots of other garbage. In other words, standard infection by means of adding new instructions here changed into inverse operation, that removes unnecessary instructions. Of course, there will be troubls with constants; but if you're interested in, you will invent something.</p>
<p>Much more interesting consequences can be made from analysis of technics, that such virus may use.</p>
<p>Really, viruses and all other programs, are all consisting of small blocks of code, i.e. elements, of some instructions each one. And such elements are used many times both in programs and viruses, and, what is most important, in different variants.</p>
<p>Now, lets imagine, that our virus contains hash value for each variant of such element, instead of keeping the code itself. And virus all the time searches for possible variants of each element within code of found programs, by means of checking hash values for each found instruction(s); and attachs these found elements to own code, as such, replacing last found variant.</p>
<p>In other words, all the virus consists of small blocks of code (elements), and, for example, variants of some element looks as follows:</p>
<table border="1" cellspacing="0" cellpadding="0" summary="variants of some element">
<tr>
<th>variant 1</th>
<th>variant 2</th>
<th>variant 3</th>
<th>variant 4</th>
<th>variant N</th></tr>
<tr><td><pre>mov eax, [ecx]
mov edx, eax</pre></td><td><pre>mov edx, [ecx]	
mov eax, edx</pre></td><td><pre>mov eax, ecx	
mov edx, [eax]	 
mov eax, edx</pre></td><td><pre>push [ecx]
mov edx, [esp]
pop eax</pre></td><td><pre>...
...</pre></td></tr>
</table>
<p>Thus, for each single element, virus will contain N hashs for N variants of this element. And, probably, last found variant.</p>
<p>As a result, there appears uncertainty in modifications of such virus, because it is unknown, of which set of instructions it can consist.</p>
<p>And the more variants (and, as such, hash values) for each element we have and the more size of the hash is and the more time of hash calculation is , the harder is to get all the information about all possible modifications of the virus.</p>
<p>As such, "definition", i.e. obtaining information about all the states of this virus, is highly distributed in time.</p>
<p>And, even more. It is unnecessary, that virus will initially contain <em>all</em> the elements. Some subprograms can be absent (i.e. only hashs will be present), and executed only when complete set of the elements is found. As such, nobody will know what these subroutines are, and where they will be executed. Similar idea was said some time ago, when it was offered to encrypt part of the virus with some unique bios data.</p>
<p>Another feature. Some of the elements are "normal", and other are "garbage". And, there are lots of possibilities in the field of addition garbage elements by taking them from other programs.</p>
<p>Where hashs will be stored? They can be encrypted within virus; if hash database is big enough, it can be distributed between infected machines all over the internet; and these hashs can be attached in the same way as viral plugins. But what it means, when possibility of new variants of elements is attached? This means, that some infected file will gain possibility to be missed while detection, and, after some time, to startup new epidemy.</p>
<p>How to split virus into elements? If it is written in asm, then, as i think, manually; if HLL is used, maybe automatically. For example to compile from c++ to asm, and then to use some parser.</p>
<p>About elements. They must consist of some small number of asm instructions, because there are a lot of combinations of these instructions: at least half of the summary size of all the programs is code. Variable length of typical element is not limited. But there exists a little note. To achive good morphing possibilities, virus must contain two types of variants of elements: first are commonly used, to allow virus change its body quickly enough; for example - variants 1,2,3 shown above; second type is rarely used elements, such as variant 4, to make finding of them hard, but possible.</p>
<p>Also, instead of searching for elements within existing files, it is possible to try to find'em by means of iterating generation of some random bytes.</p>
<p>Of course, to write a virus consisting of only such elements is a hard task. But, lets remember, metamorphic viruses are the same polymorphic ones, where poly decryptor growed and became the whole virus body, that generates itself. In other words, tomorrow it will be done, but today we alredy can use idea about elements in the generating polymorphic decryptors. I think, that it should be combined with code integration technics. Thus, in the middle of the code section of the infected program there will exist polymorphic decryptor that will be able to consist of elements, those finding requires lots of time.</p>
<div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vzo20">de</a><a href="/lib/index.php?lang=en&amp;id=vzo20">en</a><a href="/lib/index.php?lang=es&amp;id=vzo20">es</a><a href="/lib/index.php?lang=it&amp;id=vzo20">it</a><a href="/lib/index.php?lang=fr&amp;id=vzo20">fr</a><a href="/lib/index.php?lang=pl&amp;id=vzo20">pl</a><a href="/lib/index.php?lang=ru&amp;id=vzo20">ru</a><a href="/lib/index.php?lang=ua&amp;id=vzo20">ua</a></div>
</body>
</html>
