<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Alan Solomon 'Plumbing the Depths' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Alan Solomon"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Solomon, Alan,Plumbing the Depths, format, table, files, data, anti, boot, viruses, fdisk, root, directory, program, virus, sector, file, remove"/>
<meta name="Description" content="[...] PC users sometimes resort to drastic measures to remove a virus. The use [more precisely, misuse] of low-level programs like FDISK, to remove viruses, is more common than might be expected [...]"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"22a7bf5efcbc7cb8c72cf341eb4e68eba6b0b464-1498756973-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/aas09.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Plumbing the Depths</h1><p><a href="/lib/?lang=en&amp;author=Solomon%2C%20Alan">Alan Solomon</a><br/></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/aas09.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=AV#aas09">Back to index</a>] [<a href="/lib/aas09.html#disqus_thread">Comments</a>]<br/> 
<p>PC users sometimes resort to drastic measures to remove a virus. The use [more precisely, misuse] of low-level programs like FDISK, to remove viruses, is more common than might be expected. In most cases, of course, viruses can be removed, with a minimum of fuss, using an anti-virus program. So wielding such tools as FDISK is heavy-handed. However, it's quite often worse than using a 'sledgehammer to crack a nut'; in many cases, 'the nut' fails to crack. It is worth examining what effect utilities like FDISK and FORMAT have on the hard disk; and how this relates to a virus infection.</p>
<p>Most users resort to the use of such 'heavy artillery' when their anti-virus program [or several anti-virus programs] have failed to remove a virus. This is uncommon, but it can happen, for a variety of reasons. It is advisable to contact Technical Support at this point, rather than panicking and seeking an 'easy solution', which may be worse than the problem. Of course, the 'advisable' course of action is not necessarily the one which is chosen. So let's take a look at exactly what effect FORMAT and FDISK have on a disk.</p>
<p>First, let's consider the use of the program FORMAT. This is designed to prepare a disk for use. If the hard disk is formatted using the syntax FORMAT C: /U /S</p>
<p>it will have the following effect on the disk</p>
<ul>
<li>A new boot sector, and the system files, are written to the disk [if <em>/S</em> is used, this creates a system boot sector, enabling the PC to be booted from the hard disk].</li>
<li>The File Allocation Table [FAT] is overwritten. The FAT is the 'index' used by DOS and Windows 95 to keep track of the clusters [also known as allocation units, or blocks] belonging to each file.</li>
<li>The root directory is overwritten [this contains entries for all files and directories in the root directory of the drive.</li>
<li>The /U parameter ensures that the above data is not saved, before it is overwritten.</li>
</ul>
<p>The data area of the disk is not overwritten. However, since the FAT and root directory is zeroed, data on the disk is not be easily recoverable [it would have to be 'stitched together', by hand, by someone experienced in data recovery techniques.</p>
<p>If the hard disk is formatted using the syntax specified above [after booting from a clean DOS system disk], any virus in the boot sector, or the file area, will be removed. This includes file viruses and viruses which infect the hard disk boot sector [such as Form or Daboys]. The command SYS C: will also remove a virus from the hard disk boot sector, since this will have the same effect as adding /S to the FORMAT command.</p>
<p>However, it should be noted that FORMAT affects <em>only</em> the area of the disk covered by the operating system. Viruses which infect the partition sector [Master Boot Record, MBR] will not be removed by a re-format of the hard disk. The partition sector is <b>not</b> affected by FORMAT. Partition sector viruses [Parity.b, StealthBoot, NYB, etc.] and multipartite viruses [Natas, Junkie, etc.], which infect the partition sector, will 'survive' a re-format of the hard disk. It should be remembered that boot sector viruses [most of which infect the partition sector of the hard disk] represent a significant percentage of the viruses reported to Technical Support.</p>
<p>FORMAT has a slightly different effect on floppy disks. In the first place, there is no partition sector on a floppy disk; the first sector on the disk is the boot sector. Consequently, the entire disk falls within the area controlled by the operating system. In addition, when a floppy disk is formatted, format-pattern is written to every sector, overwriting any data which was previously on the disk. A re-format of a floppy disk [using the syntax described above] will remove <em>any</em> virus.</p>
<p>Having discovered that FORMAT does not remove partition sector viruses, the unsuspecting user's next 'port of call' is to run FDISK.</p>
<p>FDISK is used to partition the hard disk [a PC's hard disk may be sub-divided into four partitions, or volumes]; and to set the active [or bootable] partition. Following the scenario outlined above, where the hard disk has been partitioned already, FDISK will refuse to re-partition the hard disk unless the active partition is first deleted.</p>
<p>So, what actually happens when FDISK is used? The partition table is deleted; and replaced with a new partition table, defined by the user. In addition, format-pattern is written to the start of each track on the hard disk [up to a certain point, which includes the root directory and File Allocation Table].</p>
<p>The important thing to note, with reference to removing a partition sector virus, is that it is <em>only</em> the partition table which is deleted and replaced. The partition executable code, and the error messages in the partition sector, remain untouched. Most partition sector viruses, however, modify the partition executable code, without affecting the partition table. So FDISK will have no effect on this type of virus. Of course, the first time our unsuspecting user realises this . . . is after re-formatting the hard disk [again!] and re-loading a backup.</p>
<p>Consider the plight of a user who has run FORMAT to re-format the hard disk [and then re-loaded a backup]; and who has then run FDISK to delete and replace the partition table [and re-loaded a backup, again] . . . only to discover that the hard disk is still infected.</p>
<p>It is worth raising the issue of FDISK /MBR at this point. Since this is frequently seen as an easy way of removing partitions sector viruses, it is important to outline what it does to the partition sector; and to explain why it is inadvisable to use this as a virus removal method.</p>
<p>FDISK /MBR re-writes the partition executable code and the error messages in the partition sector, without affecting the partition table. Since <b>most</b> partition sector viruses do not modify the partition table, this would appear to be a useful way of removing these viruses. However, let the incautious user beware!</p>
<ol>
<li>Some partition sector viruses write code over the entire partition sector, including the partition table. Empire Monkey is the best known virus which does this. Empire Monkey writes its own code to the partition sector, re-locating the original, clean sector [in encrypted form] to another sector on the first track of the hard disk [cylinder 0, head 0, sector3]. When the PC is booted normally, the virus loads into memory and decrypts the original partition sector, so the PC boots normally. However, if the PC is booted from a clean DOS system disk, the virus is not loaded, the original partition sector remains encrypted and the hard disk remains inaccessible at an operating system level [any attempt to access the hard disk results in the message 'Invalid drive specification']. If FDISK /MBR is used, it will replace most of the virus code with partition executable code and error messages; but it will assume that whatever is located in the area where the partition table should be is a valid partition table; this code will not be changed. Since this is not a valid partition table, but the remnants of the virus, the PC will fail to boot normally. Remember that FDISK /MBR [in the above scenario] has removed most of the virus code; and the virus is the only mechanism for decrypting the original partition sector. [One of the variants of Exebug also writes over the partition table].</li>
<li>One-Half virus does not modify the partition table; so FDISK /MBR will successfully remove the virus from the partition sector [One-half also infects files; so it is necessary to clean the files using an anti-virus program, or replace the files with backup copies]. In addition to simply infecting the partition sector, the virus gradually encrypts cylinders on the hard disk. If the infected PC is booted normally, and the virus is memory-resident, it decrypts these cylinders 'on the fly'. However, using FDISK /MBR to remove the virus also removes the mechanism for decrypting the relevant cylinders. The result is data loss.</li>
<li>It is not only viruses which modify the partition sector. This sector may be modified by security software being used on the PC. In addition, if the user has installed disk management software, this will involve modifications to the partition sector. In both cases, use of FDISK /MBR to remove a virus will have an adverse effect.</li>
</ol>
<p>So, what conclusions can be drawn from all this? The first thing to state is that neither FORMAT nor FDISK is <b>necessary</b> to remove a virus. If they are used at all, following a virus infection, it should be for convenience, <b>not</b> necessity. For example, it may be that the PC is infected by a multipartite virus; and there are a great number of infected files; in which case, it may be more convenient to simply re-load a backup. In any event, if this course of action is appropriate, things should be done in the following order.</p>
<ul>
<li>Boot from a clean DOS system disk;</li>
<li>Use TOOLKIT /ID to copy a blank sector over cylinder 0, head 0, sector 1. Then run FDISK /MBR, to re-write the partition executable code and error messages.</li>
<li>Run FDISK, to delete [and then re-create] the partition table.</li>
<li>Re-format the hard disk, using the syntax FORMAT C: /U /S</li>
<li>Re-load a backup.</li>
</ul>
[<a style="" href="/lib/?lang=EN&amp;index=AV#aas09">Back to index</a>] [<a href="/lib/aas09.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=aas09">de</a><a href="/lib/index.php?lang=en&amp;id=aas09">en</a><a href="/lib/index.php?lang=es&amp;id=aas09">es</a><a href="/lib/index.php?lang=it&amp;id=aas09">it</a><a href="/lib/index.php?lang=fr&amp;id=aas09">fr</a><a href="/lib/index.php?lang=pl&amp;id=aas09">pl</a><a href="/lib/index.php?lang=ru&amp;id=aas09">ru</a><a href="/lib/index.php?lang=ua&amp;id=aas09">ua</a></div>
</body>
</html>
