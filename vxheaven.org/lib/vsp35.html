<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> SPTH 'Hashes for Encryption' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="SPTH"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, SPTH,Hashes for Encryption, byte, antivirus, words, technique, simple, virus, assembler, checksum, hash, real, encrypted, function, content, find, creates"/>
<meta name="Description" content="A hash function (or hash algorithm) is a way of creating a small digital &quot;fingerprint&quot; from any kind of data. You can neighter find the original fingerprinted string nor create a new string with the same checksum (without a great effort). Beside of rainbow-lists, bruteforce is the only way to find out what the checksum stands for. Bruteforce uses more time, the longer the fingerprinted data is. If hash functions will be used in viruses for encryption, antivirus programms would have to use a bruteforce attack to find the real virus code. As bruteforce requires much time, and less scanning time is essential for antivirus-programs, hash-encryption might be a useful weapon against antivirus programs."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"d3e150a0f1e1a160bdc1985558e41cfd3a92047c-1498756381-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vsp35.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Hashes for Encryption</h1><p><a href="/lib/?lang=en&amp;author=SPTH"> SPTH</a><br/> <em><a href="/vx.php?fid=1528#f1528">Electrical Ordered Freedom #1</a></em><br/> <em>January 2007</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vsp35.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=VT#vsp35">Back to index</a>] [<a href="/lib/vsp35.html#disqus_thread">Comments</a>]<br/> 
<ul>
<li><a href="#c0">0) Intro Words</a></li>
<li><a href="#c1">1) The Idea</a></li>
<li><a href="#c2">2) The Practice</a>
<ul>
<li><a href="#c21">a) Simple MD5 encryption</a></li>
<li><a href="#c22">b) Multible-byte MD5 encryption</a></li>
<li><a href="#c23">c) Multibe-byte MD5/SHA1 encryption</a></li>
<li><a href="#c24">d) The final attempt</a></li>
</ul></li>
<li><a href="#c3">3) Outro words</a></li>
</ul>
<h2><a name="c0"></a>0) Intro Words</h2>
<p>A hash function (or hash algorithm) is a way of creating a small digital "fingerprint" from any kind of data. You can neighter find the original fingerprinted string nor create a new string with the same checksum (without a great effort). Beside of rainbow-lists, bruteforce is the only way to find out what the checksum stands for. Bruteforce uses more time, the longer the fingerprinted data is. If hash functions will be used in viruses for encryption, antivirus programms would have to use a bruteforce attack to find the real virus code. As bruteforce requires much time, and less scanning time is essential for antivirus-programs, hash-encryption might be a useful weapon against antivirus programs.</p>
<h2><a name="c1"></a>1) The Idea</h2>
<p>A typical cryptographic one-way function, such as MD5 or SHA1, is not one-to-one and makes an effective hash function. How can this be used for encryption? I wrote bruteforce requires more time the longer the string is. Now imagine: Create checksums of 1-3 bytes of your virus. Then write a bruteforce function which finds the real content, combine the content to the full code and execute it. This bruteforce search should need some seconds for finding the real content, because emulators will also need the same time - and the longer an emulator will use, the worse it is for the antivirus program. Imagine an antivirus program that need 15 - 30 seconds for scanning one file - whereas the time is no problem for the virus.</p>
<h2><a name="c2"></a>2) The Practice</h2>
<p>In my examples I've used PHP, because it has an existing MD5/SHA1 function so it is easy to understand the examples. When I've thought about this technique I've thought about real binary viruses (assembler would be good, as you can write very fast bruteforce engines with it).</p>
<h3><a name="c21"></a>a) Simple MD5 encryption</h3>
<p>In this example I show you how to primitively use this technique. The code simple uses a bruteforce function to find the strings of the checksums and prints it to the browser. The checksums are always one single byte, encrypted with MD5; which means that bruteforce will only need 2^8 trials per each checksum.</p>
<h4>Simple MD5 encryption</h4>
<div class="php" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">&lt;?php</span><br/>
<span style="color: #000088;">$code</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">'c1d9f50f86825a1a2302ec2449c17196'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// H</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'e1671797c52e15f763380b45e841ec32'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// e</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'2db95e8e1a9267b7a1188556b2013b33'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// l</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'2db95e8e1a9267b7a1188556b2013b33'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// l</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'d95679752134a2d9eb61dbd7b91c4bcc'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// o</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'7215ee9c7d9dc229d2921a40e899ec5f'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// &lt;space&gt;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'5206560a306a2e085a437fd258eb57ce'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// V</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'02129bb861061d1a052c592e2dc6b383'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// X</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'e1671797c52e15f763380b45e841ec32'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// e</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'4b43b0aee35624cd95b910189b3dc231'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// r</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'03c7c0ace395d80182db07ae2c30f034'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// s</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'9033e0e305f247c0c3c80d0c7848c8b3'</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black; font-style: italic;">// !</span><br/>
<span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$j</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$z</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><span style="color: #000088;">$code</span><span style="color: black;">&#91;</span><span style="color: #000088;">$j</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #b1b100;">do</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #000088;">$i</span><span style="color: #339933;">++;</span><br/>
&nbsp; <span style="color: black;">&#125;</span> <span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/md5"><span style="color: #990000;">md5</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000088;">$code</span><span style="color: black;">&#91;</span><span style="color: #000088;">$j</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #000088;">$z</span><span style="color: #339933;">.=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #000088;">$j</span><span style="color: #339933;">++;</span><br/>
<span style="color: black;">&#125;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #000088;">$z</span><span style="color: #339933;">;</span><br/>
<span style="color: #000000; font-weight: bold;">?&gt;</span><br/>
&nbsp;</div>
<h3><a name="c22"></a>b) Multible-byte MD5 encryption</h3>
<p>This improved version can handle an unlimited number of bytes (well, limited by time - the checksums are 1 or 2 bytes, because more needs too much time for the slow PHP interpreter and 30 seconds limit of my webserver). It uses MD5 again. At this example, the bruteforce engine needs 2^16 trials to find the correct string. You could increase it to 2^24 (3 bytes) or even 2^32 if you have a damn fast webserver and much time, but I think 2^24 is realistic.</p>
<h4>Multible-byte MD5 encryption</h4>
<div class="php" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">&lt;?php</span><br/>
<span style="color: #000088;">$code</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">'a64cf5823262686e1a28b2245be34ce0'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// He</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'5b54c0a045f179bcbbbc9abcb8b5cd4c'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// ll</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'d95679752134a2d9eb61dbd7b91c4bcc'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// o</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'380f40674dcc13ab964f970e5c5750bb'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// &lt;space&gt;V</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'02129bb861061d1a052c592e2dc6b383'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// X</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'818f9c45cfa30eeff277ef38bcbe9910'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// er</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'530490af3588a14fb123af08e8bf4b95'</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black; font-style: italic;">// s!</span><br/>
<span style="color: #000088;">$j</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$z</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><span style="color: #000088;">$code</span><span style="color: black;">&#91;</span><span style="color: #000088;">$j</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #000088;">$k</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$r</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">do</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">while</span><span style="color: black;">&#40;</span><span style="color: #339933;">++</span><span style="color: #000088;">$i</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: #339933;">==</span><span style="color: #0000ff;">''</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$k</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">elseif</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/ord"><span style="color: #990000;">ord</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #000088;">$r</span><span style="color: #339933;">++;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span> <span style="color: black;">&#123;</span> <span style="color: #000088;">$k</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #000088;">$k</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/ord"><span style="color: #990000;">ord</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: black;">&#125;</span> <span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/md5"><span style="color: #990000;">md5</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000088;">$code</span><span style="color: black;">&#91;</span><span style="color: #000088;">$j</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #000088;">$z</span><span style="color: #339933;">.=</span><span style="color: #000088;">$k</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #000088;">$j</span><span style="color: #339933;">++;</span><br/>
<span style="color: black;">&#125;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #000088;">$z</span><span style="color: #339933;">;</span><br/>
<span style="color: #000000; font-weight: bold;">?&gt;</span><br/>
&nbsp;</div>
<h3><a name="c23"></a>c) Multibe-byte MD5/SHA1 encryption</h3>
<p>The next improvement is to add another checksum, which doubles the amount of trials needed for finding the encrypt string. There is just one line that has changed - the while-condition. There is a significant difference between MD5 and SHA1: MD5 builds 32-byte checksums, SHA1 creates 40-byte checksums.To not manifest which hash algorithm has been used,the checksum has to be reduced to 32 byte. This is no problem for the bruteforce, as it can compare the reduced 32 byte. An bruteforce emulator needs about 2^17 trials per checksum now to decrypt it.</p>
<h4>Multibe-byte MD5/SHA1 encryption</h4>
<div class="php" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">&lt;?php</span><br/>
<span style="color: #000088;">$code</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">'a64cf5823262686e1a28b2245be34ce0'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// 'He' MD5</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'110c8a30c16070bf2813480d9492a1a1'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// 'll' SHA1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'d95679752134a2d9eb61dbd7b91c4bcc'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// 'o' &nbsp;MD5</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'4a980110005e2e6de062cd0dfd73db7e'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// ' V' SHA1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'c032adc1ff629c9b66f22749ad667e6b'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// 'X' &nbsp;SHA1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'818f9c45cfa30eeff277ef38bcbe9910'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// 'er' MD5</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'6393a74e8dceffcbc8e77e7a54e1b813'</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black; font-style: italic;">// 's!' SHA1</span><br/>
<span style="color: #000088;">$j</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$z</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><span style="color: #000088;">$code</span><span style="color: black;">&#91;</span><span style="color: #000088;">$j</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #000088;">$k</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$r</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">do</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">while</span><span style="color: black;">&#40;</span><span style="color: #339933;">++</span><span style="color: #000088;">$i</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: #339933;">==</span><span style="color: #0000ff;">''</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$k</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">elseif</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/ord"><span style="color: #990000;">ord</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #000088;">$r</span><span style="color: #339933;">++;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span> <span style="color: black;">&#123;</span> <span style="color: #000088;">$k</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #000088;">$k</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/ord"><span style="color: #990000;">ord</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: black;">&#125;</span> <span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/md5"><span style="color: #990000;">md5</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000088;">$code</span><span style="color: black;">&#91;</span><span style="color: #000088;">$j</span><span style="color: black;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <a style="color: #000060;" href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/sha1"><span style="color: #990000;">sha1</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">32</span><span style="color: black;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000088;">$code</span><span style="color: black;">&#91;</span><span style="color: #000088;">$j</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #000088;">$z</span><span style="color: #339933;">.=</span><span style="color: #000088;">$k</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #000088;">$j</span><span style="color: #339933;">++;</span><br/>
<span style="color: black;">&#125;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #000088;">$z</span><span style="color: #339933;">;</span><br/>
<span style="color: #000000; font-weight: bold;">?&gt;</span><br/>
&nbsp;</div>
<h3><a name="c24"></a>d) The final attempt</h3>
<p>As we know that the checksum does not contain more that two or three bytes, we could also include garbage into the checksums. We have to include a counter to the bruteforce function, and count all trials. If the counter reaches a point where no code has been found, it stopps the searching, and continues with the next checksum. Furthermore I've included a function which creates new checksums and writes it to the browser. The encryption function takes one or two bytes of the string, creates MD5 or SHA1 checksums and randomly includes garbage checksums. In a real malware, which uses that technique, the encryption function is inside the encrypted code - of course - together with the spreading routines.</p>
<h4>The final attempt</h4>
<div class="php" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #000000; font-weight: bold;">&lt;?php</span><br/>
<span style="color: #000088;">$code</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">'a64cf5823262686e1a28b2245be34ce0'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// 'He' MD5</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'110c8a30c16070bf2813480d9492a1a1'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// 'll' SHA1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'d95679752134a2d9eb61dbd7b91c4bcc'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// 'o' &nbsp;MD5</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'62686dec2c331fbdc2e2e260b39f8ef6'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// GARBAGE</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'4a980110005e2e6de062cd0dfd73db7e'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// ' V' SHA1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'c032adc1ff629c9b66f22749ad667e6b'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// 'X' &nbsp;SHA1</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'a853cc79167c18e737532c32a3401b68'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// GARBAGE</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'818f9c45cfa30eeff277ef38bcbe9910'</span><span style="color: #339933;">,</span> &nbsp;<span style="color: black; font-style: italic;">// 'er' MD5</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">'6393a74e8dceffcbc8e77e7a54e1b813'</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black; font-style: italic;">// 's!' SHA1</span><br/>
<br/>
<span style="color: #000088;">$j</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$z</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><span style="color: #000088;">$code</span><span style="color: black;">&#91;</span><span style="color: #000088;">$j</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #000088;">$k</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #000088;">$r</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #000088;">$c</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">do</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #b1b100;">while</span><span style="color: black;">&#40;</span><span style="color: #339933;">++</span><span style="color: #000088;">$i</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: #339933;">==</span><span style="color: #0000ff;">''</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$k</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">elseif</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/ord"><span style="color: #990000;">ord</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #000088;">$r</span><span style="color: #339933;">++;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span> <span style="color: black;">&#123;</span> <span style="color: #000088;">$k</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><span style="color: #000088;">$k</span><span style="color: #339933;">;</span> <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">else</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/ord"><span style="color: #990000;">ord</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#123;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: black;">&#41;</span><span style="color: #339933;">-</span><span style="color: #000088;">$r</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span><span style="color: #339933;">+</span><span style="color: #cc66cc;">1</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000088;">$i</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: black;">&#125;</span> <span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/md5"><span style="color: #990000;">md5</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000088;">$code</span><span style="color: black;">&#91;</span><span style="color: #000088;">$j</span><span style="color: black;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <a style="color: #000060;" href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/sha1"><span style="color: #990000;">sha1</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$k</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">32</span><span style="color: black;">&#41;</span><span style="color: #339933;">!=</span><span style="color: #000088;">$code</span><span style="color: black;">&#91;</span><span style="color: #000088;">$j</span><span style="color: black;">&#93;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #339933;">++</span><span style="color: #000088;">$c</span><span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">65535</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #000088;">$c</span><span style="color: #339933;">&lt;</span><span style="color: #cc66cc;">65535</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #000088;">$z</span><span style="color: #339933;">.=</span><span style="color: #000088;">$k</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$i</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #000088;">$j</span><span style="color: #339933;">++;</span><br/>
<span style="color: black;">&#125;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #000088;">$z</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;br&gt;&lt;br&gt;'</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;Now let's see some other possible variants:&lt;br&gt;&quot;</span><span style="color: #339933;">;</span><br/>
<a style="color: #000060;" href="http://www.php.net/srand"><span style="color: #990000;">srand</span></a><span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>double<span style="color: black;">&#41;</span><a style="color: #000060;" href="http://www.php.net/microtime"><span style="color: #990000;">microtime</span></a><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><span style="color: #339933;">*</span><span style="color: #cc66cc;">1000000</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<span style="color: #000088;">$nz</span><span style="color: #339933;">=</span><span style="color: #0000ff;">''</span><span style="color: #339933;">;</span><br/>
<span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$z</span><span style="color: black;">&#41;</span><span style="color: #339933;">&gt;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #000088;">$t</span><span style="color: #339933;">=</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #000088;">$y</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$z</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><a style="color: #000060;" href="http://www.php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">!</span><a style="color: #000060;" href="http://www.php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #000088;">$nz</span><span style="color: #339933;">=</span><span style="color: #000088;">$nz</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;br&gt;'</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/md5"><span style="color: #990000;">md5</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$z</span><span style="color: black;">&#41;</span><span style="color: #339933;">==</span><span style="color: #cc66cc;">1</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #000088;">$y</span><span style="color: #339933;">.=</span><span style="color: #000088;">$z</span><span style="color: black;">&#123;</span><span style="color: #cc66cc;">1</span><span style="color: black;">&#125;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #000088;">$nz</span><span style="color: #339933;">=</span><span style="color: #000088;">$nz</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;br&gt;'</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/md5"><span style="color: #990000;">md5</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$y</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #b1b100;">else</span><br/>
&nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; <span style="color: #000088;">$nz</span><span style="color: #339933;">=</span><span style="color: #000088;">$nz</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;br&gt;'</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/sha1"><span style="color: #990000;">sha1</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$y</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">32</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">!</span><a style="color: #000060;" href="http://www.php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #000088;">$nz</span><span style="color: #339933;">=</span><span style="color: #000088;">$nz</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;br&gt;'</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/sha1"><span style="color: #990000;">sha1</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">.</span><a style="color: #000060;" href="http://www.php.net/chr"><span style="color: #990000;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://www.php.net/rand"><span style="color: #990000;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">255</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">32</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #000088;">$z</span><span style="color: #339933;">=</span><a style="color: #000060;" href="http://www.php.net/substr"><span style="color: #990000;">substr</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$z</span><span style="color: #339933;">,</span><a style="color: #000060;" href="http://www.php.net/strlen"><span style="color: #990000;">strlen</span></a><span style="color: black;">&#40;</span><span style="color: #000088;">$y</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<span style="color: black;">&#125;</span><br/>
<span style="color: #b1b100;">echo</span> <span style="color: #000088;">$nz</span><span style="color: #339933;">;</span><br/>
<span style="color: #000000; font-weight: bold;">?&gt;</span><br/>
&nbsp;</div>
<h2><a name="c3"></a>3) Outro words</h2>
<p>In my opinion, emulators are not fast enough to detect a virus using hash encrypted malware. If the virus is static,of course, this technique is not very useful, because the checksums of all possible variants of the the first n bytes can be used as scan-string; but if the virusbody morphs itself a little bit, this technique could make antivirus researchers a very hard life. I want to mention again, that I think this idea is very useful for assembler-viruses, because assembler is very fast, and they are binary (255 possibilities per byte, not just [A-Z&amp;&amp;a-z&amp;&amp;0-9].</p>
<p>Thanks for reading - I'm checking out now - Over!</p>
[<a style="" href="/lib/?lang=EN&amp;index=VT#vsp35">Back to index</a>] [<a href="/lib/vsp35.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vsp35">de</a><a href="/lib/index.php?lang=en&amp;id=vsp35">en</a><a href="/lib/index.php?lang=es&amp;id=vsp35">es</a><a href="/lib/index.php?lang=it&amp;id=vsp35">it</a><a href="/lib/index.php?lang=fr&amp;id=vsp35">fr</a><a href="/lib/index.php?lang=pl&amp;id=vsp35">pl</a><a href="/lib/index.php?lang=ru&amp;id=vsp35">ru</a><a href="/lib/index.php?lang=ua&amp;id=vsp35">ua</a></div>
</body>
</html>
