<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> Z0mbie 'Помехозащищенные вирусы' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="Z0mbie"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, Z0mbie,Помехозащищенные вирусы, байта, число, столбцов, байт, один, матрицы, данных, пример, "/>
<meta name="Description" content="Когда большинство вирусов было бутовыми, когда обновлялся аидстестовский вирлист, лозинский еще не впал в маразм, а касперский еще только сосал не причмокивая... Жил-был вирус, и как только он не назывался - Doodle, Yankee, Music, и еще хрен знает как.И была в том вирусе фича, а именно - коли патчил в вирусе бедняга-программист какой байт, так байт этот на место возвращался. То есть становился обратно, как был."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"4b1cddb1c4dc746de2d22b5562f80b1b519b5afe-1498757869-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vzo60.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Помехозащищенные вирусы</h1><p><a href="/lib/?lang=ru&amp;author=Z0mbie"> Z0mbie</a><br/> <em><a href="/vx.php?fid=455#f455">Top Device Online [6]</a></em><br/> <em>Июнь 2000</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vzo60.html';</script>[<a style="" href="/lib/?lang=RU&amp;index=VT#vzo60">Вернуться к списку</a>] [<a href="/lib/vzo60.html#disqus_thread">Комментарии</a>]<br/> 
<p>Когда большинство вирусов было бутовыми, когда обновлялся аидстестовский вирлист, лозинский еще не впал в маразм, а касперский еще только сосал не причмокивая... Жил-был вирус, и как только он не назывался - Doodle, Yankee, Music, и еще хрен знает как.</p>
<p>И была в том вирусе фича, а именно - коли патчил в вирусе бедняга-программист какой байт, так байт этот на место возвращался. То есть становился обратно, как был.</p>
<p>И с тех пор мучают вирмэйкеры себя и людей, доставая их вопросами - как же енто он, проклятый, восстанавливается, не делая второй своей копии?</p>
<p>Интуитивно ясно, что внесение избыточности в информацию позволяет находить и восстанавливать помехи. Пример тому - избыточность естественных языков. Сколько избыточности вносить и как ее считать, можно прочитать у Шеннона.</p>
<p>Мы, вирмэйкеры, люди простые, нам Шеннон ни к чему, всякие там теоремы мы вообще знать не желаем, и поэтому требуется простой способ восстанавливать вирус после патча.</p>
<p>Итак, представляем защищаемый блок данных в виде матрицы. По каждому столбцу и каждой строке матрицы считаем контрольную сумму, попросту XORим байты один на другой.</p>
<p>Теперь представим, что изменился один байт. Тогда изменятся контрольные суммы соответствующих столбца/строки матрицы, своими номерами указывая координаты байта.</p>
<p>Вот и все. Максимальное количество восстанавливаемых подряд байт равно числу столбцов. Количество строк и столбцов выбирается как вам удобнее.</p>
<p>Конечно, можно попросту хранить вторую копию вируса. Но ее будет легко пропатчить. И вообще, это уже совсем другая байка.</p>
<p>Кстати, судя по всему похожая фишка используется в RARе для защиты архивов от глюков, для -rr1 число столбцов (длина строки) соответственно 512 байт - один сектор.</p>
<p>Пример.</p>
<p>Есть <em>данные</em>, и есть контрольные суммы <em>по строкам</em> и <em>по столбцам</em>, посчитанные XORом. Пусть байт <em>74</em> (jz) изменили на <em>EB</em> (jmp).</p>
<table summary="">
<tr><th colspan="6">до изменения</th><th colspan="6">после изменения</th></tr>
<tr><td>90</td><td>90</td><td>90</td><td>90</td><td>90</td><th>90</th><td>90</td><td>90</td><td>90</td><td>90</td><td>90</td><th>90</th></tr>
<tr><td>90</td><th>74</th><td>12</td><td>90</td><td>90</td><th>F6</th><td>90</td><th>EB</th><td>12</td><td>90</td><td>90</td><th>69</th></tr>
<tr><td>90</td><td>90</td><td>90</td><td>90</td><td>90</td><th>90</th><td>90</td><td>90</td><td>90</td><td>90</td><td>90</td><th>90</th></tr>
<tr><td>90</td><td>90</td><td>90</td><td>90</td><td>90</td><th>90</th><td>90</td><td>90</td><td>90</td><td>90</td><td>90</td><th>90</th></tr>
<tr><th>00</th><th>E4</th><th>82</th><th>00</th><th>00</th><th> </th><th>00</th><th>7B</th><th>82</th><th>00</th><th>00</th><th> </th></tr>
</table>
<p>В результате изменятся два байта контрольных сумм - один в суммах <em>по строкам</em> и один в суммах <em>по столбцам</em>. Таким образом мы узнали координаты измененного <em>байта</em> в массиве <em>данных</em>. Как вычислить старое значение байта? - проXORить <em>старую</em> контрольную сумму на <em>новую</em> и на новое значение байта.</p>
<p><em>F6 xor 69 xor EB = 74</em>, либо <em>E4 xor 7B xor EB = 74</em>.</p>
<p>Следующую мысль выражу кратко: если и здесь не понятно, то это пиздец.</p>
<p>Пример на C++</p>
<p>Примечание (для тех кто не знает C):</p>
<table summary="C/Pascal">
<tr><th>с++</th><th>pascal</th></tr>
<tr><td>c = d ^ e;</td><td>c := d xor e;</td></tr>
<tr><td>a ^= b;</td><td>a := a xor b;</td></tr>
<tr><td>a++;</td><td>a := a + 1;</td></tr>
</table>
<div class="c" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span><br/>
<span style="color: #339933;">#include &lt;stdlib.h&gt;</span><br/>
<br/>
<span style="color: #339933;">#define COLS&nbsp; &nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // число столбцов (x)</span><br/>
<span style="color: #339933;">#define ROWS&nbsp; &nbsp; 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // число строк (y)</span><br/>
<br/>
<span style="color: #993333;">void</span> main<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br/>
<span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> a<span style="color: black;">&#91;</span>ROWS<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>COLS<span style="color: black;">&#93;</span><span style="color: #339933;">;</span>&nbsp; &nbsp; <span style="color: black; font-style: italic;">// массив данных</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> y<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> y<span style="color: #339933;">&lt;</span>ROWS<span style="color: #339933;">;</span> y<span style="color: #339933;">++</span><span style="color: black;">&#41;</span>&nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// заполним его всякой хуйней</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> x<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> x<span style="color: #339933;">&lt;</span>COLS<span style="color: #339933;">;</span> x<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">=</span>random<span style="color: black;">&#40;</span><span style="color: #0000dd;">256</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> oy<span style="color: black;">&#91;</span>ROWS<span style="color: black;">&#93;</span><span style="color: #339933;">=</span><span style="color: black;">&#123;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#125;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; <span style="color: black; font-style: italic;">// контрольные суммы: по строкам</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> ox<span style="color: black;">&#91;</span>COLS<span style="color: black;">&#93;</span><span style="color: #339933;">=</span><span style="color: black;">&#123;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#125;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; <span style="color: black; font-style: italic;">// по столбцам</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> y<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> y<span style="color: #339933;">&amp;</span>lt<span style="color: #339933;">;</span>ROWS<span style="color: #339933;">;</span> y<span style="color: #339933;">++</span><span style="color: black;">&#41;</span> &nbsp; <span style="color: black; font-style: italic;">// считаем контрольные суммы</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> x<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> x<span style="color: #339933;">&amp;</span>lt<span style="color: #339933;">;</span>COLS<span style="color: #339933;">;</span> x<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; oy<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: #339933;">^=</span>a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ox<span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">^=</span>a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">int</span> y <span style="color: #339933;">=</span> random<span style="color: black;">&#40;</span>ROWS<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// пропатчим два рандомных байта</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">int</span> x <span style="color: #339933;">=</span> random<span style="color: black;">&#40;</span>COLS<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// (они должны быть в одной строке)</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">int</span> r <span style="color: #339933;">=</span> random<span style="color: black;">&#40;</span><span style="color: #0000dd;">256</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;randomizing a[%i][%i]: %02X --&amp;gt; %02X<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span>x<span style="color: #339933;">,</span> a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">,</span> r<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> r<span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; x<span style="color: #339933;">--;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; r <span style="color: #339933;">=</span> random<span style="color: black;">&#40;</span><span style="color: #0000dd;">256</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;randomizing a[%i][%i]: %02X --&amp;gt; %02X<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span>x<span style="color: #339933;">,</span> a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">,</span> r<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> r<span style="color: #339933;">;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> ny<span style="color: black;">&#91;</span>ROWS<span style="color: black;">&#93;</span><span style="color: #339933;">=</span><span style="color: black;">&#123;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#125;</span><span style="color: #339933;">;</span> &nbsp; &nbsp; <span style="color: black; font-style: italic;">// новые контрольные суммы</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> nx<span style="color: black;">&#91;</span>COLS<span style="color: black;">&#93;</span><span style="color: #339933;">=</span><span style="color: black;">&#123;</span><span style="color: #0000dd;">0</span><span style="color: black;">&#125;</span><span style="color: #339933;">;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> y<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> y<span style="color: #339933;">&lt;</span>ROWS<span style="color: #339933;">;</span> y<span style="color: #339933;">++</span><span style="color: black;">&#41;</span>&nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// считаем и их</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> x<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> x<span style="color: #339933;">&lt;</span>COLS<span style="color: #339933;">;</span> x<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ny<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: #339933;">^=</span>a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nx<span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">^=</span>a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> y<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> y<span style="color: #339933;">&lt;</span>ROWS<span style="color: #339933;">;</span> y<span style="color: #339933;">++</span><span style="color: black;">&#41;</span>&nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// для каждого байта данных</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #993333;">int</span> x<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> x<span style="color: #339933;">&lt;</span>COLS<span style="color: #339933;">;</span> x<span style="color: #339933;">++</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// если не совпадают суммы по строкам и столбцам</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: black;">&#40;</span>oy<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: #339933;">!=</span>ny<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">&amp;&amp;</span><span style="color: black;">&#40;</span>ox<span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">!=</span>nx<span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#123;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;found error in a[%i][%i]<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> y<span style="color: #339933;">,</span>x<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// два варианта &quot;старых&quot; значений байта&lt;/i&gt;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">int</span> v1 <span style="color: #339933;">=</span> oy<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: #339933;">^</span>ny<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: #339933;">^</span>a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">int</span> v2 <span style="color: #339933;">=</span> ox<span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">^</span>nx<span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">^</span>a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span>v1<span style="color: #339933;">==</span>v2<span style="color: #339933;">?</span><span style="color: #ff0000;">&quot;correcting<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">:</span><span style="color: #ff0000;">&quot;trying to correct<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span style="color: #000066;">printf</span></a><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;%02X -&gt; %02X<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span><span style="color: #339933;">,</span> v2<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// в качестве восстановленного байта используем оный посчитанный</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// при помощи суммы по столбцу (v2), так как вероятность изменения</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// нескольких байт подряд (т.е. в одной строке) больше</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ny<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span> <span style="color: #339933;">^=</span> a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span> <span style="color: #339933;">^</span> v2<span style="color: #339933;">;</span>&nbsp; <span style="color: black; font-style: italic;">// корректируем контрольные суммы в</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nx<span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span> <span style="color: #339933;">^=</span> a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span> <span style="color: #339933;">^</span> v2<span style="color: #339933;">;</span>&nbsp; <span style="color: black; font-style: italic;">// соответствии с восстанавливаемым байтом</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; a<span style="color: black;">&#91;</span>y<span style="color: black;">&#93;</span><span style="color: black;">&#91;</span>x<span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> v2<span style="color: #339933;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black; font-style: italic;">// восстанавливаем байт</span><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
<span style="color: black;">&#125;</span> <span style="color: black; font-style: italic;">// main</span><br/>
&nbsp;</div>
<p>Результат работы программы:</p>
<pre>
randomizing a[3][3]: 51 --> A6
randomizing a[3][2]: FC --> 11
found error in a[3][2]
trying to correct
11 -> FC
found error in a[3][3]
correcting
A6 -> 51
</pre>
<p>Может возникнуть вопрос: какими должны быть изменения, чтобы подобный метод не смог восстановить пропатченый байт?</p>
<p>В основном такими:</p>
<pre>
	00 00 00 00 00	nn	Нельзя определить, какие из указанных четырех байтов
	00 A  B  00 00	**	изменились: это могут быть A и D либо B и C,
	00 C  D  00 00	**	либо любые комбинации по 3 байта, либо все 4.
	00 00 00 00 00	nn
	00 00 00 00 00	nn

	nn ** ** nn nn
</pre>
<p>То есть такая схема подсчета контрольных сумм хорошо работает только если изменения произошли в пределах одной строки/столбца. Поэтому строки эффективно делать длиннее столбцов.</p>
<p>Если вас заинтересовало помехозащищенное кодирование - ищите линейный блоковый код, коды M из N, коды Хэмминга и тому подобную хрень.</p>
[<a style="" href="/lib/?lang=RU&amp;index=VT#vzo60">Вернуться к списку</a>] [<a href="/lib/vzo60.html#disqus_thread">Комментарии</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vzo60">de</a><a href="/lib/index.php?lang=en&amp;id=vzo60">en</a><a href="/lib/index.php?lang=es&amp;id=vzo60">es</a><a href="/lib/index.php?lang=it&amp;id=vzo60">it</a><a href="/lib/index.php?lang=fr&amp;id=vzo60">fr</a><a href="/lib/index.php?lang=pl&amp;id=vzo60">pl</a><a href="/lib/index.php?lang=ru&amp;id=vzo60">ru</a><a href="/lib/index.php?lang=ua&amp;id=vzo60">ua</a></div>
</body>
</html>
