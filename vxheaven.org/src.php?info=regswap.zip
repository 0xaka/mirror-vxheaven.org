<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Regswap - Virus for Windows by Vecna (VX heaven)</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="Author" content=""/>
<meta name="KeyWords" lang="en" content="computer virus, virus, virii,vx, компьютерные вирусы, вирус, вири"/>
<meta name="Description" content="VX Heaven site is dedicted to providing information about computer viruses (virii) and web space for virus authors and groups"/>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"047a5bcbf67431883fc9ed25fba33612",petok:"b34ab369f20f5be2531fdbfd3a8ca9e59100b33b-1498755331-1800",zone:"vxheaven.org",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=85b614c0f6/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script>
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><script type="text/rocketscript">	var s = 0;
	function soundex() {
		if (document.getElementById) {
			var snd = document.getElementById("snd");
			var frm = document.getElementById("sfrm");
			s = 1 - s;
			snd.src = "/img/sound_" + (s ? "on" : "off") + ".gif";
			frm.soundex.value = s;
		}
	}
	function do_img() {
		if (document.getElementById)
			document.write('<' + 'img id="snd" class="va" src="/img/sound_' + (s ? 'on' : 'off') + '.gif" onclick="soundex();" alt="" /' + '>');
	}</script>
<link rel="stylesheet" type="text/css" href="/style.css"/><style type="text/css">.va{vertical-align:middle;}</style>
<script type="text/rocketscript" data-rocketsrc="https://apis.google.com/js/plusone.js">{"parsetags": "explicit"}</script>
</head>
<body bgcolor="#dbc8a0" text="#302000" link="#225599" vlink="#113366">
<div class="s1">
<div style="float:right;"><a href="/src.php?tbs=1"><img src="/img/max.gif" alt="Maximize"/></a></div> <form id="lf" style="margin: 0; float: right;" method="get" action="/index.php"><input type="hidden" name="action" value="set"/><select name="lang" onchange="javascript:document.getElementById('lf').submit();"><option value="ru">Русский</option><option selected="selected" value="en">English</option><option value="ua">Українська</option><option value="de">Deutsch</option><option value="es">Español</option><option value="fr">Fran&ccedil;ais</option><option value="it">Italiano</option><option value="pl">Polski</option></select></form>
<div style="float: right;"><div id="plusone"></div></div>
<script type="text/rocketscript">gapi.plusone.render("plusone", {"size":"small","count":"true"});</script>
<div style="float: right;" class="addthis_toolbox addthis_default_style">
<script type="text/rocketscript">var addthis_config = { ui_click: true }</script>
<a style="text-decoration: none; font-size: 10pt;" href="/?action=addthis" class="addthis_button_compact">Bookmark</a>
<script type="text/rocketscript" data-rocketsrc="http://s7.addthis.com/js/250/addthis_widget.js#username=herm1t"></script>
</div>
<div style="float: right;">
<script type="text/rocketscript" data-rocketsrc="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<form action="/search.php" id="cse-search-box">
<input type="hidden" name="cx" value="002577580816726040001:z9_irkorydo"/>
<input type="hidden" name="cof" value="FORID:10"/>
<input type="hidden" name="ie" value="UTF-8"/>
<input type="text" name="q" size="12" value=" "/>
<input type="submit" name="sa" value="Search"/>
</form>
</div><h1><a href="/" style="text-decoration: none; color: #000000;">VX Heaven</a></h1>
<span class="nav"><a href="/lib/">Library</a> <a href="/vl.php">Collection</a> <a href="/src.php">Sources</a> <a href="/vx.php?id=eidx">Engines</a> <a href="/vx.php?id=tidx">Constructors</a> <a href="/vx.php?id=sidx">Simulators</a> <a href="/vx.php?id=uidx">Utilities</a> <a href="/links.php">Links</a> <a href="/donate.php" style="color: #706020" id="donate">Donate</a> <a href="/forum" style="text-decoration: underline;">Forum</a> </span><br clear="all"/>
</div>
<div class="s2"><h1>Source code of computer viruses</h1><h2>Regswap - Virus for Windows by Vecna</h2><p><em>Virus for Windows</em></p><p><strong>Vecna</strong><br/><small><a href="/src.php?author=Vecna">Show all viruses by this author</a></small></p><p>1999-01-00</p><a href="#disqus_thread">Comments</a><br/><form class="fr" method="post" action="/file.php"><input type="image" src="/img/dl.gif" alt="Download"/><input type="hidden" name="file" value="c3JjL3JlZ3N3YXAuemlw"/></form> Download regswap.zip (9321 bytes) or <a href="/src_view.php?file=regswap.zip">browse online</a><p><strong>Author's description</strong></p>
<ul>
<li>Win9x PE infector</li>
<li>Direct action</li>
<li>New infection way</li>
<li>Light Metamorphism</li>
<li>VxDCall</li>
</ul>
<p>Due popular demand, i fixed this virus, and made it fully metamorphic, using
the register exchange metamorphic technic. Altought this technic isnt so
powerful as the one i used in Miss Lexotan 6mg, they can be combined, leading
to a very efficient way of avoid detection.</p>
<p>Probably, the future of metamorphism will be a mix of this technic, together
with the Miss Lexotan one and the code permutation developed by Z0MBiE in
ZCME virus and AZCME engines. The mixing of procedures, as found in the old
BadBoy virus, can be usefull too.</p>
<p>Peoples interessed in this technic should consult also AZCME32, also for w32,
written by Z0MBiE/29A. It also change register usage, but using a more
advanced technic using a internal disassembler instead of tables.</p>
<p>A review of the features: The first one is the PE infection way, inedit, that
consist in overwriting the entrycode pointed by the entrypoint, in the code
section, and saving it, encripted, to last section, increased before. We
check before if the entrypoint isnt so close to the end of the code section,
thing that can damage our host. As the entrypoint dont change, this help very
much against heuristics.</p>
<p>The metamorphism consist in changing the register used in the whole virus
body. Procedures are processed in turn, reseting the reg equivalence table
each time, making each sub register-independent. The only fixed sequences are
the vint21h procedure, due the requeriment of vint21 about the register usage,
and the random number generator, coz i use the stack in a weird way, and is
not worth fix this anymore.</p>
<p>The classical way to set a SEH frame pointed by ESP:</p>
<pre class="source">
       sub ecx, ecx
       push dwo fs:[ecx]
       mov fs:[ecx], esp
</pre>
After be processed by the engine, can turn to:</p>
<pre class="source">
       sub esi, esi
       push dwo fs:[esi]
       mov fs:[esi], esp
</pre>
<p>And so on. All registers can be modificated.</p>
<p>The tables used by this metamorphic engine are in the following format:</p>
<pre>
   00..06  -  Register index
   07..08  -  Position of reg in instruction (xx000xxx or xxxxx000)
   09..16  -  Distance from previous reg-using instruction
</pre>
<p>Thus, each register in the virus occup 1 word in these tables. A short macro,
xchr, is provided to make table contruction more easy.</p>
<p>Ideas to improve this technic:</p>
<ul>
<li>Add a rnd value between 0..SPARE to all EBP-using instructions</li>
<li>Use the free bits at top of the distance to signal other actions. As for
example, modify ADD REG1, ? to SUB REG1, NEG ? or even MOV REG1, REG2 to
PUSH REG2 / POP REG1</li>
</ul>
<script type="text/rocketscript">var disqus_url = 'http://vxheaven.org/src.php?info=regswap.zip';</script></div><br/><div class="s2">
<div id="disqus_thread"></div>
<script type="text/rocketscript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'vxheaven'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
<div><small>By accessing, viewing, downloading or otherwise using this content you agree to be bound by the <a href="/agreement.php">Terms of Use</a>!</small> <small>vxheaven.org aka vx.netlux.org</small></div>
<div style="margin-top: 2px; float: left;" class="adsapeu">
<script type="text/rocketscript">
<!--
var _acic={dataProvider:10};(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="//www.acint.net/aci.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})()
//-->
</script>
</div>
<script data-rocketsrc="http://www.google-analytics.com/urchin.js" type="text/rocketscript"></script><script type="text/rocketscript">try { _uacct = "UA-590608-1"; urchinTracker(); } catch(err) {}</script>
<div style="display: none;"></div>
</body>
</html>
